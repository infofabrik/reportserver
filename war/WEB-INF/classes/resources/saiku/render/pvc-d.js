/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */

/*!!*/

var pvc=function(a,b){function c(){if(Fa.debug>0&&"undefined"!=typeof console)["log","info",["trace","debug"],"error","warn",["group","groupCollapsed"],"groupEnd"].forEach(function(a){a=a instanceof Array?a:[a,a],e(Fa,a[0],a[1],"[pvChart]")});else{Fa.debug>1&&(Fa.debug=1),["log","info","trace","warn","group","groupEnd"].forEach(function(b){Fa[b]=a.noop});var c="[pvChart ERROR]: ";Fa.error=function(b){throw b&&"object"==typeof b&&b.message&&(b=b.message),b=""+a.nullyTo(b,""),b.indexOf(c)<0&&(b=c+b),new Error(b)}}Fa.logError=Fa.error,b.error=Fa.error}function d(){var a=b.Behavior.tipsy;a&&a.setDebug&&(a.setDebug(Fa.debug),a.log=Fa.log)}function e(b,c,d,e){d||(d=c);var f,g=console,h=g[d]||g.log;if(h){var i=e+": %s";if(a.fun.is(h))f=h.bind(g,i);else{var j=Function.prototype.apply;f=function(){j.call(h,g,a.array.append([i],arguments))}}}b[c]=f}function f(b,c){return b?a.object.is(b)?b.abs:c?c+a.firstUpperCase(b):b:c}function g(a){a=b.color(a);var c=a.r,d=a.g,e=a.b,f=(c+d+e)/3,g=2;return Math.abs(c-f)<=g&&Math.abs(d-f)<=g&&Math.abs(e-f)<=g}function h(b){b||a.fail.argumentRequired("keyArgs");var c=b.type||a.fail.argumentRequired("keyArgs.type");switch(c){case"linear":return new Fa.color.LinearScalesBuild(b).buildMap();case"discrete":return new Fa.color.DiscreteScalesBuild(b).buildMap();case"normal":return new Fa.color.NormalScalesBuild(b).buildMap()}throw a.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[c])}function i(b){b||a.fail.argumentRequired("keyArgs");var c=b.type||a.fail.argumentRequired("keyArgs.type");switch(c){case"linear":return new Fa.color.LinearScalesBuild(b).build();case"discrete":return new Fa.color.DiscreteScalesBuild(b).build();case"normal":return new Fa.color.NormalScalesBuild(b).build()}throw a.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[c])}function j(b,c){function d(a){return m[a].resolve()}function e(a,b){var c=d(a);return b&&!c.isSpecified?void 0:c.value}function f(a){return d(a).isSpecified}function g(a){return e(a,!0)}function h(b){return a.hasOwn(m,b)}function i(a){return l(a,!1)}function j(a){return l(a,!0)}function k(a){return d(a)._dv}function l(b,c){for(var d in b){var f=a.hasOwnProp.call(m,d)&&m[d];if(f){var g=b[d];void 0!==g&&f.set(g,c)}}return e}b||a.fail.argumentRequired("specs");var m={};return a.each(b,function(a,b){var d=new Oa(b,e,c,a);m[d.name]=d}),e.option=e,e.specified=g,e.defaultValue=k,e.isSpecified=f,e.isDefined=h,e.specify=i,e.defaults=j,e}function k(a){return function(b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if("string"==typeof e&&(e=this[e]),e.call(this,b)===!0)return!0}}}function l(a){return function(b){return b.specify(a),!0}}function m(a){return function(b){var c=a.call(this,b);if(void 0!==c)return b.specify(c),!0}}function n(a){return function(b){var c=a.call(this,b);if(void 0!==c)return b.defaultValue(c),!0}}function o(a,b){var c=a&&a.length;if(c){for(var d=0;c>d;d++){var e=a[d];b&&(e[b]=null),e.dispose()}a.length=0}}function p(a,b,c,d,e){c[d]=a;var f=a[b]||(a[b]=[]);null==e||e>=f.length?f.push(c):f.splice(e,0,c)}function q(b,c,d,e){var f=b[c];if(f){var g=f.indexOf(d);g>=0&&a.array.removeAt(f,g)}d[e]=null}function r(a){this.playedVisualRoles.set(a.name,a),t.call(this.complexType,this)}function s(a){this.playedVisualRoles.rem(a.name),t.call(this.complexType,this)}function t(){this._isPctRoleDimTypeMap=null}function u(b,c){function d(){var d={},f=a.query(e.source).select(function(a){c(a,d);var b=d.series;return null!=b&&null!=b.v&&(b=b.v),b||null}).distinct().array();return e._createPlot2SeriesKeySet(b,f)}var e=this;return this._dataPartGet(d,c)}function v(a,b){return a.id-b.id}function w(a,b){return b.id-a.id}function x(){delete this.isSelected}function y(a){return a.isNull||a.isSelected}function z(a){return a.isSelected===!0}function A(a){return a.isSelected===!1}function B(a){return a.isVisible===!0}function C(a){return a.isVisible===!1}function D(a){return a.isNull===!0}function E(a){return a.isNull===!1}function F(b,c,d,e,f,g){var h;if(this.owner===this){if(null==f){var i=b._formatter;f=i?i(e,c):e}f=""+f,!f&&Fa.debug>=2&&Fa.log("Only the null value should have an empty label."),h=new Fa.data.Atom(this,e,f,c,d),g&&(h.isVirtual=!0)}else{var j=this.parent||this.linkParent;h=j._atomsByKey[d]||F.call(j,b,c,d,e,f,g)}return a.array.insert(this._atoms,h,this._atomComparer),M.call(this),this._atomsByKey[d]=h,h}function G(b){var c=b.key,d=this;if(b.dimension===d)return d.owner===d||a.assert("Should be an owner dimension"),c||b!==d._virtualNullAtom||(b=d.intern(null)),b;var e=!d._lazyInit;if(e){var f=d._atomsByKey[c];if(f){if(f!==b)throw a.error.operationInvalid("Atom is from a different root data.");return b}if(d.owner===d)throw a.error.operationInvalid("Atom is from a different root data.")}return G.call(d.parent||d.linkParent,b),e&&(d._atomsByKey[c]=b,c?a.array.insert(d._atoms,b,d._atomComparer):(d._nullAtom=b,d._atoms.unshift(b)),M.call(d)),b}function H(b){var c=a.get(b,"visible"),d=a.get(b,"selected");return(null==c?null:!!c)+":"+(null==d?null:!!d)}function I(a){var b=this._nullAtom;if(!b){if(this.owner===this){var c=this.type._formatter,d=""+(c?c.call(null,null,a):"");b=new Fa.data.Atom(this,null,d,null,""),this.data._atomsBase[this.name]=b}else b=I.call(this.parent||this.linkParent,a);this._atomsByKey[""]=this._nullAtom=b,this._atoms.unshift(b)}return b}function J(){return this.owner===this||a.assert("Can only create atoms on an owner dimension."),this._virtualNullAtom||(this._virtualNullAtom=new Fa.data.Atom(this,null,"",null,""),this.data._atomsBase[this.name]=this._virtualNullAtom),this._virtualNullAtom}function K(){this.owner===this||a.assert("Can only unintern atoms of an owner dimension.");var b=this._atoms;if(b){for(var c=this._atomsByKey,d=0,e=b.length;e>d;){var f=b[d];if(f.visited)delete f.visited,d++;else if(f!==this._virtualNullAtom){b.splice(d,1),e--;var g=f.key;delete c[g],g||(delete this._nullAtom,this.data._atomsBase[this.name]=this._virtualNullAtom)}}M.call(this)}}function L(){var b=this._atoms;if(b){for(var c,d=this._atomsByKey,e=0,f=b.length;f>e;){var g=b[e];if(g.isVirtual){b.splice(e,1),f--,c=!0;var h=g.key||a.assert("Cannot be the null or virtual null atom.");delete d[h]}else e++}c&&M.call(this)}}function M(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null}function N(a){p(this,"childNodes",a,"parent"),a.owner=this.owner}function O(a){p(this,"_linkChildren",a,"linkParent"),a.owner=this.owner}function P(b,c){var d;if(!this._disposed&&(d=this._atomVisibleDatumsCount)){var e=b.atoms[this.name],f=e.key;a.hasOwn(this._atomsByKey,f)||a.assert("Atom must exist in this dimension.");var g=d[f];c||g>0||a.assert("Must have had accounted for at least one visible datum."),d[f]=(g||0)+(c?1:-1),this._visibleAtoms=this._sumCache=this._visibleIndexes=null}}function Q(){var a=this._atomVisibleDatumsCount;return a||(a={},this.data.datums(null,{visible:!0}).each(function(b){var c=b.atoms[this.name],d=c.key;a[d]=(a[d]||0)+1},this),this._atomVisibleDatumsCount=a),a}function R(a){var b=[];return this._atoms.forEach(function(c,d){this.isVisible(c)===a&&b.push(d)},this),b}function S(b){return a.query(this._atoms).where(function(a){return this.isVisible(a)===b},this).array()}function T(b,c){this.insertAt(b,c),a.lazy(this,"_childrenByKey")[b.key]=b}function U(a,b){p(this,"_linkChildren",a,"linkParent",b)}function V(a){q(this,"_linkChildren",a,"linkParent")}function W(){o(this.childNodes,"parent"),this._childrenByKey=null,o(this._linkChildren,"linkParent"),this._groupByCache=null,this._sumAbsCache=null}function X(){this.isOwner()||a.fail("Can only be called on the owner data.")}function Y(b,c){!b.isNull||a.assert("Null datums do not notify selected changes"),c?this._selectedNotNullDatums.set(b.id,b):this._selectedNotNullDatums.rem(b.id),this._sumAbsCache=null}function Z(b,c){var d=b.id,e=this,f=a.hasOwnProp;if(f.call(e._datumsById,d)){!b.isNull||a.assert("Null datums do not notify visible changes"),c?e._visibleNotNullDatums.set(d,b):e._visibleNotNullDatums.rem(d),e._sumAbsCache=null;for(var g=e._dimensionsList,h=0,i=g.length;i>h;)P.call(g[h++],b,c);for(g=e.childNodes,h=0,i=g.length;i>h;)Z.call(g[h++],b,c);if(g=e._linkChildren,g&&(i=g.length))for(h=0;i>h;)Z.call(g[h++],b,c)}}function _(b,c){return a.string.is(b)||a.fail.argumentInvalid("groupLevelText","Invalid grouping specification."),a.query(b.split(/\s*\|\s*/)).where(a.truthy).select(function(b){var d=Sa.exec(b)||a.fail.argumentInvalid("groupLevelText","Invalid grouping level syntax '{0}'.",[b]),e=d[1],f=(d[2]||"").toLowerCase(),g="desc"===f;return new Fa.data.GroupingDimensionSpec(e,g,c)})}function aa(b,c){function d(b){if(b){var c=b.key;if(!a.hasOwnProp.call(q,c)){!j&&g&&a.hasOwnProp.call(g,c)&&(b=g[c]);var d=b.id;p.push(b),q[c]=b,r[d]=b,o&&o.push(b),ba.call(this,b,k,i),b.isNull||(m&&b.isSelected&&m.set(d,b),b.isVisible&&l.set(d,b))}}}b||a.fail.argumentRequired("addDatums");var e,f,g,h,i=a.get(c,"doAtomGC",!1),j=a.get(c,"isAdditive",!1),k=!!this._dimensions,l=this._visibleNotNullDatums,m=this._selectedNotNullDatums,n=this._datums;n?(g=this._datumsByKey,h=this._datumsById,j&&i&&n.forEach(function(a){ba.call(this,a,!1,!0)},this)):j=!1;var o,p,q,r;if(j?(o=[],p=n,r=h,q=g,this._sumAbsCache=null):(this._datums=p=[],this._datumsById=r={},this._datumsByKey=q={},n&&(W.call(this),l.clear(),m&&m.clear())),a.array.is(b))for(e=0,f=b.length;f>e;)d.call(this,b[e++]);else{if(!(b instanceof a.Query))throw a.error.argumentInvalid("addDatums","Argument is of invalid type.");b.each(d,this)}if(i){var s=this._dimensionsList;for(e=0,f=s.length;f>e;)K.call(s[e++])}if(j){var t=this._linkChildren;if(t)for(e=0,f=t.length;f>e;)ca.call(t[e++],o)}}function ba(a,b,c){var d=this._dimensionsList;if(d||(b=!1),b||c){var e,f,g,h=a.atoms,i=0;if(d)for(e=d.length;e>i;)g=d[i++],f=h[g.name],f&&(b&&G.call(g,f),c&&(f.visited=!0));else{var j=this.type.dimensionsNames();for(e=j.length;e>i;)f=h[j[i++]],f&&(f.visited=!0)}}}function ca(b){b||a.fail.argumentRequired("newDatums");var c=this._groupOper;if(c)b=c.executeAdd(this,b);else{var d=this._wherePred;d&&(b=b.filter(d)),da.call(this,b)}var e=this._linkChildren,f=e&&e.length;if(f)for(var g=0;f>g;g++)ca.call(e[g],b)}function da(a){var b=this;b._sumAbsCache=null;for(var c=b._datums,d=b._visibleNotNullDatums,e=b._selectedNotNullDatums,f=b._datumsById,g=0,h=a.length;h>g;g++){var i=a[g],j=i.id;f[j]=i,ba.call(b,i,!0,!1),i.isNull||(e&&i.isSelected&&e.set(j,i),i.isVisible&&d.set(j,i)),c.push(i)}}function ea(b){function c(b){if(null!=b){"object"==typeof b||a.fail.invalidArgument("datumFilter");var c={},e=!1;for(var f in b){var g=this.dimensions(f).getDistinctAtoms(a.array.as(b[f]));g.length&&(e=!0,c[f]=g)}e&&d.push(c)}}var d=[];return b=a.array.as(b),b&&b.forEach(c,this),d}function fa(b,c){var d=a.get(c,"visible"),e=a.get(c,"isNull"),f=a.get(c,"selected"),g=a.get(c,"where");return null!=d&&(b=b.where(d?B:C)),null!=e&&(b=b.where(e?D:E)),null!=f&&(b=b.where(f?z:A)),g&&(b=b.where(g)),b}function ga(b,c){var d=a.get(c,"visible"),e=a.get(c,"isNull"),f=a.get(c,"selected"),g=a.get(c,"where"),h=[];null!=d&&h.unshift(d?B:C),null!=e&&h.unshift(e?D:E),null!=f&&h.unshift(f?z:A),g&&h.unshift(g),b&&h.unshift(ha(b));var i=h.length;if(i){if(1===i)return h[0];var j=function(a){for(var b=i;b;)if(!h[--b](a))return!1;return!0};return j}}function ha(a){function b(b){for(var e=b.atoms,f=0;d>f;f++)if(c(e,a[f]))return!0;return!1}function c(a,b){for(var c in b)if(b[c].indexOf(a[c])<0)return!1;return!0}var d=a.length;return b}function ia(b,c){var d=a.array.as(a.get(c,"orderBy")),e=a.create(c||{},{orderBy:null}),f=a.query(b).selectMany(function(a,b){return d&&(e.orderBy=d[b]),ja.call(this,a,e)},this);return f.distinct(a.propGet("id"))}function ja(b,c){var d=c.orderBy;if(d){if(d.indexOf("|")>=0)throw a.error.argumentInvalid("keyArgs.orderBy","Multi-dimension order by is not supported.")}else d=Object.keys(b).sort().join(",");var e=this.groupBy(d,c),f=e.treeHeight,g=[];return a.query(function(){var c;if(this._data){if(this._datumsQuery){if(this._data||a.assert("Must have a current data"),g.length||a.assert("Must have a parent data"),!this._dimAtomsOrQuery||a.assert(),this._datumsQuery.next())return this.item=this._datumsQuery.item,1;this._datumsQuery=null,c=g.pop(),this._data=c.data,this._dimAtomsOrQuery=c.dimAtomsOrQuery}}else this._data=e,this._dimAtomsOrQuery=a.query(b[e._groupLevelSpec.dimensions[0].name]);this._dimAtomsOrQuery||a.assert("Invalid programmer"),this._data||a.assert("Must have a current data");for(var d=g.length;;){for(;this._dimAtomsOrQuery.next();){var h=this._dimAtomsOrQuery.item,i=this._data.child(h.key);if(i&&(f-1>d||i._datums.length)){if(g.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery}),this._data=i,!(f-1>d))return this._dimAtomsOrQuery=null,this._datumsQuery=a.query(i._datums),this._datumsQuery.next(),this.item=this._datumsQuery.item,1;this._dimAtomsOrQuery=a.query(b[i._groupLevelSpec.dimensions[0].name]),d++}}if(!d)return 0;c=g.pop(),this._data=c.data,this._dimAtomsOrQuery=c.dimAtomsOrQuery,d--}return 0})}function ka(a){this._renderId!==a&&(this._renderId=a,this.renderState={})}function la(a){var b;a&&(b=a.ownerScene)&&(a=b);var c=this._active;return c!==a&&(c&&ma.call(c,!1),this._active=c=a||null,c&&ma.call(c,!0),!0)}function ma(a){this.isActive!==a&&(a?this.isActive=!0:delete this.isActive)}function na(a,b){return function(){var c=this.vars[a];return void 0===c&&(c=this[b](),void 0===c&&(c=null),this.vars[a]=c),c}}function oa(a,c){if(this.event=b.event,this.pvMark=a,a){var d=this.sign=a.sign||null;!c&&d&&(c=d.scene()),c?this.index=c.childIndex():(this.index=null,c=new Fa.visual.Scene(null,{panel:this.panel}))}else this.sign=null,this.index=null,c=new Fa.visual.Scene(null,{panel:this.panel,source:this.chart.root.data});this.scene=c}function pa(b){var c=qa(b)||a.assert("There must exist an ancestor sign");return new Fa.visual.BasicSign(c.panel,b)}function qa(a){var b;do a=a.parent;while(!(!a||(b=a.sign)||a.proto&&(b=a.proto.sign)));return b}function ra(a){return a.isDiscrete()?"discrete":a.firstDimensionValueType()===Date?"timeSeries":"numeric"}function sa(a,b){return Fa.parseDomainScope(a,b.orientation)}function ta(b){if(b){if(a.hasOwn(Ja.namesSet,b)){var c=Fa.BasePanel["y"===this.orientation?"horizontalAlign":"verticalAlign2"];return c[b]}Fa.debug>=2&&Fa.log(a.format("Invalid axis position value '{0}'.",[b]))}return"x"===this.orientation?"bottom":"left"}function ua(a){var b=this.option("Position");return Ma.toOrtho(a,b)}function va(a){var b=this.option("Position");return Ma.to(a,{singleProp:Fa.BasePanel.orthogonalLength[b]})}function wa(c){var d;if(c){var e;a.eachOwn(c,function(a,d){e=!0,c[d]=b.color(a)}),e&&(d=c)}return d}function xa(){var a,c=this.scaleType;if(c)if("discrete"===c)if(0===this.index)a=Fa.createColorScheme();else{var d=this;a=function(){return d.chart._getRoleColorScale(d.role.name)}}else cb||(cb=["red","yellow","green"].map(b.color)),a=cb.slice();else a=Fa.createColorScheme();return a}function ya(b){if(!a.object.is(b)){var c=this.option("Position");b=(new Ma).setSize(b,{singleProp:Fa.BasePanel.orthogonalLength[c]})}return b}function za(a){var b=this.option("Position");return Fa.parseAlign(b,a)}function Aa(a){return(new Ma).setSize(a,{singleProp:"width"})}function Ba(a){return a.dataPartValue}function Ca(a){if("trend"===this.name)return null;var b=this.option("TrendType");if(!b&&a&&(b=a.type),!b||"none"===b)return null;a=a?Object.create(a):{};var c=Fa.trends.get(b);a.info=c,a.type=b;var d=this.option("TrendLabel");return a.label=null!=d?String(d):c.dataPartAtom.f,a}function Da(a,b){return{resolveV1:function(c){if(0===this.globalIndex)return this._specifyChartOption(c,"show"+a)||c.defaultValue(b),!0}}}function Ea(a){return{resolveV1:function(b){return this._specifyChartOption(b,"show"+a),!0}}}Array.prototype.every||(Array.prototype.every=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;c>e;e++)if(e in b&&!a.call(d,b[e],e,b))return!1;return!0});var Fa=a.globalSpace("pvc",{debug:0});!function(){if("undefined"!=typeof window&&window.location){var a=function(a){return a&&/\bdebug=true\b/.test(a)?a:null},b=a(window.location.href);if(!b)try{b=a(window.top.location.href)}catch(a){}if(b){var c=/\bdebugLevel=(\d+)/.exec(b);Fa.debug=c?+c[1]:3}}}();var Ga=b.Mark;Fa.invisibleFill="rgba(127,127,127,0.00001)",Fa.logSeparator="------------------------------------------";var Ha=Array.prototype.slice;Fa.setDebug=function(a){return a=+a,Fa.debug=isNaN(a)?0:a,c(),d(),Fa.debug},Fa.setDebug(Fa.debug),Fa.defaultCompatVersion=function(a){var b=Fa.BaseChart.prototype.defaults;return null!=a?b.compatVersion=a:b.compatVersion},Fa.cloneMatrix=function(a){return a.map(function(a){return a.slice()})},Fa.normAngle=b.Shape.normalizeAngle,Fa.stringify=function(b,c){var d=a.get(c,"maxLevel")||5,e=[];return Fa.stringifyRecursive(e,b,d,c),e.join("")},Fa.stringifyRecursive=function(b,c,d,e){if(d>0){switch(d--,typeof c){case"undefined":return b.push("undefined");case"object":if(!c)return b.push("null"),!0;if(a.fun.is(c.stringify))return c.stringify(b,d,e);if(c instanceof Array)b.push("["),c.forEach(function(a,c){c&&b.push(", "),Fa.stringifyRecursive(b,a,d,e)||b.pop()}),b.push("]");else{var f=a.get(e,"ownOnly",!0);if(c===a.global)return b.push("<window>"),!0;if(a.fun.is(c.cloneNode))return b.push("<dom #"+(c.id||c.name||"?")+">"),!0;d>1&&c.constructor!==Object&&(d=1,f=!0),b.push("{");var g=!0;for(var h in c)f&&!a.hasOwnProp.call(c,h)||(g||b.push(", "),b.push(h+": "),Fa.stringifyRecursive(b,c[h],d,e)?g&&(g=!1):(b.pop(),g||b.pop()));if(g){var i=""+c;"[object Object]"!==i&&b.push("{"+i+"}")}b.push("}")}return!0;case"number":return b.push(""+Math.round(1e5*c)/1e5),!0;case"boolean":return b.push(""+c),!0;case"string":return b.push(JSON.stringify(c)),!0;case"function":return!!a.get(e,"funs",!1)&&(b.push(JSON.stringify(c.toString().substr(0,13)+"...")),!0)}return b.push("'new ???'"),!0}},Fa.orientation={vertical:"vertical",horizontal:"horizontal"},Fa.extensionTag="extension",Fa.extendType=function(b,c,d){if(c){var e,f=b.prototype._vars,g=function(b,c){void 0!==b&&(e||(e={}),f&&f[c]&&(c="_"+c+"EvalCore"),e[c]=a.fun.to(b))};d?d.forEach(function(a){g(c[a],a)}):a.each(g),e&&b.add(e)}},b.Color.prototype.stringify=function(a,b,c){return Fa.stringifyRecursive(a,this.key,b,c)},Ga.prototype.hasDelegateValue=function(a,b){var c=this.$propertiesMap[a];return c?!b||c.tag===b:!!this.proto&&this.proto.hasDelegateValue(a,b)},Fa.defaultColorScheme=null,Fa.brighterColorTransform=function(a){return(a.rgb?a:b.color(a)).brighter(.6)},Fa.setDefaultColorScheme=function(a){return Fa.defaultColorScheme=Fa.colorScheme(a)},Fa.defaultColor=b.Colors.category10()("?"),Fa.colorScheme=function(c){if(null==c)return null;if("function"==typeof c){if(!c.hasOwnProperty("range"))return c;c=c.range()}else c=a.array.as(c);return c.length?function(){var a=b.colors(c);return a.domain.apply(a,arguments),a}:null},Fa.createColorScheme=function(a){return Fa.colorScheme(a)||Fa.defaultColorScheme||b.Colors.category10},Fa.toGrayScale=function(a,c,d,e){a=b.color(a);var f=.299*a.r+.587*a.g+.114*a.b;void 0===d?d=200:null==d&&(d=255),void 0===e?e=30:null==e&&(e=0);var g=d-e;return f=0>=g?d:e+f/255*g,null==c?c=a.opacity:0>c&&(c=-c*a.opacity),f=Math.round(f),b.rgb(f,f,f,c)},Fa.removeTipsyLegends=function(){try{$(".tipsy").remove()}catch(a){}},Fa.createDateComparer=function(a,c){return c||(c=b.identity),function(b,d){return a.parse(c(b))-a.parse(c(d))}},Fa.time={intervals:{y:31536e6,m:2592e6,d30:2592e6,w:6048e5,d7:6048e5,d:864e5,h:36e5,M:6e4,s:1e3,ms:1},withoutTime:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},weekday:{previousOrSelf:function(a,b){var c=a.getDay(),d=c-b;if(d){var e=0>d?7+d:d;a=new Date(a-e*Fa.time.intervals.d)}return a},nextOrSelf:function(a,b){var c=a.getDay(),d=c-b;if(d){var e=d>0?7-d:-d;a=new Date(a+e*Fa.time.intervals.d)}return a},closestOrSelf:function(a,b){var c=a.getDay(),d=c-b;if(d){var e=Fa.time.intervals.d,f=d>0?1:-1;d=Math.abs(d),a=new Date(d>=4?a.getTime()+f*(7-d)*e:a.getTime()-f*d*e)}return a}}},b.Format.createParser=function(b){function c(c){return c instanceof Date?c:a.number.is(c)?new Date(c):b.parse(c)}return c},b.Format.createFormatter=function(a){function b(b){return null!=b?a.format(b):""}return b},Fa.buildTitleFromName=function(b){return a.firstUpperCase(b).replace(/([a-z\d])([A-Z])/,"$1 $2")},Fa.buildIndexedId=function(a,b){return b>0?a+""+(b+1):a},Fa.splitIndexedId=function(a){var b=/^(.*?)(\d*)$/.exec(a),c=null;return b[2]&&(c=Number(b[2]),1>=c?c=1:c--),[b[1],c]};var Ia=[null];Fa.makeExtensionAbsId=function(b,c){if(!b)return c;var d=[];c=a.array.to(c)||Ia,b=a.array.to(b);for(var e=0,g=c.length;g>e;e++)for(var h=0,i=b.length;i>h;h++){var j=f(b[h],c[e]);j&&d.push(j)}return d},Fa.makeEnumParser=function(b,c,d){if(a.array.is(c)){var e={};c.forEach(function(a){a&&(e[a.toLowerCase()]=a)}),c=function(b){return a.hasOwn(e,b)}}return d&&(d=d.toLowerCase()),function(a){return a&&(a=(""+a).toLowerCase()),c(a)||(a&&Fa.debug>=2&&Fa.warn("Invalid '"+b+"' value: '"+a+"'. Assuming '"+d+"'."),a=d),a}},Fa.parseDistinctIndexArray=function(b,c,d){if(b=a.array.as(b),null==b)return null;null==c&&(c=0),null==d&&(d=1/0);var e=a.query(b).select(function(a){return+a}).where(function(a){return!isNaN(a)&&a>=c&&d>=a}).distinct().array();return e.length?e:null},Fa.parseValuesOverflow=Fa.makeEnumParser("valuesOverflow",["show","trim","hide"],"hide"),Fa.parseMultiChartOverflow=Fa.makeEnumParser("multiChartOverflow",["grow","fit","clip"],"grow"),Fa.parseLegendClickMode=Fa.makeEnumParser("legendClickMode",["toggleSelected","toggleVisible","none"],"toggleVisible"),Fa.parseTooltipAutoContent=Fa.makeEnumParser("tooltipAutoContent",["summary","value"],"value"),Fa.parseSelectionMode=Fa.makeEnumParser("selectionMode",["rubberBand","focusWindow"],"rubberBand"),Fa.parseClearSelectionMode=Fa.makeEnumParser("clearSelectionMode",["emptySpaceClick","manual"],"emptySpaceClick"),Fa.parseSunburstSliceOrder=Fa.makeEnumParser("sliceOrder",["bySizeAscending","bySizeDescending","none"],"bySizeDescending"),Fa.parseShape=Fa.makeEnumParser("shape",b.Scene.hasSymbol,null),Fa.parseTreemapColorMode=Fa.makeEnumParser("colorMode",["byParent","bySelf"],"byParent"),Fa.parseTreemapLayoutMode=Fa.makeEnumParser("layoutMode",["squarify","slice-and-dice","slice","dice"],"squarify"),Fa.parseContinuousColorScaleType=function(a){if(a)switch(a=(""+a).toLowerCase()){case"linear":case"normal":case"discrete":break;default:Fa.debug>=2&&Fa.log("[Warning] Invalid 'ScaleType' option value: '"+a+"'."),a=null}return a},Fa.parseDomainScope=function(b,c){if(b)switch(b=(""+b).toLowerCase()){case"cell":case"global":break;case"section":if(!c)throw a.error.argumentRequired("orientation");b="y"===c?"row":"column";break;case"column":case"row":c&&c!==("row"===b?"y":"x")&&(b="section",Fa.debug>=2&&Fa.log("[Warning] Invalid 'DomainScope' option value: '"+b+"' for the orientation: '"+c+"'."));break;default:Fa.debug>=2&&Fa.log("[Warning] Invalid 'DomainScope' option value: '"+b+"'."),b=null}return b},Fa.parseDomainRoundingMode=function(a){if(a)switch(a=(""+a).toLowerCase()){case"none":case"nice":case"tick":break;default:Fa.debug>=2&&Fa.log("[Warning] Invalid 'DomainRoundMode' value: '"+a+"'."),a=null}return a},Fa.parseOverlappedLabelsMode=function(a){if(a)switch(a=(""+a).toLowerCase()){case"leave":case"hide":case"rotatethenhide":break;default:Fa.debug>=2&&Fa.log("[Warning] Invalid 'OverlappedLabelsMode' option value: '"+a+"'."),a=null}return a},Fa.castNumber=function(a){return null!=a&&(a=+a,isNaN(a)&&(a=null)),a},Fa.castPositiveNumber=function(a){return a=Fa.castNumber(a),null==a||a>0||(a=null),a},Fa.castNonNegativeNumber=function(a){return a=Fa.castNumber(a),null!=a&&0>a&&(a=null),a},Fa.parseWaterDirection=function(a){if(a){switch(a=(""+a).toLowerCase()){case"up":case"down":return a}Fa.debug>=2&&Fa.log("[Warning] Invalid 'WaterDirection' value: '"+a+"'.")}},Fa.parseTrendType=function(a){if(a){if(a=(""+a).toLowerCase(),"none"===a)return a;if(Fa.trends.has(a))return a;Fa.debug>=2&&Fa.log("[Warning] Invalid 'TrendType' value: '"+a+"'.")}},Fa.parseNullInterpolationMode=function(a){if(a){switch(a=(""+a).toLowerCase()){case"none":case"linear":case"zero":return a}Fa.debug>=2&&Fa.log("[Warning] Invalid 'NullInterpolationMode' value: '"+a+"'.")}},Fa.parseAlign=function(b,c){c&&(c=(""+c).toLowerCase());var d,e;return"left"===b||"right"===b?(d=c&&Fa.BasePanel.verticalAlign[c],d||(d="middle",e=!!c)):(d=c&&Fa.BasePanel.horizontalAlign[c],d||(d="center",e=!!c)),e&&Fa.debug>=2&&Fa.log(a.format("Invalid alignment value '{0}'. Assuming '{1}'.",[c,d])),d},Fa.parseAnchor=function(b){if(b){switch(b=(""+b).toLowerCase()){case"top":case"left":case"center":case"bottom":case"right":return b}Fa.debug>=2&&Fa.log(a.format("Invalid anchor value '{0}'.",[b]))}},Fa.parseAnchorWedge=function(b){if(b){switch(b=(""+b).toLowerCase()){case"outer":case"inner":case"center":case"start":case"end":return b}Fa.debug>=2&&Fa.log(a.format("Invalid wedge anchor value '{0}'.",[b]))}},Fa.unionExtents=function(a,b){if(a)b&&(b.min<a.min&&(a.min=b.min),b.max>a.max&&(a.max=b.max));else{if(!b)return null;a={min:b.min,max:b.max}}return a};var Ja=Fa.Sides=function(a){null!=a&&this.setSides(a)};Ja.hnames="left right".split(" "),Ja.vnames="top bottom".split(" "),Ja.names="left right top bottom".split(" "),Ja.namesSet=b.dict(Ja.names,a.retTrue),Fa.parsePosition=function(b,c){if(b&&(b=(""+b).toLowerCase(),!a.hasOwn(Ja.namesSet,b))){var d=c||"left";Fa.debug>=2&&Fa.log(a.format("Invalid position value '{0}. Assuming '{1}'.",[b,d])),b=d}return b||c||"left"},Ja.as=function(a){return null==a||a instanceof Ja||(a=(new Ja).setSides(a)),a},Ja.to=function(a){return null!=a&&a instanceof Ja||(a=(new Ja).setSides(a)),a},Ja.prototype.stringify=function(b,c,d){return Fa.stringifyRecursive(b,a.copyOwn(this),c,d)},Ja.prototype.setSides=function(a){if("string"==typeof a){var b=a.split(/\s+/).map(function(a){return Ka.parse(a)});switch(b.length){case 1:return this.set("all",b[0]),this;case 2:return this.set("top",b[0]),this.set("left",b[1]),this.set("right",b[1]),this.set("bottom",b[0]),this;case 3:return this.set("top",b[0]),this.set("left",b[1]),this.set("right",b[1]),this.set("bottom",b[2]),this;case 4:return this.set("top",b[0]),this.set("right",b[1]),this.set("bottom",b[2]),this.set("left",b[3]),this;case 0:return this}}else{if("number"==typeof a)return this.set("all",a),this;if("object"==typeof a){if(a instanceof Ka)this.set("all",a);else{this.set("all",a.all),this.set("width",a.width),this.set("height",a.height);for(var c in a)Ja.namesSet.hasOwnProperty(c)&&this.set(c,a[c])}return this}}return Fa.debug&&Fa.log("Invalid 'sides' value: "+Fa.stringify(a)),this},Ja.prototype.set=function(b,c){if(c=Ka.parse(c),null!=c)switch(b){case"all":Ja.names.forEach(function(a){this[a]=c},this);break;case"width":this.left=this.right=Ka.divide(c,2);break;case"height":this.top=this.bottom=Ka.divide(c,2);break;default:a.hasOwn(Ja.namesSet,b)&&(this[b]=c)}},Ja.prototype.resolve=function(a,b){"object"==typeof a&&(b=a.height,a=a.width);var c={};return Ja.names.forEach(function(d){var e=0,f=this[d];null!=f&&(e="number"==typeof f?f:f.resolve("left"===d||"right"===d?a:b)),c[d]=e},this),Ja.updateSize(c)},Ja.updateSize=function(a){return a.width=(a.left||0)+(a.right||0),a.height=(a.bottom||0)+(a.top||0),a},Ja.resolvedMax=function(a,b){var c={};return Ja.names.forEach(function(d){c[d]=Math.max(a[d]||0,b[d]||0)}),c},Ja.inflate=function(a,b){var c={};return Ja.names.forEach(function(d){c[d]=(a[d]||0)+b}),Ja.updateSize(c)};var Ka=Fa.PercentValue=function(a){this.percent=a};Ka.prototype.resolve=function(a){return this.percent*a},Ka.prototype.divide=function(a){return new Ka(this.percent/a)},Ka.divide=function(a,b){return a instanceof Ka?a.divide(b):a/b},Ka.parse=function(b){if(null!=b&&""!==b){switch(typeof b){case"number":return b;case"string":var c=b.match(/^(.+?)\s*(%)?$/);if(c){var d=+c[1];if(!isNaN(d)){if(!c[2])return d;if(d>=0)return new Ka(d/100)}}break;case"object":if(b instanceof Ka)return b}Fa.debug&&Fa.log(a.format("Invalid margins component '{0}'",[""+b]))}},Ka.resolve=function(a,b){return a instanceof Ka?a.resolve(b):a};var La=Ga.prototype.zOrder;Ga.prototype.zOrder=function(a){var b=this.borderPanel;return b&&b!==this?La.call(b,a):La.call(this,a)},Ga.prototype.wrapper=function(a){return this._wrapper=a,this},Ga.prototype.wrap=function(b,c){return b&&a.fun.is(b)&&this._wrapper&&!b._cccWrapped&&(b=this._wrapper(b,c),b._cccWrapped=!0),b},b.Mark.prototype.call=function(a){a.call(this,this)},Ga.prototype.lock=function(a,b){return void 0!==b&&this[a](b),(this._locked||(this._locked={}))[a]=!0,this},Ga.prototype.isIntercepted=function(a){return this._intercepted&&this._intercepted[a]},Ga.prototype.isLocked=function(a){return this._locked&&this._locked[a]},Ga.prototype.ensureEvents=function(a){var b=this.propertyValue("events",!0);return b&&"none"!==b||this.events(a||"all"),this},Ga.prototype.addMargin=function(c,d){if(0!==d){var e=a.nullyTo(this.propertyValue(c),0),f=b.functor(e);this[c](function(){return d+f.apply(this,Ha.call(arguments))})}return this},Ga.prototype.addMargins=function(b){var c=a.get(b,"all",0);return this.addMargin("left",a.get(b,"left",c)),this.addMargin("right",a.get(b,"right",c)),this.addMargin("top",a.get(b,"top",c)),this.addMargin("bottom",a.get(b,"bottom",c)),this},Ga.prototype.eachInstanceWithData=function(a,b){this.eachInstance(function(c,d,e){c.mark.sign&&c[d].data&&a.call(b,c,d,e)})},Ga.prototype.eachSceneWithDataOnRect=function(a,b,c,d){function e(d,e){if(d.intersectsRect(a)){var f=e.data;f&&f.datum&&b.call(c,f)}}var f=this,g=f.sign;if(!g||g.selectable()){null==d&&(d=f.rubberBandSelectionMode||"partial");var h="center"===d;f.eachInstanceWithData(function(a,b,c){var d=f.getShape(a,b,.15);d=(h?d.center():d).apply(c),e(d,a[b],b)})}},Ga.prototype.eachDatumOnRect=function(a,b,c,d){function e(d,e){if(d.intersectsRect(a)){var f=e.data;f&&f.datum&&f.datums().each(function(a){a.isNull||b.call(c,a)})}}var f=this,g=f.sign;if(!g||g.selectable()){null==d&&(d=f.rubberBandSelectionMode||"partial");var h="center"===d;f.eachInstanceWithData(function(a,b,c){var d=f.getShape(a,b,.15);d=(h?d.center():d).apply(c),e(d,a[b],b)})}},b.Transform.prototype.transformHPosition=function(a){return this.x+this.k*a},b.Transform.prototype.transformVPosition=function(a){return this.y+this.k*a},b.Transform.prototype.transformLength=function(a){return this.k*a};var Ma=a.type("pvc.Size").init(function(a,b){1===arguments.length?null!=a&&this.setSize(a):(null!=a&&(this.width=a),null!=b&&(this.height=b))}).add({stringify:function(b,c,d){return Fa.stringifyRecursive(b,a.copyOwn(this),c,d)},setSize:function(b,c){if("string"==typeof b){var d=b.split(/\s+/).map(function(a){return Ka.parse(a)});switch(d.length){case 1:return this.set(a.get(c,"singleProp","all"),d[0]),this;case 2:return this.set("width",d[0]),this.set("height",d[1]),this;case 0:return this}}else{if("number"==typeof b)return this.set(a.get(c,"singleProp","all"),b),this;if("object"==typeof b){if(b instanceof Ka)this.set(a.get(c,"singleProp","all"),b);else{this.set("all",b.all);for(var e in b)"all"!==e&&this.set(e,b[e])}return this}}return Fa.debug&&Fa.log("Invalid 'size' value: "+Fa.stringify(b)),this},set:function(b,c){return null==c||"all"!==b&&!a.hasOwn(Ma.namesSet,b)||(c=Ka.parse(c),null!=c&&("all"===b?Ma.names.forEach(function(a){this[a]=c},this):this[b]=c)),this},clone:function(){return new Ma(this.width,this.height)},intersect:function(a){return new Ma(Math.min(this.width,a.width),Math.min(this.height,a.height))},resolve:function(a){var b={};return Ma.names.forEach(function(c){var d=this[c];if(null!=d)if("number"==typeof d)b[c]=d;else if(a){var e=a[c];null!=e&&(b[c]=d.resolve(e))}},this),b}});Ma.names=["width","height"],Ma.namesSet=b.dict(Ma.names,a.retTrue),Ma.toOrtho=function(a,b){if(null!=a){var c;b&&(c=Fa.BasePanel.orthogonalLength[b]),
a=Ma.to(a,{singleProp:c}),b&&delete a[Fa.BasePanel.oppositeLength[c]]}return a},Ma.to=function(a,b){return null==a||a instanceof Ma||(a=(new Ma).setSize(a,b)),a};var Na=a.type("pvc.Offset").init(function(a,b){1===arguments.length?null!=a&&this.setOffset(a):(null!=a&&(this.x=a),null!=b&&(this.y=b))}).add({stringify:function(b,c,d){return Fa.stringifyRecursive(b,a.copyOwn(this),c,d)},setOffset:function(b,c){if("string"==typeof b){var d=b.split(/\s+/).map(function(a){return Ka.parse(a)});switch(d.length){case 1:return this.set(a.get(c,"singleProp","all"),d[0]),this;case 2:return this.set("x",d[0]),this.set("y",d[1]),this;case 0:return this}}else{if("number"==typeof b)return this.set(a.get(c,"singleProp","all"),b),this;if("object"==typeof b){this.set("all",b.all);for(var e in b)"all"!==e&&this.set(e,b[e]);return this}}return Fa.debug&&Fa.log("Invalid 'offset' value: "+Fa.stringify(b)),this},set:function(b,c){null!=c&&a.hasOwn(Na.namesSet,b)&&(c=Ka.parse(c),null!=c&&("all"===b?Na.names.forEach(function(a){this[a]=c},this):this[b]=c))},resolve:function(a){var b={};return Ma.names.forEach(function(c){var d=Na.namesSizeToOffset[c],e=this[d];if(null!=e)if("number"==typeof e)b[d]=e;else if(a){var f=a[c];null!=f&&(b[d]=e.resolve(f))}},this),b}});Na.addStatic({names:["x","y"]}).addStatic({namesSet:b.dict(Na.names,a.retTrue),namesSizeToOffset:{width:"x",height:"y"},namesSidesToOffset:{left:"x",right:"x",top:"y",bottom:"y"},as:function(a){return null==a||a instanceof Na||(a=(new Na).setOffset(a)),a}}),null==$.support.svg&&($.support.svg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")),Fa.text={getFitInfo:function(a,c,d,e,f){if(""===d)return{h:!0,v:!0,d:!0};var g=b.Text.measureWidth(d,e);return{h:a>=g,v:c>=g,d:g<=Math.sqrt(a*a+c*c)-f}},trimToWidthB:function(a,c,d,e,f){var g=b.Text.measureWidth(e,d),h=1.5*g;return Fa.text.trimToWidth(a,c,d,e,f,h)},trimToWidth:function(a,c,d,e,f,g){if(""===c)return c;var h=b.Text.measureWidth(c,d);if(a>=h)return c;if(h>1.5*a)return Fa.text.trimToWidthBin(a,c,d,e,f,g);for(a-=b.Text.measureWidth(e,d);h>a;)c=f?c.slice(1):c.slice(0,c.length-1),h=b.Text.measureWidth(c,d);return g&&g>=h?"":f?e+c:c+e},trimToWidthBin:function(a,c,d,e,f,g){a-=b.Text.measureWidth(e,d);for(var h,i,j=c.length,k=j-2,l=0;k>=l&&k>0;){h=Math.ceil((l+k)/2);var m=f?c.slice(j-h):c.slice(0,h);if(i=b.Text.measureWidth(m,d),i>a)k=h-1;else{if(!(b.Text.measureWidth(f?c.slice(j-h-1):c.slice(0,h+1),d)<a))return g&&g>=i?"":f?e+m:m+e;l=h+1}}return c=f?c.slice(j-k):c.slice(0,k),i=c.length,g&&g>=i?"":f?e+c:c+e},justify:function(a,c,d){var e=[];if(c<b.Text.measureWidth("a",d))return e;for(var f=(a||"").split(/\s+/),g="";f.length;){var h=f.shift();if(h){var i=g?g+" "+h:h;b.Text.measureWidth(i,d)>c?(g&&e.push(g),g=h):g=i}}return g&&e.push(g),e},getLabelBBox:function(a,c,d,e,f,g){var h=b.Label.getPolygon(a,c,d,e,f,g),i=h.bbox();return i.source=h,i.sourceAngle=f,i.sourceAlign=d,i.sourceTextWidth=a,i}},Fa.color={scale:i,scales:h,toGray:Fa.toGrayScale,isGray:g},a.type("pvc.color.ScalesBuild").init(function(c){this.keyArgs=c,this.data=c.data||a.fail.argumentRequired("keyArgs.data"),this.domainDimName=c.colorDimension||a.fail.argumentRequired("keyArgs.colorDimension"),this.domainDim=this.data.dimensions(this.domainDimName);var d=this.domainDim.type;d.isComparable?this.domainComparer=function(a,b){return d.compare(a,b)}:(this.domainComparer=null,Fa.log("Color value dimension should be comparable. Generated color scale may be invalid.")),this.nullRangeValue=c.colorMissing?b.color(c.colorMissing):b.Color.transparent,this.domainRangeCountDif=0}).add({build:function(){this.range=this._getRange(),this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var a=this._getDomain();return this._createScale(a)},buildMap:function(){this.range=this._getRange(),this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var b;if(this.keyArgs.normPerBaseCategory)b=function(a){var b=this._ensureDomain(null,!1,a);return this._createScale(b)};else{var c=this._getDomain(),d=this._createScale(c);b=a.fun.constant(d)}return this._createCategoryScalesMap(b)},_createScale:a.method({isAbstract:!0}),_createCategoryScalesMap:function(a){return this.data.children().object({name:function(a){return a.absKey},value:a,context:this})},_getRange:function(){var a=this.keyArgs,c=a.colors||["red","yellow","green"];return null!=a.colorMin&&null!=a.colorMax?c=[a.colorMin,a.colorMax]:null!=a.colorMin?c.unshift(a.colorMin):null!=a.colorMax&&c.push(a.colorMax),c.map(function(a){return b.color(a)})},_getDataExtent:function(a){var b=a.dimensions(this.domainDimName).extent({visible:!0});if(!b)return null;var c=b.min.value,d=b.max.value;return d==c&&(d>=1?c=d-1:d=c+1),{min:c,max:d}},_getDomain:function(){var a=this.keyArgs.colorDomain;return null!=a?(a=a.slice(),this.domainComparer&&a.sort(this.domainComparer),a.length>this.desiredDomainCount&&(a=a.slice(0,this.desiredDomainCount))):a=[],this._ensureDomain(a,!0,this.data)},_ensureDomain:function(c,d,e){var f;if(c&&d){var g=this.desiredDomainCount-c.length;if(g>0&&(f=this._getDataExtent(e)))switch(g){case 1:this.domainComparer?a.array.insert(c,f.max,this.domainComparer):c.push(f.max);break;case 2:this.domainComparer?(a.array.insert(c,f.min,this.domainComparer),a.array.insert(c,f.max,this.domainComparer)):(c.unshift(f.min),c.push(f.max));break;default:Fa.debug>=2&&Fa.log("Ignoring option 'colorDomain' due to unsupported length."+a.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,c.length])),c=null}}if(!c&&(f||(f=this._getDataExtent(e)),f)){var h=f.min,i=f.max,j=(i-h)/(this.desiredDomainCount-1);c=b.range(h,i+j,j)}return c}}),a.type("pvc.color.LinearScalesBuild",Fa.color.ScalesBuild).add({_createScale:function(a){var c=b.Scale.linear();return a&&c.domain.apply(c,a),c.range.apply(c,this.range),c}}),a.type("pvc.color.DiscreteScalesBuild",Fa.color.ScalesBuild).init(function(a){this.base(a),this.domainRangeCountDif=1}).add({_createScale:function(c){function d(a){if(null==a)return g;for(var b=0;e>b;b++)if(a<=c[b+1])return f[b];return f[h]}var e=c.length-1,f=this.range,g=this.nullRangeValue,h=f.length-1;return a.copy(d,b.Scale.common),d.domain=function(){return c},d.range=function(){return f},d}}),a.space("pvc.trends",function(b){var c={};a.set(b,"define",function(b,d){b||a.fail.argumentRequired("type"),d||a.fail.argumentRequired("trendSpec"),a.object.is(d)||a.fail.argumentInvalid("trendSpec","Must be a trend specification object."),b=(""+b).toLowerCase(),Fa.debug>=2&&a.hasOwn(c,b)&&Fa.log(a.format("[WARNING] A trend type with the name '{0}' is already defined.",[b]));var e=d.label||a.fail.argumentRequired("trendSpec.label"),f=d.model||a.fail.argumentRequired("trendSpec.model");a.fun.is(f)||a.fail.argumentInvalid("trendSpec.mode","Must be a function.");var g={dataPartAtom:{v:"trend",f:e},type:b,label:e,model:f};c[b]=g},"get",function(b){return b||a.fail.argumentRequired("type"),a.getOwn(c,b)||a.fail.operationInvalid("Undefined trend type '{0}'.",[b])},"has",function(b){return a.hasOwn(c,b)},"types",function(){return a.ownKeys(c)}),b.define("linear",{label:"Linear trend",model:function(b){for(var c=a.get(b,"rows"),d=a.get(b,"x"),e=a.get(b,"y"),f=0,g=0,h=0,i=0,j=0,k=0,l=function(a){return null!=a?+a:NaN};c.next();){var m=c.item,n=d?l(d(m)):f;if(!isNaN(n)){var o=l(e(m));isNaN(o)||(g++,h+=n,i+=o,j+=n*o,k+=n*n)}f++}var p,q;if(g>=2){var r=h/g,s=i/g,t=j/g,u=k/g,v=u-r*r;return q=0===v?0:(t-r*s)/v,p=s-q*r,{alpha:p,beta:q,reset:a.noop,sample:function(a){return p+q*+a}}}}}),b.define("moving-average",{label:"Moving average",model:function(b){var c=Math.max(+(a.get(b,"periods")||3),2),d=0,e=[];return{reset:function(){d=0,e.length=0},sample:function(a,b){var f=c;return null!=b&&(e.unshift(b),d+=b,f=e.length,f>c&&(d-=e.pop(),f=c)),d/f}}}}),b.define("weighted-moving-average",{label:"Weighted Moving average",model:function(b){var c=Math.max(+(a.get(b,"periods")||3),2),d=0,e=0,f=[],g=0,h=0;return{reset:function(){d=e=h=g=0,f.length=0},sample:function(a,b){if(null!=b)if(c>g)f.push(b),g++,h+=g,e+=g*b,d+=b;else{e+=g*b-d,d+=b-f[0];for(var i=1;c>i;i++)f[i-1]=f[i];f[c-1]=b}return e/h}}}})}),j.resolvers=k,j.constant=l,j.specify=m,j.defaultValue=n,Fa.options=j;var Oa=a.type().init(function(b,c,d,e){this.name=b,this.option=c,this._dv=this.value=a.get(e,"value"),this._resolve=a.get(e,"resolve");var f=!this._resolve;this.isResolved=f,this.isSpecified=!1,this._setCalled=!1,this._context=d,this._cast=a.get(e,"cast"),this._getDefault=f?null:a.get(e,"getDefault"),this.data=a.get(e,"data")}).add({resolve:function(){if(!this.isResolved&&(this.isResolved=!0,this._setCalled=!1,this._getFunProp("_resolve").call(this._context,this),!this._setCalled)){this.isSpecified=!1;var a=this._dynDefault();null!=a&&(this.value=this._dv=a)}return this},specify:function(a){return this.set(a,!1)},defaultValue:function(a){return arguments.length&&this.set(a,!0),this._dv},cast:function(a){if(null!=a){var b=this._getFunProp("_cast");b&&(a=b.call(this._context,a,this))}return a},set:function(a,b){if(this._setCalled=!0,null!=a&&(a=this.cast(a)),null==a){if(a=this._dynDefault(),null==a){if(!this.isSpecified)return this;a=this._dv}b=!0}return b?(this._dv=a,this.isSpecified||(this.value=a)):(this.isResolved=this.isSpecified=!0,this.value=a),this},_dynDefault:function(){var a=this._getFunProp("_getDefault");return a&&this.cast(a.call(this._context,this))},_getFunProp:function(a){var b=this[a];if(b){var c=this._context;c&&"string"==typeof b&&(b=c[b])}return b}});a.global.NoDataException=function(){},a.global.InvalidDataException=function(a){this.message=a?a:"Invalid Data."},Fa.data={visibleKeyArgs:{visible:!0}},a.type("pvc.data.DimensionType").init(function(c,d,e){this.complexType=c,this.name=d,this.label=a.get(e,"label")||Fa.buildTitleFromName(d);var f=Fa.splitIndexedId(d);this.group=f[0],this.groupLevel=a.nullyTo(f[1],0),this.label.indexOf("{")>=0&&(this.label=a.format(this.label,[this.groupLevel+1])),this.playedVisualRoles=new a.Map,this.isHidden=!!a.get(e,"isHidden");var g=a.get(e,"valueType")||null,h=Fa.data.DimensionType.valueTypeName(g),i=a.getOwn(Fa.data.DimensionType.cast,h,null);if(this.valueType=g,this.valueTypeName=h,this.cast=i,this.isDiscreteValueType=this.valueType!==Number&&this.valueType!==Date,this.isDiscrete=a.get(e,"isDiscrete"),null==this.isDiscrete)this.isDiscrete=this.isDiscreteValueType;else if(this.isDiscrete=!!this.isDiscrete,!this.isDiscrete&&this.isDiscreteValueType)throw a.error.argumentInvalid("isDiscrete","The only supported continuous value types are Number and Date.");if(this._converter=a.get(e,"converter")||null,!this._converter){var j=a.get(e,"rawFormat");if(j)switch(this.valueType){case Date:this._converter=b.Format.createParser(b.Format.date(j))}}if(this._key=a.get(e,"key")||null,this._comparer=a.get(e,"comparer"),void 0===this._comparer)switch(this.valueType){case Number:case Date:this._comparer=a.compare;break;default:this._comparer=null}if(this.isComparable=null!=this._comparer,this._formatter=a.get(e,"formatter")||null,!this._formatter)switch(this.valueType){case Number:this._formatter=b.Format.createFormatter(b.Format.number().fractionDigits(0,2));break;case Date:var k=a.get(e,"format");k||(k=a.get(e,"rawFormat"),k&&(k=k.replace(/-/g,"/"))),k||(k="%Y/%m/%d"),this._formatter=b.Format.createFormatter(b.Format.date(k))}}).add({isCalculated:!1,compare:function(a,b){return null==a?null==b?0:-1:null==b?1:this._comparer.call(null,a,b)},comparer:function(a){if(!this.isComparable)return null;var b=this;return a?this._reverseComparer||(this._reverseComparer=function(a,c){return b.compare(c,a)}):this._directComparer||(this._directComparer=function(a,c){return b.compare(a,c)})},atomComparer:function(a){return a?this._reverseAtomComparer||(this._reverseAtomComparer=this._createReverseAtomComparer()):this._directAtomComparer||(this._directAtomComparer=this._createDirectAtomComparer())},_toDiscrete:function(){this.isDiscrete=!0},_toCalculated:function(){this.isCalculated=!0},_createReverseAtomComparer:function(){function a(a,c){return a===c?0:b.compare(c.value,a.value)}if(!this.isComparable)return w;var b=this;return a},_createDirectAtomComparer:function(){function a(a,c){return a===c?0:b.compare(a.value,c.value)}if(!this.isComparable)return v;var b=this;return a},formatter:function(){return this._formatter},converter:function(){return this._converter},playingPercentVisualRole:function(){return a.query(this.playedVisualRoles.values()).any(function(a){return a.isPercent})}}),Fa.data.DimensionType.cast={Date:function(a){return a instanceof Date?a:new Date(a)},Number:function(a){return a=Number(a),isNaN(a)?null:a},String:String,Boolean:Boolean,Object:Object,Any:null},Fa.data.DimensionType.dimensionGroupName=function(a){return a.replace(/^(.*?)(\d*)$/,"$1")},Fa.data.DimensionType.valueTypeName=function(b){if(null==b)return"Any";switch(b){case Boolean:return"Boolean";case Number:return"Number";case String:return"String";case Object:return"Object";case Date:return"Date";default:throw a.error.argumentInvalid("valueType","Invalid valueType function: '{0}'.",[b])}},Fa.data.DimensionType.extendSpec=function(b,c,d){var e=Fa.data.DimensionType.dimensionGroupName(b),f=a.get(d,"dimensionGroups");if(f){var g=f[e];g&&(c=a.create(g,c))}switch(c||(c={}),e){case"category":var h=a.get(d,"isCategoryTimeSeries",!1);h&&void 0===c.valueType&&(c.valueType=Date);break;case"value":void 0===c.valueType&&(c.valueType=Number),c.valueType===Number&&(void 0!==c.formatter||c.format||(c.formatter=a.get(d,"valueNumberFormatter")))}return void 0!==c.converter||c.valueType!==Date||c.rawFormat||(c.rawFormat=a.get(d,"timeSeriesFormat")),c},a.type("pvc.data.ComplexType").init(function(a){if(this._dims={},this._dimsList=[],this._dimsNames=[],this._calculations=[],this._calculatedDimNames={},this._dimsIndexByName=null,this._dimsByGroup={},this._dimsNamesByGroup={},a)for(var b in a)this.addDimension(b,a[b])}).add({describe:function(){var a=["COMPLEX TYPE INFORMATION",Fa.logSeparator];return this._dimsList.forEach(function(b){var c=[];c.push(b.valueTypeName),b.isComparable&&c.push("comparable"),b.isDiscrete||c.push("continuous"),b.isHidden&&c.push("hidden"),a.push("  "+b.name+" ("+c.join(", ")+")")}),a.join("\n")},dimensions:function(b,c){if(null==b)return this._dims;var d=a.getOwn(this._dims,b,null);if(!d&&a.get(c,"assertExists",!0))throw a.error.argumentInvalid("name","Undefined dimension '{0}'",[b]);return d},dimensionsList:function(){return this._dimsList},calculatedDimensionsList:function(){return this._calcDimsList},dimensionsNames:function(){return this._dimsNames},groupDimensions:function(b,c){var d=a.getOwn(this._dimsByGroup,b);if(!d&&a.get(c,"assertExists",!0))throw a.error.operationInvalid("There is no dimension type group with name '{0}'.",[b]);return d},groupDimensionsNames:function(b,c){var d=a.getOwn(this._dimsNamesByGroup,b);if(!d&&a.get(c,"assertExists",!0))throw a.error.operationInvalid("There is no dimension type group with name '{0}'.",[b]);return d},addDimension:function(b,c){b||a.fail.argumentRequired("name"),!a.hasOwn(this._dims,b)||a.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[b]);var d=new Fa.data.DimensionType(this,b,c);this._dims[b]=d,this._dimsIndexByName=null;var e,f=d.group;if(f){var g,h=a.getOwn(this._dimsByGroup,f);h?g=this._dimsNamesByGroup[f]:(h=this._dimsByGroup[f]=[],g=this._dimsNamesByGroup[f]=[]),e=a.array.insert(g,b,a.compare),e=~e,a.array.insertAt(h,e,d)}var i,j=this._dimsList.length;if(f){e=d.groupLevel;for(var k=0;j>k;k++){var l=this._dimsList[k];if(l.group===f){if(l.groupLevel>e){i=k;break}i=k+1}}null==i&&(i=j)}else i=j;return a.array.insertAt(this._dimsList,i,d),a.array.insertAt(this._dimsNames,i,b),d._calculate&&(i=a.array.binarySearch(this._calcDimsList,d._calculationOrder,a.compare,function(a){return a._calculationOrder}),i>=0?i++:i=~i,a.array.insertAt(this._calcDimsList,i,d)),this._isPctRoleDimTypeMap=null,d},addCalculation:function(b,c){b||a.fail.argumentRequired("calcSpec");var d=b.calculation||a.fail.argumentRequired("calculations[i].calculation"),e=b.names;if(e="string"==typeof e?e.split(/\s*\,\s*/):a.array.as(e),e&&e.length){var f=this._calculatedDimNames;e.forEach(function(b){if(b){b=b.replace(/^\s*(.+?)\s*$/,"$1"),!a.hasOwn(f,b)||a.fail.argumentInvalid("calculations[i].names","Dimension name '{0}' is already being calculated.",[b]);var d=this._dims[b];if(!d){var e=Fa.data.DimensionType.extendSpec(b,null,c);this.addDimension(b,e)}f[b]=!0,d._toCalculated()}},this)}this._calculations.push(d)},isCalculated:function(b){return a.hasOwn(this._calculatedDimNames,b)},_calculate:function(a){var b=this._calculations,c=b.length;if(c){for(var d={},e=0;c>e;e++){var f=b[e];f(a,d)}return d}},getPlayingPercentVisualRoleDimensionMap:function(){var b=this._isPctRoleDimTypeMap;return b||(b=this._isPctRoleDimTypeMap=new a.Map(a.query(a.own(this._dims)).where(function(a){return a.playingPercentVisualRole()}).object({name:function(a){return a.name}}))),b},sortDimensionNames:function(b,c){var d=this._dimsIndexByName;return d||(d=a.query(this._dimsList).object({name:function(a){return a.name},value:function(a,b){return b}}),this._dimsIndexByName=d),b.sort(function(b,e){return a.compare(d[c?c(b):b],d[c?c(e):e])}),b}}),a.type("pvc.data.ComplexTypeProject").init(function(a){this._dims={},this._dimList=[],this._dimGroupsDims={},this._dimGroupSpecs=a||{},this._calcList=[]}).add({_ensureDim:function(b,c){b||a.fail.argumentInvalid("name","Invalid dimension name '{0}'.",[b]);var d=a.getOwn(this._dims,b);if(d)c&&a.setUDefaults(d.spec,c);else{d=this._dims[b]=this._createDim(b,c),this._dimList.push(d);var e=a.array.lazy(this._dimGroupsDims,d.groupName);a.array.insert(e,b,a.compare)}return d},hasDim:function(b){return a.hasOwn(this._dims,b)},setDim:function(b,c){var d=this._ensureDim(b).spec;return c&&a.copy(d,c),this},setDimDefaults:function(b,c){return a.setUDefaults(this._ensureDim(b).spec,c),this},_createDim:function(b,c){var d=Fa.data.DimensionType.dimensionGroupName(b),e=this._dimGroupSpecs[d];return e&&(c=a.create(e,c)),{name:b,groupName:d,spec:c||{}}},readDim:function(b,c){var d=this._ensureDim(b,c);if(d.isRead)throw a.error.operationInvalid("Dimension '{0}' already is the target of a reader.",[b]);if(d.isCalc)throw a.error.operationInvalid("Dimension '{0}' is being calculated, so it cannot be the target of a reader.",[b]);d.isRead=!0},calcDim:function(b,c){var d=this._ensureDim(b,c);if(d.isCalc)throw a.error.operationInvalid("Dimension '{0}' already is being calculated.",[b]);if(d.isRead)throw a.error.operationInvalid("Dimension '{0}' is the target of a reader, so it cannot be calculated.",[b]);d.isCalc=!0},isReadOrCalc:function(b){if(b){var c=a.getOwn(this._dims,b);if(c)return c.isRead||c.isCalc}return!1},groupDimensionsNames:function(a){return this._dimGroupsDims[a]},setCalc:function(b){b||a.fail.argumentRequired("calculations[i]"),b.calculation||a.fail.argumentRequired("calculations[i].calculation");var c=b.names;c="string"==typeof c?c.split(/\s*\,\s*/):a.array.as(c),c&&c.length&&c.forEach(this.calcDim,this),this._calcList.push(b)},configureComplexType:function(a,b){this._dimList.forEach(function(c){var d=c.name,e=c.spec;e=Fa.data.DimensionType.extendSpec(d,e,b),a.addDimension(d,e)}),this._calcList.forEach(function(b){a.addCalculation(b)})}}),a.type("pvc.data.TranslationOper").init(function(b,c,d,e,f){this.chart=b,this.complexTypeProj=c,this.source=d||a.fail.argumentRequired("source"),this.metadata=e||a.fail.argumentRequired("metadata"),this.options=f||{},this._initType(),Fa.debug>=4&&(this._logItems=!0,this._logItemCount=0)}).add({_logItems:!1,logSource:a.method({isAbstract:!0}),logVItem:a.method({isAbstract:!0}),_translType:"Unknown",logTranslatorType:function(){return this._translType+" data source translator"},virtualItemSize:function(){return this.metadata.length},freeVirtualItemSize:function(){return this.virtualItemSize()-this._userUsedIndexesCount},setSource:function(b){if(!b)throw a.error.argumentRequired("source");this.source=b},defReader:function(b){b||a.fail.argumentRequired("readerSpec");var c;c=a.string.is(b)?b:b.names,c=a.string.is(c)?c.split(/\s*\,\s*/):a.array.as(c);var d=a.array.as(b.indexes);d&&d.forEach(this._userUseIndex,this);var e=!(!c||!c.length),f=b.reader;if(f)e||a.fail.argumentRequired("reader.names","Required argument when a reader function is specified."),this._userRead(f,c);else{if(e)return this._userCreateReaders(c,d);d&&d.forEach(function(a){this._userIndexesToSingleDim[a]=null},this)}return d},configureType:function(){this._configureTypeCore()},_configureTypeCore:a.method({isAbstract:!0}),_initType:function(){this._userDimsReaders=[],this._userDimsReadersByDim={},this._userItem=[],this._userUsedIndexes={},this._userUsedIndexesCount=0,this._userIndexesToSingleDim=[];var a=this.options.readers;a&&a.forEach(this.defReader,this);var b=Fa.parseDistinctIndexArray(this.options.multiChartIndexes);b&&(this._multiChartIndexes=this.defReader({names:"multiChart",indexes:b}))},_userUseIndex:function(b){if(b=+b,0>b)throw a.error.argumentInvalid("index","Invalid reader index: '{0}'.",[b]);if(a.hasOwn(this._userUsedIndexes,b))throw a.error.argumentInvalid("index","Virtual item index '{0}' is already assigned.",[b]);return this._userUsedIndexes[b]=!0,this._userUsedIndexesCount++,this._userItem[b]=!0,b},_userCreateReaders:function(b,c){c?c.forEach(function(a,b){c[b]=+a}):c=[];var d,e=c.length,f=b.length;if(f>e){var g=e>0?c[e-1]+1:0;do g=this._nextAvailableItemIndex(g),c[e]=g,this._userUseIndex(g),e++;while(f>e)}for(var h,i=e===f?f:f-1,j=0;i>j;j++)d=b[j],h=c[j],this._userIndexesToSingleDim[h]=d,this._userRead(this._propGet(d,h),d);if(f>i)for(var k=Fa.splitIndexedId(b[f-1]),l=k[0],m=a.nullyTo(k[1],0),n=i;e>n;n++,m++)d=Fa.buildIndexedId(l,m),h=c[n],this._userIndexesToSingleDim[h]=d,this._userRead(this._propGet(d,h),d);return c},_userRead:function(b,c){a.fun.is(b)||a.fail.argumentInvalid("reader","Reader must be a function."),a.array.is(c)?c.forEach(function(a){this._readDim(a,b)},this):this._readDim(c,b),this._userDimsReaders.push(b)},_readDim:function(a,b){var c,d,e=this._userIndexesToSingleDim.indexOf(a);if(e>=0&&(c=this._itemInfos[e],c&&!this.options.ignoreMetadataLabels)){var f=c.label||c.name;f&&(d={label:f})}this.complexTypeProj.readDim(a,d),this._userDimsReadersByDim[a]=b},execute:function(a){return this.data=a,this._executeCore()},_executeCore:function(){var b=this._getDimensionsReaders();return a.query(this._getItems()).select(function(a){return this._readItem(a,b)},this)},_getItems:function(){return this.source},_getDimensionsReaders:function(){return this._userDimsReaders},_readItem:function(b,c){var d=this._logItems;if(d){var e=this._logItemCount;10>e?(Fa.log("virtual item ["+this._logItemCount+"]: "+Fa.stringify(b)),this._logItemCount++):(Fa.log("..."),d=this._logItems=!1)}for(var f=0,g=c.length,h=this.data,i={};g>f;)c[f++].call(h,b,i);if(d){var j={};for(var k in i){var l=i[k];a.object.is(l)&&(l="v"in l?l.v:"value"in l?l.value:"..."),j[k]=l}Fa.log("-> read: "+Fa.stringify(j))}return i},_propGet:function(a,b){function c(c,d){d[a]=c[b]}return c},_nextAvailableItemIndex:function(b,c){for(null==b&&(b=0),null==c&&(c=1/0);c>b&&a.hasOwn(this._userItem,b);)b++;return c>b?b:-1},_getUnboundRoleDefaultDimNames:function(a,b,c,d){var e=this.chart.visualRoles[a];if(e&&!e.isPreBound()){var f=e.defaultDimensionName;if(f){for(f=f.match(/^(.*?)(\*)?$/)[1],c||(c=[]),null==d&&(d=0),null==b&&(b=1);b--;){var g=Fa.buildIndexedId(f,d++);this.complexTypeProj.isReadOrCalc(g)||c.push(g)}return c.length?c:null}}},collectFreeDiscreteAndConstinuousIndexes:function(a,b){this._itemInfos.forEach(function(c,d){if(!this._userUsedIndexes[d]){var e=1===c.type?b:a;e&&e.push(d)}},this)}}),a.type("pvc.data.MatrixTranslationOper",Fa.data.TranslationOper).add({_initType:function(){this.J=this.metadata.length,this.I=this.source.length,this._processMetadata(),this.base()},setSource:function(a){this.base(a),this.I=this.source.length},_knownContinuousColTypes:{numeric:1,number:1,integer:1},_processMetadata:function(){for(var b=this._knownContinuousColTypes,c=a.query(this.metadata).select(function(a,b){return a.colIndex=b,a}).where(function(a){var c=a.colType;return!c||1!==b[c.toLowerCase()]}).select(function(a){return a.colIndex}).array(),d=a.array.create(this.J,1),e=this.I,f=this.source,g=c.length,h=0;e>h&&g>0;h++)for(var i=f[h],j=0;g>j;){var k=c[j],l=i[k];null!=l?(d[k]=this._getSourceValueType(l),c.splice(j,1),g--):j++}this._columnTypes=d},_buildItemInfoFromMetadata:function(a){var b=this.metadata[a];return{type:this._columnTypes[a],name:b.colName,label:b.colLabel}},_getSourceValueType:function(a){switch(typeof a){case"number":return 1;case"object":if(a instanceof Date)return 1}return 0},logSource:function(){var b=["DATA SOURCE SUMMARY",Fa.logSeparator,"ROWS ("+Math.min(10,this.I)+"/"+this.I+")"];a.query(this.source).take(10).each(function(a,c){b.push("  ["+c+"] "+Fa.stringify(a))}),this.I>10&&b.push("  ..."),b.push("COLS ("+this.J+")");var c=this._columnTypes;return this.metadata.forEach(function(a,d){b.push("  ["+d+"] '"+a.colName+"' (type: "+a.colType+", inspected: "+(c[d]?"number":"string")+(a.colLabel?", label: '"+a.colLabel+"'":"")+")")}),b.push(""),b.join("\n")},_logVItem:function(b,c){var d=["VIRTUAL ITEM ARRAY",Fa.logSeparator],e=4,f=5,g=9;this._itemInfos.forEach(function(a,b){e=Math.max(e,(a.name||"").length),f=Math.max(f,(a.label||"").length);var c=this._userIndexesToSingleDim[b];c&&(g=Math.max(g,c.length))},this),d.push("Index | Kind | Type   | "+a.string.padRight("Name",e)+" | "+a.string.padRight("Label",f)+" > Dimension","------+------+--------+-"+a.string.padRight("",e,"-")+"-+-"+a.string.padRight("",f,"-")+"-+-"+a.string.padRight("",g,"-")+"-");var h=0;return b.forEach(function(b){for(var g=0,i=c[b];i>g;g++){var j=this._itemInfos[h],k=this._userIndexesToSingleDim[h];void 0===k&&(k=""),d.push(" "+h+"    | "+b+"    | "+(j.type?"number":"string")+" | "+a.string.padRight(j.name||"",e)+" | "+a.string.padRight(j.label||"",f)+" | "+k),h++}},this),d.push(""),d.join("\n")},_createPlot2SeriesKeySet:function(b,c){var d=null,e=c.length;return a.query(b).each(function(b){var f=+b;if(isNaN(f))throw a.error.argumentInvalid("plot2DataSeriesIndexes","Element is not a number '{0}'.",[b]);if(0>f){if(-e>=f)throw a.error.argumentInvalid("plot2DataSeriesIndexes","Index is out of range '{0}'.",[f]);f=e+f}else if(f>=e)throw a.error.argumentInvalid("plot2DataSeriesIndexes","Index is out of range '{0}'.",[f]);d||(d={}),d[c[f]]=!0}),d},_dataPartGet:function(b,c){function d(d,l){e||(f=b(),e=i.data.dimensions(j),Fa.debug>=3&&f&&Fa.log("Second axis series values: "+Fa.stringify(a.keys(f))));var m;c(d,k);var n=k.series;null!=n&&null!=n.v&&(n=n.v),m=a.hasOwn(f,n)?h||(h=e.intern("1")):g||(g=e.intern("0")),l[j]=m}var e,f,g,h,i=this,j=this.options.dataPartDimName,k={};return d}}),a.type("pvc.data.CrosstabTranslationOper",Fa.data.MatrixTranslationOper).add({_translType:"Crosstab",virtualItemSize:function(){return this.R+this.C+this.M},_executeCore:function(){function b(a,b){for(var c=f[a],d=0,h=g[a];h-- >0;)e[c++]=b[d++]}function c(a,b){for(var c=f.M,d=g._colGroupsIndexes[b],h=g.M,i=0;h>i;i++){var j=d[i];e[c++]=null!=j?a[j]:null}}if(!this.metadata.length)return a.query();var d=this._getDimensionsReaders(),e=new Array(this.virtualItemSize()),f=this._itemCrossGroupIndex,g=this,h=a.query(this.source);if(this._colGroups&&this._colGroups.length){var i=function(f){return b("R",f),a.query(this._colGroups).select(function(a,g){return b("C",a),c(f,g),this._readItem(e,d)},this)};return h.selectMany(i,this)}return h.select(function(a){return b("R",a),this._readItem(e,d)},this)},_processMetadata:function(){this.base(),this._separator=this.options.separator||"~";var b=this.R=1;this.C=1,this.M=1,this.measuresDirection=null;var c,d=this.options.seriesInRows,e=this.metadata;c=e.map(d?function(a){return a.colName}:this.options.compatVersion<=1?function(a){return{v:a.colName}}:function(a){return{v:a.colName,f:a.colLabel}});var f=this._itemCrossGroupInfos={};if(this.options.isMultiValued){var g=a.get(this.options,"measuresInColumns",!0);if(g||null==this.options.measuresIndex){b=this.R=this._getCategoriesCount();var h=c.slice(b),i=h.length;i>0?(g?(this.measuresDirection="columns",this._processEncodedColGroups(h)):(this._colGroups=h,this._colGroupsIndexes=[],this._colGroups.forEach(function(a,b){this._colGroups[b]=this._splitEncodedColGroupCell(a),this._colGroupsIndexes[b]=[this.R+b]},this),f.M=[this._buildItemInfoFromMetadata(b)]),this.C=this._colGroups[0].length,f.C=a.range(0,this.C).select(function(){return{type:0}}).array()):(this.C=this.M=0,f.M=[],f.C=[])}else{this.measuresDirection="rows",this.R=+this.options.measuresIndex;var j=this.options.measuresCount;null==j&&(j=1),this.M=j,this._colGroups=c.slice(this.R+1),this._colGroups.forEach(function(a,b){this._colGroups[b]=[a]},this)}}else b=this.R=this._getCategoriesCount(),this._colGroups=c.slice(b),this._colGroupsIndexes=new Array(this._colGroups.length),this._colGroups.forEach(function(a,c){this._colGroups[c]=[a],this._colGroupsIndexes[c]=[b+c]},this),f.C=[{type:0}],f.M=[{type:this._columnTypes[b]}];f.R=a.range(0,this.R).select(this._buildItemInfoFromMetadata,this).array();var k=this._itemCrossGroupIndex={C:d?this.R:0,R:d?0:this.C,M:this.C+this.R},l=this._itemInfos=new Array(this.virtualItemSize());a.eachOwn(k,function(a,b){f[b].forEach(function(b,c){l[a+c]=b})}),this._itemLogicalGroup={series:d?this.R:this.C,category:d?this.C:this.R,value:this.M},this._itemLogicalGroupIndex={series:0,category:this._itemLogicalGroup.series,value:this.C+this.R}},logVItem:function(){return this._logVItem(["C","R","M"],{C:this.C,R:this.R,M:this.M})},_getCategoriesCount:function(){var b=this.options.categoriesCount;return null!=b&&(!isFinite(b)||0>b)&&(b=null),null==b&&(b=a.query(this._columnTypes).whayl(function(a){return 0===a}).count(),b||(b=1)),b},_splitEncodedColGroupCell:function(a){var b,c=a.v;return null==c?c=[]:(c=c.split(this._separator),b=a.f,b&&(b=b.split(this._separator))),c.map(function(a,c){return{v:a,f:b&&b[c]}})},_processEncodedColGroups:function(b){for(var c,d=b.length||a.assert("Must have columns"),e=this.R,f=[],g={},h=[],i=0;d>i;i++){var j,k,l,m,n=b[i],o=n.v,p=n.f,q=o.lastIndexOf(this._separator);0>q?(j=o,k=p,o="",l=[]):(j=o.substring(q+1),o=o.substring(0,q),l=o.split(this._separator),null!=p&&(m=p.split(this._separator),k=m.pop()),l.forEach(function(a,b){var c=m&&m[b];l[b]={v:a,f:c}})),c&&c.encValues===o?c.measureNames.push(j):(c={startIndex:i,encValues:o,values:l,measureNames:[j]},f.push(c));var r=i-c.startIndex,s=a.getOwn(g,j);s?r>s.groupIndex&&(s.groupIndex=r):(g[j]=s={name:j,label:k,type:this._columnTypes[e+i],groupIndex:r,index:i},h.push(s))}h.sort(function(b,c){return a.compare(b.groupIndex,c.groupIndex)||a.compare(b.index,c.index)}),h.forEach(function(a,b){a.groupIndex=b});var t=f.length,u=new Array(t),v=new Array(t),w=h.length;f.map(function(a,b){u[b]=a.values;var c=a.startIndex,d=v[b]=new Array(w);a.measureNames.forEach(function(a,b){var f=g[a].groupIndex;d[f]=e+c+b})}),this._colGroups=u,this._colGroupsIndexes=v,this._itemCrossGroupInfos.M=h,this.M=w},configureType:function(){if("rows"===this.measuresDirection)throw a.error.notImplemented();this.base()},_configureTypeCore:function(){function b(a,b,d){for(var h=e[a]+d;d>0;){var i=Fa.buildIndexedId(a,b);if(!c.complexTypeProj.isReadOrCalc(i)){if(f=c._nextAvailableItemIndex(f),f>=h)return;g.push({names:i,indexes:f}),f++,d--}b++}}var c=this,d=c._itemLogicalGroup,e=c._itemLogicalGroupIndex,f=0,g=[],h=this.options.dataPartDimName;if(h&&1===this.C&&!this.complexTypeProj.isReadOrCalc(h)){var i=this.options.plot2DataSeriesIndexes;if(null!=i){var j=this._colGroups.map(function(a){return""+a[0].v});this._plot2SeriesKeySet=this._createPlot2SeriesKeySet(i,j)}}if(["series","category","value"].forEach(function(a){var c=d[a];c>0&&b(a,0,c)}),g&&g.forEach(this.defReader,this),this._plot2SeriesKeySet){var k=this._userDimsReadersByDim.series;
if(k){var l=a.fun.constant(this._plot2SeriesKeySet);this._userRead(this._dataPartGet(l,k),h)}}}}),a.type("pvc.data.RelationalTranslationOper",Fa.data.MatrixTranslationOper).add({M:0,C:0,S:0,_translType:"Relational",_processMetadata:function(){this.base();var b=this.metadata,c=this.J,d=this.options.categoriesCount;null!=d&&(!isFinite(d)||0>d)&&(d=0);var e,f,g;this.options.isMultiValued&&(f=Fa.parseDistinctIndexArray(this.options.measuresIndexes,0,c-1),g=f?f.length:0);var h;if(null==g)if(c>0&&3>=c&&(null==d||1===d)&&null==e)g=1,f=[c-1],d=c>=2?1:0,e=c>=3?1:0,h=d+e;else if(null!=d&&d>=c)h=c,d=c,e=0,g=0;else{var i=null!=d?c-d:1/0;f=a.query(b).where(function(a,b){return 0!==this._columnTypes[b]},this).select(function(a){return a.colIndex}).take(i).array(),g=f.length}null==h&&(h=c-g,0===h?e=d=0:null!=d?d>h?(d=h,e=0):e=h-d:(e=h>1?1:0,d=h-e));var j=this.options.seriesInRows,k=[];h&&(e&&!j&&k.push({name:"S",count:e}),d&&k.push({name:"C",count:d}),e&&j&&k.push({name:"S",count:e})),g&&k.push({name:"M",count:g});var l=a.range(0,c).array();f&&f.forEach(function(a){l.splice(a,1)});var m={};k.forEach(function(a){var b=a.count,c=a.name;m[c]=a,a.indexes=f&&"M"===c?f:l.splice(0,b)}),this.M=g,this.S=e,this.C=d;var n=[];["S","C","M"].forEach(function(b){var c=m[b];c&&a.array.append(n,c.indexes)}),this._itemInfos=n.map(this._buildItemInfoFromMetadata,this),this._itemCrossGroupIndex={S:0,C:this.S,M:this.S+this.C},this._itemPerm=n},logVItem:function(){return this._logVItem(["S","C","M"],{S:this.S,C:this.C,M:this.M})},_configureTypeCore:function(){function a(a,e,f,g){for(var h=b._itemCrossGroupIndex[e]+g;g>0;){var i=Fa.buildIndexedId(a,f);if(!b.complexTypeProj.isReadOrCalc(i)){if(c=b._nextAvailableItemIndex(c),c>=h)return;d.push({names:i,indexes:c}),c++,g--}f++}}var b=this,c=0,d=[];this.S>0&&a("series","S",0,this.S),this.C>0&&a("category","C",0,this.C),this.M>0&&a("value","M",0,this.M),d&&d.forEach(this.defReader,this);var e=this.options.dataPartDimName;if(e&&!this.complexTypeProj.isReadOrCalc(e)){var f=this.options.plot2DataSeriesIndexes;if(null!=f){var g=this._userDimsReadersByDim.series;g&&this._userRead(u.call(this,f,g),e)}}},_executeCore:function(){var c=this._getDimensionsReaders(),d=this._itemPerm;return a.query(this._getItems()).select(function(a){return a=b.permute(a,d),this._readItem(a,c)},this)}}),a.type("pvc.data.Atom").init(function(b,c,d,e,f){this.dimension=b,this.id=null==c?-a.nextId():a.nextId(),this.value=c,this.label=d,void 0!==e&&(this.rawValue=e),this.key=f}).add({isVirtual:!1,rawValue:void 0,toString:function(){var a=this.label;return null!=a?a:(a=this.value,null!=a?""+a:"")}});var Pa=1;a.type("pvc.data.Complex").init(function(b,c,d,e,f,g){var h=this;h.id=Pa++;var i;b&&(i=b.owner,e||(e=b.atoms)),h.owner=i=i||h;var j=i.type||a.fail.argumentRequired("owner.type");h.atoms=e?Object.create(e):{};var k=!!d;d||(d=j._dimsNames);var l,m,n=h.atoms,o=d.length;if(c){var p=i._dimensions,q=function(a){var b=c[a],d=p[a].intern(b);null==b||e&&d===e[a]||(n[a]=d)};if(k)for(l=o;l--;)q(d[l]);else for(m in c)q(m);if(g){c=j._calculate(h);for(m in c)a.hasOwnProp.call(n,m)||q(m)}}var r;if(o)if(1===o)r=n[d[0]],h.value=r.value,h.rawValue=r.rawValue,h.key=r.key,f&&(h.label=r.label);else{var s,t,u,v=i.keySep,w=i.labelSep;for(l=0;o>l;l++)r=n[d[l]],l?s+=v+r.key:s=r.key,f&&(u=r.label)&&(t?t+=w+u:t=u);h.value=h.rawValue=h.key=s,f&&(h.label=t)}else h.value=null,h.key="",f&&(h.label="")}).add({labelSep:" ~ ",keySep:"~",value:null,label:null,rawValue:void 0,ensureLabel:function(){var b=this.label;if(null==b){b="";var c=this.owner.labelSep;a.eachOwn(this.atoms,function(a){var d=a.label;d&&(b?b+=c+d:b=d)}),this.label=b}return b},view:function(a){return new Fa.data.ComplexView(this,a)},toString:function(){var a=[""+this.constructor.typeName];return null!=this.index&&a.push("#"+this.index),this.owner.type.dimensionsNames().forEach(function(b){a.push(b+": "+Fa.stringify(this.atoms[b].value))},this),a.join(" ")},rightTrimKeySep:function(a){return a&&Fa.data.Complex.rightTrimKeySep(a,this.owner.keySep)},absKeyTrimmed:function(){return this.rightTrimKeySep(this.absKey)},keyTrimmed:function(){return this.rightTrimKeySep(this.key)}}),Fa.data.Complex.rightTrimKeySep=function(a,b){if(a&&b)for(var c,d=b.length;a.lastIndexOf(b)===(c=a.length-d)&&c>=0;)a=a.substr(0,c);return a},Fa.data.Complex.values=function(a,b){var c=a.atoms;return b.map(function(a){return c[a].value})},Fa.data.Complex.compositeKey=function(a,b){var c=a.atoms;return b.map(function(a){return c[a].key}).join(a.owner.keySep)},Fa.data.Complex.labels=function(a,b){var c=a.atoms;return b.map(function(a){return c[a].label})};var Qa=a.propGet("id");a.type("pvc.data.ComplexView",Fa.data.Complex).init(function(a,b){this.source=a,this.viewDimNames=b,this.base(a,a.atoms,b,a.owner.atoms,!0)}).add({values:function(){return Fa.data.Complex.values(this,this.viewDimNames)},labels:function(){return Fa.data.Complex.labels(this,this.viewDimNames)}}),a.type("pvc.data.Datum",Fa.data.Complex).init(function(a,b){this.base(a,b,null,null,!1,!0)}).add({isSelected:!1,isVisible:!0,isNull:!1,isVirtual:!1,isTrend:!1,trend:null,isInterpolated:!1,interpolation:null,setSelected:function(a){if(this.isNull)return!1;a=null==a||!!a;var b=this.isSelected!==a;return b&&(a?this.isSelected=!0:delete this.isSelected,Y.call(this.owner,this,a)),b},toggleSelected:function(){return this.setSelected(!this.isSelected)},setVisible:function(a){if(this.isNull)return!1;a=null==a||!!a;var b=this.isVisible!==a;return b&&(this.isVisible=a,Z.call(this.owner,this,a)),b},toggleVisible:function(){return this.setVisible(!this.isVisible)}});var Ra=a.propGet("isSelected");a.type("pvc.data.TrendDatum",Fa.data.Datum).init(function(a,b,c){this.base(a,b),this.trend=c}).add({isVirtual:!0,isTrend:!0}),a.type("pvc.data.InterpolationDatum",Fa.data.Datum).init(function(a,b,c){this.base(a,b),this.interpolation=c}).add({isVirtual:!0,isInterpolated:!0}),a.type("pvc.data.Dimension").init(function(b,c){this.data=b,this.type=c,this.root=this,this.owner=this;var d=c.name;if(this.name=d,this._atomComparer=c.atomComparer(),this._atomsByKey={},b.isOwner())this._atoms=[],J.call(this);else{var e,f=b.parent;f?(e=f._dimensions[d],N.call(e,this),this.root=b.parent.root):(f=b.linkParent,f||a.assert("Data must have a linkParent"),e=f._dimensions[d],O.call(e,this)),this._nullAtom=this.owner._nullAtom,this._lazyInit=function(){this._lazyInit=null;for(var b=this.data._datums,c=b.length,f=this._atomsByKey,g=0;c>g;g++){var h=b[g].atoms[d];f[h.key]=h}this._atoms=e.atoms().filter(function(b){return a.hasOwnProp.call(f,b.key)})}}}).add({parent:null,linkParent:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:!1,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){return this._lazyInit&&this._lazyInit(),this._atoms.length},isVisible:function(b){return this._lazyInit&&this._lazyInit(),a.hasOwn(this._atomsByKey,b.key)||a.assert("Atom must exist in this dimension."),Q.call(this)[b.key]>0},atoms:function(b){this._lazyInit&&this._lazyInit();var c=a.get(b,"visible");return null==c?this._atoms:(c=!!c,this._visibleAtoms||(this._visibleAtoms={}),this._visibleAtoms[c]||(this._visibleAtoms[c]=S.call(this,c)))},indexes:function(c){this._lazyInit&&this._lazyInit();var d=a.get(c,"visible");return null==d?b.range(0,this._atoms.length):(d=!!d,this._visibleIndexes||(this._visibleIndexes={}),this._visibleIndexes[d]||(this._visibleIndexes[d]=R.call(this,d)))},atom:function(a){if(null==a||""===a)return this._nullAtom;if(a instanceof Fa.data.Atom)return a;this._lazyInit&&this._lazyInit();var b=this.type._key,c=b?b.call(null,a):a;return this._atomsByKey[c]||null},getDistinctAtoms:function(a){var b=[],c=a?a.length:0;if(c)for(var d={},e=0;c>e;e++){var f,g=this.atom(a[e]);g&&!d[f="\0"+g.key]&&(d[f]=g,b.push(g))}return b},extent:function(b){var c=this.atoms(b),d=c.length;if(d){var e=this._nullAtom&&null==c[0].value?1:0,f=d-e;if(f>0){var g,h=c[e],i=c[d-1];if(h!==i&&a.get(b,"abs",!1)){var j=h.value<0?-1:1,k=i.value<0?-1:1;if(j===k)0>k&&(g=i,i=h,h=g);else if(f>2){i.value<-h.value&&(i=h);var l=a.array.binarySearch(c,0,this.type.comparer(),function(a){return a.value});if(0>l){l=~l;var m=c[l-1],n=c[l];h=-m.value<n.value?m:n}else h=c[l]}else i.value<-h.value&&(g=i,i=h,h=g)}return{min:h,max:i}}}},min:function(a){var b=this.atoms(a),c=b.length;if(c){var d=this._nullAtom&&null==b[0].value?1:0;return c>d?b[d]:void 0}},max:function(a){var b=this.atoms(a),c=b.length;return c&&null!=b[c-1].value?b[c-1]:void 0},sumAbs:function(b){return this.sum(a.create(b,{abs:!0}))},value:function(b){return this.sum(b&&b.abs?a.create(b,{abs:!1}):b)},valueAbs:function(a){var b=this.value(a);return b?Math.abs(b):b},sum:function(b){var c=!!a.get(b,"abs",!1),d=a.get(b,"zeroIfNone",!0),e=H(b)+":"+c,f=a.getOwn(this._sumCache,e);if(void 0===f){var g=this.name;f=this.data.datums(null,b).reduce(function(a,b){var d=b.atoms[g].value;return c&&0>d&&(d=-d),null!=a?a+d:d},null),(this._sumCache||(this._sumCache={}))[e]=f}return d?f||0:f},percent:function(a,b){var c=a instanceof Fa.data.Atom?a.value:a;if(!c)return 0;var d=this.sumAbs(b);return d?Math.abs(c)/d:0},valuePercent:function(a){var b=this.valueAbs(a);if(!b)return 0;var c=this.data.parent;if(!c)return 1;var d=c.dimensionsSumAbs(this.name,a);return b/d},percentOverParent:function(a){return this.valuePercent(a)},format:function(a,b){return""+(this.type._formatter?this.type._formatter.call(null,a,b):"")},intern:function(b,c){if(null==b||""===b)return this._nullAtom||I.call(this,b);if(b instanceof Fa.data.Atom){if(b.dimension!==this)throw a.error.operationInvalid("Atom is of a different dimension.");return b}var d,e,f=this.type;if("object"==typeof b&&"v"in b&&(e=b.f,b=b.v,null==b||""===b))return this._nullAtom||I.call(this);if(c)d=b;else{var g=f._converter;if(g){if(d=g(b),null==d||""===d)return this._nullAtom||I.call(this,b)}else d=b}var h=f.cast;if(h&&(d=h(d),null==d||""===d))return this._nullAtom||I.call(this);var i=f._key,j=""+(i?i(d):d);j||a.fail.operationInvalid("Only a null value can have an empty key.");var k=this._atomsByKey[j];return k?(!c&&k.isVirtual&&delete k.isVirtual,k):F.call(this,f,b,j,d,e,c)},read:function(a,b){if(null==a||""===a)return null;var c,d=this.type;if("object"==typeof a&&"v"in a&&(b=a.f,a=a.v,null==a||""===a))return null;var e=d._converter;if(c=e?e(a):a,null==c||""===c)return null;var f=d.cast;if(f&&(c=f(c),null==c||""===c))return null;var g=d._key,h=""+(g?g(c):c),i=this._atomsByKey[h];if(i)return{rawValue:a,key:h,value:i.value,label:""+(null==b?i.label:b)};if(null==b){var j=d._formatter;b=j?j(c,a):c}return b=""+b,{rawValue:a,key:h,value:c,label:b}},dispose:function(){var a=this;if(!a._disposed){o(a.childNodes,"parent"),o(a._linkChildren,"linkParent");var b;(b=a.parent)&&q(b,"childNodes",a,"parent"),(b=a.linkParent)&&q(b,"_linkChildren",a,"linkParent"),M.call(a),a._lazyInit=a._atoms=a._nullAtom=a._virtualNullAtom=null,a._disposed=!0}}}),a.type("pvc.data.Data",Fa.data.Complex).init(function(c){c||a.fail.argumentRequired("keyArgs"),this._visibleNotNullDatums=new a.Map;var d,e,f,g,h,i,j=this.parent=c.parent||null;if(j)this.root=j.root,this.depth=j.depth+1,this.type=j.type,h=c.datums||a.fail.argumentRequired("datums"),d=j.owner,e=c.atoms||a.fail.argumentRequired("atoms"),g=c.atomsDimNames||a.fail.argumentRequired("atomsDimNames"),f=j.atoms;else{this.root=this,g=[];var k=c.linkParent||null;k?(d=k.owner,this.type=d.type,h=c.datums||a.fail.argumentRequired("datums"),this._leafs=[],this._wherePred=c.where||null,f=k.atoms,i=a.get(c,"index",null),U.call(k,this,i)):(d=this,f={},c.labelSep&&(this.labelSep=c.labelSep),c.keySep&&(this.keySep=c.keySep),this.type=c.type||a.fail.argumentRequired("type"),this._selectedNotNullDatums=new a.Map)}h&&aa.call(this,h),this.owner=d,this._atomsBase=f,this._dimensions={},this._dimensionsList=[],this.type.dimensionsList().forEach(this._initDimension,this),this.base(d,e,g,f,!0),b.Dom.Node.call(this),j?(i=a.get(c,"index",null),T.call(j,this,i),this.absLabel=j.absLabel?a.string.join(d.labelSep,j.absLabel,this.label):this.label,this.absKey=j.absKey?a.string.join(d.keySep,j.absKey,this.key):this.key):(this.absLabel=this.label,this.absKey=this.key)}).add(b.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_dimensionsList:null,_freeDimensionNames:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_visibleNotNullDatums:null,_selectedNotNullDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_groupOper:null,_wherePred:null,_groupSpec:null,_groupLevel:null,_datums:null,_datumsById:null,_datumsByKey:null,depth:0,label:"",absLabel:"",_disposed:!1,_isFlattenGroup:!1,_isDegenerateFlattenGroup:!1,_initDimension:function(a){var b=new Fa.data.Dimension(this,a);this._dimensions[a.name]=b,this._dimensionsList.push(b)},dimensions:function(b,c){if(null==b)return this._dimensions;var d=a.getOwn(this._dimensions,b);if(!d&&a.get(c,"assertExists",!0))throw a.error.argumentInvalid("name","Undefined dimension '{0}'.",[b]);return d},dimensionsList:function(){return this._dimensionsList},freeDimensionsNames:function(){var a=this._freeDimensionNames;return a||(this._freeDimensionNames=a=this.type.dimensionsNames().filter(function(a){var b=this.atoms[a];return!(b instanceof Fa.data.Atom)||null==b.value},this)),a},isOwner:function(){return this.owner===this},children:function(){var b=this.childNodes;return b.length?a.query(b):a.query()},child:function(b){return a.getOwn(this._childrenByKey,b,null)},childCount:function(){return this.childNodes.length},leafs:function(){return a.query(this._leafs)},count:function(){return this._datums.length},firstDatum:function(){return this._datums.length?this._datums[0]:null},firstAtoms:function(){return(this.firstDatum()||this).atoms},singleDatum:function(){var a=this._datums;return 1===a.length?a[0]:null},dispose:function(){var a=this;if(!a._disposed){W.call(a);var b;(b=a._selectedNotNullDatums)&&b.clear(),a._visibleNotNullDatums.clear(),b=a._dimensionsList;for(var c=0,d=b.length;d>c;c++)b[c].dispose();a._dimensions=null,a._dimensionsLIst=null,(b=a.parent)&&(b.removeChild(a),a.parent=null),(b=a.linkParent)&&V.call(b,a),a._disposed=!0}},disposeChildren:function(){W.call(this)}}),Fa.data.Data.add({selectedCount:function(){return this.isOwner()?this._selectedNotNullDatums.count:this.datums(null,{selected:!0}).count()},selectedDatums:function(){return this.isOwner()?this._selectedNotNullDatums.values():this.datums(null,{selected:!0}).array()},selectedDatumMap:function(){if(!this.isOwner()){var b=this.datums(null,{selected:!0}).object({name:a.propGet("id")});return new a.Set(b)}return this._selectedNotNullDatums.clone()},visibleCount:function(){return this._visibleNotNullDatums.count},replaceSelected:function(b){a.array.is(b)||(b=b.array());var c=a.query(b).where(Ra).object({name:Qa}),d=this.owner.clearSelected(function(b){return!a.hasOwn(c,b.id)});return d|=Fa.data.Data.setSelected(b,!0)},clearSelected:function(a){if(this.owner!==this)return this.owner.clearSelected(a);if(!this._selectedNotNullDatums.count)return!1;var b;return a?(b=!1,this._selectedNotNullDatums.values().filter(a).forEach(function(a){b=!0,x.call(a),this._selectedNotNullDatums.rem(a.id)},this)):(b=!0,this._selectedNotNullDatums.values().forEach(function(a){x.call(a)}),this._selectedNotNullDatums.clear()),b}}),Fa.data.Data.setSelected=function(b,c){var d=0;return b&&a.query(b).each(function(a){d|=a.setSelected(c)}),!!d},Fa.data.Data.toggleSelected=function(b,c){a.array.isLike(b)||(b=a.query(b).array());var d=a.query(b),e=c?d.any(Ra):d.all(y);return this.setSelected(b,!e)},Fa.data.Data.setVisible=function(b,c){var d=0;return b&&a.query(b).each(function(a){d|=a.setVisible(c)}),!!d},Fa.data.Data.toggleVisible=function(b){a.array.isLike(b)||(b=a.query(b).array());var c=a.query(b).all(a.propGet("isVisible"));return Fa.data.Data.setVisible(b,!c)},a.space("pvc.data").FlatteningMode=a.set(a.makeEnum(["DfsPre","DfsPost"]),"None",0),a.type("pvc.data.GroupingSpec").init(function(b,c,d){this.type=c||null;var e=[];this.hasCompositeLevels=!1;var f=[];this.levels=a.query(b||void 0).where(function(a){return a.dimensions.length>0}).select(function(b){return e.push(b.id),a.array.append(f,b.dimensionNames()),!this.hasCompositeLevels&&b.dimensions.length>1&&(this.hasCompositeLevels=!0),b._setAccDimNames(f.slice(0)),b},this).array(),this._dimNames=f,this.depth=this.levels.length,this.isSingleLevel=1===this.depth,this.isSingleDimension=this.isSingleLevel&&!this.hasCompositeLevels,this.firstDimension=this.depth>0?this.levels[0].dimensions[0]:null,this.rootLabel=a.get(d,"rootLabel")||"",this.flatteningMode=a.get(d,"flatteningMode")||Fa.data.FlatteningMode.None,this._cacheKey=this._calcCacheKey(),this.id=this._cacheKey+"##"+e.join("||")}).add({_calcCacheKey:function(b){return[a.get(b,"flatteningMode")||this.flatteningMode,a.get(b,"reverse")||"false",a.get(b,"isSingleLevel")||this.isSingleLevel,a.get(b,"rootLabel")||this.rootLabel].join("#")},bind:function(b){this.type=b||a.fail.argumentRequired("type"),this.levels.forEach(function(a){a.bind(b)})},dimensions:function(){return a.query(this.levels).prop("dimensions").selectMany()},dimensionNames:function(){return this._dimNames},view:function(a){return a.view(this.dimensionNames())},isDiscrete:function(){var a;return!this.isSingleDimension||!!(a=this.firstDimension)&&a.type.isDiscrete},firstDimensionType:function(){var a=this.firstDimension;return a&&a.type},firstDimensionName:function(){var a=this.firstDimensionType();return a&&a.name},firstDimensionValueType:function(){var a=this.firstDimensionType();return a&&a.valueType},isNull:function(){return!this.levels.length},ensure:function(b){var c;if(b){var d=this._calcCacheKey(b);if(d!==this._cacheKey){var e=a.lazy(this,"_groupingCache");c=a.getOwn(e,d),c||(c=e[d]=this._ensure(b))}}return c||this},_ensure:function(b){var c=this;if(a.get(b,"isSingleLevel")&&!c.isSingleLevel)return c._singleLevelGrouping(b);if(a.get(b,"reverse"))return c._reverse(b);var d=a.get(b,"flatteningMode")||c.flatteningMode,e=a.get(b,"rootLabel")||c.rootLabel;return d!==c.flatteningMode||e!==c.rootLabel?new Fa.data.GroupingSpec(c.levels,c.type,{flatteningMode:d,rootLabel:e}):c},_singleLevelGrouping:function(b){var c=!!a.get(b,"reverse"),d=this.dimensions().select(function(a){return c?new Fa.data.GroupingDimensionSpec(a.name,!a.reverse,a.type.complexType):a}),e=new Fa.data.GroupingLevelSpec(d,this.type);return new Fa.data.GroupingSpec([e],this.type,{flatteningMode:null,rootLabel:a.get(b,"rootLabel")||this.rootLabel})},_reverse:function(b){var c=a.query(this.levels).select(function(b){var c=a.query(b.dimensions).select(function(a){return new Fa.data.GroupingDimensionSpec(a.name,!a.reverse,a.type.complexType)});return new Fa.data.GroupingLevelSpec(c,this.type)});return new Fa.data.GroupingSpec(c,this.type,{flatteningMode:a.get(b,"flatteningMode")||this.flatteningMode,rootLabel:a.get(b,"rootLabel")||this.rootLabel})},toString:function(){return a.query(this.levels).select(function(a){return""+a}).array().join(", ")}}),a.type("pvc.data.GroupingLevelSpec").init(function(b,c){var d=[],e=[];this.dimensions=a.query(b).select(function(a){return d.push(a.id),e.push(a.name),a}).array(),this._dimNames=e,this.dimensionsInDefOrder=this.dimensions.slice(0),c&&this._sortDimensions(c),this.id=d.join(","),this.depth=this.dimensions.length;var f=this;this.comparer=function(a,b){return f.compare(a,b)}}).add({_sortDimensions:function(a){a.sortDimensionNames(this.dimensionsInDefOrder,function(a){return a.name})},_setAccDimNames:function(a){this._accDimNames=a},accDimensionNames:function(){return this._accDimNames},dimensionNames:function(){return this._dimNames},bind:function(a){this._sortDimensions(a),this.dimensions.forEach(function(b){b.bind(a)})},compare:function(a,b){for(var c=this.dimensions,d=this.depth,e=0;d>e;e++){var f=c[e].compareDatums(a,b);if(f)return f}return 0},key:function(a){for(var b="",c=this._dimNames,d=this.depth,e=a.owner.keySep,f=a.atoms,g=0;d>g;g++){var h=f[c[g]].key;g?b+=e+h:b=h}return b},atomsInfo:function(a){for(var b={},c=this._dimNames,d=this.depth,e=a.atoms,f=(a.owner.keySep,0);d>f;f++){var g=c[f];b[g]=e[g]}return{atoms:b,dimNames:c}},toString:function(){return a.query(this.dimensions).select(function(a){return""+a}).array().join("|")}}),a.type("pvc.data.GroupingDimensionSpec").init(function(a,b,c){this.name=a,this.reverse=!!b,this.id=a+":"+(b?"0":"1"),c&&this.bind(c)}).add({type:null,comparer:null,bind:function(b){b||a.fail.argumentRequired("type"),this.type=b.dimensions(this.name),this.comparer=this.type.atomComparer(this.reverse)},compareDatums:function(a,b){if(this.type.isComparable){var c=this.name;return this.comparer(a.atoms[c],b.atoms[c])}return this.reverse?b.id-a.id:a.id-b.id},toString:function(){return this.name+(this.reverse?" desc":"")}}),Fa.data.GroupingSpec.parse=function(b,c){if(!b)return new Fa.data.GroupingSpec(null,c);var d;a.array.is(b)?d=b:a.string.is(b)&&(d=b.split(/\s*,\s*/));var e=a.query(d).select(function(a){var b=_(a,c);return new Fa.data.GroupingLevelSpec(b,c)});return new Fa.data.GroupingSpec(e,c)};var Sa=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;a.type("pvc.data.DataOper").init(function(b){b||a.fail.argumentRequired("linkParent"),this._linkParent=b}).add({key:null,execute:a.method({isAbstract:!0})}),a.type("pvc.data.GroupingOper",Fa.data.DataOper).init(function(b,c,d){c||a.fail.argumentRequired("groupingSpecs"),this.base(b,d),this._where=a.get(d,"where"),this._visible=a.get(d,"visible",null),this._selected=a.get(d,"selected",null);var e=this._isNull=a.get(d,"isNull",null);this._postFilter=null!=e?function(a){return a.isNull===e}:null;var f=null==this._selected,g="";this._where&&(g=a.get(d,"whereKey"),g||(d&&null!==g?(g=""+a.nextId("dataOperWhereKey"),d.whereKey=g):f=!1));var h=[];this._groupSpecs=a.array.as(c).map(function(c){if(c instanceof Fa.data.GroupingSpec){if(c.type!==b.type)throw a.error.argumentInvalid("groupingSpecText","Invalid associated complex type.")}else c=Fa.data.GroupingSpec.parse(c,b.type);return h.push(c.id),c}),f&&(this.key=h.join("!!")+"||visible:"+this._visible+"||isNull:"+this._isNull+"||where:"+g)}).add({execute:function(){var b=fa(a.query(this._linkParent._datums),{visible:this._visible,selected:this._selected,where:this._where}),c=this._group(b);return this._generateData(c,null,this._linkParent)},executeAdd:function(b,c){var d=fa(a.query(c),{visible:this._visible,selected:this._selected,where:this._where}),e=this._group(d);return this._generateData(e,null,this._linkParent,b),e.datums},_group:function(b){var c={isRoot:!0,treeHeight:a.query(this._groupSpecs).select(function(a){var b=a.levels.length;return b?a.flatteningMode?1:b:0}).reduce(a.add,0),datums:[]};return c.treeHeight>0&&this._groupSpecRecursive(c,a.query(b).array(),0),c},_groupSpecRecursive:function(a,b,c){var d=this._groupSpecs[c];d.flatteningMode?this._groupSpecRecursiveFlattened(a,b,d,c):this._groupSpecRecursiveNormal(a,b,d,c)},_groupSpecRecursiveNormal:function(b,c,d,e){function f(b,c,j){var k=g[j],l=j===h-1,m=i&&l;b.groupSpec=d,b.groupLevelSpec=k;for(var n=b.children=this._groupLevelDatums(k,b,c,!1),o=0,p=n.length;p>o;o++){var q=n[o];if(!m){var r=q.datums;q.datums=[],l?this._groupSpecRecursive(q,r,e+1):f.call(this,q,r,j+1)}a.array.append(b.datums,q.datums)}}var g=d.levels,h=g.length,i=e===this._groupSpecs.length-1;b.isRoot&&(b.label=d.rootLabel),f.call(this,b,c,0)},_groupSpecRecursiveFlattened:function(b,c,d,e){function f(b,c,d){for(var m=h[d],o=d===i-1,p=j&&o,q=this._groupLevelDatums(m,b,c,!0),r=j?b.datums:[],s=0,t=q.length;t>s;s++){var u=q[s],v=u.datums;if(a.array.lazy(b,"_children").push(u),a.hasOwn(l,u.key))a.array.append(r,v);else{var w=k.length;g||(n(u),b.isFlattenGroup=!0),p||(u.datums=[],o?this._groupSpecRecursive(u,v,e+1):f.call(this,u,v,d+1)),a.array.append(r,u.datums),g&&(a.hasOwn(l,u.key)&&(u.isFlattenGroup||a.assert("Must be a parent for duplicate keys to exist."),1===u._children.length&&(k.splice(w,k.length-w),u.isDegenerateFlattenGroup=!0)),n(u),b.isFlattenGroup=!0)}}j||this._groupSpecRecursive(b,r,e+1)}var g=d.flatteningMode===Fa.data.FlatteningMode.DfsPost,h=d.levels,i=h.length,j=e===this._groupSpecs.length-1,k=[],l={};b.children=k,b.childrenByKey=l;var m={key:"",absKey:"",atoms:{},datums:[],label:d.rootLabel,dimNames:[]},n=function(a){k.push(a),l[a.key]=a};g||n(m),f.call(this,m,c,0),g&&n(m),b.datums=m.datums},_groupLevelDatums:function(b,c,d,e){for(var f,g=[],h={},i=this._postFilter,j=b.comparer,k=function(a,b){return j(a.firstDatum,b.firstDatum)},l=0,m=d.length;m>l;l++){var n=d[l],o=b.key(n),p=a.hasOwnProp.call(h,o)&&h[o];p?(!i||i(n))&&p.datums.push(n):(p=b.atomsInfo(n),p.key=o,p.firstDatum=n,p.datums=!i||i(n)?[n]:[],e&&(f||(f=n.owner.keySep),this._onNewChildNodeFlattened(o,f,p,b,c)),a.array.insert(g,p,k),h[o]=p)}if(i)for(l=g.length;l--;)g[l].datums.length||g.splice(l,1);return g},_onNewChildNodeFlattened:function(b,c,d,e,f){if(a.copy(d.atoms,f.atoms),d.dimNames=e.accDimensionNames(),f.dimNames.length){var g=f.absKey+c+b;d.absKey=g,d.key=Fa.data.Complex.rightTrimKeySep(g,c)}else d.absKey=b},_generateData:function(b,c,d,e){var f,g;if(b.isRoot)e?(f=e,da.call(f,b.datums)):(g=!0,f=new Fa.data.Data({linkParent:d,datums:b.datums}),f.treeHeight=b.treeHeight,f._groupOper=this);else if(e&&(f=d.child(b.key),f&&ca.call(f,b.datums)),!f){g=!0;var h,i;e&&(i=d.childNodes)&&(h=~a.array.binarySearch(i,b.datums[0],c.groupLevelSpec.comparer)),f=new Fa.data.Data({parent:d,atoms:b.atoms,atomsDimNames:b.dimNames,datums:b.datums,index:h})}if(g){b.isFlattenGroup&&(f._isFlattenGroup=!0,f._isDegenerateFlattenGroup=!!b.isDegenerateFlattenGroup);var j=b.label;j&&(f.label+=j,f.absLabel+=j)}var k=b.children,l=k&&k.length;if(l){g&&(f._groupSpec=b.groupSpec,f._groupLevelSpec=b.groupLevelSpec);for(var m=0;l>m;m++)this._generateData(k[m],b,f,e)}else if(g&&!b.isRoot){var n=f.root._leafs;f.leafIndex=n.length,n.push(f)}return f}}),a.type("pvc.data.LinearInterpolationOper").init(function(b,c,d,e,f,g,h){this._newDatums=[],this._data=d;var i=e.flatten(b).children(),j=f.isBound()?f.flatten(c,{visible:!0,isNull:!1}).children().array():[null];this._isCatDiscrete=e.grouping.isDiscrete(),this._firstCatDim=this._isCatDiscrete?null:b.owner.dimensions(e.firstDimensionName()),this._stretchEnds=h;var k=this._valDim=b.owner.dimensions(g.firstDimensionName()),l={visible:!0,zeroIfNone:!1};this._catInfos=i.select(function(a,b){var c=d.child(a.key),e={data:c||a,value:a.value,isInterpolated:!1,serInfos:null,index:b};return e.serInfos=j.map(function(a){var b=c;b&&a&&(b=b.child(a.key));var d=b?b.dimensions(k.name).value(l):null;return{data:a,group:b,value:d,isNull:null==d,catInfo:e}}),e}).array(),this._serCount=j.length,this._serStates=a.range(0,this._serCount).select(function(a){return new Fa.data.LinearInterpolationOperSeriesState(this,a)},this).array()}).add({interpolate:function(){for(var a;a=this._catInfos.shift();)a.serInfos.forEach(this._visitSeries,this);var b=this._newDatums;b.length&&this._data.owner.add(b)},_visitSeries:function(a,b){this._serStates[b].visit(a)},nextUnprocessedNonNullCategOfSeries:function(a){for(var b=0,c=this._catInfos.length;c>b;){var d=this._catInfos[b++],e=d.serInfos[a];if(!e.isNull)return e}}}),a.type("pvc.data.LinearInterpolationOperSeriesState").init(function(a,b){this.interpolation=a,this.index=b,this._lastNonNull(null)}).add({visit:function(a){a.isNull?this._interpolate(a):this._lastNonNull(a)},_lastNonNull:function(a){return arguments.length&&(this.__lastNonNull=a,this.__nextNonNull=void 0),this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(void 0===this.__nextNonNull){var b=this.__lastNonNull,c=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(c&&b){var d=b.value,e=c.value,f=e-d;if(this.interpolation._isCatDiscrete){var g=c.catInfo.index-b.catInfo.index;g>=2||a.assert("Must have at least one interpolation point."),this._stepValue=f/g,this._middleIndex=~~(g/2);var h=g-1;this._isOdd=h%2>0}else{var i=+b.catInfo.value,j=+c.catInfo.value,k=j-i;this._steep=f/k,this._middleCat=(j+i)/2}}}},_interpolate:function(b){this._initInterpData();var c=this.__nextNonNull,d=this.__lastNonNull,e=c||d;if(e){var f,g,h=this.interpolation,i=b.catInfo;if(c&&d)if(h._isCatDiscrete){var j=i.index-d.catInfo.index;f=d.value+this._stepValue*j,g=this._isOdd?j<this._middleIndex?d.group:c.group:j<=this._middleIndex?d.group:c.group}else{var k=+i.value,l=+d.catInfo.value;f=d.value+this._steep*(k-l),g=k<this._middleCat?d.group:c.group}else{if(!h._stretchEnds)return;f=e.value,g=e.group}var m=Object.create(g._datums[0].atoms);a.copyOwn(m,i.data.atoms);var n=h._valDim.intern(f,!0);m[n.dimension.name]=n,h._newDatums.push(new Fa.data.InterpolationDatum(g.owner,m,"linear"))}}}),a.type("pvc.data.ZeroInterpolationOper").init(function(b,c,d,e,f,g,h){this._newDatums=[],this._data=d;var i=e.flatten(b).children(),j=f.isBound()?f.flatten(c,{visible:!0,isNull:!1}).children().array():[null];this._isCatDiscrete=e.grouping.isDiscrete(),this._firstCatDim=this._isCatDiscrete?null:b.owner.dimensions(e.firstDimensionName()),this._stretchEnds=h;var k=this._valDim=b.owner.dimensions(g.firstDimensionName()),l={visible:!0,zeroIfNone:!1};this._catInfos=i.select(function(a,b){var c=d.child(a.key),e={data:c||a,value:a.value,isInterpolated:!1,serInfos:null,index:b};return e.serInfos=j.map(function(a){var b=c;b&&a&&(b=b.child(a.key));var d=b?b.dimensions(k.name).value(l):null;return{data:a,group:b,value:d,isNull:null==d,catInfo:e}}),e}).array(),this._serCount=j.length,this._serStates=a.range(0,this._serCount).select(function(a){return new Fa.data.ZeroInterpolationOperSeriesState(this,a)},this).array()}).add({interpolate:function(){for(var a;a=this._catInfos.shift();)a.serInfos.forEach(this._visitSeries,this);var b=this._newDatums;b.length&&this._data.owner.add(b)},_visitSeries:function(a,b){this._serStates[b].visit(a)},nextUnprocessedNonNullCategOfSeries:function(a){for(var b=0,c=this._catInfos.length;c>b;){var d=this._catInfos[b++],e=d.serInfos[a];if(!e.isNull)return e}}}),a.type("pvc.data.ZeroInterpolationOperSeriesState").init(function(a,b){this.interpolation=a,this.index=b,this._lastNonNull(null)}).add({visit:function(a){a.isNull?this._interpolate(a):this._lastNonNull(a)},_lastNonNull:function(a){return arguments.length&&(this.__lastNonNull=a,this.__nextNonNull=void 0),this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(void 0===this.__nextNonNull){var b=this.__lastNonNull,c=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(c&&b)if(b.value,c.value,this.interpolation._isCatDiscrete){var d=c.catInfo.index-b.catInfo.index;d>=2||a.assert("Must have at least one interpolation point."),this._middleIndex=~~(d/2);var e=d-1;this._isOdd=e%2>0}else{var f=+b.catInfo.value,g=+c.catInfo.value;this._middleCat=(g+f)/2}}},_interpolate:function(b){this._initInterpData();var c=this.__nextNonNull,d=this.__lastNonNull,e=c||d;if(e){var f,g=this.interpolation,h=b.catInfo;if(c&&d)if(g._isCatDiscrete){var i=h.index-d.catInfo.index;f=this._isOdd?i<this._middleIndex?d.group:c.group:i<=this._middleIndex?d.group:c.group}else{var j=+h.value;f=j<this._middleCat?d.group:c.group}else{if(!g._stretchEnds)return;f=e.group}var k=Object.create(f._datums[0].atoms);a.copyOwn(k,h.data.atoms);var l=g._zeroAtom||(g._zeroAtom=g._valDim.intern(0,!0));k[l.dimension.name]=l,g._newDatums.push(new Fa.data.InterpolationDatum(f.owner,k,"zero"))}}}),Fa.data.Data.add({load:function(b,c){X.call(this);var d=a.get(c,"where"),e=a.get(c,"isNull"),f=a.query(b).select(function(a){var b=new Fa.data.Datum(this,a);return e&&e(b)&&(b.isNull=!0),d&&!d(b)?null:b},this);aa.call(this,f,{isAdditive:!1,doAtomGC:!0})},clearVirtuals:function(){var b=this._datums;if(b){this._sumAbsCache=null;for(var c,d=this._visibleNotNullDatums,e=this._selectedNotNullDatums,f=this._datumsByKey,g=this._datumsById,h=0,i=b.length;i>h;){
var j=b[h];if(j.isVirtual){var k=j.id,l=j.key;b.splice(h,1),delete g[k],delete f[l],e&&j.isSelected&&e.rem(k),j.isVisible&&d.rem(k),i--,c=!0}else h++}if(c){if(!b.length&&this.parent)return void this.dispose();var m=this.childNodes;if(m)for(h=0,i=m.length;i>h;){var n=m[h];n.clearVirtuals(),n.parent?h++:i--}this._linkChildren&&this._linkChildren.forEach(function(a){a.clearVirtuals()})}}a.eachOwn(this._dimensions,function(a){L.call(a)})},add:function(a){X.call(this),aa.call(this,a,{isAdditive:!0,doAtomGC:!0})},groupBy:function(a,b){var c,d,e=new Fa.data.GroupingOper(this,a,b),f=e.key;return f&&(c=this._groupByCache,d=c&&c[f]),d?Fa.debug>=7&&Fa.log("[GroupBy] Cache key hit '"+f+"'"):(Fa.debug>=7&&Fa.log("[GroupBy] "+(f?"Cache key not found: '"+f+"'":"No Cache key")),d=e.execute(),f&&((c||(this._groupByCache={}))[f]=d)),d},where:function(b,c){var d;if(b)b=ea.call(this,b,c),d=ia.call(this,b,c);else{if(!c)return a.query(this._datums);d=fa(a.query(this._datums),c)}var e=ga(b,c);return new Fa.data.Data({linkParent:this,datums:d,where:e})},datums:function(b,c){return b?(b=ea.call(this,b,c),ia.call(this,b,c)):c?fa(a.query(this._datums),c):a.query(this._datums)},datum:function(b,c){return b||a.fail.argumentRequired("whereSpec"),b=ea.call(this,b,c),ia.call(this,b,c).first()||null},dimensionsSumAbs:function(b,c){var d=b+":"+H(c),e=a.getOwn(this._sumAbsCache,d);return null==e&&(e=this.children().where(function(a){return!a._isFlattenGroup||a._isDegenerateFlattenGroup}).select(function(a){return a.dimensions(b).valueAbs(c)||0},this).reduce(a.add,0),(this._sumAbsCache||(this._sumAbsCache={}))[d]=e),e}}),Fa.data.Data.add({getInfo:function(){var b=["DATA SUMMARY",Fa.logSeparator,"  Dimension",Fa.logSeparator];return a.eachOwn(this.dimensions(),function(a,c){var d=a.count(),e=a.type,f=[];f.push('"'+e.label+'"'),f.push(e.valueTypeName),e.isComparable&&f.push("comparable"),e.isDiscrete||f.push("continuous"),e.isHidden&&f.push("hidden"),b.push("  "+c+" ("+f.join(", ")+") ("+d+")\n\t"+a.atoms().slice(0,10).map(function(a){return a.label}).join(", ")+(d>10?"...":""))}),b.join("\n")},getValues:function(){return b.range(0,this.getCategoriesSize()).map(function(a){return this._getValuesForCategoryIndex(a)},this)},_getDimensionValues:function(a){return this.dimensions(a).atoms().map(function(a){return a.value})},_getDimensionVisibleValues:function(a){return this.dimensions(a).atoms({visible:!0}).map(function(a){return a.value})},getSeries:function(){return this._getDimensionValues("series")},getVisibleSeriesIndexes:function(){return this.dimensions("series").indexes({visible:!0})},getVisibleCategoriesIndexes:function(){return this.dimensions("category").indexes({visible:!0})},getVisibleSeries:function(){return this._getDimensionVisibleValues("series")},getCategories:function(){return this._getDimensionValues("category")},getVisibleCategories:function(){return this._getDimensionVisibleValues("category")},_getValuesForCategoryIndex:function(b){var c=this.dimensions("category").atoms()[b],d=this.datums({category:c}).uniqueIndex(function(a){return a.atoms.series.key});return this.dimensions("series").atoms().map(function(b){var c=a.getOwn(d,b.key);return c?c.atoms.value.value:null})},getSeriesSize:function(){var a=this.dimensions("series",{assertExists:!1});return a?a.count():0},getCategoriesSize:function(){var a=this.dimensions("category",{assertExists:!1});return a?a.count():0}}),a.scope(function(){var b=a.makeEnum(["Interactive","ShowsActivity","ShowsSelection","ShowsTooltip","Selectable","Unselectable","Hoverable","Clickable","DoubleClickable","SelectableByClick","SelectableByRubberband","SelectableByFocusWindow","Animatable"]);b.ShowsInteraction=b.ShowsActivity|b.ShowsSelection,b.Actionable=b.Hoverable|b.Clickable|b.DoubleClickable|b.SelectableByClick,b.HandlesEvents=b.Actionable|b.ShowsTooltip,b.HandlesClickEvent=b.Clickable|b.SelectableByClick,a.type("pvc.visual.Interactive").addStatic(b).addStatic({ShowsAny:b.ShowsInteraction|b.ShowsTooltip,SelectableAny:b.Selectable|b.SelectableByClick|b.SelectableByRubberband|b.SelectableByFocusWindow}).add({_ibits:-1}).add(a.query(a.ownKeys(b)).object({name:a.firstLowerCase,value:function(a){var c=b[a];return function(){return!!(this._ibits&c)}}}))}),a.type("pvc.visual.Scene").init(function(c,d){if(Fa.debug>=4&&(this.id=a.nextId("scene")),this._renderId=0,this.renderState={},b.Dom.Node.call(this,null),this.parent=c||null,c){this.root=c.root;var e=a.get(d,"index",null);c.insertAt(this,e)}else this.root=this,this._active=null,this._panel=a.get(d,"panel")||a.fail.argumentRequired("panel","Argument is required on root scene.");var f,g,h,i,j,k,l,m=a.array.to(a.get(d,"source"));m&&m.length?(this.source=m,f=m[0],f instanceof Fa.data.Data?(g=f,j=m,h=g.firstDatum()||a.query(j).select(function(a){return a.firstDatum()}).first(a.notNully)):(f instanceof Fa.data.Datum||a.assert("not a datum"),h=f,i=m),k=f.atoms,l=h&&h.atoms||f.atoms):k=l=c?Object.create(c.atoms):{},this.atoms=k,this.firstAtoms=l,j&&(this.groups=j),g&&(this.group=g),i&&(this._datums=i),h&&(this.datum=h),(!f||f.isNull)&&(this.isNull=!0),this.vars=c?Object.create(c.vars):{}}).add(b.Dom.Node).add(Fa.visual.Interactive).add({source:null,groups:null,group:null,_datums:null,datum:null,isNull:!1,get:function(a,b){var c=this.vars[a];return c&&c[b||"value"]},getSeries:function(){return this.get("series")},getCategory:function(){return this.get("category")},getValue:function(){return this.get("value")},getTick:function(){return this.get("tick")},getX:function(){return this.get("x")},getY:function(){return this.get("y")},getSeriesLabel:function(){return this.get("series","label")},getCategoryLabel:function(){return this.get("category","label")},getValueLabel:function(){return this.get("value","label")},getTickLabel:function(){return this.get("tick","label")},getXLabel:function(){return this.get("x","label")},getYLabel:function(){return this.get("y","label")},data:function(){var a=this.group;if(!a){for(var b=this;!a&&(b=b.parent);)a=b.group;a||(a=this.panel.data)}return a},datums:function(){return this.groups?a.query(this.groups).selectMany(function(a){return a.datums()}):this._datums?a.query(this._datums):a.query()},format:function(b){return a.format(b,this._formatScope,this)},_formatScope:function(b){if("#"===b.charAt(0)){if(b=b.substr(1).split("."),b.length>2)throw a.error.operationInvalid("Scene format mask is invalid.");var c=this.firstAtoms[b[0]];if(c){if(b.length>1)switch(b[1]){case"value":return c.value;case"label":break;default:throw a.error.operationInvalid("Scene format mask is invalid.")}return c}return null}return a.getPath(this.vars,b)},isRoot:function(){return this.root===this},panel:function(){return this.root._panel},chart:function(){return this.root._panel.chart},compatVersion:function(){return this.root._panel.compatVersion()},children:function(){var b=this.childNodes;return b.length?a.query(b):a.query()},leafs:function(){function b(a){for(;a.childNodes.length;)a=a.childNodes[0];return a}var c=this;return a.query(function(a){if(!a){var d=b(c);return d===c?0:(this.item=d,1)}var e=this.item.nextSibling;if(e)return this.item=e,1;for(var f=this.item;f!==c&&(f=f.parentNode);)if(e=f.nextSibling)return this.item=b(e),1;return 0})},anyInteraction:function(){return!!this.root._active||this.anySelected()},isActive:!1,setActive:function(a){a=!!a,this.isActive!==a&&la.call(this.root,this.isActive?null:this)},clearActive:function(){return la.call(this.root,null)},anyActive:function(){return!!this.root._active},active:function(){return this.root._active},activeSeries:function(){var a,b=this.active();return b&&(a=b.vars.series)&&a.value},isActiveSeries:function(){if(this.isActive)return!0;var a=this.renderState.isActiveSeries;if(null==a){var b;a=null!=(b=this.activeSeries())&&b===this.vars.series.value,this.renderState.isActiveSeries=a}return a},isActiveDatum:function(){return!!this.isActive},isActiveDescendantOrSelf:function(){return!!this.isActive||a.lazy(this.renderState,"isActiveDescOrSelf",this._calcIsActiveDescOrSelf,this)},_calcIsActiveDescOrSelf:function(){var a=this.active();if(a)for(;a=a.parent;)if(a===this)return!0;return!1},isVisible:function(){return this._visibleInfo().is},anyVisible:function(){return this._visibleInfo().any},_visibleInfo:function(){return a.lazy(this.renderState,"visibleInfo",this._createVisibleInfo,this)},_createVisibleInfo:function(){var b=this.chart().data.owner.visibleCount()>0,c=b&&this.datums().any(a.propGet("isVisible"));return{any:b,is:c}},isSelected:function(){return this._selectedInfo().is},anySelected:function(){return this._selectedInfo().any},_selectedInfo:function(){return a.lazy(this.renderState,"selectedInfo",this._createSelectedInfo,this)},_createSelectedInfo:function(){var a=this.chart().data.owner.selectedCount()>0,b=a&&this.datums().any(Ra);return{any:a,is:b}},select:function(b){var c=this,d=c.datums().array();if(d.length){var e=c.chart();e._updatingSelections(function(){d=e._onUserSelection(d),d&&d.length&&(e.options.ctrlSelectMode&&a.get(b,"replace",!0)?e.data.replaceSelected(d):Fa.data.Data.toggleSelected(d))})}},isSelectedDescendantOrSelf:function(){return!!this.isSelected()||a.lazy(this.renderState,"isSelectedDescOrSelf",this._calcIsSelectedDescOrSelf,this)},_calcIsSelectedDescOrSelf:function(){var a=this.firstChild;if(a)do if(a.isSelectedDescendantOrSelf())return!0;while(a=a.nextSibling);return!1},toggleVisible:function(){Fa.data.Data.toggleVisible(this.datums())&&this.chart().render(!0,!0,!1)}}),Fa.visual.Scene.prototype.variable=function(b,c){var d,e=this;if(e._vars&&e._vars[b])void 0!==c&&(d=a.set({},"_"+b+"EvalCore",a.fun.to(c)));else{e.hasOwnProperty("_vars")||(e._vars=a.create(e._vars)),e._vars[b]=!0,d={};var f="_"+b+"Eval";d[b]=na(b,f);var g=f+"Core";a.hasOwn(e,f)||(d[f]=a.methodCaller(g)),a.hasOwn(e,g)||(d[g]=a.fun.to(void 0===c?null:c))}return d&&e.constructor.add(d),e};var Ta=Fa.visual.ValueLabelVar=function(a,b,c,d){this.value=a,this.label=b,void 0!==c&&(this.rawValue=c),void 0!==d&&(this.absLabel=d)};if(a.set(Ta.prototype,"rawValue",void 0,"absLabel",void 0,"setValue",function(a){return this.value=a,this},"setLabel",function(a){return this.label=a,this},"clone",function(){return new Ta(this.value,this.label,this.rawValue)},"toString",function(){var a=this.label||this.value;return null==a?"":"string"!=typeof a?""+a:a}),Ta.fromComplex=function(a){return a?new Ta(a.value,a.label,a.rawValue,a.absLabel):new Ta(null,"",null)},Ta.fromAtom=Ta.fromComplex,a.type("pvc.visual.Context").init(function(a,b,c){this.chart=a.chart,this.panel=a,oa.call(this,b,c)}).add({isPinned:!1,pin:function(){return this.isPinned=!0,this},compatVersion:function(){return this.panel.compatVersion()},finished:function(a){return this.sign.finished(a)},delegate:function(a){return this.sign.delegate(a)},getV1Series:function(){var b;return a.nullyTo(this.scene.firstAtoms&&(b=this.scene.firstAtoms[this.panel._getV1DimName("series")])&&b.rawValue,"Series")},getV1Category:function(){var a;return this.scene.firstAtoms&&(a=this.scene.firstAtoms[this.panel._getV1DimName("category")])&&a.rawValue},getV1Value:function(){var a;return this.scene.firstAtoms&&(a=this.scene.firstAtoms[this.panel._getV1DimName("value")])&&a.value},getV1Datum:function(){return this.panel._getV1Datum(this.scene)},get:function(a,b){return this.scene.get(a,b)},getSeries:function(){return this.scene.get("series")},getCategory:function(){return this.scene.get("category")},getValue:function(){return this.scene.get("value")},getTick:function(){return this.scene.get("tick")},getX:function(){return this.scene.get("x")},getY:function(){return this.scene.get("y")},getSeriesLabel:function(){return this.scene.get("series","label")},getCategoryLabel:function(){return this.scene.get("category","label")},getValueLabel:function(){return this.scene.get("value","label")},getTickLabel:function(){return this.scene.get("tick","label")},getXLabel:function(){return this.scene.get("x","label")},getYLabel:function(){return this.scene.get("y","label")},select:function(a){return this.scene.select(a)},toggleVisible:function(){return this.scene.toggleVisible()},click:function(){var a=this;if(a.clickable()&&a.panel._onClick(a),a.selectableByClick()){var b=a.event;a.select({replace:!b||!b.ctrlKey})}},doubleClick:function(){this.doubleClickable()&&this.panel._onDoubleClick(this)},clickable:function(){var a=this;return(a.sign?a.sign.clickable():a.panel.clickable())&&(!a.scene||a.scene.clickable())},selectableByClick:function(){var a=this;return(a.sign?a.sign.selectableByClick():a.panel.selectableByClick())&&(!a.scene||a.scene.selectableByClick())},doubleClickable:function(){var a=this;return(a.sign?a.sign.doubleClickable():a.panel.doubleClickable())&&(!a.scene||a.scene.doubleClickable())},hoverable:function(){var a=this;return(a.sign?a.sign.hoverable():a.panel.hoverable())&&(!a.scene||a.scene.hoverable())}}),Object.defineProperty)try{Object.defineProperty(Fa.visual.Context.prototype,"parent",{get:function(){throw a.error.operationInvalid("The 'this.parent.index' idiom has no equivalent in this version. Please try 'this.pvMark.parent.index'.")}})}catch(a){}a.space("pvc.visual").TraversalMode=a.makeEnum(["Tree","FlattenedSingleLevel","FlattenDfsPre","FlattenDfsPost"]),a.type("pvc.visual.Role").init(function(b,c){this.name=b,this.label=a.get(c,"label")||Fa.buildTitleFromName(b),this.index=a.get(c,"index")||0,this.dimensionDefaults=a.get(c,"dimensionDefaults")||{},a.get(c,"isRequired",!1)&&(this.isRequired=!0),a.get(c,"autoCreateDimension",!1)&&(this.autoCreateDimension=!0);var d=a.get(c,"defaultSourceRole");d&&(this.defaultSourceRoleName=d);var e=a.get(c,"defaultDimension");if(e&&(this.defaultDimensionName=e),!e&&this.autoCreateDimension)throw a.error.argumentRequired("defaultDimension");var f,g=a.get(c,"requireIsDiscrete");if(null!=g&&(g||(f=!0)),null!=f&&(f=a.get(c,"requireSingleDimension",!1))){a.get(c,"isMeasure",!1)&&(this.isMeasure=!0,a.get(c,"isPercent",!1)&&(this.isPercent=!0));var h=a.get(c,"valueType",null);h!==this.valueType&&(this.valueType=h,this.dimensionDefaults.valueType=h)}f!==this.requireSingleDimension&&(this.requireSingleDimension=f),g!=this.requireIsDiscrete&&(this.requireIsDiscrete=!!g,this.dimensionDefaults.isDiscrete=this.requireIsDiscrete);var i=a.get(c,"traversalMode");null!=i&&i!==this.traversalMode&&(this.traversalMode=i)}).add({isRequired:!1,requireSingleDimension:!1,valueType:null,requireIsDiscrete:null,isMeasure:!1,isPercent:!1,defaultSourceRoleName:null,defaultDimensionName:null,grouping:null,traversalMode:Fa.visual.TraversalMode.FlattenedSingleLevel,rootLabel:"",autoCreateDimension:!1,isReversed:!1,label:null,sourceRole:null,isDefaultSourceRole:!1,firstDimensionType:function(){var a=this.grouping;return a&&a.firstDimensionType()},firstDimensionName:function(){var a=this.grouping;return a&&a.firstDimensionName()},firstDimensionValueType:function(){var a=this.grouping;return a&&a.firstDimensionValueType()},isDiscrete:function(){var a=this.grouping;return a&&a.isDiscrete()},setSourceRole:function(a,b){this.sourceRole=a,this.isDefaultSourceRole=!!b},setIsReversed:function(a){a?this.isReversed=!0:delete this.isReversed},setTraversalMode:function(b){var c=Fa.visual.TraversalMode;b=a.nullyTo(b,c.FlattenedSingleLevel),b!==this.traversalMode&&(b===c.FlattenedSingleLevel?delete this.traversalMode:this.traversalMode=b)},setRootLabel:function(a){a!==this.rootLabel&&(a?this.rootLabel=a:delete this.rootLabel,this.grouping&&this._updateBind(this.grouping))},flatten:function(b,c){var d=this.flattenedGrouping(c)||a.fail.operationInvalid("Role is unbound.");return b.groupBy(d,c)},flattenedGrouping:function(a){var b=this.grouping;if(b){a=a?Object.create(a):{};var c=a.flatteningMode;return null==c&&(c=a.flatteningMode=this._flatteningMode()),null!=a.isSingleLevel||c||(a.isSingleLevel=!0),b.ensure(a)}},_flatteningMode:function(){var a=Fa.visual.TraversalMode,b=Fa.data.FlatteningMode;switch(this.traversalMode){case a.FlattenDfsPre:return b.DfsPre;case a.FlattenDfsPost:return b.DfsPost}return a.None},select:function(b,c){var d=this.grouping;if(d)return a.setUDefaults(c,"flatteningMode",Fa.data.FlatteningMode.None),b.groupBy(d.ensure(c),c)},view:function(a){var b=this.grouping;return b?b.view(a):void 0},preBind:function(a){return this.__grouping=a,this},isPreBound:function(){return!!this.__grouping},preBoundGrouping:function(){return this.__grouping},isBound:function(){return!!this.grouping},postBind:function(a){var b=this.__grouping;return b&&(delete this.__grouping,b.bind(a),this.bind(b)),this},bind:function(a){return a=this._validateBind(a),this._updateBind(a),this},_validateBind:function(b){if(b)if(b.isNull())b=null;else{if(this.requireSingleDimension&&!b.isSingleDimension)throw a.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name]);var c=this.valueType,d=this.requireIsDiscrete;b.dimensions().each(function(b){var e=b.type;if(c&&e.valueType!==c)throw a.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,e.name,Fa.data.DimensionType.valueTypeName(c),e.valueTypeName]);if(null!=d&&e.isDiscrete!==d){if(!d)throw a.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts {2} dimensions.",[this.name,e.name,d?"discrete":"continuous"]);e._toDiscrete()}},this)}return b},_updateBind:function(a){this.grouping&&this.grouping.dimensions().each(function(a){a.type&&s.call(a.type,this)},this),this.grouping=a,this.grouping&&(this.grouping=this.grouping.ensure({reverse:this.isReversed,rootLabel:this.rootLabel}),this.grouping.dimensions().each(function(a){r.call(a.type,this)},this))}}),a.type("pvc.visual.RoleVarHelper").init(function(b,c,d){var e=a.get(d,"hasPercentSubVar",!1),f=a.get(d,"roleVar"),g=this.grouping=c&&c.grouping;if(g){this.role=c,this.sourceRoleName=c.sourceRole&&c.sourceRole.name;var h=b.panel();this.panel=h,g.isDiscrete()||(this.rootContDim=h.data.owner.dimensions(g.firstDimensionName()),e&&(this.percentFormatter=h.chart.options.percentValueFormat))}if(!f){if(!c)throw a.error.operationInvalid("Role is not defined, so the roleVar argument is required.");f=c.name}if(!g){var i=b.vars[f]=new Ta(null,"");e&&(i.percent=new Ta(null,""))}this.roleVarName=f,b["is"+a.firstUpperCase(f)+"Bound"]=!!g,a.get(d,"allowNestedVars")&&(this.allowNestedVars=!0)}).add({allowNestedVars:!1,isBound:function(){return!!this.grouping},onNewScene:function(b,c){if(this.grouping){var d=this.roleVarName;if(this.allowNestedVars?!a.hasOwnProp.call(b.vars,d):!b.vars[d]){var e=this.sourceRoleName;if(e){var f=a.getOwn(b.vars,e);if(f)return void(b.vars[d]=f.clone())}if(c){var g,h=this.rootContDim;if(h){var i,j,k=b.group,l=k?k.singleDatum():b.datum;if(l)l.isNull||(g=Ta.fromAtom(l.atoms[h.name]),null!=g.value&&this.percentFormatter&&(k?(j=k.dimensions(h.name),i=j.valuePercent({visible:!0})):i=b.data().dimensions(h.name).percent(g.value)));else if(k){j=k.dimensions(h.name);var m=j.value({visible:!0,zeroIfNone:!1});if(null!=m){var n=h.format(m);g=new Ta(m,n,m),this.percentFormatter&&(i=j.valuePercent({visible:!0}))}}g&&this.percentFormatter&&(g.percent=null==g.value?new Ta(null,""):new Ta(i,this.percentFormatter.call(null,i)))}else{var o=b.datum;if(o&&!o.isNull){var p=this.grouping.view(o);g=Ta.fromComplex(p)}}g||(g=new Ta(null,""),this.percentFormatter&&(g.percent=new Ta(null,""))),b.vars[d]=g}}}}}),Ga.prototype.getSign=function(){return this.sign||pa(this)},Ga.prototype.getScene=function(){return this.getSign().scene()},Ga.prototype.getContext=function(){return this.getSign().context()},Ga.prototype.preBuildInstance=function(a){var b=a.data;b instanceof Fa.visual.Scene&&ka.call(b,this.renderId())},a.type("pvc.visual.BasicSign").init(function(b,c){this.chart=b.chart,this.panel=b,!c.sign||a.assert("Mark already has an attached Sign."),this.pvMark=c,c.sign=this}).add({compatVersion:function(){return this.chart.compatVersion()},localProperty:function(a,b){return this.pvMark.localProperty(a,b),this},lock:function(a,b){return this.lockMark(a,this._bindWhenFun(b,a))},optional:function(a,b,c){return this.optionalMark(a,this._bindWhenFun(b,a),c)},lockMark:function(a,b){return this.pvMark.lock(a,b),this},optionalMark:function(a,b,c){return this.pvMark[a](b,c),this},delegate:function(a,b){return this.pvMark.delegate(a,b)},delegateExtension:function(a){return this.pvMark.delegate(a,Fa.extensionTag)},delegateNotExtension:function(a){return this.pvMark.delegateExcept(a,Fa.extensionTag)},hasDelegate:function(a){return this.pvMark.hasDelegate(a)},_createPropInterceptor:function(a,b){var c=this;return function(){var d=this.sign;return d&&d===c?b.apply(c,arguments):c._getPvSceneProp(a,this.index)}},_getPvSceneProp:function(b,c){var d=this.pvMark,e=d.scene;if(e){var f=d.hasOwnProperty("index")?d.index:Math.min(c,e.length-1);if(null!=f)return e[f][b]}throw a.error.operationInvalid("Cannot evaluate inherited property.")},_bindWhenFun:function(b,c){if(a.fun.is(b)){var d=this;return d._createPropInterceptor(c,function(a){return b.call(d,a)})}return b},_lockDynamic:function(a,b){var c=this;return c.lockMark(a,c._createPropInterceptor(a,function(a){return c[b].call(c,a)}))},scene:function(){var a=this.pvMark.instance(),b=a&&a.data;return b instanceof Fa.visual.Scene?b:null},instanceState:function(a){return this.pvMark.instanceState(a)},context:function(a,b){var c;return b||!(c=this.instanceState())?this._createContext(a):c.cccContext||(c.cccContext=this._createContext(a))},_createContext:function(a){return new Fa.visual.Context(this.panel,this.pvMark,a)}}),a.type("pvc.visual.Sign",Fa.visual.BasicSign).init(function(b,c,d){var e=this;e.base(b,c,d),e._ibits=b._ibits;var f=a.get(d,"extensionId");if(null!=f&&(e.extensionAbsIds=a.array.to(b._makeExtensionAbsId(f))),e.isActiveSeriesAware=a.get(d,"activeSeriesAware",!0),e.isActiveSeriesAware){var g=b.visualRoles,h=g&&g.series;h&&h.isBound()||(e.isActiveSeriesAware=!1)}c.wrapper(a.get(d,"wrapper")||e.createDefaultWrapper()),a.get(d,"freeColor",!0)||e._bindProperty("fillStyle","fillColor","color")._bindProperty("strokeStyle","strokeColor","color")}).postInit(function(a,b,c){this._addInteractive(c),a._addSign(this)}).add({createDefaultWrapper:function(){var a=this;return function(b){return function(c){return b.call(a.context(),c)}}},property:function(b){var c=a.firstUpperCase(b),d="base"+c,e="default"+c,f="normal"+c,g="interactive"+c,h={};return h[b]=function(a,b){this._finished=!1,this._arg=b;var c=this[d](a,b);return null==c?null:this._finished?c:(c=this.showsInteraction()&&a.anyInteraction()?this[g](a,c,b):this[f](a,c,b),this._arg=null,c)},h[d]=function(){return this.delegateExtension()},h[e]=function(){},h[f]=function(a,b){return b},h[g]=function(a,b){return b},this.constructor.add(h),this},anyInteraction:function(a){return a.anyInteraction()},finished:function(a){return this._finished=!0,a},applyExtensions:function(){if(!this._extended){this._extended=!0;var a=this.extensionAbsIds;a&&a.forEach(function(a){this.panel.extendAbs(this.pvMark,a)},this)}return this},intercept:function(a,b){var c=this._createPropInterceptor(a,b);return this._intercept(a,c)},lockDimensions:function(){return this.pvMark.lock("left").lock("right").lock("top").lock("bottom").lock("width").lock("height"),this},_extensionKeyArgs:{tag:Fa.extensionTag},_bindProperty:function(b,c,d){var e=this;d||(d=c);var f="default"+a.firstUpperCase(d);if(a.fun.is(e[f])&&!e.pvMark.hasDelegateValue(b,Fa.extensionTag)){var g=function(a){return e[f](a,e._arg)};e.pvMark.intercept(b,g,e._extensionKeyArgs)}var h=this._createPropInterceptor(b,function(a){return e[c](a)});return e._intercept(b,h)},_intercept:function(b,c){var d=this.pvMark,e=this.extensionAbsIds;return e&&a.query(e).select(function(a){return this.panel._getExtensionAbs(a,b)},this).where(a.notUndef).each(function(a){a=d.wrap(a,b),d.intercept(b,a,this._extensionKeyArgs)},this),(d._intercepted||(d._intercepted={}))[b]=!0,d.intercept(b,c),this}}).prototype.property("color").constructor.add(Fa.visual.Interactive).add({extensionAbsIds:null,_addInteractive:function(b){var c=this,d=a.get;if(c.interactive()){var e=c._ibits,f=Fa.visual.Interactive;d(b,"noTooltip")&&(e&=~f.ShowsTooltip),d(b,"noHover")&&(e&=~f.Hoverable),d(b,"noClick")&&(e&=~f.Clickable),d(b,"noDoubleClick")&&(e&=~f.DoubleClickable),d(b,"noSelect")?e&=~f.SelectableAny:this.selectable()&&(d(b,"noClickSelect")&&(e&=~f.SelectableByClick),d(b,"noRubberSelect")&&(e&=~f.SelectableByRubberband)),c.showsInteraction()&&(d(b,"showsInteraction")===!1&&(e&=~f.ShowsInteraction),c.showsActivity()&&d(b,"showsActivity")===!1&&(e&=~f.ShowsActivity),c.showsSelection()&&d(b,"showsSelection")===!1&&(e&=~f.ShowsSelection)),c._ibits=e}c.handlesEvents()?(c.showsTooltip()&&c._addPropTooltip(d(b,"tooltipArgs")),c.hoverable()&&c._addPropHoverable(),c.handlesClickEvent()&&c._addPropClick(),c.doubleClickable()&&c._addPropDoubleClick()):c.pvMark.events("none")},fillColor:function(a){return this.color(a,"fill")},strokeColor:function(a){return this.color(a,"stroke")},defaultColor:function(a){return this.defaultColorSceneScale()(a)},dimColor:function(a,b){return"text"===b?Fa.toGrayScale(a,-.75,null,null):Fa.toGrayScale(a,-.3,null,null)},defaultColorSceneScale:function(){return a.lazy(this,"_defaultColorSceneScale",this._initDefColorScale,this)},_initDefColorScale:function(){var b=this.panel.axes.color;return b?b.sceneScale({sceneVarName:"color"}):a.fun.constant(Fa.defaultColor)},mayShowActive:function(a,b){return!!this.showsActivity()&&(a.isActive||!b&&this.isActiveSeriesAware&&a.isActiveSeries()||a.isActiveDatum())},mayShowNotAmongSelected:function(a){return this.mayShowAnySelected(a)&&!a.isSelected()},mayShowSelected:function(a){return this.showsSelection()&&a.isSelected()},mayShowAnySelected:function(a){return this.showsSelection()&&a.anySelected()},_addPropTooltip:function(c){if(!this.pvMark.hasTooltip){var d=a.create(this.chart._tooltipOptions,a.get(c,"options"));d.isLazy=a.get(c,"isLazy",!0);var e=a.get(c,"buildTooltip")||this._getTooltipFormatter(d);if(e){d.isEnabled=this._isTooltipEnabled.bind(this);var f=a.get(c,"tipsyEvent");f||(f="mouseover"),this.pvMark.localProperty("tooltip").tooltip(this._createTooltipProp(e,d.isLazy)).title(a.fun.constant("")).ensureEvents().event(f,b.Behavior.tipsy(d)).hasTooltip=!0}}},_getTooltipFormatter:function(a){return this.panel._getTooltipFormatter(a)},_isTooltipEnabled:function(){return this.panel._isTooltipEnabled()},_createTooltipProp:function(a,b){var c,d=this;return c=b?function(b){var c,e=d.context(b,!0);return function(){return e&&(c=a(e),e=null),c}}:function(b){var c=d.context(b);return a(c)},function(a){return a&&!a.isIntermediate&&a.showsTooltip()?c(a):void 0}},_addPropHoverable:function(){var a,b,c=this.panel;a="mouseover",b="mouseout",this.pvMark.ensureEvents().event(a,function(a){!a.hoverable()||c.selectingByRubberband()||c.animating()||(a.setActive(!0),c.renderInteractive())}).event(b,function(a){!a.hoverable()||c.selectingByRubberband()||c.animating()||a.clearActive()&&c.renderInteractive()})},_ignoreClicks:0,_propCursorClick:function(a){var b=this._ibits&a._ibits,c=Fa.visual.Interactive;return b&c.HandlesClickEvent||b&c.DoubleClickable?"pointer":null},_addPropClick:function(){var a=this;a.pvMark.cursor(a._propCursorClick.bind(a)).ensureEvents().event("click",a._handleClick.bind(a))},_addPropDoubleClick:function(){var a=this;a.pvMark.cursor(a._propCursorClick.bind(a)).ensureEvents().event("dblclick",a._handleDoubleClick.bind(a))},_handleClick:function(){var a=this,c=a.pvMark,d=c.instance(),e=d.data,f=a.doubleClickable()&&e.doubleClickable();if(f){var g=c.scene,h=c.index,i=b.event;window.setTimeout(function(){if(a._ignoreClicks)a._ignoreClicks--;else try{b.event=i,c.context(g,h,function(){a._handleClickCore()})}catch(a){b.error(a)}finally{delete b.event}},a.chart.options.doubleClickMaxDelay||300)}else a._ignoreClicks?a._ignoreClicks--:a._handleClickCore()},_handleClickCore:function(){this._onClick(this.context())},_handleDoubleClick:function(){var a=this,b=a.scene();b&&b.doubleClickable()&&(a._ignoreClicks=2,a._onDoubleClick(a.context(b)))},_onClick:function(a){a.click()},_onDoubleClick:function(a){a.doubleClick()}}),a.type("pvc.visual.Panel",Fa.visual.Sign).init(function(c,d,e){var f=a.get(e,"panel");if(!f){var g=a.get(e,"panelType")||b.Panel;f=d.add(g)}this.base(c,f,e)}).add({_addInteractive:function(b){var c=!0;b=a.setDefaults(b,"noSelect",c,"noHover",c,"noTooltip",c,"noClick",c,"noDoubleClick",c),this.base(b)}}),a.type("pvc.visual.Label",Fa.visual.Sign).init(function(a,c,d){var e=c.add(b.Label);this.base(a,e,d)}).add({_addInteractive:function(b){var c=!0;b=a.setDefaults(b,"noSelect",c,"noHover",c,"noTooltip",c,"noClick",c,"noDoubleClick",c,"showsInteraction",!1),this.base(b)},defaultColor:a.fun.constant(b.Color.names.black)});var Ua=b.Color.names.white;a.type("pvc.visual.ValueLabel",Fa.visual.Label).init(function(b,c,d){this.valuesFont=a.get(d,"valuesFont")||b.valuesFont,this.valuesMask=a.get(d,"valuesMask")||b.valuesMask,this.valuesOptimizeLegibility=a.get(d,"valuesOptimizeLegibility",b.valuesOptimizeLegibility),this.valuesOverflow=a.get(d,"valuesOverflow",b.valuesOverflow),this.hideOverflowed="hide"===this.valuesOverflow,this.trimOverflowed=!this.hideOverflowed&&"trim"===this.valuesOverflow,this.hideOrTrimOverflowed=this.hideOverflowed||this.trimOverflowed;var e;e=a.get(d,"noAnchor",!1)?c:c.anchor(b.valuesAnchor),d&&null==d.extensionId&&(d.extensionId="label"),this.base(b,e,d),this.pvMark.font(this.valuesFont),this._bindProperty("text","text")._bindProperty("textStyle","textColor","color").intercept("visible",this.visible)}).prototype.property("text").property("textStyle").constructor.addStatic({maybeCreate:function(a,b,c){return a.valuesVisible&&a.valuesMask?new Fa.visual.ValueLabel(a,b,c):null},isNeeded:function(a){return a.valuesVisible&&a.valuesMask}}).add({_addInteractive:function(b){b=a.setDefaults(b,"showsInteraction",!0,"noSelect",!0,"noTooltip",!0,"noClick",!0,"noDoubleClick",!0,"noHover",!0),this.base(b)},visible:function(a){var b=this.getAnchoredToMark();if(b&&!b.visible())return!1;if(!this.hideOrTrimOverflowed)return this.delegate(!0);var c;if(this.hasDelegate(Fa.extensionTag)&&(c=this.delegateExtension(),null!=c))return c;if(c=this.delegateNotExtension(),c===!1)return!1;if(a.isActive&&this.showsActivity())return!0;var d=this.textFitInfo(a);return!(d&&d.hide)},textFitInfo:function(a){var b=a.renderState,c=b.textFitInfo;return void 0!==c?c:b.textFitInfo=this.calcTextFitInfo(a,this._evalBaseText())||null},calcTextFitInfo:function(){return null},_evalBaseText:function(){var a=this.pvMark,b=a.binds.properties.text.proto;return a.evalInPropertyContext(this.baseText.bind(this),b)},baseText:function(a){var b=a.renderState,c=b.baseText;return void 0!==c?c:this.base(a)},defaultText:function(a){return a.format(this.valuesMask)},normalText:function(a,b){var c;return this.trimOverflowed&&(c=this.textFitInfo(a))?this.trimText(a,b,c):b},interactiveText:function(a,b){var c;return!this.trimOverflowed||a.isActive&&this.showsActivity()||!(c=this.textFitInfo(a))?b:this.trimText(a,b,c)},trimText:function(a,b,c){var d=c&&c.widthMax;return null!=d?Fa.text.trimToWidthB(d,b,this.pvMark.font(),".."):b},textColor:function(a){return this.color(a,"text")},backgroundColor:function(b,c){var d=this.instanceState();if(!d)return this.calcBackgroundColor(b,c);var e=a.lazy(d,"cccBgColorCache"),f=a.getOwn(e,c);return f||(f=e[c]=this.calcBackgroundColor(b,c)),f},calcBackgroundColor:function(a){var b=this.getAnchoredToMark();if(b){var c=b.fillStyle();if(c&&c!==Ua&&this.isAnchoredInside(a,b))return c}return Ua},getAnchoredToMark:function(){return this.pvMark.target||this.pvMark.parent},isAnchoredInside:function(a,c){if(!c&&!(c=this.getAnchoredToMark()))return!1;var d,e=this.pvMark,f=e.text(),g=b.Text.measure(f,e.font()),h=e.left(),i=e.top();null==h&&(d=e.parent,h=d.width()-(e.right()||0)),null==i&&(d||(d=e.parent),i=d.height()-(e.bottom()||0));var j=b.Label.getPolygon(g.width,g.height,e.textAlign(),e.textBaseline(),e.textAngle(),e.textMargin()).center().plus(h,i),k=c.getShape(c.scene,e.index);
return k.containsPoint(j)},maybeOptimizeColorLegibility:function(a,b,c){if(this.valuesOptimizeLegibility){var d=this.backgroundColor(a,c);return d&&d!==Ua&&d.isDark()===b.isDark()?b.complementary().alpha(.9):b}return b},normalColor:function(a,b,c){return this.maybeOptimizeColorLegibility(a,b,c)},interactiveColor:function(a,b,c){return!this.mayShowActive(a)&&this.mayShowNotAmongSelected(a)?this.dimColor(b,c):this.maybeOptimizeColorLegibility(a,b,c)}}),a.type("pvc.visual.Dot",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.Dot),g=a.get(e,"proto");if(g&&f.extend(g),e=a.setDefaults(e,"freeColor",!1),this.base(c,f,e),!a.get(e,"freePosition",!1)){var h=c.isOrientationVertical()?"left":"bottom",i=c.anchorOrtho(h);this._lockDynamic(h,"x")._lockDynamic(i,"y")}this._bindProperty("shape","shape")._bindProperty("shapeRadius","radius")._bindProperty("shapeSize","size"),this.optional("strokeDasharray",void 0).optional("lineWidth",1.5)}).prototype.property("size").property("shape").constructor.add({y:a.fun.constant(0),x:a.fun.constant(0),radius:function(){this.instanceState().cccRadius=this.delegateExtension()},baseSize:function(b){var c=this.instanceState().cccRadius;return null!=c?a.sqr(c):this.base(b)},defaultSize:a.fun.constant(12),interactiveSize:function(a,b){return this.mayShowActive(a,!0)?2.5*Math.max(b,5):b},interactiveColor:function(a,b,c){if(this.mayShowActive(a,!0)){if("stroke"===c)return b.brighter(1)}else if(this.mayShowNotAmongSelected(a)){if(this.mayShowActive(a))return b.alpha(.8);switch(c){case"fill":return this.dimColor(b,c);case"stroke":return b.alpha(.45)}}return this.base(a,b,c)}}),a.type("pvc.visual.DotSizeColor",Fa.visual.Dot).init(function(a,c,d){this.base(a,c,d);var e=this.compatVersion()<=1;if(this._bindProperty("lineWidth","strokeWidth").intercept("visible",function(a){if(!this.canShow(a))return!1;var b=this.delegateExtension();return null==b&&(b=e||this.defaultVisible(a)),b}),this._initColor(),this._initSize(),this.isSizeBound){var f=a.axes.size;if(f.scaleUsesAbs()){this.isSizeAbs=!0;var g=this._sceneDefColor;this._sceneDefColor=function(a,c){return"stroke"===c&&a.vars.size.value<0?b.Color.names.black:g.call(this,a,c)},this.pvMark.lineCap("round").strokeDasharray(function(a){return a.vars.size.value<0?"dash":null})}}}).prototype.property("strokeWidth").constructor.add({isColorBound:!1,isColorDiscrete:!1,isSizeBound:!1,isSizeAbs:!1,canShow:function(a){return!a.isIntermediate},defaultVisible:function(a){return!a.isNull&&(!this.isSizeBound&&!this.isColorBound||this.isSizeBound&&null!=a.vars.size.value||this.isColorBound&&(this.isColorDiscrete||null!=a.vars.color.value))},_initColor:function(){var b,c,d=this.panel,e=d.visualRoles.color;if(e){this.isColorDiscrete=e.isDiscrete();var f=d.axes.color;e.isBound()?(this.isColorBound=!0,c=f.sceneScale({sceneVarName:"color"})):f&&(b=f.option("Unbound"))}c||(c=a.fun.constant(b||Fa.defaultColor)),this._sceneDefColor=c},_initSize:function(){var b,c,d=this.panel,e=d.plot,f=e.option("Shape"),g=e.option("NullShape"),h=d.visualRoles.size;if(h){var i=d.axes.size,j=i&&i.scale,k=!!j&&h.isBound();if(k){this.isSizeBound=!0;var l=j.min+.05*(j.max-j.min);this.nullSizeShapeHasStrokeOnly="cross"===g,c=function(a){return null!=a.vars.size.value?f:g},b=function(a){var b=a.vars.size.value;return null!=b?j(b):g?l:0}}}b||(c=a.fun.constant(f),b=function(a){return this.base(a)}),this._sceneDefSize=b,this._sceneDefShape=c},defaultColor:function(a,b){return this._sceneDefColor(a,b)},normalColor:function(a,b,c){return"stroke"===c?b.darker():this.base(a,b,c)},interactiveColor:function(a,b,c){if(this.mayShowActive(a,!0))switch(c){case"fill":return this.isSizeBound?b.alpha(.75):b;case"stroke":return b.darker()}else if(this.showsSelection()){var d=a.isSelected(),e=!d&&a.anySelected();if(e){if(this.mayShowActive(a))return b.alpha(.8);switch(c){case"fill":return this.dimColor(b,c);case"stroke":return b.alpha(.45)}}if(d&&g(b))return"stroke"===c&&(b=b.darker(3)),b.darker(2)}return"stroke"===c?b.darker():b},defaultSize:function(a){return this._sceneDefSize(a)},defaultShape:function(a){return this._sceneDefShape(a)},interactiveSize:function(b,c){if(!this.mayShowActive(b,!0))return c;var d=Math.sqrt(c),e=Math.max(1,Math.min(1.1*d,2));return a.sqr(d+e)},defaultStrokeWidth:function(a){return this.nullSizeShapeHasStrokeOnly&&null==a.vars.size.value?1.8:1},interactiveStrokeWidth:function(a,b){return this.mayShowActive(a,!0)?2*b:this.mayShowSelected(a)?1.5*b:b}}),b.LineInterm=function(){b.Line.call(this)},b.LineInterm.prototype=b.extend(b.Line),b.LineInterm.prototype.getNearestInstanceToMouse=function(a,c){var d=b.Line.prototype.getNearestInstanceToMouse.call(this,a,c),e=a[d];return e&&e.data&&e.data.isIntermediate&&d+1<a.length&&d++,d},a.type("pvc.visual.Line",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.LineInterm);if(this.base(c,f,e),this.lock("segmented","smart").lock("antialias",!0),!a.get(e,"freePosition",!1)){var g=c.isOrientationVertical()?"left":"bottom",h=c.anchorOrtho(g);this._lockDynamic(h,"y")._lockDynamic(g,"x")}this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({_addInteractive:function(b){b=a.setDefaults(b,"noTooltip",!0),this.base(b)},y:a.fun.constant(0),x:a.fun.constant(0),defaultStrokeWidth:a.fun.constant(1.5),interactiveStrokeWidth:function(a,b){return this.mayShowActive(a)?2.5*Math.max(1,b):b},interactiveColor:function(a,c,d){return this.mayShowNotAmongSelected(a)?this.mayShowActive(a)?b.Color.names.darkgray.darker().darker():this.dimColor(c,d):this.base(a,c,d)}}),b.AreaInterm=function(){b.Area.call(this)},b.AreaInterm.prototype=b.extend(b.Area),b.AreaInterm.prototype.getNearestInstanceToMouse=function(a,c){var d=b.Area.prototype.getNearestInstanceToMouse.call(this,a,c),e=a[d];return e&&e.data&&e.data.isIntermediate&&d+1<a.length&&d++,d},a.type("pvc.visual.Area",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.AreaInterm);e||(e={}),e.freeColor=!0,this.base(c,f,e);var g=a.get(e,"antialias",!0);if(this.lock("segmented","smart").lock("antialias",g),!a.get(e,"freePosition",!1)){var h=c.isOrientationVertical()?"left":"bottom",i=c.anchorOrtho(h),j=c.anchorOrthoLength(i);this._lockDynamic(h,"x")._lockDynamic(i,"y")._lockDynamic(j,"dy")}this._bindProperty("fillStyle","fillColor","color"),this.lock("strokeStyle",null).lock("lineWidth",0)}).add({_addInteractive:function(b){b=a.setDefaults(b,"noTooltip",!0),this.base(b)},y:a.fun.constant(0),x:a.fun.constant(0),dy:a.fun.constant(0),interactiveColor:function(a,b,c){return"fill"===c&&this.mayShowNotAmongSelected(a)?this.dimColor(b,c):this.base(a,b,c)}}),a.type("pvc.visual.Bar",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.Bar);e=a.setDefaults(e,"freeColor",!1),this.base(c,f,e),this.normalStroke=a.get(e,"normalStroke",!1),this._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({normalColor:function(a,b,c){return"stroke"!==c||this.normalStroke?b:null},interactiveColor:function(a,c,d){if("stroke"===d){if(this.mayShowActive(a,!0))return c.brighter(1.3).alpha(.7);if(!this.normalStroke)return null;if(this.mayShowNotAmongSelected(a))return this.mayShowActive(a)?b.Color.names.darkgray.darker().darker():this.dimColor(c,d);if(this.mayShowActive(a))return c.brighter(1).alpha(.7)}else if("fill"===d){if(this.mayShowActive(a,!0))return c.brighter(.2).alpha(.8);if(this.mayShowNotAmongSelected(a))return this.mayShowActive(a)?b.Color.names.darkgray.darker(2).alpha(.8):this.dimColor(c,d);if(this.mayShowActive(a))return c.brighter(.2).alpha(.8)}return this.base(a,c,d)},defaultStrokeWidth:function(){return.5},interactiveStrokeWidth:function(a,b){return this.mayShowActive(a,!0)?1.3*Math.max(1,b):b}}),b.PieSlice=function(){b.Wedge.call(this)},b.PieSlice.prototype=b.extend(b.Wedge).property("offsetRadius"),b.PieSlice.prototype.midAngle=function(){var a=this.instance();return a.startAngle+a.angle/2},b.PieSlice.prototype.defaults=(new b.PieSlice).extend(b.Wedge.prototype.defaults).offsetRadius(0),a.type("pvc.visual.PieSlice",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.PieSlice);e=a.setDefaults(e,"freeColor",!1),this.base(c,f,e),this._activeOffsetRadius=a.get(e,"activeOffsetRadius",0),this._maxOffsetRadius=a.get(e,"maxOffsetRadius",0),this._resolvePctRadius=a.get(e,"resolvePctRadius"),this._center=a.get(e,"center"),this.optional("lineWidth",.6)._bindProperty("angle","angle")._bindProperty("offsetRadius","offsetRadius")._lockDynamic("bottom","y")._lockDynamic("left","x").lock("top",null).lock("right",null)}).prototype.property("offsetRadius").constructor.add({angle:a.fun.constant(0),x:function(){return this._center.x+this._offsetSlice("cos")},y:function(){return this._center.y-this._offsetSlice("sin")},_offsetSlice:function(a){var b=this.pvMark.offsetRadius()||0;return b&&(b*=Math[a](this.pvMark.midAngle())),b},defaultColor:function(a,b){return"stroke"===b?null:this.base(a,b)},interactiveColor:function(a,b,c){if(this.mayShowActive(a,!0))switch(c){case"fill":return b.brighter(.2).alpha(.8);case"stroke":return b.brighter(1.3).alpha(.7)}else if(this.mayShowNotAmongSelected(a)&&"fill"===c)return this.dimColor(b,c);return this.base(a,b,c)},offsetRadius:function(a){var b=this.base(a);return Math.min(Math.max(0,b),this._maxOffsetRadius)},baseOffsetRadius:function(a){var b=this.base(a)||0;return this._resolvePctRadius(Ka.parse(b))},interactiveOffsetRadius:function(a,b){return b+(this.mayShowActive(a,!0)?this._activeOffsetRadius:0)}}),a.type("pvc.visual.Rule",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.Rule),g=a.get(e,"proto");g&&f.extend(g),this.base(c,f,e),a.get(e,"freeStyle")||this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({_addInteractive:function(b){var c=!0;b=a.setDefaults(b,"noHover",c,"noSelect",c,"noTooltip",c,"noClick",c,"noDoubleClick",c,"showsInteraction",!1),this.base(b)},defaultStrokeWidth:a.fun.constant(1),interactiveStrokeWidth:function(a,b){return this.mayShowActive(a,!0)?2.2*Math.max(1,b):b},interactiveColor:function(a,b,c){return a.datum&&!this.mayShowActive(a,!0)&&this.mayShowNotAmongSelected(a)?this.dimColor(b,c):this.base(a,b,c)}}),a.type("pvc.visual.OptionsBase").init(function(b,c,d,e){this.chart=b,this.type=c,this.index=null==d?0:d,this.name=a.get(e,"name"),this.id=this._buildId(),this.optionId=this._buildOptionId();var f=this._resolvers=[];this._registerResolversFull(f,e),this.option=Fa.options(this._getOptionsDefinition(),this)}).add({_buildId:function(){return Fa.buildIndexedId(this.type,this.index)},_buildOptionId:function(){return this.id},_chartOption:function(a){return this.chart.options[a]},_getOptionsDefinition:a.method({isAbstract:!0}),_registerResolversFull:function(b,c){var d=a.get(c,"fixed");d&&(this._fixed=d,b.push(Fa.options.specify(function(a){return d[a.name]}))),this._registerResolversNormal(b,c);var e=a.get(c,"defaults");e&&(this._defaults=e),b.push(this._resolveDefault)},_registerResolversNormal:function(b,c){a.get(c,"byV1",!0)&&this.chart.compatVersion()<=1&&b.push(this._resolveByV1OnlyLogic),this.name&&b.push(Fa.options.specify(function(b){return this._chartOption(this.name+a.firstUpperCase(b.name))})),b.push(this._resolveByOptionId),a.get(c,"byNaked",!this.index)&&b.push(this._resolveByNaked)},_resolveFull:function(a){for(var b=this._resolvers,c=0,d=b.length;d>c;c++)if(b[c].call(this,a))return!0;return!1},_resolveFixed:Fa.options.specify(function(a){return this._fixed?this._fixed[a.name]:void 0}),_resolveByV1OnlyLogic:function(a){var b,c=a.data;return c&&(b=c.resolveV1)?b.call(this,a):void 0},_resolveByName:Fa.options.specify(function(b){return this.name?this._chartOption(this.name+a.firstUpperCase(b.name)):void 0}),_resolveByOptionId:Fa.options.specify(function(b){return this._chartOption(this.optionId+a.firstUpperCase(b.name))}),_resolveByNaked:Fa.options.specify(function(b){return this.index?void 0:this._chartOption(a.firstLowerCase(b.name))}),_resolveDefault:function(a){var b,c=a.data;if(c&&(b=c.resolveDefault)&&b.call(this,a))return!0;if(this._defaults){var d=this._defaults[a.name];if(void 0!==d)return a.defaultValue(d),!0}},_specifyChartOption:function(a,b){var c=this._chartOption(b);if(null!=c)return a.specify(c),!0}}),a.type("pvc.visual.MultiChart",Fa.visual.OptionsBase).init(function(a){this.base(a,"multiChart",0,{byV1:!1,byNaked:!1})}).add({_getOptionsDefinition:function(){return Fa.visual.MultiChart.optionsDef}}).addStatic({optionsDef:{Max:{resolve:"_resolveFull",cast:Fa.castPositiveNumber,value:1/0},ColumnsMax:{resolve:"_resolveFull",cast:Fa.castPositiveNumber,value:3},SingleRowFillsHeight:{resolve:"_resolveFull",cast:Boolean,value:!0},SingleColFillsHeight:{resolve:"_resolveFull",cast:Boolean,value:!0},Overflow:{resolve:"_resolveFull",cast:Fa.parseMultiChartOverflow,value:"grow"}}}),a.type("pvc.visual.SmallChart",Fa.visual.OptionsBase).init(function(a){this.base(a,"small",0,{byV1:!1,byNaked:!1})}).add({_getOptionsDefinition:function(){return Fa.visual.SmallChart.optionsDef}}).addStatic({optionsDef:{Width:{resolve:"_resolveFull",cast:Ka.parse,value:null},Height:{resolve:"_resolveFull",cast:Ka.parse,value:null},AspectRatio:{resolve:"_resolveFull",cast:Fa.castPositiveNumber,getDefault:function(){return this.chart instanceof Fa.PieChart?10/7:5/4}},Margins:{resolve:"_resolveFull",cast:Ja.as,value:new Ja(new Ka(.02))},Paddings:{resolve:"_resolveFull",cast:Ja.as,value:0}}});var Va=a.type("pvc.visual.Axis",Fa.visual.OptionsBase).init(function(a,b,c,d){this.base(a,b,c,d),a._addAxis(this)}).add({scaleTreatsNullAs:function(){return"null"},scaleNullRangeValue:function(){return null},scaleUsesAbs:a.retFalse,scaleSumNormalized:a.retFalse,domainVisibleOnly:a.retTrue,domainIgnoreNulls:a.retFalse,domainGroupOperator:function(){return"flatten"},domainItemValueProp:function(){return"value"},bind:function(b){var c=this;return b||a.fail.argumentRequired("dataCells"),!c.dataCells||a.fail.operationInvalid("Axis is already bound."),c.dataCells=a.array.to(b),c.dataCell=c.dataCells[0],c.role=c.dataCell&&c.dataCell.role,c.scaleType=ra(c.role.grouping),c._domainData=null,c._domainValues=null,c._domainItems=null,c._checkRoleCompatibility(),this},domainData:function(){this.isBound()||a.fail.operationInvalid("Axis is not bound.");var b=this._domainData;if(!b){var c=this.dataCells.map(Ba),d=this.chart.partData(c);this._domainData=b=this._createDomainData(d)}return b},domainCellData:function(a){var b=this.dataCells;if(1===b.length)return this.domainData();var c=b[a],d=this.chart.partData(c.dataPartValue);return this._createDomainData(d)},domainCellItems:function(a){var b=this.dataCells;if(1===b.length)return this.domainItems();var c;return c="number"==typeof a?this.domainCellData(a):a,this._selectDomainItems(c).array()},domainValues:function(){var a=this._domainValues;return a||(this._calcDomainItems(),a=this._domainValues),a},domainItems:function(){var a=this._domainItems;return a||(this._calcDomainItems(),a=this._domainItems),a},domainItemValue:function(b){return a.nullyTo(b[this.domainItemValueProp()],"")},isDiscrete:function(){return!!this.role&&this.role.isDiscrete()},isBound:function(){return!!this.role},setScale:function(b,c){return this.isBound()||a.fail.operationInvalid("Axis is not bound."),this.scale=b?c?b:this._wrapScale(b):null,this},_wrapScale:function(b){b.type=this.scaleType;var c;if("discrete"!==b.type){var d=this.scaleUsesAbs(),e=this.scaleTreatsNullAs();if(e&&"null"!==e){var f="min"===e;c=d?function(a){return b(null==a?f?b.domain()[0]:0:0>a?-a:a)}:function(a){return b(null==a?f?b.domain()[0]:0:a)}}else{var g=this.scaleNullRangeValue();c=d?function(a){return null==a?g:b(0>a?-a:a)}:function(a){return null==a?g:b(a)}}}else c=function(a){return b(null==a?"":a)};return a.copy(c,b)},sceneScale:function(b){var c=a.get(b,"sceneVarName")||this.role.name,d=this.role.grouping;if(d.isSingleDimension&&d.firstDimensionValueType()===Number){var e=this.scale,f=a.get(b,"nullToZero",!0),g=function(a){var b=a.vars[c].value;if(null==b){if(!f)return b;b=0}return e(b)};return a.copy(g,e),g}return this.scale.by1(function(a){return a.vars[c].value})},_checkRoleCompatibility:function(){var b=this.dataCells.length;if(b>1){var c,d,e=this._getBoundRoleGrouping(this.role);if("discrete"===this.scaleType){for(d=1;b>d;d++)if(c=this._getBoundRoleGrouping(this.dataCells[d].role),e.id!==c.id)throw a.error.operationInvalid("Discrete roles on the same axis must have equal groupings.")}else{if(!e.firstDimensionType().isComparable)throw a.error.operationInvalid("Continuous roles on the same axis must have 'comparable' groupings.");for(d=1;b>d;d++)if(c=this._getBoundRoleGrouping(this.dataCells[d].role),this.scaleType!==ra(c))throw a.error.operationInvalid("Continuous roles on the same axis must have scales of the same type.")}}},_getBoundRoleGrouping:function(b){var c=b.grouping;if(!c)throw a.error.operationInvalid("Axis' role '"+b.name+"' is unbound.");return c},_createDomainData:function(a){var b={visible:!!this.domainVisibleOnly()||null,isNull:!this.chart.options.ignoreNulls&&!this.domainIgnoreNulls()&&null};return this.role[this.domainGroupOperator()](a,b)},_selectDomainItems:function(a){return a.children()},_calcDomainItems:function(){var b=a.hasOwnProp,c={},d=[],e=[],f=(this.domainItemValueProp(),this.domainData());this._selectDomainItems(f).each(function(a){var f=this.domainItemValue(a);b.call(c,f)||(c[f]=1,d.push(f),e.push(a))},this),this._domainItems=e,this._domainValues=d},_getOptionsDefinition:function(){return Wa}}),Wa={},Xa=a.type("pvc.visual.CartesianAxis",Va).init(function(a,b,c,d){var e=a.options;this.orientation=Xa.getOrientation(b,e.orientation),this.orientedId=Xa.getOrientedId(this.orientation,c),a._allowV1SecondAxis&&1===c&&(this.v1SecondOrientedId="second"+this.orientation.toUpperCase()),this.base(a,b,c,d);var f=this.extensionPrefixes=[this.id+"Axis",this.orientedId+"Axis"];this.v1SecondOrientedId&&f.push(this.v1SecondOrientedId+"Axis"),this._extPrefAxisPosition=f.length,f.push("axis")}).add({bind:function(a){return this.base(a),this._syncExtensionPrefixes(),this},_syncExtensionPrefixes:function(){var a=this.extensionPrefixes;a.length=this._extPrefAxisPosition;var b=this.scaleType;b&&(a.push(b+"Axis"),"discrete"!==b&&a.push("continuousAxis")),a.push("axis")},setScale:function(a){var b=this.scale;if(this.base(a),b&&(delete this.domain,delete this.ticks,delete this._roundingPaddings),a&&!a.isNull&&"discrete"!==this.scaleType){this.domain=a.domain(),this.domain.minLocked=!!a.minLocked,this.domain.maxLocked=!!a.maxLocked;var c=this.option("DomainRoundMode");"nice"===c&&a.nice();var d=this.option("TickFormatter");d&&a.tickFormatter(d)}return this},setTicks:function(b){var c=this.scale;if(c&&!c.isNull||a.fail.operationInvalid("Scale must be set and non-null."),this.ticks=b,"discrete"!==c.type&&"tick"===this.option("DomainRoundMode")){delete this._roundingPaddings;var d=b&&b.length;d?this.scale.domain(b[0],b[d-1]):this.scale.domain(this.domain[0],this.domain[1])}},setScaleRange:function(a){var b=this.scale;if(b.min=0,b.max=a,b.size=a,"discrete"===b.type){if(b.domain().length>0){var c=this.chart.options.panelSizeRatio||.8;b.splitBandedCenter(b.min,b.max,c)}}else b.range(b.min,b.max);return b},getScaleRoundingPaddings:function(){var b=this._roundingPaddings;if(!b){b={begin:0,end:0,beginLocked:!1,endLocked:!1};var c=this.scale;if(c&&!c.isNull&&"discrete"!==c.type){var d=this.domain;if(b.beginLocked=d.minLocked,b.endLocked=d.maxLocked,"numeric"===c.type&&"none"!==this.option("DomainRoundMode")){var e=c.domain(),f=this.domain||a.assert("Original domain must be set"),g=e[1]-e[0];if(g){var h=f[0]-e[0];h>0&&(b.begin=h/g),h=e[1]-f[1],h>0&&(b.end=h/g)}}}this._roundingPaddings=b}return b},calcContinuousTicks:function(a){return null==a&&(a=this.option("DesiredTickCount")),this.scale.ticks(a,{roundInside:"tick"!==this.option("DomainRoundMode"),numberExponentMin:this.option("TickExponentMin"),numberExponentMax:this.option("TickExponentMax")})},_getOptionsDefinition:function(){return _a},_buildOptionId:function(){return this.id+"Axis"},_registerResolversNormal:function(a){this.chart.compatVersion()<=1&&a.push(this._resolveByV1OnlyLogic),a.push(this._resolveByOptionId,this._resolveByOrientedId),1===this.index&&a.push(this._resolveByV1OptionId),a.push(this._resolveByScaleType,this._resolveByCommonId)},_resolveByOrientedId:Fa.options.specify(function(a){return this._chartOption(this.orientedId+"Axis"+a.name)}),_resolveByV1OptionId:Fa.options.specify(function(a){return this._chartOption("secondAxis"+a.name)}),_resolveByScaleType:Fa.options.specify(function(a){var b=this.scaleType;if(b){var c=a.name,d=this._chartOption(b+"Axis"+c);return void 0===d&&"discrete"!==b&&(d=this._chartOption("continuousAxis"+c)),d}}),_resolveByCommonId:Fa.options.specify(function(a){return this._chartOption("axis"+a.name)})});Xa.getOrientation=function(a,b){return"base"===a==("vertical"===b)?"x":"y"},Xa.getOrientedId=function(a,b){return 0===b?a:a+(b+1)};var Ya={resolve:"_resolveFull",data:{resolveV1:function(a){return this.index||"ortho"!==this.type||this._specifyChartOption(a,this.id+a.name),!0}}},Za={resolveV1:function(a){if(this.index){if(this._resolveByV1OptionId(a))return!0}else if(this._resolveByOrientedId(a))return!0;return this._resolveDefault(a),!0}},$a=Fa.options.defaultValue(function(){if(!this.typeIndex)return"x"===this.orientation?"bottom":"left";var a=this.chart.axesByType[this.type].first,b=a.option("Position");return Fa.BasePanel.oppositeAnchor[b]}),_a=a.create(Wa,{Visible:{resolve:"_resolveFull",data:{resolveV1:function(b){if(this.index<=1){var c=0===this.index?a.firstUpperCase(this.orientation):"Second";this._specifyChartOption(b,"show"+c+"Scale")}return!0}},cast:Boolean,value:!0},Composite:{resolve:function(a){return this.index>0?(a.specify(!1),!0):this._resolveFull(a)},data:{resolveV1:function(a){return this._specifyChartOption(a,"useCompositeAxis"),!0}},cast:Boolean,value:!1},Size:{resolve:"_resolveFull",data:Za,cast:ua},SizeMax:{resolve:"_resolveFull",cast:ua},Position:{resolve:"_resolveFull",data:{resolveV1:Za.resolveV1,resolveDefault:$a},cast:ta},FixedMin:Ya,FixedMax:Ya,OriginIsZero:{resolve:"_resolveFull",data:{resolveV1:function(a){switch(this.index){case 0:this._specifyChartOption(a,"originIsZero");break;case 1:this.chart._allowV1SecondAxis&&this._specifyChartOption(a,"secondAxisOriginIsZero")}return!0}},cast:Boolean,value:!0},DomainScope:{resolve:"_resolveFull",cast:sa,value:"global"},Offset:{resolve:"_resolveFull",data:{resolveV1:function(a){switch(this.index){case 0:this._specifyChartOption(a,"axisOffset");break;case 1:if(this.chart._allowV1SecondAxis){this._specifyChartOption(a,"secondAxisOffset");break}}return!0}},cast:Fa.castNumber},LabelSpacingMin:{resolve:"_resolveFull",cast:Fa.castNumber},OverlappedLabelsMode:{resolve:"_resolveFull",cast:Fa.parseOverlappedLabelsMode,value:"rotatethenhide"},Grid:{resolve:"_resolveFull",data:{resolveV1:function(a){return this.index||this._specifyChartOption(a,this.orientation+"AxisFullGrid"),!0}},cast:Boolean,value:!1},GridCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:!0},EndLine:{resolve:"_resolveFull",cast:Boolean},ZeroLine:{resolve:"_resolveFull",cast:Boolean,value:!0},RuleCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:!0},Ticks:{resolve:"_resolveFull",cast:Boolean},DesiredTickCount:{resolve:"_resolveFull",data:{resolveV1:Za.resolveV1,resolveDefault:function(a){if(this.chart.compatVersion()<=1)return a.defaultValue(5),!0}},cast:Fa.castNumber},MinorTicks:{resolve:"_resolveFull",data:Za,cast:Boolean,value:!0},TickFormatter:{resolve:"_resolveFull",cast:a.fun.as},DomainRoundMode:{resolve:"_resolveFull",data:{resolveV1:Za.resolveV1,resolveDefault:function(a){if(this.chart.compatVersion()<=1)return a.defaultValue("none"),!0}},cast:Fa.parseDomainRoundingMode,value:"tick"},TickExponentMin:{resolve:"_resolveFull",cast:Fa.castNumber},TickExponentMax:{resolve:"_resolveFull",cast:Fa.castNumber},Title:{resolve:"_resolveFull",cast:String},TitleSize:{resolve:"_resolveFull",cast:va},TitleSizeMax:{resolve:"_resolveFull",cast:va},TitleFont:{resolve:"_resolveFull",cast:String},TitleMargins:{resolve:"_resolveFull",cast:Ja.as},TitlePaddings:{resolve:"_resolveFull",cast:Ja.as},TitleAlign:{resolve:"_resolveFull",cast:function(a){var b=this.option("Position");return Fa.parseAlign(b,a)}},Font:{resolve:"_resolveFull",cast:String},ClickAction:{resolve:"_resolveFull",data:Za},DoubleClickAction:{resolve:"_resolveFull",data:Za},TooltipEnabled:{resolve:"_resolveFull",cast:Boolean,value:!0},TooltipFormat:{resolve:"_resolveFull",cast:a.fun.as,value:null},TooltipAutoContent:{resolve:"_resolveFull",cast:Fa.parseTooltipAutoContent,value:"value"}});a.type("pvc.visual.CartesianAxisRootScene",Fa.visual.Scene),a.type("pvc.visual.CartesianAxisTickScene",Fa.visual.Scene).init(function(b,c){this.base(b,c),this.vars.tick=new Ta(a.get(c,"tick"),a.get(c,"tickLabel"),a.get(c,"tickRaw")),a.get(c,"isHidden")&&(this.isHidden=!0)}).add({isHidden:!1}),a.type("pvc.visual.CartesianFocusWindow",Fa.visual.OptionsBase).init(function(a){this.base(a,"focusWindow",0,{byNaked:!1});var b=a.axes.base;this.base=new Fa.visual.CartesianFocusWindowAxis(this,b)}).add({_getOptionsDefinition:function(){return ab},_exportData:function(){return{base:a.copyProps(this.base,Fa.visual.CartesianFocusWindow.props)}},_importData:function(a){var b=a.base;this.base.option.specify({Begin:b.begin,End:b.end,Length:b.length})},_initFromOptions:function(){this.base._initFromOptions()},_onAxisChanged:function(){var a=this.option("Changed");a&&a.call(this.chart.basePanel.context())}});var ab=a.create(Wa,{Changed:{resolve:"_resolveFull",cast:a.fun.as}});a.type("pvc.visual.CartesianFocusWindowAxis",Fa.visual.OptionsBase).init(function(b,c){this.window=b,this.axis=c,this.isDiscrete=c.isDiscrete(),this.base(c.chart,"focusWindow"+a.firstUpperCase(c.type),0,{byNaked:!1})}).addStatic({props:["begin","end","length"]}).add({_getOptionsDefinition:function(){return bb},_initFromOptions:function(){var a=this.option;this.set({begin:a("Begin"),end:a("End"),length:a("Length")})},set:function(b){var c,d,e,f=this,g=a.get(b,"render"),h=a.get(b,"select",!0);if(b=f._readArgs(b))c=b.begin,d=b.end,e=b.length;else if(null!=this.begin&&null!=this.end&&null!=this.length)return;var i,j,k=f.axis,l=k.scale,m=f.isDiscrete,n=m?null:k.role.firstDimensionType().cast,o=l.domain();if(m){j=o.length;var p,q,r;if(null!=c){var s=+c;isNaN(s)||(1/0===s?(p=j-1,c=o[p]):s===-1/0&&(p=0,c=o[p])),null==p&&(p=o.indexOf(""+c),0>p&&(p=0,c=o[p]))}if(null!=d){var t=+d;isNaN(t)||(1/0===t?(q=j-1,d=o[q]):t===-1/0&&(q=0,d=o[q])),null==q&&(q=o.indexOf(""+d),0>q&&(q=j-1,d=o[q]))}null!=e&&(e=+e,isNaN(e)?e=null:0>e&&(null!=c||null!=d)&&(i=c,r=p,c=d,p=q,d=i,q=r,e=-e)),null!=c?null!=d?(p>q&&(i=c,r=p,c=d,p=q,d=i,q=r),e=q-p+1):(null==e&&(e=j-p),q=p+e-1,q>j-1&&(q=j-1,e=q-p+1),d=o[q]):null!=d?(null==e&&(e=q),p=q-e+1,0>p&&(p=0,e=q-p+1),c=o[p]):(null==e&&(e=Math.max(~~(j/3),1)),e>j?(e=j,p=0,q=j-1):(r=~~(j/2),p=r-~~(e/2),q=p+e-1),c=o[p],d=o[q])}else{null!=e&&(e=+e,isNaN(e)?e=null:0>e&&(null!=c||null!=d)&&(i=c,c=d,d=i,e=-e));var u=o[0],v=o[1];if(j=v-u,null!=c&&(u>c&&(c=u),c>v&&(c=v)),null!=d&&(u>d&&(d=u),d>v&&(d=v)),null!=c)null!=d?(c>d&&(i=c,c=d,d=i),e=d-c):(null==e&&(e=v-c),d=c+e,d>v&&(d=v,e=d-c));else if(null!=d)null==e&&(e=d-u),c=d-e,u>c&&(c=u,e=d-c);else if(null==e&&(e=Math.max(~~(j/3),1)),e>j)e=j,c=u,d=v;else{i=~~(j/2),c=i-~~(e/2);var w=+c,x=+e;d=w+x}c=n(c),d=n(d),e=n(e);var y=f.option("Constraint");if(y){var z={type:"new",target:"begin",value:c,length:e,length0:e,min:u,max:v,minView:u,maxView:v};y(z),c=n(z.value),e=n(z.length);var w=+c,x=+e;d=n(w+x)}}f._set(c,d,e,h,g)},_updatePosition:function(a,b,c,d){var e,f,g,h=this,i=h.axis,j=i.scale;if(h.isDiscrete){var k=j.invertIndex(a),l=j.invertIndex(b)-1,m=j.domain();e=m[k],f=m[l],g=l-k+1}else e=j.invert(a),f=j.invert(b),g=f-e;this._set(e,f,g,c,d)},_constraintPosition:function(a){var b,c=this,d=c.axis,e=d.scale;if(c.isDiscrete){var f=Math.floor(e.invertIndex(a.point,!0));if(f>=0){var g=e.range(),h=e.domain().length,i=(g.max-g.min)/h;f>=h&&("new"===a.type||"resize-begin"===a.type)&&(f=h-1),a.point=f*i}}else if(b=c.option("Constraint")){var j,k,l,m=d.role.firstDimensionType().cast,n=m(e.invert(a.point)),o="begin"===a.target?1:-1,p=a.point+o*a.length,q=m(e.invert(p)),r=m(o*(q-n));a.length===a.length0?j=r:(k=a.point+o*a.length0,l=m(e.invert(k)),j=o*(l-n));var s=m(e.invert(a.min)),t=m(e.invert(a.max)),u={type:a.type,target:a.target,value:n,length:r,length0:j,min:s,max:t,minView:m(e.invert(a.minView)),maxView:m(e.invert(a.maxView))};b(u),+u.value!==+n&&(n=u.value,a.point=e(n));var v=u.length;if(+v!==+r)if(+v===+j)a.length=a.length0;else{var w=+n+o*+v,x=e(w);a.length=x-o*a.point}+u.min!==+s&&(a.min=e(u.min)),+u.max!==+t&&(a.max=e(u.max))}},_compare:function(a,b){return this.isDiscrete?""+a==""+b:+a===+b},_set:function(a,b,c,d,e){var f=this,g=!1;return f._compare(a,f.begin)||(f.begin=a,g=!0),f._compare(b,f.end)||(f.end=b,g=!0),f._compare(c,f.length)||(f.length=c,g=!0),g&&f.window._onAxisChanged(this),d&&f._updateSelection({render:e}),g},_readArgs:function(a){if(a){var b={},c=0,d=function(d){var e=a[d];null!=e?c=!0:e=this[d],b[d]=e};if(Fa.visual.CartesianFocusWindowAxis.props.forEach(d,this),c)return b}},_updateSelection:function(b){var c,d,e=this,f=e.axis,g=f.isDiscrete(),h=f.chart,i=f.dataCell,j=i.role,k=h.partData(i.dataPartValue);if(g){d=j.flatten(k);var l=d.child(e.begin),m=d.child(e.end);if(l&&m){var n=l.childIndex(),o=m.childIndex();c=a.range(n,o-n+1).select(function(a){return d.childNodes[a]}).selectMany(a.propGet("_datums")).where(B).distinct(a.propGet("key"))}}else{d=k;var p=j.firstDimensionName();c=a.query(k._datums).where(B).where(function(a){var b=a.atoms[p].value;return null!=b&&b>=e.begin&&b<=e.end})}c&&(h.data.replaceSelected(c),h.root.updateSelections(b))}});var bb=a.create(Wa,{Resizable:{resolve:"_resolveFull",cast:Boolean,value:!0},Movable:{resolve:"_resolveFull",cast:Boolean,value:!0},Begin:{resolve:"_resolveFull"},End:{resolve:"_resolveFull"},Length:{resolve:"_resolveFull"},Constraint:{resolve:"_resolveFull",cast:a.fun.as}});a.type("pvc.visual.ColorAxis",Va).add({scaleNullRangeValue:function(){return this.option("Missing")||null},scaleUsesAbs:function(){return this.option("UseAbs")},domainVisibleOnly:function(){return"discrete"!==this.scaleType},bind:function(b){return this.base(b),this._legendGroupScene=null,this._plotList=a.query(b).select(function(a){return a.plot}).distinct(function(a){return a&&a.id}).array(),this},_wrapScale:function(a){var b;if(b="discrete"!==this.scaleType||(this.option.isSpecified("Transform")||!this.option.isSpecified("Colors")&&!this.option.isSpecified("Map"))){var c=this.option("Transform");c&&(a=a.transform(c))}return this.base(a)},scheme:function(){return a.lazy(this,"_scheme",this._createScheme,this)},_createColorMapFilter:function(b){var c=a.uniqueIndex(b,function(a){return a.key});return{domain:function(c){return!a.hasOwn(b,c)},color:function(b){return!a.hasOwn(c,b.key)}}},_getBaseScheme:function(){return this.option("Colors")},_createScheme:function(){var b=this,c=b._getBaseScheme();if("discrete"!==b.scaleType)return function(){var a=c.apply(null,arguments);return b._wrapScale(a)};var d=b.option("Map");if(!d)return function(){var a=c.apply(null,arguments);return b._wrapScale(a)};var e=this._createColorMapFilter(d);return function(f){var g;f instanceof Array||(f=a.array.copy(arguments)),f=f.filter(e.domain);var h=c(f),i=h.range().filter(e.color);h.range(i),g=function(b){var c=a.getOwn(d,b);return c||h(b)},a.copy(g,h);var j,k;return g.domain=function(){if(arguments.length)throw a.operationInvalid("The scale cannot be modified.");return j||(j=a.array.append(a.ownKeys(d),f)),j},g.range=function(){if(arguments.length)throw a.operationInvalid("The scale cannot be modified.");return k||(k=a.array.append(a.own(d),i)),k},b._wrapScale(g)}},sceneScale:function(b){var c=a.get(b,"sceneVarName")||this.role.name,d=this.scalesByCateg;
if(d){var e=this.option("Missing");return function(a){var b=a.vars[c].value;if(null==b)return e;var f=a.group.parent.absKey;return d[f](b)}}return this.scale.by1(function(a){return a&&a.vars[c].value})},_buildOptionId:function(){return this.id+"Axis"},_getOptionsDefinition:function(){return eb},_resolveByNaked:Fa.options.specify(function(b){return this.index?void 0:this._chartOption(this.id+a.firstUpperCase(b.name))}),_specifyV1ChartOption:function(a,b){return!!(!this.index&&this.chart.compatVersion()<=1&&this._specifyChartOption(a,b))||void 0}});var cb,db={resolveDefault:function(b){return!(this.index||!this._specifyChartOption(b,a.firstLowerCase(b.name)))||void 0}},eb=a.create(Wa,{Colors:{resolve:"_resolveFull",getDefault:xa,data:{resolveV1:function(a){return"discrete"===this.scaleType?0===this.index?this._specifyChartOption(a,"colors"):1===this.index&&this.chart._allowV1SecondAxis&&this._specifyChartOption(a,"secondAxisColor"):this._specifyChartOption(a,"colorRange"),!0},resolveDefault:function(a){0===this.index&&this._specifyChartOption(a,"colors")}},cast:Fa.colorScheme},Map:{resolve:"_resolveFull",cast:wa},Transform:{resolve:"_resolveFull",data:{resolveDefault:function(b){var c=this._plotList;if(c.length<=2){var d=a.query(c).all(function(a){var b=a.name;return"plot2"===b||"trend"===b});if(d)return b.defaultValue(Fa.brighterColorTransform),!0}}},cast:a.fun.to},NormByCategory:{resolve:function(a){return this.chart._allowColorPerCategory?this._resolveFull(a):(a.specify(!1),!0)},data:{resolveV1:function(a){return this._specifyV1ChartOption(a,"normPerBaseCategory"),!0}},cast:Boolean,value:!1},ScaleType:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyV1ChartOption(a,"scalingType"),!0}},cast:Fa.parseContinuousColorScaleType,value:"linear"},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:!1},Domain:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyV1ChartOption(a,"colorRangeInterval"),!0}},cast:a.array.to},Min:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyV1ChartOption(a,"minColor"),!0}},cast:b.color},Max:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyV1ChartOption(a,"maxColor"),!0}},cast:b.color},Missing:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyV1ChartOption(a,"nullColor"),!0}},cast:b.color,value:b.color("lightgray")},Unbound:{resolve:"_resolveFull",getDefault:function(){var a=this.option("Colors");return a().range()[0]||Fa.defaultColor},cast:b.color},LegendVisible:{resolve:"_resolveFull",data:db,cast:Boolean,value:!0},LegendClickMode:{resolve:"_resolveFull",data:db,cast:Fa.parseLegendClickMode,value:"togglevisible"},LegendDrawLine:{resolve:"_resolveFull",data:db,cast:Boolean,value:!1},LegendDrawMarker:{resolve:"_resolveFull",data:db,cast:Boolean,value:!0},LegendShape:{resolve:"_resolveFull",data:db,cast:Fa.parseShape}});a.type("pvc.visual.SizeAxis",Va).init(function(b,c,d,e){e=a.set(e,"byNaked",!1),this.base(b,c,d,e)}).add({_buildOptionId:function(){return this.id+"Axis"},scaleTreatsNullAs:function(){return"min"},scaleUsesAbs:function(){return this.option("UseAbs")},setScaleRange:function(b){var c=this.scale;return c.min=b.min,c.max=b.max,c.size=b.max-b.min,c.range(c.min,c.max),Fa.debug>=4&&Fa.log("Scale: "+Fa.stringify(a.copyOwn(c))),this},_getOptionsDefinition:function(){return fb}});var fb=a.create(Wa,{OriginIsZero:{resolve:"_resolveFull",cast:Boolean,value:!1},FixedMin:{resolve:"_resolveFull",cast:Fa.castNumber},FixedMax:{resolve:"_resolveFull",cast:Fa.castNumber},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:!1}});a.type("pvc.visual.NormalizedAxis",Va).init(function(b,c,d,e){e=a.set(e,"byNaked",!1),this.base(b,c,d,e)}).add({_buildOptionId:function(){return this.id+"Axis"},scaleTreatsNullAs:function(){return"zero"},scaleUsesAbs:a.retTrue,scaleSumNormalized:a.retTrue,setScaleRange:function(b){var c=this.scale;return c.min=b.min,c.max=b.max,c.size=b.max-b.min,c.range(c.min,c.max),Fa.debug>=4&&Fa.log("Scale: "+Fa.stringify(a.copyOwn(c))),this},_getOptionsDefinition:function(){return gb}});var gb=a.create(Wa,{OriginIsZero:{value:!0}});a.type("pvc.visual.Legend",Fa.visual.OptionsBase).init(function(b,c,d,e){e=a.set(e,"byNaked",!1),this.base(b,c,d,e)}).add({_getOptionsDefinition:function(){return hb}});var hb={Position:{resolve:"_resolveFull",cast:Fa.parsePosition,value:"bottom"},Size:{resolve:"_resolveFull",cast:ya},SizeMax:{resolve:"_resolveFull",cast:ya},Align:{resolve:"_resolveFull",data:{resolveDefault:function(a){var b,c=this.option("Position");return"top"!==c&&"bottom"!==c?b="top":this.chart.compatVersion()<=1&&(b="left"),a.defaultValue(b),!0}},cast:za},Margins:{resolve:"_resolveFull",data:{resolveDefault:function(b){if(this.chart.compatVersion()>1){var c=this.option("Position"),d=a.set({},Fa.BasePanel.oppositeAnchor[c],5);b.defaultValue(d)}return!0}},cast:Ja.as},Paddings:{resolve:"_resolveFull",cast:Ja.as,value:5},Font:{resolve:"_resolveFull",cast:String},ItemSize:{resolve:"_resolveFull",cast:Aa}};a.type("pvc.visual.legend.BulletRootScene",Fa.visual.Scene).init(function(b,c){this.base(b,c),this._unresolvedMarkerDiam=a.get(c,"markerSize"),this._unresolvedItemPadding=new Ja(a.get(c,"itemPadding",5)),this._unresolvedItemSize=Ma.to(a.get(c,"itemSize"))||new Ma,a.set(this.vars,"horizontal",a.get(c,"horizontal",!1),"font",a.get(c,"font"),"textMargin",a.get(c,"textMargin",6)-3)}).add({layout:function(b){function c(b){var c=b.labelTextSize(),e=!c||!c.width||!c.height;if(b.isHidden=e,!e){var f,h={width:l+c.width,height:Math.max(c.height,k)},j={width:i.width||g.width+h.width,height:i.height||g.height+h.height},m={width:Math.max(0,j.width-g.width),height:Math.max(0,j.height-g.height)};q?f=!q.items.length:(q=new Fa.visual.legend.BulletItemSceneSection(0),f=!0);var r=q.size[n]+m[n];f||(r+=g[n]),!f&&r>p&&(d(!1),r=m[n]);var s=q.size;s[n]=r,s[o]=Math.max(s[o],m[o]);var t=q.items.length;q.items.push(b),a.set(b.vars,"section",q,"sectionIndex",t,"textSize",c,"itemSize",j,"itemClientSize",m,"itemContentSize",h)}}function d(a){var b=q.size;s[o]+=b[o],r.length&&(s[o]+=g[o]),s[n]=Math.max(s[n],b[n]),r.push(q),a||(q=new Fa.visual.legend.BulletItemSceneSection(r.length))}var e=b.clientSize;if(!(e.width>0&&e.height>0))return new Ma(0,0);var f=b.desiredClientSize,g=this._unresolvedItemPadding.resolve(e),h={width:e.width+g.width,height:e.height+g.height},i=this._unresolvedItemSize.resolve(h),j={width:i.width&&Math.max(0,i.width-g.width),height:i.height&&Math.max(0,i.height-g.height)},k=this._unresolvedMarkerDiam||j.height||15;this.vars.itemPadding=g,this.vars.desiredItemSize=i,this.vars.desiredItemClientSize=j,this.vars.markerSize=k;var l=k+this.vars.textMargin,m=Math.max(0,Math.min(j.width||1/0,f.width||1/0,e.width)-l),n=this.vars.horizontal?"width":"height",o=Fa.BasePanel.oppositeLength[n],p=f[n];(!p||0>p)&&(p=e[n]);var q,r=[],s={width:0,height:0};if(this.childNodes.forEach(function(a){a.childNodes.forEach(c,this)},this),!q)return new Ma(0,0);d(!0),a.set(this.vars,"sections",r,"contentSize",s,"labelWidthMax",m);var t=this.compatVersion()<=1,u=t?p:s[n],v=f[o];(!v||0>v)&&(v=s[o]);var w=this.vars.size=a.set({},n,Math.min(u,e[n]),o,Math.min(v,e[o]));return w},defaultGroupSceneType:function(){var b=this._bulletGroupType;return b||(b=a.type(Fa.visual.legend.BulletGroupScene),this._bulletGroupType=b),b},createGroup:function(a){var b=this.defaultGroupSceneType();return new b(this,a)}}),a.type("pvc.visual.legend.BulletItemSceneSection").init(function(a){this.index=a,this.items=[],this.size={width:0,height:0}}),a.type("pvc.visual.legend.BulletGroupScene",Fa.visual.Scene).init(function(b,c){this.base(b,c),this.extensionPrefix=a.get(c,"extensionPrefix")||"",this._renderer=a.get(c,"renderer"),this.colorAxis=a.get(c,"colorAxis"),this.clickMode=a.get(c,"clickMode"),!this.clickMode&&this.colorAxis&&(this.clickMode=this.colorAxis.option("LegendClickMode"))}).add({hasRenderer:function(){return!!this._renderer},renderer:function(a){if(null!=a)this._renderer=a;else if(a=this._renderer,!a){var b,c=this.colorAxis;c&&(b={drawRule:c.option("LegendDrawLine"),drawMarker:c.option("LegendDrawMarker"),markerShape:c.option("LegendShape")}),a=new Fa.visual.legend.BulletItemDefaultRenderer(b),this._renderer=a}return a},itemSceneType:function(){var b=this._itemSceneType;if(!b){b=a.type(Fa.visual.legend.BulletItemScene);var c=this.clickMode;switch(c){case"toggleselected":b.add(Fa.visual.legend.BulletItemSceneSelection);break;case"togglevisible":b.add(Fa.visual.legend.BulletItemSceneVisibility)}var d=this.panel();d._extendSceneType("item",b,["isOn","executable","execute","value","labelText"]);var e=Fa.makeExtensionAbsId(Fa.makeExtensionAbsId("ItemScene",[this.extensionPrefix,"$"]),d._getExtensionPrefix()),f=d.chart._getExtension(e,"value");void 0!==f&&b.prototype.variable("value",f),this._itemSceneType=b}return b},createItem:function(a){var b=this.itemSceneType();return new b(this,a)}}),a.type("pvc.visual.legend.BulletItemScene",Fa.visual.Scene).init(function(){if(this.base.apply(this,arguments),!this.executable()){var a=Fa.visual.Interactive;this._ibits=a.Interactive|a.ShowsInteraction|a.Hoverable|a.SelectableAny}}).add({isOn:a.fun.constant(!0),executable:a.fun.constant(!1),execute:a.fun.constant(),labelText:function(){return this.value().label},labelTextSize:function(){return b.Text.measure(this.labelText(),this.vars.font)},_valueEval:function(){var a=this._valueEvalCore();return a instanceof Ta||(a=new Ta(a,a)),a},_valueEvalCore:function(){var a,b,c,d,e,f=this.group||this.datum;return f&&(a=f.value,b=f.rawValue,e=this._getTrendLineSuffix(f),c=f.ensureLabel()+e,d=f.absLabel?f.absLabel+e:c),new Ta(a||null,c||"",b,d)},_getTrendLineSuffix:function(a){var b,c;return(b=a.firstDatum())&&(c=b.trend)?" ("+c.label+")":""}}).prototype.variable("value"),a.type("pvc.visual.legend.BulletItemSceneSelection").add({isOn:function(){var a=this.group||this.datum;return!a.owner.selectedCount()||this.isSelected()},executable:function(){return this.chart().selectableByClick()},execute:function(){var a=this.datums().array();if(a.length){var b=this.chart();b._updatingSelections(function(){a=b._onUserSelection(a),a&&a.length&&Fa.data.Data.toggleSelected(a,!0)})}}}),a.type("pvc.visual.legend.BulletItemSceneVisibility").add({isOn:function(){return this.datums().any(function(a){return!a.isNull&&a.isVisible})},executable:a.fun.constant(!0),execute:function(){Fa.data.Data.toggleVisible(this.datums())&&this.chart().render(!0,!0,!1)}}),a.type("pvc.visual.legend.BulletItemRenderer"),a.type("pvc.visual.legend.BulletItemDefaultRenderer",Fa.visual.legend.BulletItemRenderer).init(function(b){this.drawRule=a.get(b,"drawRule",!1),this.drawRule&&(this.rulePvProto=a.get(b,"rulePvProto")),this.drawMarker=!this.drawRule||a.get(b,"drawMarker",!0),this.drawMarker&&(this.markerShape=a.get(b,"markerShape","square"),this.markerPvProto=a.get(b,"markerPvProto"))}).add({drawRule:!1,drawMarker:!0,markerShape:null,rulePvProto:null,markerPvProto:null,create:function(a,b,c,d){var e={},f=this.drawRule,g=function(a){return a.color};if(f){var h=(new Ga).left(0).top(function(){return this.parent.height()/2}).width(function(){return this.parent.width()}).lineWidth(1,Fa.extensionTag).strokeStyle(g,Fa.extensionTag),i=this.rulePvProto;i&&(h=i.extend(h)),e.pvRule=new Fa.visual.Rule(a,b,{proto:h,noSelect:!1,noHover:!1,activeSeriesAware:!1,extensionId:c+"Rule",extensionId:Fa.makeExtensionAbsId("Rule",[c,"$"]),showsInteraction:!0,wrapper:d}).pvMark}if(this.drawMarker){var j=(new Ga).left(function(){return this.parent.width()/2}).top(function(){return this.parent.height()/2}).shapeSize(function(){return this.parent.width()},Fa.extensionTag).lineWidth(2,Fa.extensionTag).fillStyle(g,Fa.extensionTag).strokeStyle(g,Fa.extensionTag).shape(this.markerShape,Fa.extensionTag).angle(f?0:Math.PI/2,Fa.extensionTag).antialias(function(){var a=Math.abs(Math.cos(this.angle()));if(0!==a&&1!==a)switch(this.shape()){case"square":case"bar":return!1}return!0},Fa.extensionTag),k=this.markerPvProto;k&&(j=k.extend(j)),e.pvDot=new Fa.visual.Dot(a,b,{proto:j,freePosition:!0,activeSeriesAware:!1,noTooltip:!0,noClick:!0,extensionId:Fa.makeExtensionAbsId("Dot",[c,"$"]),wrapper:d}).pvMark}return e}}),a.type("pvc.visual.DataCell").init(function(b,c,d,e,f){this.plot=b,this.axisType=c,this.axisIndex=d,this.role=b.chart.visualRoles[e]||a.fail.argumentInvalid("roleName","Role is not defined."),this.dataPartValue=f}),a.type("pvc.visual.ColorDataCell",Fa.visual.DataCell).init(function(a,b,c,d,e){this.base(a,b,c,d,e),this._legendGroupScene=null}).add({legendGroupScene:function(a){return arguments.length?(this._legendGroupScene=a,this):this._legendGroupScene}}),a.type("pvc.visual.Plot",Fa.visual.OptionsBase).init(function(b,c){var d=a.getPath(b,["plotsByType",this.type]),e=d?d.length:0,f=b.plotList.length;c=a.set(c,"byNaked",!f),this.base(b,this.type,e,c),b._addPlot(this);var g=this.extensionPrefixes=[this.id];this.globalIndex||g.push(""),this.name&&g.push(this.name)}).add({_getOptionsDefinition:function(){return Fa.visual.Plot.optionsDef},_resolveByNaked:Fa.options.specify(function(b){return this.globalIndex?void 0:this._chartOption(a.firstLowerCase(b.name))}),collectDataCells:function(a){var b=this._getColorDataCell();b&&a.push(b)},_getColorDataCell:function(){var a=this.option("ColorRole");return a?new Fa.visual.ColorDataCell(this,"color",this.option("ColorAxis")-1,a,this.option("DataPart")):void 0}}),Fa.visual.Plot.optionsDef={Orientation:{resolve:function(a){return a.specify(this._chartOption("orientation")||"vertical"),!0},cast:String},ValuesVisible:{resolve:"_resolveFull",data:{resolveV1:function(a){if(0===this.globalIndex){var b=this._chartOption("showValues");return void 0!==b?a.specify(b):(b="point"!==this.type,a.defaultValue(b)),!0}}},cast:Boolean,value:!1},ValuesAnchor:{resolve:"_resolveFull",cast:Fa.parseAnchor},ValuesFont:{resolve:"_resolveFull",cast:String,value:"10px sans-serif"},ValuesMask:{resolve:"_resolveFull",cast:String,value:"{value}"},ValuesOptimizeLegibility:{resolve:"_resolveFull",cast:Boolean,value:!1},ValuesOverflow:{resolve:"_resolveFull",cast:Fa.parseValuesOverflow,value:"hide"},DataPart:{resolve:"_resolveFixed",cast:String,value:"0"},ColorRole:{resolve:"_resolveFixed",cast:String,value:"color"},ColorAxis:{resolve:Fa.options.resolvers([function(a){if(0===this.globalIndex)return a.specify(1),!0},"_resolveFull"]),cast:function(b){return b=Fa.castNumber(b),b=null!=b?a.between(b,1,10):1},value:1}},a.type("pvc.visual.CartesianOrthoDataCell",Fa.visual.DataCell).init(function(a,b,c,d,e,f,g,h){this.base(a,b,c,d,e),this.isStacked=f,this.nullInterpolationMode=g,this.trend=h}),a.type("pvc.visual.CartesianPlot",Fa.visual.Plot).add({collectDataCells:function(b){this.base(b),b.push(new Fa.visual.DataCell(this,"base",this.option("BaseAxis")-1,this.option("BaseRole"),this.option("DataPart")));var c=a.array.to(this.option("OrthoRole")),d=this.option("DataPart"),e=this.option("OrthoAxis")-1,f=this.option.isDefined("Stacked")?this.option("Stacked"):void 0,g=this.option("NullInterpolationMode"),h=this.option("Trend");c.forEach(function(a){b.push(new Fa.visual.CartesianOrthoDataCell(this,"ortho",e,a,d,f,g,h))},this)},_getOptionsDefinition:function(){return Fa.visual.CartesianPlot.optionsDef}}),Fa.visual.CartesianPlot.optionsDef=a.create(Fa.visual.Plot.optionsDef,{BaseAxis:{value:1},BaseRole:{resolve:"_resolveFixed",cast:String},OrthoAxis:{resolve:function(a){return 0===this.globalIndex?(a.specify(1),!0):this._resolveFull(a)},data:{resolveV1:function(a){return"plot2"===this.name&&this.chart._allowV1SecondAxis&&this._chartOption("secondAxisIndependentScale")&&a.specify(2),!0}},cast:function(b){return b=Fa.castNumber(b),null!=b?a.between(b,1,10):1},value:1},OrthoRole:{resolve:Fa.options.resolvers(["_resolveFixed","_resolveDefault"])},Trend:{resolve:"_resolveFull",data:{resolveDefault:function(a){var b=this.option("TrendType");if(b)return a.defaultValue({type:b}),!0}},cast:Ca},TrendType:{resolve:"_resolveFull",cast:Fa.parseTrendType},TrendLabel:{resolve:"_resolveFull",cast:String},NullInterpolationMode:{resolve:"_resolveFull",cast:Fa.parseNullInterpolationMode,value:"none"}}),a.type("pvc.visual.CategoricalPlot",Fa.visual.CartesianPlot).add({_getOptionsDefinition:function(){return Fa.visual.CategoricalPlot.optionsDef}}),Fa.visual.CategoricalPlot.optionsDef=a.create(Fa.visual.CartesianPlot.optionsDef,{Stacked:{resolve:"_resolveFull",cast:Boolean,value:!1},BaseRole:{value:"category"},OrthoRole:{value:"value"}}),a.type("pvc.visual.BarPlotAbstract",Fa.visual.CategoricalPlot).add({_getOptionsDefinition:function(){return Fa.visual.BarPlotAbstract.optionsDef}}),Fa.visual.BarPlotAbstract.optionsDef=a.create(Fa.visual.CategoricalPlot.optionsDef,{BarSizeRatio:{resolve:"_resolveFull",cast:function(a){return a=Fa.castNumber(a),null==a?a=1:.05>a?a=.05:a>1&&(a=1),a},value:.9},BarSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyChartOption(a,"maxBarSize"),!0}},cast:function(a){return a=Fa.castNumber(a),null==a?a=1/0:1>a&&(a=1),a},value:2e3},BarOrthoSizeMin:{resolve:"_resolveFull",cast:Fa.castNonNegativeNumber,value:1.5},BarStackedMargin:{resolve:"_resolveFull",cast:function(a){return a=Fa.castNumber(a),null!=a&&0>a&&(a=0),a},value:0},OverflowMarkersVisible:{resolve:"_resolveFull",cast:Boolean,value:!0},ValuesAnchor:{value:"center"}}),a.type("pvc.visual.BarPlot",Fa.visual.BarPlotAbstract).add({type:"bar"}),a.type("pvc.visual.NormalizedBarPlot",Fa.visual.BarPlotAbstract).add({type:"bar",_getOptionsDefinition:function(){return Fa.visual.NormalizedBarPlot.optionsDef}}),Fa.visual.NormalizedBarPlot.optionsDef=a.create(Fa.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:!0}}),a.type("pvc.visual.WaterfallPlot",Fa.visual.BarPlotAbstract).add({type:"water",_getOptionsDefinition:function(){return Fa.visual.WaterfallPlot.optionsDef}}),Fa.visual.WaterfallPlot.optionsDef=a.create(Fa.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:!0},TotalLineLabel:{resolve:"_resolveFull",cast:String,value:"Accumulated"},TotalValuesVisible:{resolve:"_resolveFull",data:{resolveDefault:function(a){return a.defaultValue(this.option("ValuesVisible")),!0}},cast:Boolean},Direction:{resolve:"_resolveFull",cast:Fa.parseWaterDirection,value:"down"},AreasVisible:{resolve:"_resolveFull",cast:Boolean,value:!0},AllCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}}),a.type("pvc.visual.PointPlot",Fa.visual.CategoricalPlot).add({type:"point",_getOptionsDefinition:function(){return Fa.visual.PointPlot.optionsDef}}),Fa.visual.PointPlot.optionsDef=a.create(Fa.visual.CategoricalPlot.optionsDef,{DotsVisible:{resolve:"_resolveFull",data:Da("Dots",!0),cast:Boolean,value:!1},LinesVisible:{resolve:"_resolveFull",data:Da("Lines",!0),cast:Boolean,value:!1},AreasVisible:{resolve:"_resolveFull",data:Da("Areas",!1),cast:Boolean,value:!1},ValuesAnchor:{value:"right"}}),a.type("pvc.visual.MetricXYPlot",Fa.visual.CartesianPlot).add({_getOptionsDefinition:function(){return Fa.visual.MetricXYPlot.optionsDef}}),Fa.visual.MetricXYPlot.optionsDef=a.create(Fa.visual.CartesianPlot.optionsDef,{BaseRole:{value:"x"},OrthoAxis:{resolve:null},OrthoRole:{value:"y"}}),a.type("pvc.visual.MetricPointPlot",Fa.visual.MetricXYPlot).add({type:"scatter",collectDataCells:function(a){if(this.base(a),this.option("DotsVisible")){var b=this.chart.visualRole(this.option("SizeRole"));b.isBound()&&a.push(new Fa.visual.DataCell(this,"size",this.option("SizeAxis")-1,b.name,this.option("DataPart")))}},_getOptionsDefinition:function(){return Fa.visual.MetricPointPlot.optionsDef}}),Fa.visual.MetricPointPlot.optionsDef=a.create(Fa.visual.MetricXYPlot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},Shape:{resolve:"_resolveFull",cast:Fa.parseShape,value:"circle"},NullShape:{resolve:"_resolveFull",cast:Fa.parseShape,value:"cross"},DotsVisible:{resolve:"_resolveFull",data:Ea("Dots"),cast:Boolean,value:!1},LinesVisible:{resolve:"_resolveFull",data:Ea("Lines"),cast:Boolean,value:!1},ValuesAnchor:{value:"right"},ValuesMask:{value:"{x},{y}"}}),a.type("pvc.visual.PiePlot",Fa.visual.Plot).add({type:"pie",collectDataCells:function(a){this.base(a);var b=this.option("DataPart");a.push(new Fa.visual.DataCell(this,"category",0,"category",b)),a.push(new Fa.visual.DataCell(this,"angle",0,"value",b))},_getOptionsDefinition:function(){return Fa.visual.PiePlot.optionsDef}}),Fa.visual.PiePlot.optionsDef=a.create(Fa.visual.Plot.optionsDef,{ActiveSliceRadius:{resolve:"_resolveFull",cast:Ka.parse,value:new Ka(.05)},ExplodedSliceRadius:{resolve:"_resolveFull",cast:Ka.parse,value:0},ExplodedSliceIndex:{resolve:"_resolveFull",cast:Fa.castNumber,value:null},ValuesAnchor:{cast:Fa.parseAnchorWedge,value:"outer"},ValuesVisible:{value:!0},ValuesLabelStyle:{resolve:function(a){var b=this.chart.compatVersion()<=1;return b?(a.specify("inside"),!0):this._resolveFull(a)},cast:function(a){switch(a){case"inside":case"linked":return a}return Fa.debug>=2&&Fa.log("[Warning] Invalid 'ValuesLabelStyle' value: '"+a+"'."),"linked"},value:"linked"},ValuesMask:{resolve:"_resolveFull",data:{resolveDefault:function(a){return a.defaultValue("linked"===this.option("ValuesLabelStyle")?"{value} ({value.percent})":"{value}"),!0}}},LinkInsetRadius:{resolve:"_resolveFull",cast:Ka.parse,value:new Ka(.05)},LinkOutsetRadius:{resolve:"_resolveFull",cast:Ka.parse,value:new Ka(.025)},LinkMargin:{resolve:"_resolveFull",cast:Ka.parse,value:new Ka(.025)},LinkHandleWidth:{resolve:"_resolveFull",cast:Fa.castNumber,value:.5},LinkLabelSize:{resolve:"_resolveFull",cast:Ka.parse,value:new Ka(.15)},LinkLabelSpacingMin:{resolve:"_resolveFull",cast:Fa.castNumber,value:.5}}),a.type("pvc.visual.HeatGridPlot",Fa.visual.CategoricalPlot).add({type:"heatGrid",collectDataCells:function(a){if(this.base(a),this.option("UseShapes")){var b=this.chart.visualRole(this.option("SizeRole"));b.isBound()&&a.push(new Fa.visual.DataCell(this,"size",this.option("SizeAxis")-1,b.name,this.option("DataPart")))}},_getOptionsDefinition:function(){return Fa.visual.HeatGridPlot.optionsDef}}),Fa.visual.HeatGridPlot.optionsDef=a.create(Fa.visual.CategoricalPlot.optionsDef,{SizeRole:{value:"size"},SizeAxis:{value:1},UseShapes:{resolve:"_resolveFull",cast:Boolean,value:!1},Shape:{resolve:"_resolveFull",cast:Fa.parseShape,value:"square"},NullShape:{resolve:"_resolveFull",cast:Fa.parseShape,value:"cross"},ValuesVisible:{getDefault:function(){return!this.option("UseShapes")},value:null},ValuesMask:{value:null},ValuesAnchor:{value:"center"},OrthoRole:{value:"series"},OrthoAxis:{resolve:null},NullInterpolationMode:{resolve:null,value:"none"},Stacked:{resolve:null,value:!1}}),a.type("pvc.visual.BoxPlot",Fa.visual.CategoricalPlot).add({type:"box",_getOptionsDefinition:function(){return Fa.visual.BoxPlot.optionsDef}}),Fa.visual.BoxPlot.optionsDef=a.create(Fa.visual.CategoricalPlot.optionsDef,{Stacked:{resolve:null,value:!1},OrthoRole:{value:["median","lowerQuartil","upperQuartil","minimum","maximum"]},BoxSizeRatio:{resolve:"_resolveFull",cast:function(a){return a=Fa.castNumber(a),null==a?a=1:.05>a?a=.05:a>1&&(a=1),a},value:1/3},BoxSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(a){return this._specifyChartOption(a,"maxBoxSize"),!0}},cast:function(a){return a=Fa.castNumber(a),null==a?a=1/0:1>a&&(a=1),a},value:1/0}}),a.type("pvc.visual.BulletPlot",Fa.visual.Plot).add({type:"bullet",_getOptionsDefinition:function(){return Fa.visual.BulletPlot.optionsDef}}),Fa.visual.BulletPlot.optionsDef=a.create(Fa.visual.Plot.optionsDef,{ValuesVisible:{value:!0},ColorRole:{value:null}}),a.type("pvc.visual.TreemapPlot",Fa.visual.Plot).add({type:"treemap",_getOptionsDefinition:function(){return Fa.visual.TreemapPlot.optionsDef},collectDataCells:function(a){this.base(a);var b=this.option("SizeRole");b&&a.push(new Fa.visual.DataCell(this,"size",this.option("SizeAxis")-1,b,this.option("DataPart")))}}),Fa.visual.TreemapPlot.optionsDef=a.create(Fa.visual.Plot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},ValuesAnchor:{cast:Fa.parseAnchor,value:"center"},ValuesVisible:{value:!0},ValuesMask:{resolve:"_resolveFull",value:"{category}"},ValuesOptimizeLegibility:{value:!0},LayoutMode:{resolve:"_resolveFull",cast:Fa.parseTreemapLayoutMode,value:"squarify"},ColorMode:{resolve:"_resolveFull",cast:Fa.parseTreemapColorMode,value:"byparent"},RootCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}}),a.type("pvc.visual.SunburstPlot",Fa.visual.Plot).add({type:"sunburst",_getOptionsDefinition:function(){return Fa.visual.SunburstPlot.optionsDef},collectDataCells:function(a){this.base(a);var b=this.option("SizeRole");b&&a.push(new Fa.visual.DataCell(this,"size",this.option("SizeAxis")-1,b,this.option("DataPart")))}}),Fa.visual.SunburstPlot.optionsDef=a.create(Fa.visual.Plot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},ValuesAnchor:{cast:Fa.parseAnchor,value:"center"},ValuesVisible:{value:!0},ValuesMask:{resolve:"_resolveFull",value:"{category}"},ValuesOptimizeLegibility:{value:!0},RootCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"},SliceOrder:{resolve:"_resolveFull",cast:Fa.parseSunburstSliceOrder,value:"bySizeDescending"},EmptySlicesVisible:{resolve:"_resolveFull",cast:Boolean,value:!1},EmptySlicesLabel:{resolve:"_resolveFull",cast:String,value:""}}),a.type("pvc.Abstract").init(function(){this._syncLog()}).add({invisibleLineWidth:.001,defaultLineWidth:1.5,_logInstanceId:null,_syncLog:function(){if(Fa.debug&&"undefined"!=typeof console){var a=this._getLogInstanceId();["log","info",["trace","debug"],"error","warn",["group","groupCollapsed"],"groupEnd"].forEach(function(b){b=b instanceof Array?b:[b,b],e(this,"_"+b[0],b[1],a)},this)}},_getLogInstanceId:function(){return this._logInstanceId||(this._logInstanceId=this._processLogInstanceId(this._createLogInstanceId()))},_createLogInstanceId:function(){return""+this.constructor},_processLogInstanceId:function(b){var c=30,d=b.substr(0,c);return d.length<c&&(d+=a.array.create(c-d.length," ").join("")),"["+d+"]"}}),a.scope(function(){var a=Fa.Abstract.prototype,b=function(){this._syncLog()};["log","info","trace","error","warn","group","groupEnd"].forEach(function(c){a["_"+c]=b})}),a.type("pvc.BaseChart",Fa.Abstract).add(Fa.visual.Interactive).init(function(b){var c=b,d=this.parent=a.get(b,"parent")||null;d?b||a.fail.argumentRequired("options"):b=a.mixin.copy({},this.defaults,b),this.options=b,d?(this.root=d.root,this.smallColIndex=b.smallColIndex,this.smallRowIndex=b.smallRowIndex):this.root=this,this.base(),Fa.debug>=3&&this._info("NEW CHART\n"+Fa.logSeparator.replace(/-/g,"=")+"\n  DebugLevel: "+Fa.debug),Fa.debug>=3&&!d&&c&&(this._info("OPTIONS:\n",c),Fa.debug>=5&&this._trace(Fa.stringify(b,{ownOnly:!1,funs:!0}))),d&&d._addChild(this),this._constructData(b),this._constructVisualRoles(b)}).add({_disposed:!1,_animatable:!1,parent:null,children:null,root:null,isCreated:!1,_createVersion:0,renderCallback:void 0,multiChartPageCount:null,multiChartPageIndex:null,_multiChartOverflowClipped:!1,left:0,top:0,width:null,height:null,margins:null,paddings:null,_allowV1SecondAxis:!1,compatVersion:function(a){return(a||this.options).compatVersion},_createLogInstanceId:function(){return""+this.constructor+this._createLogChildSuffix()},_createLogChildSuffix:function(){return this.parent?" ("+(this.smallRowIndex+1)+","+(this.smallColIndex+1)+")":""},_addChild:function(b){b.parent===this||a.assert("Not a child of this chart."),this.children.push(b)},_create:function(a){this._createPhase1(a),this._createPhase2(a)},_createPhase1:function(a){this._createVersion++,this.isCreated=!1,Fa.debug>=3&&this._log("Creating"),this.children=[],this.parent||Fa.removeTipsyLegends(),this._processOptions(),this.parent||this._checkNoDataI(),this.parent||this.data||(this._initVisualRoles(),this._bindVisualRolesPreI(),this._complexTypeProj=this._createComplexTypeProject(),this._bindVisualRolesPreII()),this._initData(a),this.parent||this._checkNoDataII();var b=this.visualRoles.multiChart.isBound(),c=this._chartLevel();this._initPlots(b),this._initAxes(b),b&&!this.parent&&this._initMultiCharts(),this.parent||(this._interpolate(b),this._generateTrends(b)),this._setAxesScales(c)},_createPhase2:function(){var a=this.visualRoles.multiChart.isBound();this._initChartPanels(a),this.isCreated=!0},_setSmallLayout:function(b){if(b){var c=this.basePanel;this._setProp("left",b)|this._setProp("top",b)&&c&&a.set(c.position,"left",this.left,"top",this.top),this._setProp("width",b)|this._setProp("height",b)&&c&&(c.size=new Ma(this.width,this.height)),this._setProp("margins",b)&&c&&(c.margins=new Ja(this.margins)),this._setProp("paddings",b)&&c&&(c.paddings=new Ja(this.paddings))}},_setProp:function(a,b){var c=b[a];if(null!=c)return this[a]=c,!0},_processOptions:function(){var a=this.options;return this.parent||(this.width=a.width,this.height=a.height,this.margins=a.margins,this.paddings=a.paddings),this.compatVersion()<=1&&(a.plot2=this._allowV1SecondAxis&&!!a.secondAxis),this._processOptionsCore(a),this._processExtensionPoints(),a},_processOptionsCore:function(a){if(this.parent)this._ibits=this.parent._ibits,this._tooltipOptions=this.parent._tooltipOptions;else{var c="batik"!==b.renderer();c&&(c=a.interactive,null==c&&(c=!0));var d;if(c){var e=Fa.visual.Interactive;d=e.Interactive|e.ShowsInteraction,this._processTooltipOptions(a)&&(d|=e.ShowsTooltip),a.animate&&$.support.svg&&(d|=e.Animatable);var f=!1;if(a.selectable)switch(d|=e.Selectable,Fa.parseSelectionMode(a.selectionMode)){case"rubberband":d|=e.SelectableByRubberband|e.SelectableByClick;break;case"focuswindow":d|=e.SelectableByFocusWindow,f=!0}f||"emptyspaceclick"!==Fa.parseClearSelectionMode(a.clearSelectionMode)||(d|=e.Unselectable),a.hoverable&&(d|=e.Hoverable),a.clickable&&(d|=e.Clickable|e.DoubleClickable)}else d=0;this._ibits=d}},_tooltipDefaults:{gravity:"s",delayIn:200,delayOut:80,offset:2,opacity:.9,html:!0,fade:!0,useCorners:!1,arrowVisible:!0,followMouse:!1,format:void 0},_processTooltipOptions:function(b){var c=this.compatVersion()<=1,d=b.tooltip,e=b.tooltipEnabled;return null==e&&(d&&(e=d.enabled),null==e&&(c&&(e=b.showTooltips),null==e&&(e=!0))),e?(d||(d={}),c&&this._importV1TooltipOptions(d,b),a.eachOwn(this._tooltipDefaults,function(c,e){var f=b["tooltip"+a.firstUpperCase(e)];void 0!==f?d[e]=f:void 0===d[e]&&(d[e]=c)})):d={},this._tooltipOptions=d,e},_importV1TooltipOptions:function(a,b){var c=b.tipsySettings;if(c){this.extend(c,"tooltip");for(var d in c)void 0===a[d]&&(a[d]=c[d]);null==a.html&&(a.html=!1)}},render:function(a,b,c){var d;Fa.debug>1&&Fa.group("CCC RENDER"),this._suspendSelectionUpdate();try{this.useTextMeasureCache(function(){try{for(;;){if(!this.isCreated||b?this._create({reloadData:c}):!this.parent&&this.isCreated&&Fa.removeTipsyLegends(),this.basePanel.render({bypassAnimation:a,recreate:b}),!this._isMultiChartOverflowClip){this._isMultiChartOverflowClipRetry=!1;break}b=!0,c=!1,this._isMultiChartOverflowClipRetry=!0,this._isMultiChartOverflowClip=!1,this._multiChartOverflowClipped=!0}}catch(a){a instanceof NoDataException?(Fa.debug>1&&this._log("No data found."),this._addErrorPanelMessage("No data found",!0)):(d=!0,Fa.logError(a.message),Fa.debug>0&&this._addErrorPanelMessage("Error: "+a.message,!1))}})}finally{d||this._resumeSelectionUpdate(),Fa.debug>1&&Fa.groupEnd()}return this},_addErrorPanelMessage:function(a,c){var d=this.options,e=(new b.Panel).canvas(d.canvas).width(this.width).height(this.height),f=e.anchor("center").add(b.Label).text(a);c&&this.extend(f,"noDataMessage"),e.render()},useTextMeasureCache:function(a,c){var d=this.root,e=d._textMeasureCache||(d._textMeasureCache=b.Text.createCache());return b.Text.usingCache(e,a,c||this)},animate:function(a,b){return this.basePanel.animate(a,b)},animatingStart:function(){return this.basePanel.animatingStart()},animatable:function(){return this._animatable&&this.base();
},isOrientationVertical:function(a){return(a||this.options.orientation)===Fa.orientation.vertical},isOrientationHorizontal:function(a){return(a||this.options.orientation)===Fa.orientation.horizontal},dispose:function(){this._disposed||(this._disposed=!0)},defaults:{width:400,height:300,orientation:"vertical",ignoreNulls:!0,crosstabMode:!0,isMultiValued:!1,seriesInRows:!1,groupedLabelSep:void 0,animate:!0,titlePosition:"top",titleAlign:"center",legend:!1,legendPosition:"bottom",v1StyleTooltipFormat:function(a,b,c,d){return a+", "+b+":  "+this.chart.options.valueFormat(c)+(d&&d.percent?" ("+d.percent.label+")":"")},valueFormat:a.scope(function(){var a=b.Format.number().fractionDigits(0,2);return function(b){return a.format(b)}}),percentValueFormat:a.scope(function(){var a=b.Format.number().fractionDigits(0,1);return function(b){return a.format(100*b)+"%"}}),clickable:!1,doubleClickMaxDelay:300,hoverable:!1,selectable:!1,selectionMode:"rubberband",ctrlSelectMode:!0,clearSelectionMode:"emptySpaceClick",compatVersion:1/0}}),Fa.BaseChart.add({visualRoles:null,visualRoleList:null,_serRole:null,_dataPartRole:null,_measureVisualRoles:null,visualRole:function(b){var c=a.getOwn(this.visualRoles,b);if(!c)throw a.error.operationInvalid("roleName","There is no visual role with name '{0}'.",[b]);return c},measureVisualRoles:function(){return this._measureVisualRoles},measureDimensionsNames:function(){return a.query(this._measureVisualRoles).select(function(a){return a.firstDimensionName()}).where(a.notNully).array()},_constructVisualRoles:function(){var a=this.parent;a?(this.visualRoles=a.visualRoles,this.visualRoleList=a.visualRoleList,this._measureVisualRoles=a._measureVisualRoles,["_multiChartRole","_serRole","_colorRole","_dataPartRole"].forEach(function(b){var c=a[b];c&&(this[b]=c)},this)):(this.visualRoles={},this.visualRoleList=[],this._measureVisualRoles=[])},_hasDataPartRole:a.fun.constant(!1),_getSeriesRoleSpec:a.fun.constant(null),_getColorRoleSpec:a.fun.constant(null),_addVisualRole:function(b,c){c=a.set(c,"index",this.visualRoleList.length);var d=new Fa.visual.Role(b,c);return this.visualRoleList.push(d),this.visualRoles[b]=d,d.isMeasure&&this._measureVisualRoles.push(d),d},_initVisualRoles:function(){this._multiChartRole=this._addVisualRole("multiChart",{defaultDimension:"multiChart*",requireIsDiscrete:!0}),this._hasDataPartRole()&&(this._dataPartRole=this._addVisualRole("dataPart",{defaultDimension:"dataPart",requireSingleDimension:!0,requireIsDiscrete:!0,dimensionDefaults:{isHidden:!0,comparer:a.compare}}));var b=this._getSeriesRoleSpec();b&&(this._serRole=this._addVisualRole("series",b));var c=this._getColorRoleSpec();c&&(this._colorRole=this._addVisualRole("color",c))},_assertUnboundRoleIsOptional:function(b){if(b.isRequired)throw a.error.operationInvalid("Chart type requires unassigned role '{0}'.",[b.name])},_bindVisualRolesPreI:function(){a.eachOwn(this.visualRoles,function(a){a.setIsReversed(!1)});var b=[],c=this.options,d=c.visualRoles;this.visualRoleList.forEach(function(a){var b=a.name,e=c[b+"Role"];void 0!==e&&(d||(d=c.visualRoles={}),void 0===d[b]&&(d[b]=e))});var e;if(d){e={};var f=a.query(a.keys(d)).select(this.visualRole,this).array();f.sort(function(a,b){return a.index-b.index}),f.forEach(function(c){var f,g,h=c.name,i=d[h];if(a.object.is(i))if(a.nullyTo(i.isReversed,!1)&&c.setIsReversed(!0),g=i.from,g&&g!==h){var j=this.visualRoles[g]||a.fail.operationInvalid("Source role '{0}' is not supported by the chart type.",[g]);c.setSourceRole(j),b.push(c)}else f=i.dimensions;else f=i;if(void 0!==f){f||this._assertUnboundRoleIsOptional(c);var k=Fa.data.GroupingSpec.parse(f);c.preBind(k),k.dimensions().each(function(b){a.hasOwn(e,b.name)?delete e[b.name]:e[b.name]=c})}},this)}this._sourcedRoles=b,this._dimsBoundToSingleRole=e},_bindVisualRolesPreII:function(){var b=this._dimsBoundToSingleRole;b&&(delete this._dimsBoundToSingleRole,a.eachOwn(b,this._setRoleBoundDimensionDefaults,this));var c=this._sourcedRoles;delete this._sourcedRoles,a.query(this.visualRoleList).where(function(a){return a.defaultSourceRoleName&&!a.sourceRole&&!a.isPreBound()}).each(function(a){var b=this.visualRoles[a.defaultSourceRoleName];b&&(a.setSourceRole(b,!0),c.push(a))},this),c.forEach(function(a){var b=a.sourceRole;b.isReversed&&a.setIsReversed(!a.isReversed),!a.defaultDimensionName&&b.isPreBound()&&a.preBind(b.preBoundGrouping())})},_setRoleBoundDimensionDefaults:function(a,b){this._complexTypeProj.setDimDefaults(b,a.dimensionDefaults)},_bindVisualRolesPostI:function(){function b(b,c){a.array.lazy(m,b).push(c)}function c(a){return l.hasDim(a)}function d(c,d){a.array.is(d)?d.forEach(function(a){b(a,c)}):b(d,c),c.setSourceRole(null),c.preBind(Fa.data.GroupingSpec.parse(d))}function e(a,b){b.length&&(a.requireSingleDimension?d(a,b[0]):d(a,b))}function f(a,b){l.setDim(b,{isHidden:!0}),d(a,b)}function g(a){k._assertUnboundRoleIsOptional(a),a.bind(null),a.setSourceRole(null)}function h(a){a.preBoundGrouping().dimensionNames().forEach(b)}function i(b){if(!b.sourceRole||b.isDefaultSourceRole){var h=b.defaultDimensionName;if(h){var i=h.match(/^(.*?)(\*)?$/)||a.fail.argumentInvalid("defaultDimensionName"),j=i[1],k=i[2];if(k){var m=l.groupDimensionsNames(j);if(m)return void e(b,m)}else if(c(j))return void d(b,j);b.autoCreateDimension?f(b,j):b.sourceRole?n.push(b):g(b)}else b.sourceRole?n.push(b):g(b)}else n.push(b)}function j(a){var b=a.sourceRole;b.isPreBound()?a.preBind(b.preBoundGrouping()):g(a)}var k=this,l=k._complexTypeProj,m={},n=[];a.query(k.visualRoleList).where(function(a){return a.isPreBound()}).each(h),a.query(k.visualRoleList).where(function(a){return!a.isPreBound()}).each(i),n.forEach(j),a.query(a.ownKeys(m)).where(function(a){return 1===m[a].length}).each(function(a){var b=m[a][0];k._setRoleBoundDimensionDefaults(b,a)})},_bindVisualRolesPostII:function(b){a.query(this.visualRoleList).where(function(a){return a.isPreBound()}).each(function(a){a.postBind(b)})},_logVisualRoles:function(){var b=a.ownKeys(this.visualRoles),c=Math.max(10,a.query(b).select(function(a){return a.length}).max()),d=a.string.padRight("VisualRole",c)+" < Dimension(s)",e=["VISUAL ROLES MAP SUMMARY",Fa.logSeparator,d,a.string.padRight("",c+1,"-")+"+--------------"];a.eachOwn(this.visualRoles,function(b,d){e.push(a.string.padRight(d,c)+" | "+(b.grouping||"-"))}),e.push(""),this._log(e.join("\n"))},_getDataPartDimName:function(){var a=this._dataPartRole;if(a){if(a.isBound())return a.firstDimensionName();var b=a.preBoundGrouping();return b?b.firstDimensionName():a.defaultDimensionName}}}),Fa.BaseChart.add({dataEngine:null,data:null,_partsDataCache:null,_visibleDataCache:null,resultset:[],metadata:[],_trendable:!1,_interpolatable:!1,_constructData:function(b){this.parent&&(this.dataEngine=this.data=b.data||a.fail.argumentRequired("options.data"))},_checkNoDataI:function(){if(!this.allowNoData&&!this.resultset.length)throw new NoDataException},_checkNoDataII:function(){if(!(this.allowNoData||this.data&&this.data.count()))throw this.data=null,new NoDataException},_initData:function(b){if(!this.parent){var c=this.data;c?a.get(b,"reloadData",!0)?this._onReloadData():(c.disposeChildren(),c.clearVirtuals()):this._onLoadData()}delete this._partsDataCache,delete this._visibleDataCache,Fa.debug>=3&&this._log(this.data.getInfo())},_onLoadData:function(){var b=this.data,c=this._translation;!b&&!c||a.assert("Invalid state.");var d=this.options,e=this._getDataPartDimName(),f=this._complexTypeProj||a.assert("Invalid state."),g=this._createTranslationOptions(e);c=this._translation=this._createTranslation(g),Fa.debug>=3&&(this._log(c.logSource()),this._log(c.logTranslatorType())),c.configureType(),e&&!f.isReadOrCalc(e)&&this._addDefaultDataPartCalculation(e),Fa.debug>=3&&this._log(c.logVItem()),this._bindVisualRolesPostI();var h=new Fa.data.ComplexType;f.configureComplexType(h,g),this._bindVisualRolesPostII(h),Fa.debug>=10&&this._log(h.describe()),Fa.debug>=3&&this._logVisualRoles(),b=this.dataEngine=this.data=new Fa.data.Data({type:h,labelSep:d.groupedLabelSep,keySep:g.separator});var i={where:this._getLoadFilter(),isNull:this._getIsNullDatum()},j=c.execute(b);b.load(j,i)},_onReloadData:function(){var b=this.data,c=this._translation;b&&c||a.assert("Invalid state."),this.options,c.setSource(this.resultset),Fa.debug>=3&&this._log(c.logSource());var d={where:this._getLoadFilter(),isNull:this._getIsNullDatum()},e=c.execute(b);b.load(e,d)},_createComplexTypeProject:function(){var a=this.options,b=new Fa.data.ComplexTypeProject(a.dimensionGroups),c=a.dimensions;for(var d in c)b.setDim(d,c[d]);var e=this._getDataPartDimName();e&&(b.setDim(e),this._addPlot2SeriesDataPartCalculation(b,e));var f=a.calculations;return f&&f.forEach(function(a){b.setCalc(a)}),b},_getLoadFilter:function(){},_getIsNullDatum:function(){var a=this.measureDimensionsNames(),b=a.length;return b?function(c){for(var d=c.atoms,e=0;b>e;e++)if(null!=d[a[e]].value)return!1;return!0}:void 0},_createTranslation:function(a){var b=this._getTranslationClass(a);return new b(this,this._complexTypeProj,this.resultset,this.metadata,a)},_getTranslationClass:function(a){return a.crosstabMode?Fa.data.CrosstabTranslationOper:Fa.data.RelationalTranslationOper},_createTranslationOptions:function(b){var c=this.options,d=c.dataOptions||{},e=c.dataSeparator;void 0===e&&(e=d.separator),e||(e="~");var f=c.dataMeasuresInColumns;void 0===f&&(f=d.measuresInColumns);var g=c.dataCategoriesCount;void 0===g&&(g=d.categoriesCount);var h=c.dataIgnoreMetadataLabels;void 0===h&&(h=d.ignoreMetadataLabels);var i,j=c.plot2,k=c.valueFormat;k&&k!==this.defaults.valueFormat&&(i=function(a){return null!=a?k(a):""});var l,m;return j&&(this._allowV1SecondAxis&&this.compatVersion()<=1?m=c.secondAxisIdx:(l=null!=this._serRole&&c.plot2Series&&a.array.as(c.plot2Series),l&&l.length||(l=null,m=c.plot2SeriesIndexes)),l||(m=Fa.parseDistinctIndexArray(m,-1/0)||-1)),{compatVersion:this.compatVersion(),plot2DataSeriesIndexes:m,seriesInRows:c.seriesInRows,crosstabMode:c.crosstabMode,isMultiValued:c.isMultiValued,dataPartDimName:b,dimensionGroups:c.dimensionGroups,dimensions:c.dimensions,readers:c.readers,measuresIndexes:c.measuresIndexes,multiChartIndexes:c.multiChartIndexes,separator:e,measuresInColumns:f,categoriesCount:g,measuresIndex:d.measuresIndex||d.measuresIdx,measuresCount:d.measuresCount||d.numMeasures,isCategoryTimeSeries:c.timeSeries,timeSeriesFormat:c.timeSeriesFormat,valueNumberFormatter:i,ignoreMetadataLabels:h}},_addPlot2SeriesDataPartCalculation:function(b,c){if(!(this.compatVersion()<=1)){var d=this.options,e=this._serRole,f=null!=e&&d.plot2&&d.plot2Series&&a.array.as(d.plot2Series);if(f&&f.length){var g,h,i,j,k=!1,l=a.query(f).uniqueIndex();b.setCalc({names:c,calculation:function(b,d){if(k||(e.isBound()&&(g=e.grouping.dimensionNames(),h=b.owner.dimensions(c)),k=!0),h){var f=Fa.data.Complex.compositeKey(b,g);d[c]=a.hasOwnProp.call(l,f)?j||(j=h.intern("1")):i||(i=h.intern("0"))}}})}}},_addDefaultDataPartCalculation:function(a){var b,c;this._complexTypeProj.setCalc({names:a,calculation:function(d,e){b||(b=d.owner.dimensions(a)),e[a]=c||(c=b.intern("0"))}})},partData:function(b,c){if(c||(c=this.data),null==b)return c;if(this.parent)return this.root.partData(b,c);var d=this._dataPartRole;if(!d||!d.isBound())return c;var e="\0"+c.id+":"+a.nullyTo(b,""),f=a.lazy(this,"_partsDataCache"),g=f[e];return g||(g=this._createPartData(c,d,b),f[e]=g),g},_createPartData:function(b,c,d){var e=c.firstDimensionName(),f=b.dimensions(e).getDistinctAtoms(a.array.to(d)),g=ha([a.set({},e,f)]);return b.where(null,{where:g})},visibleData:function(b,c){var d=a.get(c,"baseData")||this.data;if(this.parent)return c=c?Object.create(c):{},c.baseData=d,this.root.visibleData(b,c);var e=!!a.get(c,"inverted",!1),f=!(!this.options.ignoreNulls&&!a.get(c,"ignoreNulls",!0)),g="\0"+d.id+"|"+e+"|"+f+"|"+(null!=b?b:null),h=a.lazy(this,"_visibleDataCache"),i=h[g];if(!i){var j=this.partData(b,d);c=c?Object.create(c):{},c.visible=!0,c.isNull=!f&&null,i=h[g]=this._createVisibleData(j,c)}return i},_createVisibleData:function(a,b){var c=this._serRole;return c&&c.isBound()?c.flatten(a,b):a.where(null,b)},_initMultiCharts:function(){var b=this;b.multiOptions=new Fa.visual.MultiChart(b),b.smallOptions=new Fa.visual.SmallChart(b);var c,d,e,f,g=b.multiOptions.option,h=b.visualRoles.multiChart.flatten(b.data,{visible:!0,isNull:null}),i=h.childNodes;b._isMultiChartOverflowClipRetry?(d=b._clippedMultiChartRowsMax,c=b._clippedMultiChartColsMax,f=c,e=d*c):e=g("Max");var j=Math.min(i.length,e);0===j?c=d=f=0:b._isMultiChartOverflowClipRetry||(f=g("ColumnsMax"),c=Math.min(j,f),c>=1&&isFinite(c)||a.assert("Must be at least 1 and finite"),d=Math.ceil(j/c),d>=1||a.assert("Must be at least 1")),b._multiInfo={data:h,smallDatas:i,count:j,rowCount:d,colCount:c,colsMax:f}},_interpolate:function(b){if(this._interpolatable){var c=a.query(this.axesList).selectMany(a.propGet("dataCells")).where(function(a){var b=a.nullInterpolationMode;return!!b&&"none"!==b}).distinct(function(a){return a.role.name+"|"+(a.dataPartValue||"")}).array();this._eachLeafDatasAndDataCells(b,c,this._interpolateDataCell,this)}},_generateTrends:function(b){var c=this._getDataPartDimName();if(this._trendable&&c){var d=a.query(this.axesList).selectMany(a.propGet("dataCells")).where(a.propGet("trend")).distinct(function(a){return a.role.name+"|"+(a.dataPartValue||"")}).array(),e=[];this._eachLeafDatasAndDataCells(b,d,function(a,b){this._generateTrendsDataCell(e,a,b)},this),e.length&&this.data.owner.add(e)}},_eachLeafDatasAndDataCells:function(a,b,c,d){var e=b.length;if(e){var f,g;a?(f=this._multiInfo.smallDatas,g=this._multiInfo.count):(f=[this.data],g=1);for(var h=0;g>h;h++)for(var i=f[h],j=0;e>j;j++)c.call(d,b[j],i,j,h)}},_interpolateDataCell:function(){},_generateTrendsDataCell:function(){},_getTrendDataPartAtom:function(){var a=this._getDataPartDimName();return a?this.data.owner.dimensions(a).intern("trend"):void 0},setData:function(a,b){return this.setResultset(a&&a.resultset),this.setMetadata(a&&a.metadata),$.extend(this.options,b),this},setResultset:function(b){return!this.parent||a.fail.operationInvalid("Can only set resultset on root chart."),this.resultset=b||[],this.resultset.length||this._warn("Resultset is empty"),this},setMetadata:function(b){return!this.parent||a.fail.operationInvalid("Can only set metadata on root chart."),this.metadata=b||[],this.metadata.length||this._warn("Metadata is empty"),this}}),Fa.BaseChart.add({_initPlots:function(a){if(this.plotPanelList=null,this.parent){var b=this.root;this.plots=b.plots,this.plotList=b.plotList,this.plotsByType=b.plotsByType}else this.plots={},this.plotList=[],this.plotsByType={},this._initPlotsCore(a)},_initPlotsCore:function(){},_addPlot:function(b){var c=this.plotsByType,d=this.plots,e=b.type,f=b.index,g=b.name,h=b.id;if(g&&a.hasOwn(d,g))throw a.error.operationInvalid("Plot name '{0}' already taken.",[g]);if(a.hasOwn(d,h))throw a.error.operationInvalid("Plot id '{0}' already taken.",[h]);var i=a.array.lazy(c,e);if(a.hasOwn(i,f))throw a.error.operationInvalid("Plot index '{0}' of type '{1}' already taken.",[f,e]);b.globalIndex=this.plotList.length,i[f]=b,this.plotList.push(b),d[h]=b,g&&(d[g]=b)},_collectPlotAxesDataCells:function(b,c){var d=[];b.collectDataCells(d),d.length&&a.query(d).where(function(a){return a.role.isBound()}).each(function(b){var d=a.array.lazy(c,b.axisType);a.array.lazy(d,b.axisIndex).push(b)})},_addPlotPanel:function(b){a.lazy(this,"plotPanels")[b.plot.id]=b,a.array.lazy(this,"plotPanelList").push(b)},_createPlotPanels:function(){throw a.error.notImplemented()}}),Fa.BaseChart.add({colors:null,axes:null,axesList:null,axesByType:null,_axisClassByType:{color:Fa.visual.ColorAxis,size:Fa.visual.SizeAxis,base:Xa,ortho:Xa},_axisCreateChartLevel:{color:1,size:2,base:3,ortho:3},_axisSetScaleChartLevel:{color:1,size:2,base:2,ortho:2},_axisCreationOrder:["color","size","base","ortho"],_axisCreateIfUnbound:{},_chartLevel:function(){var a=0;return this.parent||(a|=1),(this.parent||!this.visualRoles.multiChart.isBound())&&(a|=2),a},_initAxes:function(){this.axes={},this.axesList=[],this.axesByType={},delete this._rolesColorScale;var b;this.parent?b=this.root._dataCellsByAxisTypeThenIndex:(b={},this.plotList.forEach(function(a){this._collectPlotAxesDataCells(a,b)},this),this._dataCellsByAxisTypeThenIndex=b);var c=this._chartLevel();this._axisCreationOrder.forEach(function(a){if(0!==(this._axisCreateChartLevel[a]&c)){var d,e=b[a];e?(d=this._axisClassByType[a],d&&e.forEach(function(b,c){new d(this,a,c)},this)):this._axisCreateIfUnbound[a]&&(d=this._axisClassByType[a],d&&new d(this,a,0))}},this),this.parent&&this.root.axesList.forEach(function(b){a.hasOwn(this.axes,b.id)||this._addAxis(b)},this),a.eachOwn(b,function(a,b){this._axisCreateChartLevel[b]&c&&a.forEach(function(a,c){var d=this.axes[Fa.buildIndexedId(b,c)];d.isBound()||d.bind(a)},this)},this)},_addAxis:function(b){this.axes[b.id]=b,b.chart===this&&(b.axisIndex=this.axesList.length),this.axesList.push(b);var c=a.array.lazy(this.axesByType,b.type),d=c.count||0;return b.typeIndex=d,c[b.index]=b,d||(c.first=b),c.count=d+1,"color"===b.type&&b.isBound()&&this._onColorAxisScaleSet(b),this},_getAxis:function(a,b){var c=this.axesByType[a];return c&&null!=b&&+b>=0?c[b]:void 0},_setAxesScales:function(a){this.axesList.forEach(function(b){this._axisSetScaleChartLevel[b.type]&a&&b.isBound()&&this._setAxisScale(b,a)},this)},_setAxisScale:function(a,b){this._setAxisScaleByScaleType(a,b)},_setAxisScaleByScaleType:function(b,c){switch(b.scaleType){case"discrete":this._setDiscreteAxisScale(b,c);break;case"numeric":this._setNumericAxisScale(b,c);break;case"timeSeries":this._setTimeSeriesAxisScale(b,c);break;default:throw a.error("Unknown axis scale type.")}},_describeScale:function(b,c){c.isNull&&Fa.debug>=3&&this._log(a.format("{0} scale for axis '{1}'- no data",[b.scaleType,b.id]))},_setDiscreteAxisScale:function(a){if("color"!==a.type){var c=a.domainValues(),d=new b.Scale.ordinal;c.length?d.domain(c):d.isNull=!0,this._describeScale(a,d),a.setScale(d)}else this._setDiscreteColorAxisScale(a)},_setTimeSeriesAxisScale:function(a){var c=this._getContinuousVisibleExtentConstrained(a),d=new b.Scale.linear;if(c){var e=c.min,f=c.max,g=1,h=function(){var a=f-e;a&&Math.abs(a)<g&&(f=e=new Date(Math.round((e+f)/2)),a=0),a?0>a&&(!c.maxLocked||c.minLocked?f=new Date(e.getTime()+Fa.time.intervals.h):e=new Date(f.getTime()-Fa.time.intervals.h)):(c.minLocked||(e=new Date(e.getTime()-Fa.time.intervals.h)),(!c.maxLocked||c.minLocked)&&(f=new Date(f.getTime()+Fa.time.intervals.h)))};h(),d.domain(e,f),d.minLocked=c.minLocked,d.maxLocked=c.maxLocked}else d.isNull=!0;this._describeScale(a,d),a.setScale(d)},_setNumericAxisScale:function(a){if("color"!==a.type){var c=this._getContinuousVisibleExtentConstrained(a),d=new b.Scale.linear;if(c){var e=c.min,f=c.max,g=1e-10,h=function(){var a=f-e;a&&Math.abs(a)<=g&&(e=(e+f)/2,e=f=+e.toFixed(10),a=0),a?0>a&&(!c.maxLocked||c.minLocked?f=Math.abs(e)>g?1.01*e:.1:e=Math.abs(f)>g?.99*f:-.1):(c.minLocked||(e=Math.abs(e)>g?.99*e:-.1),(!c.maxLocked||c.minLocked)&&(f=Math.abs(f)>g?1.01*f:.1))};h();var i=a.option.isDefined("OriginIsZero")&&a.option("OriginIsZero");i&&(0===e?c.minLocked=!0:0===f?c.maxLocked=!0:e*f>0&&(e>0?c.minLocked||(c.minLocked=!0,e=0):c.maxLocked||(c.maxLocked=!0,f=0),h())),d.domain(e,f),d.minLocked=c.minLocked,d.maxLocked=c.maxLocked}else d.isNull=!0;this._describeScale(a,d),a.setScale(d)}else this._setNumericColorAxisScale(a)},_warnSingleContinuousValueRole:function(b){b.grouping.isSingleDimension||this._warn("A linear scale can only be obtained for a single dimension role."),b.grouping.isDiscrete()&&this._warn(a.format("The single dimension of role '{0}' should be continuous.",[b.name]))},_getContinuousVisibleExtentConstrained:function(a,b,c){var d,e=function(){return d||(d=this.data.owner.dimensions(a.role.grouping.firstDimensionName()))},f=!1,g=!1;if(null==b&&a.option.isDefined("FixedMin")&&(b=a.option("FixedMin"),null!=b&&(b=e.call(this).read(b)),f=null!=b,f&&(b=b.value,0>b&&a.scaleUsesAbs()&&(b=-b))),null==c&&a.option.isDefined("FixedMax")&&(c=a.option("FixedMax"),null!=c&&(c=e.call(this).read(c)),g=null!=c,g&&(c=c.value,0>c&&a.scaleUsesAbs()&&(c=-c))),null==b||null==c){var h=this._getContinuousVisibleExtent(a);if(!h)return null;null==b&&(b=h.min),null==c&&(c=h.max)}return{min:b,max:c,minLocked:f,maxLocked:g}},_getContinuousVisibleExtent:function(b){var c=b.dataCells;return 1===c.length?this._getContinuousVisibleCellExtent(b,c[0]):a.query(c).select(function(a){return this._getContinuousVisibleCellExtent(b,a)},this).reduce(Fa.unionExtents,null)},_getContinuousVisibleCellExtent:function(b,c){var d=c.role;if(this._warnSingleContinuousValueRole(d),"series"===d.name)throw a.error.notImplemented();var e=b.scaleSumNormalized(),f=this.visibleData(c.dataPartValue),g=d.firstDimensionName();if(e){var h=f.dimensionsSumAbs(g);if(h)return{min:0,max:h}}else{var i=b.scaleUsesAbs(),j=f.dimensions(g).extent({abs:i});if(j){var k=j.min.value,l=j.max.value;return{min:i?Math.abs(k):k,max:i?Math.abs(l):l}}}},_setDiscreteColorAxisScale:function(a){var b=a.domainValues(),c=a.scheme()(b);this._describeScale(a,c),a.setScale(c,!0),this._onColorAxisScaleSet(a)},_setNumericColorAxisScale:function(b){if(1!==b.dataCells.length)throw a.error("Can't handle multiple continuous datacells in color axis.");this._warnSingleContinuousValueRole(b.role);var c=this.visibleData(b.dataCell.dataPartValue),d=b.option("NormByCategory"),e={type:b.option("ScaleType"),colors:b.option("Colors")().range(),colorDomain:b.option("Domain"),colorMin:b.option("Min"),colorMax:b.option("Max"),colorMissing:b.option("Missing"),data:c,colorDimension:b.role.firstDimensionName(),normPerBaseCategory:d};if(d)b.scalesByCateg=h(e);else{var f=i(e);this._describeScale(b,f),b.setScale(f)}this._onColorAxisScaleSet(b)},_onColorAxisScaleSet:function(a){switch(a.index){case 0:this.colors=a.scheme();break;case 1:this._allowV1SecondAxis&&(this.secondAxisColor=a.scheme())}},_getRoleColorScale:function(b){return a.lazy(a.lazy(this,"_rolesColorScale"),b,this._createRoleColorScale,this)},_createRoleColorScale:function(b){function c(b){var c=""+b;a.hasOwnProp.call(f,c)||(f[c]=e(b))}var d,e,f={};return this.axesByType.color.forEach(function(a){var f=a.role,g=f.name===b||f.sourceRole&&f.sourceRole.name===b;g&&a.scale&&(0===a.index||a.option.isSpecified("Colors")||a.option.isSpecified("Map"))&&(e=a.scale,d||(d=e),a.domainValues().forEach(c))},this),d?(e=function(b){var c=""+b;if(a.hasOwnProp.call(f,c))return f[c];var e=d(b);return f[c]=e,e},a.copy(e,d),e):Fa.createColorScheme()()},_onLaidOut:function(){}}),Fa.BaseChart.add({basePanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,_initChartPanels:function(a){this._initBasePanel(),this._initTitlePanel();var b=this._initLegendPanel(),c=a&&!this.parent;if(c&&this._initMultiChartPanel(),b&&this._initLegendScenes(b),!c){var d=this.options;this._createContent({margins:a?d.smallContentMargins:d.contentMargins,paddings:a?d.smallContentPaddings:d.contentPaddings,clickAction:d.clickAction,doubleClickAction:d.doubleClickAction})}},_createContent:function(){},_initBasePanel:function(){var a=this.parent;this.basePanel=new Fa.BasePanel(this,a&&a._multiChartPanel,{margins:this.margins,paddings:this.paddings,size:{width:this.width,height:this.height}})},_initTitlePanel:function(){var b=this,c=b.options,d=c.title;a.empty(d)||(!b.parent,this.titlePanel=new Fa.TitlePanel(b,b.basePanel,{title:d,font:c.titleFont,anchor:c.titlePosition,align:c.titleAlign,alignTo:c.titleAlignTo,offset:c.titleOffset,keepInBounds:c.titleKeepInBounds,margins:c.titleMargins,paddings:c.titlePaddings,titleSize:c.titleSize,titleSizeMax:c.titleSizeMax}))},_initLegendPanel:function(){var b=this.options;if(b.legend){var c=new Fa.visual.Legend(this,"legend",0);return this.legendPanel=new Fa.LegendPanel(this,this.basePanel,{anchor:c.option("Position"),align:c.option("Align"),alignTo:b.legendAlignTo,offset:b.legendOffset,keepInBounds:b.legendKeepInBounds,size:c.option("Size"),sizeMax:c.option("SizeMax"),margins:c.option("Margins"),paddings:c.option("Paddings"),font:c.option("Font"),scenes:a.getPath(b,"legend.scenes"),textMargin:b.legendTextMargin,itemPadding:b.legendItemPadding,itemSize:c.option("ItemSize"),markerSize:b.legendMarkerSize})}},_getLegendBulletRootScene:function(){return this.legendPanel&&this.legendPanel._getBulletRootScene()},_initMultiChartPanel:function(){var a=this.basePanel,b=this.options;this._multiChartPanel=new Fa.MultiChartPanel(this,a,{margins:b.contentMargins,paddings:b.contentPaddings}),this._multiChartPanel.createSmallCharts(),a._children.unshift(a._children.pop())},_coordinateSmallChartsLayout:function(){},_initLegendScenes:function(b){var c=this.axesByType.color;if(c){var d,e,f,g=0,h=this,i=function(a,b){if("togglevisible"===a.option("LegendClickMode")&&(void 0===d&&(d=h._getTrendDataPartAtom()||null,d&&(e=d.dimension.name)),d&&b.firstAtoms()[e]===d))return"none"},j=function(){return f||(rootScene=b._getBulletRootScene())};a.query(c).where(function(a){return a.option("LegendVisible")&&a.isBound()&&a.isDiscrete()}).each(function(a){for(var b=a.scale,c=-1,d=a.dataCells,e=d.length;++c<e;){var f=d[c],h=a.domainCellData(c),k=j().createGroup({source:h,colorAxis:a,clickMode:i(a,h),extensionPrefix:Fa.buildIndexedId("",g++)});f.legendGroupScene(k),a.domainCellItems(h).forEach(function(c){var d=k.createItem({source:c}),e=a.domainItemValue(c);d.color=b(e)})}})}}}),Fa.BaseChart.add({_updateSelectionSuspendCount:0,_lastSelectedDatums:null,clearSelections:function(){return this.data.owner.clearSelected()&&this.updateSelections(),this},_updatingSelections:function(a,b){this._suspendSelectionUpdate();try{a.call(b||this)}finally{this._resumeSelectionUpdate()}},_suspendSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount++:this.root._suspendSelectionUpdate()},_resumeSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount>0&&(--this._updateSelectionSuspendCount||this.updateSelections()):this.root._resumeSelectionUpdate()},updateSelections:function(b){if(this===this.root){if(this._inUpdateSelections||this._updateSelectionSuspendCount)return this;var c=this._calcSelectedChangedDatums();if(!c)return this;Fa.removeTipsyLegends(),this._inUpdateSelections=!0;try{var d=this.options.selectionChangedAction;if(d){var e=this.data.selectedDatums(),f=c.values();d.call(this.basePanel.context(),e,f)}a.get(b,"render",!0)&&this.useTextMeasureCache(function(){this.basePanel.renderInteractive()},this)}finally{this._inUpdateSelections=!1}}else this.root.updateSelections();return this},_calcSelectedChangedDatums:function(){if(this.data){var a,b=this.data.selectedDatumMap(),c=this._lastSelectedDatums;if(c){if(a=c.symmetricDifference(b),!a.count)return}else{if(!b.count)return;a=b.clone()}return this._lastSelectedDatums=b,a}},_onUserSelection:function(a){if(!a||!a.length)return a;if(this===this.root){var b=this.options.userSelectionAction;return b?b.call(this.basePanel.context(),a)||a:a}return this.root._onUserSelection(a)}}),Fa.BaseChart.add({_processExtensionPoints:function(){var b;if(this.parent)b=this.parent._components;else{var c=this.options.extensionPoints;if(b={},c)for(var d in c){var e,f,g=d.indexOf("_");if(g>0&&(e=d.substring(0,g),f=d.substr(g+1),e&&f)){var h=a.getOwn(b,e)||(b[e]=new a.OrderedMap);h.add(f,c[d])}}}this._components=b},extend:function(b,c,d){a.array.is(c)?c.forEach(function(a){this._extendCore(b,a,d)},this):this._extendCore(b,c,d)},_extendCore:function(b,c,d){if(b){var e=a.getOwn(this._components,c);if(e){b.borderPanel&&(b=b.borderPanel);var f=Fa.debug>=3?[]:null,g=a.get(d,"constOnly",!1),h=b.wrap,i={tag:Fa.extensionTag},j=b instanceof Ga,k=j&&(h||g),l=function(c,d){if(null!=c){var e=typeof c;if("object"===e){if("svg"===d||"css"===d){var f=b.propertyValue(d);f&&(c=a.copy(f,c))}else if(c instanceof Array)return c.map(function(a){return l(a,d)})}else if(k&&"function"===e){if(g)return;"add"!==d&&"call"!==d&&(c=h.call(b,c,d))}}return c},m=function(a,c){c instanceof Array?a.apply(b,c):a.call(b,c)};e.forEach(function(a,c){if(b.isLocked&&b.isLocked(c))f&&f.push(c+": locked extension point!");else if(b.isIntercepted&&b.isIntercepted(c))f&&f.push(c+":"+Fa.stringify(a)+" (controlled)");else if(f&&f.push(c+": "+Fa.stringify(a)),a=l(a,c),void 0!==a){var d=b[c];"function"==typeof d?j&&b.properties[c]?b.intercept(c,a,i):a instanceof Array?a.forEach(function(a){m(d,a)}):m(d,a):b[c]=a}}),f&&(f.length?this._log("Applying Extension Points for: '"+c+"'\n\t* "+f.join("\n\t* ")):Fa.debug>=5&&this._log("No Extension Points for: '"+c+"'"))}}else Fa.debug>=4&&this._log("Applying Extension Points for: '"+c+"' (target mark does not exist)")},_getExtension:function(b,c){var d;if(a.array.is(b)){for(var e,f=b.length-1;f>=0;)if(d=a.getOwn(this._components,b[f--]),d&&void 0!==(e=d.get(c)))return e}else if(d=a.getOwn(this._components,b))return d.get(c)},_getComponentExtensions:function(b){return a.getOwn(this._components,b)},_getConstantExtension:function(b,c){var d=this._getExtension(b,c);return a.fun.is(d)?void 0:d}}),a.type("pvc.BasePanel",Fa.Abstract).add(Fa.visual.Interactive).init(function(b,c,d){if(this.chart=b,this.base(),this.axes=Object.create(b.axes),d){d.scenes&&(this._sceneTypeExtensions=d.scenes,delete d.scenes);var e=d.axes;e&&(a.copy(this.axes,e),delete d.axes)}$.extend(this,d),this.axes.color||(this.axes.color=b.axes.color),this.position={};var f=d&&d.margins;if(c||void 0!==f||(f=3),this.margins=new Ja(f),this.paddings=new Ja(d&&d.paddings),this.size=new Ma(d&&d.size),this.sizeMax=new Ma(d&&d.sizeMax),c?(this.parent=c,this.isTopRoot=!1,this.isRoot=c.chart!==b,this.root=this.isRoot?this:c.root,this.topRoot=c.topRoot,this._ibits=c._ibits,this.isRoot&&(this.position.left=b.left,this.position.top=b.top),c._addChild(this)):(this.parent=null,this.root=this,this.topRoot=this,this.isRoot=!0,this.isTopRoot=!0,this._ibits=b._ibits),this.data=(this.isRoot?b:c).data,this.isRoot)this.anchor=null,this.align=null,this.alignTo=null,this.offset=null;else{this.align=Fa.parseAlign(this.anchor,this.align);var g=this.alignTo,h=this.anchor;null==g||""===g||"left"!==h&&"right"!==h?g=this.align:"page-middle"!==g&&(g=isNaN(+g.charAt(0))?Fa.parseAlign(h,g):Ka.parse(g)),this.alignTo=g,this.offset=new Na(this.offset)}if(null==this.borderWidth){var i,j=this._getExtensionId();if(j){var k=this._getExtension(j,"strokeStyle");null!=k&&(i=+this._getConstantExtension(j,"lineWidth"),(isNaN(i)||!isFinite(i))&&(i=null))}this.borderWidth=null==i?0:1.5}var l=Fa.visual.Interactive,m=this._ibits;m=a.bit.set(m,l.Clickable,b._ibits&l.Clickable&&!!this.clickAction),m=a.bit.set(m,l.DoubleClickable,b._ibits&l.DoubleClickable&&!!this.doubleClickAction),this._ibits=m}).add({chart:null,parent:null,_children:null,type:b.Panel,_extensionPrefix:"",_rubberSelectableMarks:null,height:null,width:null,borderWidth:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:!1,isTopRoot:!1,root:null,topRoot:null,_layoutInfo:null,_signs:null,data:null,dataPartValue:null,_animating:0,_selectingByRubberband:!1,_v1DimRoleName:{series:"series",category:"category",value:"value"},_sceneTypeExtensions:null,clickAction:null,doubleClickAction:null,compatVersion:function(a){return this.chart.compatVersion(a)},_createLogInstanceId:function(){return""+this.constructor+this.chart._createLogChildSuffix()},_getLegendBulletRootScene:function(){return this.chart._getLegendBulletRootScene()},_addChild:function(b){b.parent===this||a.assert("Child has a != parent."),(this._children||(this._children=[])).push(b)},_addSign:function(b){a.array.lazy(this,"_signs").push(b),b.selectableByRubberband()&&a.array.lazy(this,"_rubberSelectableMarks").push(b.pvMark)},visibleData:function(a){return this.chart.visibleData(this.dataPartValue,a)},partData:function(){return this.chart.partData(this.dataPartValue)},layout:function(b,c){if(!this._layoutInfo||a.get(c,"force",!1)){var d=a.get(c,"referenceSize");
!d&&b&&(d=a.copyOwn(b));var e=this.size.resolve(d),f=this.sizeMax.resolve(d);if(!b){if(null==e.width||null==e.height)throw a.error.operationInvalid("Panel layout without width or height set.");b=a.copyOwn(e)}!d&&b&&(d=a.copyOwn(b)),null!=f.width&&b.width>f.width&&(b.width=f.width),null!=f.height&&b.height>f.height&&(b.height=f.height);var g=this.borderWidth/2,h=(a.get(c,"margins")||this.margins).resolve(d),i=(a.get(c,"paddings")||this.paddings).resolve(d),j=Ja.inflate(h,g),k=Ja.inflate(i,g),l=j.width+k.width,m=j.height+k.height,n=new Ma(Math.max(b.width-l,0),Math.max(b.height-m,0)),o=a.copyOwn(e);null!=o.width&&(o.width=Math.max(o.width-l,0)),null!=o.height&&(o.height=Math.max(o.height-m,0));var p=this._layoutInfo||null,q=a.get(c,"canChange",!0),r=this._layoutInfo={canChange:q,referenceSize:d,realMargins:h,realPaddings:i,borderWidth:this.borderWidth,margins:j,paddings:k,desiredClientSize:o,clientSize:n,pageClientSize:p?p.pageClientSize:n.clone(),previous:p};p&&(delete p.previous,delete p.pageClientSize);var s,t=this._calcLayout(r);t?(r.clientSize=t,s={width:t.width+l,height:t.height+m}):(s=b,t=n),this.isVisible=t.width>0&&t.height>0,delete r.desiredClientSize,this.width=s.width,this.height=s.height,!q&&p&&delete r.previous,Fa.debug>=5&&(this._log("Size       = "+Fa.stringify(s)),this._log("Margins    = "+Fa.stringify(r.margins)),this._log("Paddings   = "+Fa.stringify(r.paddings)),this._log("ClientSize = "+Fa.stringify(r.clientSize))),this._onLaidOut()}},_onLaidOut:function(){this.isRoot&&this.chart._onLaidOut()},_calcLayout:function(b){function c(a,b,c){for(var d=0;a--;){if(b.call(c,a,d)===!1)return!0;d++}return!1}function d(b,c){m&&n._group("LayoutCycle #"+(c+1)+" (remaining: "+b+")");try{var d=b>0;k=new Ja(0),l=a.copyOwn(j);for(var f,g=0,h=t.length;h>g;){f=t[g],m&&n._group("SIDE Child #"+(g+1)+" at "+f.anchor);try{if(e.call(this,f,d))return!0}finally{m&&n._groupEnd()}g++}for(g=0,h=s.length;h>g;){f=s[g],m&&n._group("FILL Child #"+(g+1));try{if(e.call(this,f,d))return!0}finally{m&&n._groupEnd()}g++}return!1}finally{m&&n._groupEnd()}}function e(a,b){var d,e=!1;return u.canChange=b,c(3,function(c,j){m&&n._group("Attempt #"+(j+1));try{if(u.paddings=d,u.canChange=c>0,a.layout(new Ma(l),u),a.isVisible){if(e=g.call(this,a,b))return!1;var k=a._layoutInfo.requestPaddings;if(f(d,k)){if(d=k,c>0)return d=new Ja(d),m&&this._log("Child requested paddings change: "+Fa.stringify(d)),!0;Fa.debug>=2&&this._warn("Child requests paddings change but iterations limit has been reached.")}h.call(this,a),"fill"!==a.anchor&&i.call(this,a)}return!1}finally{m&&n._groupEnd()}},this),e}function f(b,c){return!!c&&a.query(Ja.names).each(function(a){var d=b&&b[a]||0,e=c&&c[a]||0;return!(Math.abs(e-d)>=.1)&&void 0})}function g(a,b){var c=!1,d=a.width-l.width;d>0&&(Fa.debug>=3&&this._log("Child added width = "+d),b?(c=!0,l.width+=d,j.width+=d):Fa.debug>=2&&this._warn("Child wanted more width, but layout iterations limit has been reached."));var e=a.height-l.height;return e>0&&(Fa.debug>=3&&this._log("Child added height ="+e),b?(c=!0,l.height+=e,j.height+=e):Fa.debug>=2&&this._warn("Child wanted more height, but layout iterations limit has been reached.")),c}function h(c){var d,e=c.anchor,f=c.align,g=c.alignTo;"fill"===e?(e="left",d=k.left+l.width/2-c.width/2,f=g="middle"):d=k[e];var h,i;switch(f){case"top":case"bottom":case"left":case"right":h=f,i=0;break;case"center":case"middle":h=q[p[e]],i=-c[o[h]]/2}var j,m;switch(g){case"top":case"bottom":case"left":case"right":m=g,j=m!==h?l[o[h]]:0;break;case"center":case"middle":m=q[p[e]],j=l[o[h]]/2;break;case"page-center":case"page-middle":m=q[p[e]];var n=o[h],s=Math.min(l[n],b.pageClientSize[n]);j=s/2}var t=k[m]+j+i,u=c.offset.resolve(l);u&&(d+=u[r[e]]||0,t+=u[r[h]]||0),c.keepInBounds&&(0>d&&(d=0),0>t&&(t=0)),c.setPosition(a.set({},e,d,h,t))}function i(a){var b=a.anchor,c=o[b],d=a[c];k[b]+=d,l[c]-=d}var j,k,l,m,n=this;if(n._children){var o=Fa.BasePanel.orthogonalLength,p=Fa.BasePanel.relativeAnchor,q=Fa.BasePanel.leftTopAnchor,r=Na.namesSidesToOffset,s=[],t=[];n._children.forEach(function(b){var c=b.anchor;c&&("fill"===c?s.push(b):(a.hasOwn(p,c)||a.fail.operationInvalid("Unknown anchor value '{0}'",[c]),t.push(b)))}),m=Fa.debug>=5,j=a.copyOwn(b.clientSize);var u={force:!0,referenceSize:j};m&&n._group("CCC DOCK LAYOUT clientSize = "+Fa.stringify(j));try{c(5,d,n)}finally{m&&n._groupEnd()}}return j},invalidateLayout:function(){this._layoutInfo=null,this._children&&this._children.forEach(function(a){a.invalidateLayout()})},_create:function(c){if(!this.pvPanel||c){var d;delete this._invalidDataError,this.pvPanel=null,this.pvRootPanel&&(this.pvRootPanel=null),delete this._signs;try{this.layout()}catch(a){if(!(a instanceof InvalidDataException))throw a;this._invalidDataError=d=a}if(this.isTopRoot&&this.chart._isMultiChartOverflowClip)return;if(!this.isVisible)return;this.isRoot&&this._creating();var e=this._layoutInfo.margins,f=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=(new b.Panel).canvas(this.chart.options.canvas);var g=new Fa.visual.Scene(null,{panel:this});this.pvRootPanel.lock("data",[g]),(e.width>0||e.height>0)&&(this.pvPanel.width(this.width).height(this.height),this.pvPanel=this.pvPanel.add(b.Panel))}else this.pvPanel=this.parent.pvPanel.add(this.type);var h=this.pvPanel,i=this.width-e.width,j=this.height-e.height;h.width(i).height(j),Fa.debug>=15&&(e.width>0||e.height>0)&&(this.isTopRoot?this.pvRootPanel:this.parent.pvPanel).add(this.type).width(this.width).height(this.height).left(null!=this.position.left?this.position.left:null).right(null!=this.position.right?this.position.right:null).top(null!=this.position.top?this.position.top:null).bottom(null!=this.position.bottom?this.position.bottom:null).strokeStyle("orange").lineWidth(1).strokeDasharray("- .");var k={};a.eachOwn(this.position,function(a,b){h[b](a+e[b]),k[this.anchorLength(b)]=!0},this),k.width||(e.left>0&&h.left(e.left),e.right>0&&h.right(e.right)),k.height||(e.top>0&&h.top(e.top),e.bottom>0&&h.bottom(e.bottom)),(f.width>0||f.height>0)&&(this.pvPanel=h.add(b.Panel).width(i-f.width).height(j-f.height).left(f.left).top(f.top)),h.borderPanel=h,h.paddingPanel=this.pvPanel,this.pvPanel.paddingPanel=this.pvPanel,this.pvPanel.borderPanel=h,Fa.debug>=15&&(this.pvPanel.strokeStyle("lightgreen").lineWidth(1).strokeDasharray("- "),this.pvPanel!==h&&h.strokeStyle("blue").lineWidth(1).strokeDasharray(". "));var l=this._getExtensionId();if(new Fa.visual.Panel(this,null,{panel:h,extensionId:l}),!d)try{this._createCore(this._layoutInfo)}catch(a){if(!(a instanceof InvalidDataException))throw a;this._invalidDataError=d=a}if(d){var m=h.anchor("center").add(b.Label).text(d.message);this.chart.extend(m,"invalidDataMessage")}if(this.isTopRoot&&(this.chart._multiChartOverflowClipped&&this._addMultichartOverflowClipMarker(),this._initSelection()),this.applyExtensions(),this.isRoot&&Fa.debug>5){var n=["SCALES SUMMARY",Fa.logSeparator];this.chart.axesList.forEach(function(a){var b=a.scale;if(b){var c=b.domain&&b.domain(),d=b.range&&b.range();n.push(a.id),n.push("    domain: "+(c?Fa.stringify(c):"?")),n.push("    range : "+(d?Fa.stringify(d):"?"))}},this),this._log(n.join("\n"))}}},_creating:function(){this._children&&this._children.forEach(function(a){a._creating()})},_createCore:function(){this._children&&this._children.forEach(function(a){a._create()})},render:function(b){if(!this.isTopRoot)return this.topRoot.render(b);if(this._create(a.get(b,"recreate",!1)),(!this.isTopRoot||!this.chart._isMultiChartOverflowClip)&&this.isVisible){var c=this.pvRootPanel;if(this._invalidDataError)c.render();else{this._onRender();var d=(this.chart.options,this._animating),e=this.chart.animatable();this._animating=e&&!a.get(b,"bypassAnimation",!1)?1:0;try{if(c.render(),this._animating){this._animating=2;var f=this;c.transition().duration(2e3).ease("cubic-in-out").start(function(){d?d=0:(f._animating=0,f._onRenderEnd(!0))})}else this._onRenderEnd(!1)}finally{this._animating=0}}}},_onRender:function(){var a=this.chart.options.renderCallback;if(a)if(this.compatVersion()<=1)a.call(this.chart);else{var b=this.context();a.call(b,b.scene)}},_onRenderEnd:function(a){this._children&&this._children.forEach(function(b){b._onRenderEnd(a)})},renderInteractive:function(){if(this.isVisible){var a=this._getSelectableMarks();if(a&&a.length)a.forEach(function(a){a.render()});else if(!this._children)return void this.pvPanel.render();this._children&&this._children.forEach(function(a){a.renderInteractive()})}},_getSelectableMarks:function(){return this._rubberSelectableMarks},animate:function(a,b){return 1===this.topRoot._animating?a:b},animatingStart:function(){return 1===this.topRoot._animating},animating:function(){return this.topRoot._animating>0},setPosition:function(b){for(var c in b)if(a.hasOwn(Ja.namesSet,c)){var d=b[c];null===d?delete this.position[c]:(d=+d,!isNaN(d)&&isFinite(d)&&(this.position[c]=d))}},createAnchoredSize:function(a,b){return this.isAnchorTopOrBottom()?new Ma(b.width,Math.min(b.height,a)):new Ma(Math.min(b.width,a),b.height)},applyExtensions:function(){this._signs&&this._signs.forEach(function(a){a.applyExtensions()})},extend:function(a,b,c){this.chart.extend(a,this._makeExtensionAbsId(b),c)},extendAbs:function(a,b,c){this.chart.extend(a,b,c)},_extendSceneType:function(b,c,d){var e=a.get(this._sceneTypeExtensions,b);e&&Fa.extendType(c,e,d)},_absBaseExtId:{abs:"base"},_absSmallBaseExtId:{abs:"smallBase"},_getExtensionId:function(){return this.isRoot?this.chart.parent?this._absSmallBaseExtId:this._absBaseExtId:void 0},_getExtensionPrefix:function(){return this._extensionPrefix},_makeExtensionAbsId:function(a){return Fa.makeExtensionAbsId(a,this._getExtensionPrefix())},_getExtension:function(a,b){return this.chart._getExtension(this._makeExtensionAbsId(a),b)},_getExtensionAbs:function(a,b){return this.chart._getExtension(a,b)},_getConstantExtension:function(a,b){return this.chart._getConstantExtension(this._makeExtensionAbsId(a),b)},getPvPanel:function(c){var d=this.pvPanel;if(!c)return d;if(!this.parent)throw a.error.operationInvalid("Layers are not possible in a root panel.");if(!d)throw a.error.operationInvalid("Cannot access layer panels without having created the main panel.");var e=null;if(this._layers?e=this._layers[c]:this._layers={},!e){var f=this.parent.pvPanel;e=f.borderPanel.add(this.type).extend(d.borderPanel);var g=e;d!==d.borderPanel&&(e=g.add(b.Panel).extend(d)),g.borderPanel=g,g.paddingPanel=e,e.paddingPanel=e,e.borderPanel=g,this.initLayerPanel(e,c),this._layers[c]=e}return e},initLayerPanel:function(){},_getV1DimName:function(a){var b=this._v1DimName||(this._v1DimNameCache={}),c=b[a];if(null==c){var d=this.chart.visualRoles[this._v1DimRoleName[a]];c=d?d.firstDimensionName():"",b[a]=c}return c},_getV1Datum:function(a){return a.datum},context:function(){var a=this._context;return!a||a.isPinned?a=this._context=new Fa.visual.Context(this):oa.call(a),a},_isTooltipEnabled:function(){return!this.selectingByRubberband()&&!this.animating()},_getTooltipFormatter:function(a){var b=this.compatVersion()<=1,c=a.format;if(!c){if(!b)return this._summaryTooltipFormatter;if(c=this.chart.options.v1StyleTooltipFormat,!c)return}return b?function(a){return c.call(a.panel,a.getV1Series(),a.getV1Category(),a.getV1Value()||"",a.getV1Datum())}:function(a){return c.call(a,a.scene)}},_summaryTooltipFormatter:function(b){function c(b,c){k.push("<b>"+b+"</b>: "+(a.html.escape(c)||" - ")+"<br/>")}function d(a,b){var c;return c=f?f.dimensions(b).valuePercent(j):i.dimensions(b).percent(a.value,j),n(c)}var e=b.scene;if(!e.datum)return"";var f=e.group,g=f&&f.count()>1,h=e.datum;if(!g&&(!h||h.isNull))return"";var i=e.data(),j={visible:!0},k=[];h.isInterpolated?k.push("<i>Interpolation</i>: "+a.html.escape(h.interpolation)+"<br/>"):h.isTrend&&k.push("<i>"+a.html.escape(h.trend.label)+"</i><br/>");var l=i.type,m=b.panel.stacked===!1?null:l.getPlayingPercentVisualRoleDimensionMap(),n=m?b.chart.options.percentValueFormat:null,o=g?f.atoms:e.datum.atoms,p=l.sortDimensionNames(a.keys(o)),q=!1;return p.forEach(function(b){var e=o[b],f=e.dimension.type;if(!(f.isHidden||g&&null==e.value)){q=!0;var h=e.label;m&&m.has(b)&&(h+=" ("+d(e,b)+")"),c(a.html.escape(e.dimension.type.label),h)}}),g&&(q&&k.push("<hr />"),k.push("<b>#</b>: "+f._datums.length+"<br/>"),l.sortDimensionNames(f.freeDimensionsNames()).forEach(function(b){var e=f.dimensions(b);if(!e.type.isHidden){var g,h=a.html.escape(e.type.label);e.type.valueType===Number?(g=e.format(e.value(j)),m&&m.has(b)&&(g+=" ("+d(null,b)+")"),h="&sum; "+h):g=e.atoms(j).map(function(a){return a.label||"- "}).join(", "),c(h,g)}})),'<div style="text-align: left;">'+k.join("\n")+"</div>"},_onClick:function(a){var b=this.clickAction;b&&(this.compatVersion()<=1?this._onV1Click(a,b):b.call(a,a.scene))},_onDoubleClick:function(a){var b=this.doubleClickAction;b&&(this.compatVersion()<=1?this._onV1DoubleClick(a,b):b.call(a,a.scene))},_onV1Click:function(a,b){b.call(a.pvMark,a.getV1Series(),a.getV1Category(),a.getV1Value(),a.event,a.getV1Datum())},_onV1DoubleClick:function(a,b){b.call(a.pvMark,a.getV1Series(),a.getV1Category(),a.getV1Value(),a.event,a.getV1Datum())},_addMultichartOverflowClipMarker:function(){function b(a){var b=a.shapeRadius();if(null==b){var c=a.shapeSize();null!=c&&(b=Math.sqrt(c))}return b||d}var c=10,d=5,e=new Fa.visual.Dot(this,this.pvPanel,{noSelect:!0,noHover:!0,noClick:!0,noDoubleClick:!0,noTooltip:!1,freePosition:!0,extensionId:"multiChartOverflowMarker"}).lock("data").pvMark.shape("triangle").shapeRadius(d).top(null).left(null).bottom(function(){return b(this)+c}).right(function(){return b(this)+c}).shapeAngle(0).lineWidth(1.5).strokeStyle("red").fillStyle("rgba(255, 0, 0, 0.2)");a.fun.is(e.tooltip)&&e.tooltip("Some charts did not fit the available space.")},selectingByRubberband:function(){return this.topRoot._selectingByRubberband},_initSelection:function(){var c=this,d=c.chart;if(c.interactive()){var e=c.unselectable(),f=c.selectableByRubberband();if(f||e){var g=c.data,h=c.pvRootPanel||c.pvPanel.paddingPanel;if(c._getExtensionAbs("base","fillStyle")||h.fillStyle(Fa.invisibleFill),h.lock("events","all"),f){var i=4;c._selectingByRubberband=!1;var j,k,l,m=this.selectBar=new Fa.visual.Bar(c,h,{extensionId:"rubberBand",normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0}).override("defaultStrokeWidth",a.fun.constant(1.5)).override("defaultColor",function(a,b){return"stroke"===b?"#86fe00":"rgba(203, 239, 163, 0.6)"}).override("interactiveColor",function(a,b){return b}).pvMark.lock("visible",function(){return!!k}).lock("left",function(){return k.x}).lock("right").lock("top",function(){return k.y}).lock("bottom").lock("width",function(){return k.dx}).lock("height",function(){return k.dy}).lock("cursor").lock("events","none");h.intercept("data",function(){var a=this.delegate();return a&&a.forEach(function(a){null==a.x&&(a.x=a.y=a.dx=a.dy=0)}),a}).event("mousedown",b.Behavior.select().autoRender(!1)).event("select",function(a){if(k)k=new b.Shape.Rect(a.x,a.y,a.dx,a.dy);else{if(c.animating())return;if(a.dx*a.dx+a.dy*a.dy<=i)return;k=new b.Shape.Rect(a.x,a.y,a.dx,a.dy),c._selectingByRubberband=!0,j||(j=h.toScreenTransform()),c.rubberBand=k.apply(j)}m.render()}).event("selectend",function(){if(k){var a=arguments[arguments.length-1];j||(j=h.toScreenTransform());var b=k.apply(j);k=null,c._selectingByRubberband=!1,m.render();try{c._processRubberBand(b,a)}finally{l=new Date}}}),e&&h.event("click",function(){if(l){var a=new Date-l;if(300>a)return void(l=null)}g.clearSelected()&&d.updateSelections()})}else e&&h.event("click",function(){g.clearSelected()&&d.updateSelections()})}}},_processRubberBand:function(a,b,c){this.rubberBand=a;try{this._onRubberBandSelectionEnd(b,c)}finally{this.rubberBand=null}},_onRubberBandSelectionEnd:function(a,b){Fa.debug>=20&&this._log("rubberBand "+Fa.stringify(this.rubberBand)),b=Object.create(b||{}),b.toggle=!1;var c=this._getDatumsOnRubberBand(a,b);if(c){var d=this.chart;d._updatingSelections(function(){var e=!a.ctrlKey&&d.options.ctrlSelectMode;e?(d.data.owner.clearSelected(),Fa.data.Data.setSelected(c,!0)):b.toggle?Fa.data.Data.toggleSelected(c):Fa.data.Data.setSelected(c,!0)})}},_getDatumsOnRubberBand:function(b,c){var d=new a.Map;this._getDatumsOnRect(d,this.rubberBand,c);var e=d.values();return e.length&&(e=this.chart._onUserSelection(e),e&&!e.length&&(e=null)),e},_getDatumsOnRect:function(a,b,c){this._getOwnDatumsOnRect(a,b,c);var d=this._children;d&&d.forEach(function(d){d._getDatumsOnRect(a,b,c)})},_getOwnDatumsOnRect:function(b,c,d){var e=this;if(!e.isVisible)return!1;var f=e._getSelectableMarks();if(!f||!f.length)return!1;var g=b.count,h=a.get(d,"markSelectionMode"),i=function(a){a.isNull||b.set(a.id,a)},j=function(a){a.selectableByRubberband()&&a.datums().each(i)},k=function(a){a.eachSceneWithDataOnRect(c,j,null,h)};return f.forEach(k),g<b.count},isAnchorTopOrBottom:function(a){return a||(a=this.anchor),"top"===a||"bottom"===a},isOrientationVertical:function(a){return this.chart.isOrientationVertical(a)},isOrientationHorizontal:function(a){return this.chart.isOrientationHorizontal(a)}}).addStatic({relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},verticalAlign2:{top:"top",bottom:"bottom",middle:"middle",right:"top",left:"bottom",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}}),a.scope(function(){var b=Fa.BasePanel,c={},d={anchorOrtho:"relativeAnchor",anchorOrthoMirror:"relativeAnchorMirror",anchorOpposite:"oppositeAnchor",anchorLength:"parallelLength",anchorOrthoLength:"orthogonalLength"};a.eachOwn(d,function(a,d){var e=b[a];c[d]=function(a){return e[a||this.anchor]}}),b.add(c)}),a.type("pvc.PlotPanel",Fa.BasePanel).init(function(a,b,c,d){this.base(a,b,d),this.plot=c,this._extensionPrefix=c.extensionPrefixes,this.dataPartValue=c.option("DataPart"),this.axes.color=a._getAxis("color",(c.option("ColorAxis")||0)-1),this.orientation=c.option("Orientation"),this.valuesVisible=c.option("ValuesVisible"),this.valuesAnchor=c.option("ValuesAnchor"),this.valuesMask=c.option("ValuesMask"),this.valuesFont=c.option("ValuesFont"),this.valuesOverflow=c.option("ValuesOverflow"),this.valuesOptimizeLegibility=c.option("ValuesOptimizeLegibility");var e=this.visualRoles=Object.create(a.visualRoles),f=c.option("ColorRole");e.color=f?a.visualRole(f):null,this.chart._addPlotPanel(this)}).add({anchor:"fill",visualRoles:null,_getExtensionId:function(){var a=["chart","plot"];return this.plotName&&a.push(this.plotName),a},defaultLegendGroupScene:function(){var b=this.axes.color;return b&&b.option("LegendVisible")&&b.isBound()?a.query(b.dataCells).where(function(a){return a.plot===this.plot},this).select(function(a){return a.legendGroupScene()}).first(a.notNully):void 0},isOrientationVertical:function(){return this.orientation===Fa.orientation.vertical},isOrientationHorizontal:function(){return this.orientation===Fa.orientation.horizontal}}),a.type("pvc.MultiChartPanel",Fa.BasePanel).add({anchor:"fill",createSmallCharts:function(){var b,c=this.chart,d=c._multiInfo;if(d&&(b=d.count)){var e,f,g,h=this._getCoordinatedRootAxesByScopeType();h&&(e={},f=function(b,c,d){var f=a.array.lazy(e,c);a.array.lazy(f,d).push(b)},g=function(a){h.row&&f(a,"row",a.smallRowIndex),h.column&&f(a,"column",a.smallColIndex),h.global&&f(a,"global",0)});for(var i=this._buildSmallChartsBaseOptions(),j=c.constructor,k=d.smallDatas,l=d.colCount,m=0;b>m;m++){var n=k[m],o=m%l,p=Math.floor(m/l),q=a.set(Object.create(i),"smallColIndex",o,"smallRowIndex",p,"title",n.absLabel,"data",n),r=new j(q);h?(r._createPhase1(),g(r)):r._create()}if(h){var s=this;a.eachOwn(h,function(a,b){a.forEach(function(a){e[b].forEach(function(b){s._coordinateScopeAxes(a.id,b)})})}),c.children.forEach(function(a){a._createPhase2()})}d.coordScopesByType=e}},_getCoordinatedRootAxesByScopeType:function(){var b=!1,c=a.query(this.chart.axesList).multipleIndex(function(a){if("discrete"!==a.scaleType&&a.option.isDefined("DomainScope")){var c=a.option("DomainScope");if("cell"!==c)return b=!0,c}});return b?c:null},_coordinateScopeAxes:function(b,c){var d=a.query(c).select(function(a){var c=a.axes[b].scale;if(!c.isNull){var d=c.domain();return{min:d[0],max:d[1]}}}).reduce(Fa.unionExtents,null);d&&c.forEach(function(a){var c=a.axes[b],e=c.scale;e.isNull||(e.domain(d.min,d.max),c.setScale(e))})},_buildSmallChartsBaseOptions:function(){var b=this.chart,c=b.options;return a.set(Object.create(c),"parent",b,"legend",!1,"titleFont",c.smallTitleFont,"titlePosition",c.smallTitlePosition,"titleAlign",c.smallTitleAlign,"titleAlignTo",c.smallTitleAlignTo,"titleOffset",c.smallTitleOffset,"titleKeepInBounds",c.smallTitleKeepInBounds,"titleMargins",c.smallTitleMargins,"titlePaddings",c.smallTitlePaddings,"titleSize",c.smallTitleSize,"titleSizeMax",c.smallTitleSizeMax)},_calcLayout:function(b){var c=this.chart,d=c._multiInfo;if(d){var e=c.multiOptions.option,f=c.smallOptions.option,g=b.clientSize,h=b.previous,i=h?h.initialClientWidth:g.width,j=h?h.initialClientHeight:g.height,k=f("Width");null!=k&&(k=Ka.resolve(k,i));var l=f("Height");null!=l&&(l=Ka.resolve(l,j));var m=f("AspectRatio"),n=d.rowCount,o=d.colCount;null==k&&(isFinite(d.colsMax)?k=g.width/o:(null==l&&(l=j),k=m*l)),null==l&&(l=1===n&&e("SingleRowFillsHeight")||1===o&&e("SingleColFillsHeight")?j:k/m);var p=k*o,q=l*n;if(!c._isMultiChartOverflowClipRetry)switch(c._isMultiChartOverflowClip=!1,e("Overflow")){case"fit":p>i&&(p=i,k=p/o),q>j&&(q=j,l=q/n);break;case"clip":var r=o,s=n,t=p>i;t&&(r=Math.floor(i/k));var u=q>j;u&&(s=Math.floor(j/l)),(u||t)&&(c._isMultiChartOverflowClip=!0,c._clippedMultiChartRowsMax=s,c._clippedMultiChartColsMax=r)}return a.set(b,"initialClientWidth",i,"initialClientHeight",j,"width",k,"height",l),{width:p,height:Math.max(g.height,q)}}},_getExtensionId:function(){return"content"},_createCore:function(b){var c=this.chart;!c._isMultiChartOverflowClip||a.assert("Overflow&clip condition should be resolved.");var d=c._multiInfo;if(d){var e=c.smallOptions.option,f=e("Margins"),g=e("Paddings");c.children.forEach(function(a){a._setSmallLayout({left:a.smallColIndex*b.width,top:a.smallRowIndex*b.height,width:b.width,height:b.height,margins:this._buildSmallMargins(a,f,d),paddings:g})},this);var h=d.coordScopesByType;h&&c._coordinateSmallChartsLayout(h),this.base(b)}},_buildSmallMargins:function(a,b,c){var d=c.colCount-1,e=c.rowCount-1,f=a.smallColIndex,g=a.smallRowIndex,h={};return f>0&&(h.left=b.left),d>f&&(h.right=b.right),g>0&&(h.top=b.top),e>g&&(h.bottom=b.bottom),h}}),a.type("pvc.TitlePanelAbstract",Fa.BasePanel).init(function(a,b,c){c||(c={});var d=c.anchor||this.anchor;if(null==c.size){var e=c.titleSize;null!=e&&(c.size=(new Ma).setSize(e,{singleProp:this.anchorOrthoLength(d)}))}if(null==c.sizeMax){var f=c.titleSizeMax;null!=f&&(c.sizeMax=(new Ma).setSize(f,{singleProp:this.anchorOrthoLength(d)}))}if(null==c.paddings&&(c.paddings=this.defaultPaddings),this.base(a,b,c),void 0===c.font){var g=this._getExtension("label","font");"string"==typeof g&&(this.font=g)}}).add({pvLabel:null,anchor:"top",title:null,titleSize:void 0,font:"12px sans-serif",defaultPaddings:2,_extensionPrefix:"title",_calcLayout:function(a){var c=new Ma,d=this.anchor,e=this.anchorLength(d),f=this.anchorOrthoLength(d),g=b.Text.measureWidth(this.title,this.font)+2,h=a.clientSize[e],i=a.desiredClientSize[e];null==i?i=g>h?h:g:i>h&&(i=h);var j;j=g>i?Fa.text.justify(this.title,i,this.font):this.title?[this.title]:[];var k=b.Text.fontHeight(this.font),l=j.length*k,m=a.clientSize[f],n=a.desiredClientSize[f];if(null==n?n=l:n>m&&(n=m),l>n){var o=Math.max(1,Math.floor(n/k));if(j.length>o){var p=j[o];j.length=o,l=n=o*k;var q=j[o-1]+" "+p;j[o-1]=Fa.text.trimToWidthB(i,q,this.font,"..")}}return a.lines=j,a.topOffset=(n-l)/2,a.lineSize={width:i,height:k},a.a_width=e,a.a_height=f,c[e]=i,c[f]=n,c},_createCore:function(a){var b,c=this._buildScene(a),d={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2},e=Fa.BasePanel.horizontalAlign[this.align],f=Fa.BasePanel.leftTopAnchor[this.anchor];this.compatVersion()<=1&&(b=function(a){return function(){return a.call(this)}}),this.pvLabel=new Fa.visual.Label(this,this.pvPanel,{extensionId:"label",wrapper:b}).lock("data",c.lineScenes).pvMark[f](function(b){return a.topOffset+b.vars.size.height/2+this.index*b.vars.size.height}).textAlign(e)[this.anchorOrtho(f)](function(a){switch(this.textAlign()){case"center":return a.vars.size.width/2;case"left":return 0;case"right":return a.vars.size.width}}).text(function(a){return a.vars.textLines[this.index]}).font(this.font).textBaseline("middle").textAngle(d[this.anchor])},_buildScene:function(b){var c=new Fa.visual.Scene(null,{panel:this,source:this.chart.data}),d=b.lines;return c.vars.size=b.lineSize,c.vars.textLines=d,c.lineScenes=a.array.create(d.length,c),c},_getExtensionId:a.fun.constant("")}),a.type("pvc.TitlePanel",Fa.TitlePanelAbstract).init(function(a,b,c){c||(c={});var d=a.compatVersion()<=1;if(d){var e=c.titleSize;null==e&&(c.titleSize=25)}this._extensionPrefix=a.parent?"smallTitle":"title",this.base(a,b,c)}).add({font:"14px sans-serif",defaultPaddings:4}),a.type("pvc.LegendPanel",Fa.BasePanel).init(function(a,b,c){if(this.base(a,b,c),void 0===c.font){var d=this._getConstantExtension("label","font");d&&(this.font=d)}var e=Fa.visual.Interactive;this._ibits&e.Interactive&&(this._ibits|=e.Clickable)}).add({pvRule:null,pvDot:null,pvLabel:null,anchor:"bottom",pvLegendPanel:null,textMargin:6,itemPadding:2.5,itemSize:null,markerSize:15,font:"10px sans-serif",_calcLayout:function(a){return this._getBulletRootScene().layout(a)},_createCore:function(a){var c=a.clientSize,d=this._getBulletRootScene(),e=d.vars.itemPadding,f=d.vars.contentSize,g=this.isAnchorTopOrBottom(),h=g?"top":"left",i=this.anchorOpposite(h),j=this.anchorLength(h),k=this.anchorOrthoLength(h),l=g?"center":"middle",m=g?"left":"top",n=this.anchorOpposite(m),o=0;switch(this.align){case n:o=c[j]-f[j];break;case l:o=(c[j]-f[j])/2}this.pvPanel.borderPanel.overflow("hidden");var p,q=this.pvPanel.add(b.Panel).data(d.vars.sections)[m](o)[h](function(){var a=this.sibling();return a?a[h]+a[k]+e[k]:0})[j](function(a){return a.size[j]})[k](function(a){return a.size[k]});this.compatVersion()<=1&&(p=function(a){return function(b){return a.call(this,b.vars.value.rawValue)}});var r=this.pvLegendPanel=new Fa.visual.Panel(this,q,{extensionId:"panel",wrapper:p,noSelect:!1,noHover:!0,noClick:!1,noClickSelect:!0}).pvMark.lock("data",function(a){return a.items})[n](null)[i](null)[m](function(a){var b=a.vars.itemPadding,c=this.sibling();return c?c[m]+c[j]+b[j]:0})[h](g?function(a){var b=a.vars;return b.section.size.height/2-b.itemClientSize.height/2}:0).height(function(a){return a.vars.itemClientSize.height}).width(g?function(a){return a.vars.itemClientSize.width}:function(){return this.parent.width()}).def("hidden","false").fillStyle(function(){return"true"==this.hidden()?"rgba(200,200,200,1)":"rgba(200,200,200,0.0001)"}),s=new Fa.visual.Panel(this,r,{extensionId:"markerPanel"}).pvMark.left(0).top(0).right(null).bottom(null).width(function(a){return a.vars.markerSize}).height(function(a){return a.vars.itemClientSize.height});Fa.debug>=20&&(q.strokeStyle("red").lineWidth(.5).strokeDasharray("."),r.strokeStyle("green").lineWidth(.5).strokeDasharray("."),s.strokeStyle("blue").lineWidth(.5).strokeDasharray(".")),d.childNodes.forEach(function(a){var b=new Fa.visual.Panel(this,s).pvMark.visible(function(b){return b.parent===a});a.renderer().create(this,b,a.extensionPrefix,p)},this),this.pvLabel=new Fa.visual.Label(this,s.anchor("right"),{extensionId:"label",noTooltip:!1,noClick:!1,wrapper:p}).intercept("textStyle",function(a){var b=this.delegateExtension()||"black";return a.isOn()?b:Fa.toGrayScale(b,null,void 0,150)}).pvMark.textAlign("left").text(function(a){var b=a.labelText(),c=a.vars;return c.textSize.width>c.labelWidthMax&&(b=Fa.text.trimToWidthB(c.labelWidthMax,b,c.font,"..",!1)),b}).textMargin(function(a){return a.vars.textMargin}).font(function(a){return a.vars.font}).textDecoration(function(a){return a.isOn()?"":"line-through"}),Fa.debug>=16&&s.anchor("right").add(b.Panel)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).add(b.Line).data(function(a){var b=a.vars,c=Fa.text.getLabelBBox(Math.min(b.labelWidthMax,b.textSize.width),2*b.textSize.height/3,"left","middle",0,b.textMargin),d=c.source.points();return d.length>1&&(d=d.concat(d[0])),d}).left(function(a){return a.x}).top(function(a){return a.y}).strokeStyle("red").lineWidth(.5).strokeDasharray("-")},_onClick:function(b){var c=b.scene;a.fun.is(c.execute)&&c.executable()&&c.execute()},_getExtensionPrefix:function(){return"legend"},_getExtensionId:function(){return"area"},_getSelectableMarks:function(){return[this.pvLegendPanel]},_getBulletRootScene:function(){var a=this._rootScene;return a||(a=new Fa.visual.legend.BulletRootScene(null,{panel:this,source:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,textMargin:this.textMargin,itemPadding:this.itemPadding,itemSize:this.itemSize}),this._rootScene=a),a},_getTooltipFormatter:function(a){return a.isLazy=!1,function(a){var b=a.scene.vars.value,c=b.absLabel||b.label,d=a.pvMark.text();return c!==d?c:""}}}),a.type("pvc.CartesianAbstract",Fa.BaseChart).init(function(a){this.axesPanels={},this.base(a)}).add({_gridDockPanel:null,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,yScale:null,xScale:null,_getSeriesRoleSpec:function(){return{isRequired:!0,defaultDimension:"series*",autoCreateDimension:!0,requireIsDiscrete:!0}},_getColorRoleSpec:function(){return{isRequired:!0,defaultDimension:"color*",defaultSourceRole:"series",requireIsDiscrete:!0}},_addAxis:function(a){switch(this.base(a),a.type){case"base":case"ortho":this.axes[a.orientedId]=a,a.v1SecondOrientedId&&(this.axes[a.v1SecondOrientedId]=a)}return this},_setAxisScale:function(a,b){this.base(a,b);var c="ortho"===a.type,d=c||"base"===a.type;d&&(c&&1===a.index?this.secondScale=a.scale:a.index||(this[a.orientation+"Scale"]=a.scale))},_createContent:function(b){this._createFocusWindow(),this._gridDockPanel=new Fa.CartesianGridDockingPanel(this,this.basePanel,{margins:b.margins,paddings:b.paddings}),["base","ortho"].forEach(function(b){var c=this.axesByType[b];c&&a.query(c).reverse().each(function(a){this._createAxisPanel(a)},this)},this),this._createPlotPanels(this._gridDockPanel,{clickAction:b.clickAction,doubleClickAction:b.doubleClickAction})},_createFocusWindow:function(){if(this.selectableByFocusWindow()){var a,b=this.focusWindow;b&&(a=b._exportData()),b=this.focusWindow=new Fa.visual.CartesianFocusWindow(this),a&&b._importData(a),b._initFromOptions()}else this.focusWindow&&delete this.focusWindow},_createAxisPanel:function(b){if(b.option("Visible")){var c,d=b.option("Title");a.empty(d)||(c=new Fa.AxisTitlePanel(this,this._gridDockPanel,b,{title:d,font:b.option("TitleFont")||b.option("Font"),anchor:b.option("Position"),align:b.option("TitleAlign"),margins:b.option("TitleMargins"),paddings:b.option("TitlePaddings"),titleSize:b.option("TitleSize"),titleSizeMax:b.option("TitleSizeMax")}));var e=new Fa.AxisPanel(this,this._gridDockPanel,b,{anchor:b.option("Position"),size:b.option("Size"),sizeMax:b.option("SizeMax"),clickAction:b.option("ClickAction"),doubleClickAction:b.option("DoubleClickAction"),
useCompositeAxis:b.option("Composite"),font:b.option("Font"),labelSpacingMin:b.option("LabelSpacingMin"),grid:b.option("Grid"),gridCrossesMargin:b.option("GridCrossesMargin"),ruleCrossesMargin:b.option("RuleCrossesMargin"),zeroLine:b.option("ZeroLine"),desiredTickCount:b.option("DesiredTickCount"),showTicks:b.option("Ticks"),showMinorTicks:b.option("MinorTicks")});return c&&(e.titlePanel=c),this.axesPanels[b.id]=e,this.axesPanels[b.orientedId]=e,b.index<=1&&b.v1SecondOrientedId&&(this[b.v1SecondOrientedId+"AxisPanel"]=e),e}},_onLaidOut:function(){this.plotPanelList&&this.plotPanelList[0]&&["base","ortho"].forEach(function(a){var b=this.axesByType[a];b&&b.forEach(this._setCartAxisScaleRange,this)},this)},_setCartAxisScaleRange:function(a){var b=this.plotPanelList[0]._layoutInfo,c=b.clientSize,d="x"===a.orientation?c.width:c.height;return a.setScaleRange(d),a.scale},_getAxesRoundingPaddings:function(){function a(a,b,d){var e=c[a];null==e||b>e?(c[a]=b,c[a+"Locked"]=d):d&&(c[a+"Locked"]=d)}function b(b){if(b){var c=b.getScaleRoundingPaddings();if(c){var d="x"===b.orientation;a(d?"left":"bottom",c.begin,c.beginLocked),a(d?"right":"top",c.end,c.endLocked)}}}var c={},d=this.axesByType;return["base","ortho"].forEach(function(a){var c=d[a];c&&c.forEach(b)}),c},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:!1,horizontalAnchorSwapLimit:80,font:"10px sans-serif"},markEvent:function(c,d,e){var f=this,g=f.axes.base,h=f.axes.ortho,i=g.role,j=g.scale,k=f.data.owner.dimensions(i.grouping.firstDimensionName());if(k.type,g.isDiscrete())return f._warn("Can only mark events in charts with a continuous base scale."),f;var l=$.extend({},f.markEventDefaults,e),m=k.read(c,d),n=j(m.value),o=j.range(),p=o[1];if(n<o[0]||n>p)return this._warn("Cannot mark event because it is outside the base scale's domain."),this;var q=this.plotPanelList[0].pvPanel,r=h.scale.range()[1],s=l.horizontalAnchor;if(!l.forceHorizontalAnchor){var t="right"===s,u=t?p-n:n,v=b.Text.measureWidth(m.label,l.font);v>u&&(s=t?"left":"right")}var w="top"===l.verticalAnchor?l.verticalOffset:r-l.verticalOffset,x=q.add(b.Line).data([0,r]).bottom(a.identity).left(n).lineWidth(l.lineWidth).strokeStyle(l.strokeStyle);return x.anchor(s).visible(function(){return!this.index}).top(w).add(b.Label).font(l.font).text(m.label).textStyle(l.textStyle),f},defaults:{panelSizeRatio:.9,timeSeries:!1,timeSeriesFormat:"%Y-%m-%d"}}),a.type("pvc.GridDockingPanel",Fa.BasePanel).add({anchor:"fill",_calcLayout:function(b){function c(a,d){q&&p._group("LayoutCycle "+(F?"- Disaster MODE":"#"+(d+1)));try{var e,f,i,j,k=b.canChange!==!1&&!F&&a>0,l=!1;for(e=0,f=z.length;f>e;){q&&p._group("SIDE Child #"+(e+1));try{if(i=h(z[e],k),!F&&i){if(j=!1,0!==(i&D)&&(q&&p._log("SIDE Child #"+(e+1)+" changed overflow paddings"),l||(l=!0,b.requestPaddings=b.paddings)),0!==(i&C)&&(a>0?(q&&p._log("SIDE Child #"+(e+1)+" changed normal paddings"),j=!0):Fa.debug>=2&&p._warn("SIDE Child #"+(e+1)+" changed paddings but no more iterations possible.")),0!==(i&B))return F=!0,c(0),!1;if(j)return!0}}finally{q&&p._groupEnd()}e++}if(l)return q&&p._log("Restarting due to overflowPaddings change"),!1;for(e=0,f=y.length;f>e;){q&&p._group("FILL Child #"+(e+1));try{if(i=g(y[e],k),!F&&i){if(j=!1,0!==(i&C)&&(a>0?(Fa.debug>=5&&p._log("FILL Child #"+(e+1)+" increased paddings"),j=!0):Fa.debug>=2&&p._warn("FILL Child #"+(e+1)+" increased paddings but no more iterations possible.")),0!==(i&B))return F=!0,c(0),!1;if(j)return!0}}finally{q&&p._groupEnd()}e++}return!1}finally{q&&p._groupEnd()}}function d(a,b){for(var c=0;a--;){if(b(a,c)===!1)return!0;c++}return!1}function e(b){var c=b.anchor;if(c)if("fill"===c){y.push(b);var d=b.paddings.resolve(x.referenceSize);s=Ja.resolvedMax(s,d)}else a.hasOwn(v,c)||a.fail.operationInvalid("Unknown anchor value '{0}'",[c]),z.push(b)}function f(a,b){q&&p._group("SIDE Child #"+(b+1));try{var c=0,d=a.anchor;return x.paddings=l(d,s),a.layout(new Ma(t),x),a.isVisible&&(c|=m(d,s,a),i(d,a),j(d,a)),c}finally{q&&p._groupEnd()}}function g(a,b){var c=0,d=a.anchor;return x.paddings=l(d,s),x.canChange=b,a.layout(new Ma(t),x),a.isVisible&&(c|=m(d,s,a,b),i(d,a),k(a,d)),c}function h(c,d){var e=0;if(c.isVisible){var f=c.anchor,g=w[f],h=u[f],i=t[g],j=c[h],o=new Ma(a.set({},g,i,h,j));x.paddings=l(f,s),x.canChange=d,c.layout(o,x),c.isVisible&&(e=m(f,s,c,d)|n(f,b.paddings,c,d),e||k(c,c.align))}return e}function i(b,c){var d;"fill"===b?(b="left",d=r.left+t.width/2-c.width/2):d=r[b],c.setPosition(a.set({},b,d))}function j(a,b){var c=u[a],d=b[c];r[a]+=d,t[c]-=d}function k(b,c){var d;"fill"===c&&(c="middle");var e;switch(c){case"top":case"bottom":case"left":case"right":d=c,e=r[d];break;case"middle":d="bottom",e=r.bottom+t.height/2-b.height/2;break;case"center":d="left",e=r.left+t.width/2-b.width/2}b.setPosition(a.set({},d,e))}function l(a,b){var c=new Ja;return o(a).forEach(function(a){c.set(a,b[a])}),c}function m(b,c,d,e){var f=d._layoutInfo.requestPaddings,g=0;if(f&&(q&&Fa.debug>=10&&(p._log("=> clientSize="+Fa.stringify(d._layoutInfo.clientSize)),p._log("<= requestPaddings="+Fa.stringify(f))),o(b).forEach(function(a){var b=c[a]||0,d=Math.floor(1e4*(f[a]||0))/1e4,h=d-b,i=Math.max(1,Math.abs(.01*b));0!==h&&Math.abs(h)>=i&&(e?(g|=C,c[a]=d,q&&p._log("Changed padding "+a+" <- "+d)):Fa.debug>=2&&p._warn("CANNOT change but child wanted to: "+a+"="+d))}),g)){var h=Ja.names.map(function(a){return(c[a]||0).toFixed(0)}).join("|");a.hasOwn(A,h)?(Fa.debug>=2&&p._warn("LOOP detected!!!!"),g|=B):A[h]=!0,c.width=c.left+c.right,c.height=c.top+c.bottom}return g}function n(a,b,c,d){var e=c._layoutInfo.overflowPaddings||E,f=0;return q&&Fa.debug>=10&&p._log("<= overflowPaddings="+Fa.stringify(e)),o(a).forEach(function(a){if(e.hasOwnProperty(a)){var c=b[a]||0,g=Math.floor(1e4*(e[a]||0))/1e4;g-=r[a];var h=g-c,i=Math.max(1,Math.abs(.05*c));h>=i&&(d?(f|=D,b[a]=g,q&&p._log("changed overflow padding "+a+" <- "+g)):Fa.debug>=2&&p._warn("CANNOT change overflow padding but child wanted to: "+a+"="+g))}}),f&&(b.width=b.left+b.right,b.height=b.top+b.bottom),f}function o(a){switch(a){case"left":case"right":return Ja.vnames;case"top":case"bottom":return Ja.hnames;case"fill":return Ja.names}}var p=this;if(p._children){var q=Fa.debug>=5,r=new Ja(0),s=new Ja(0),t=a.copyOwn(b.clientSize),u=Fa.BasePanel.orthogonalLength,v=Fa.BasePanel.relativeAnchor,w=Fa.BasePanel.parallelLength,x={force:!0,referenceSize:b.clientSize},y=[],z=[],A={},B=1,C=2,D=4,E=new Ja,F=!1;q&&p._group("CCC GRID LAYOUT clientSize = "+Fa.stringify(t));try{this._children.forEach(e),q&&p._group("Phase 1 - Determine MARGINS and FILL SIZE from SIDE panels");try{z.forEach(f)}finally{q&&(p._groupEnd(),p._log("Final FILL margins = "+Fa.stringify(r)),p._log("Final FILL border size = "+Fa.stringify(t)))}q&&p._group("Phase 2 - Determine COMMON PADDINGS");try{d(9,c)}finally{q&&(p._groupEnd(),p._log("Final FILL clientSize = "+Fa.stringify({width:t.width-s.width,height:t.height-s.height})),p._log("Final COMMON paddings = "+Fa.stringify(s)))}b.gridMargins=new Ja(r),b.gridPaddings=new Ja(s),b.gridSize=new Ma(t)}finally{q&&p._groupEnd()}}}}),a.type("pvc.CartesianGridDockingPanel",Fa.GridDockingPanel).init(function(a,b,c){this.base(a,b,c),this._plotBgPanel=new Fa.PlotBgPanel(a,this)}).add({_getExtensionId:function(){return this.chart.parent?"smallContent":"content"},_createCore:function(b){var c=this.chart,d=c.axes,e=d.x,f=d.y;e.isBound()||(e=null),f.isBound()||(f=null),e&&e.option("Grid")&&(this.xGridRule=this._createGridRule(e)),f&&f.option("Grid")&&(this.yGridRule=this._createGridRule(f)),this.base(b),c.focusWindow&&this._createFocusWindow(b);var g;g=c.compatVersion()<=1?!(!e.option("EndLine")&&!f.option("EndLine")):a.get(c.options,"plotFrameVisible",!0),g&&(this.pvFrameBar=this._createFrame(b,d)),e&&"discrete"!==e.scaleType&&e.option("ZeroLine")&&(this.xZeroLine=this._createZeroLine(e,b)),f&&"discrete"!==f.scaleType&&f.option("ZeroLine")&&(this.yZeroLine=this._createZeroLine(f,b))},_createGridRule:function(c){var d=c.scale;if(!d.isNull){var e=c.role.grouping.isDiscrete(),f=this._getAxisGridRootScene(c);if(f){var g=this._layoutInfo.gridMargins,h=this._layoutInfo.gridPaddings,i="x"===c.orientation?"left":"bottom",j=this.anchorLength(i),k=this.anchorOrtho(i),l=this.anchorOpposite(k),m=g[i]+h[i],n=g[k],o=g[l],p=f.leafs().array(),q=p.length;e&&q&&p.push(p[q-1]);var r;this.compatVersion()<=1&&(r=function(a){return function(b){return a.call(this,b.vars.tick.rawValue)}});var s=new Fa.visual.Rule(this,this.pvPanel,{extensionId:c.extensionPrefixes.map(function(a){return a+"Grid"}),wrapper:r}).lock("data",p).lock(j,null).override("defaultColor",a.fun.constant(b.color("#f0f0f0"))).pvMark.antialias(!0)[k](n)[l](o).zOrder(-12).events("none");if(e){var t=d.range().step/2;s[i](function(a){var b=m+d(a.vars.tick.value),c=this.index===q;return b+(c?t:-t)})}else s[i](function(a){return m+d(a.vars.tick.value)});return s}}},_getAxisGridRootScene:function(a){var b=a.isDiscrete(),c=b?a.domainData():this.data,d=new Fa.visual.CartesianAxisRootScene(null,{panel:this,source:c});if(b)c.childNodes.forEach(function(a){new Fa.visual.CartesianAxisTickScene(d,{source:a,tick:a.value,tickRaw:a.rawValue,tickLabel:a.label})});else{var e=a.ticks||a.calcContinuousTicks();e.forEach(function(b){new Fa.visual.CartesianAxisTickScene(d,{tick:b,tickRaw:b,tickLabel:a.scale.tickFormat(b)})},this)}return d},_createFrame:function(a,b){if(!b.base.scale.isNull&&(!b.ortho.scale.isNull||b.ortho2&&!b.ortho2.scale.isNull)){var c=a.gridMargins,d=c.left,e=c.right,f=c.top,g=c.bottom,h=[];return this.compatVersion()<=1&&(h.push("xAxisEndLine"),h.push("yAxisEndLine")),h.push("plotFrame"),new Fa.visual.Panel(this,this.pvPanel,{extensionId:h}).pvMark.lock("left",d).lock("right",e).lock("top",f).lock("bottom",g).lock("fillStyle",null).events("none").strokeStyle("#666666").lineWidth(1).antialias(!1).zOrder(-8)}},_createZeroLine:function(c,d){var e=c.scale;if(!e.isNull){var f=e.domain();if(f[0]*f[1]<-1e-12){var g="x"===c.orientation?"left":"bottom",h=this.anchorLength(g),i=this.anchorOrtho(g),j=this.anchorOpposite(i),k=d.gridMargins,l=d.gridPaddings,m=k[g]+l[g]+e(0),n=k[i],o=k[j],p=new Fa.visual.Scene(null,{panel:this});return new Fa.visual.Rule(this,this.pvPanel,{extensionId:c.extensionPrefixes.map(function(a){return a+"ZeroLine"})}).lock("data",[p]).lock(h,null).lock(i,n).lock(j,o).lock(g,m).override("defaultColor",a.fun.constant(b.color("#666666"))).pvMark.events("none").lineWidth(1).antialias(!0).zOrder(-9)}}},_createFocusWindow:function(c){function d(){K[y]=0-B[r],K[z]=H+B[r]+B[v]}function e(){var a=arguments[arguments.length-1],b="end"===a.drag.phase;h._selectingByRubberband=!b,R.render(),T.render();var c=K[w],d=K[w]+K[x];if(!p){var e=G-c;c=G-d,d=e}j._updatePosition(c,d,b,!0)}function f(a,b){var c,d,e=a.m,f=e[X],g=K[Y];switch(b){case"new":c=0,d="begin";break;case"resize-begin":c=g,d="begin";break;case"move":c=g,d="begin";break;case"resize-end":c=f-K[X],d="end"}var h=a.min[X],i=a.max[X],k={type:b,target:d,point:f,length:c,length0:g,min:h,max:i,minView:0,maxView:G};switch(j._constraintPosition(k),e[X]=k.point,b){case"resize-begin":k.max=Math.min(k.max,K[X]+K[Y]);break;case"resize-end":k.min=Math.max(k.min,K[X])}a.min[X]=k.min,a.max[X]=k.max}var g=this,h=g.topRoot,i=g.chart,j=i.focusWindow.base,k=j.axis,l=k.scale;if(!l.isNull){var m=j.option("Resizable"),n=j.option("Movable"),o=k.isDiscrete(),p=i.isOrientationVertical(),q=p?"left":"top",r=p?"top":"left",s=g.anchorOrthoLength(q),t=g.anchorOpposite(q),u=g.anchorOrthoLength(r),v=g.anchorOpposite(r),w=p?"x":"y",x="d"+w,y=p?"y":"x",z="d"+y,A=c.gridMargins,B=c.gridPaddings,C={left:A.left+B.left,right:A.right+B.right,top:A.top+B.top,bottom:A.bottom+B.bottom};C.width=C.left+C.right,C.height=C.top+C.bottom;var D=c.clientSize,E=D[s],F=D[u],G=E-C[s],H=F-C[u],I=B[q],J=B[t],K=new Fa.visual.Scene(null,{panel:this}),L=o?l.range().step:0,M=L/2;K[w]=l(j.begin)-M,K[x]=L+(l(j.end)-M)-K[w],d();var N=function(a){return function(){return K[a]}},O=function(){var a=K[w];return Math.max(0,Math.min(G,a))},P=function(){var a=O(),b=K[w]+K[x];return b=Math.max(0,Math.min(G,b)),b-a},Q=function(a,b){return new Fa.visual.Bar(g,a,{extensionId:b,normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).pvMark.lock("data").lock("visible").lock(q,O).lock(s,P).lock(r,N(y)).lock(u,N(z)).lock(v).lock(t).sign},R=this._plotBgPanel.pvPanel.borderPanel;R.lock("data",[K]),n&&m?R.paddingPanel.lock("events","all").lock("cursor","crosshair").event("mousedown",b.Behavior.select().autoRender(!1).collapse(p?"y":"x").positionConstraint(function(a){var b="start"===a.phase?"new":"resize-end";return f(a,b)})).event("selectstart",function(a){d(),e(a)}).event("select",e).event("selectend",e):R.paddingPanel.events("all");var S=Q(R.paddingPanel,"focusWindowBg").override("defaultColor",a.fun.constant(Fa.invisibleFill)).pvMark;n?S.lock("events","all").lock("cursor","move").event("mousedown",b.Behavior.drag().autoRender(!1).collapse(p?"y":"x").positionConstraint(function(a){f(a,"move")})).event("drag",e).event("dragend",e):S.events("none");var T=new Fa.visual.Panel(g,g.pvPanel).pvMark.lock("data",[K]).lock("visible").lock("fillStyle",Fa.invisibleFill).lock("left",C.left).lock("right",C.right).lock("top",C.top).lock("bottom",C.bottom).lock("zOrder",10).lock("events",function(){var a=K.drag;return a&&"end"!==a.phase?"all":"none"}).lock("cursor",function(){var a=K.drag;return a&&"end"!==a.phase?"drag"===a.type||"select"===a.type&&!m?"move":p?"ew-resize":"ns-resize":null}).antialias(!1),U="rgba(20, 20, 20, 0.1)";new Fa.visual.Bar(g,T,{extensionId:"focusWindowBaseCurtain",normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).override("defaultColor",function(a,b){return"stroke"===b?null:U}).pvMark.lock("data",[K,K]).lock("visible").lock("events","none").lock(q,function(){return this.index?O()+P():-I}).lock(t,function(){return this.index?-J:null}).lock(s,function(){return this.index?null:I+O()}).lock(r,N(y)).lock(u,N(z)).lock(v);var V=Q(T,"focusWindow").override("defaultColor",a.fun.constant(null)).pvMark.lock("events","none"),W=function(c){var d="left"===c||"top"===c?"begin":"end",h=g.anchorOpposite(c),i="linear-gradient(to "+h+", "+U+", #444 90%)",k=new Fa.visual.Bar(g,V.anchor(c),{extensionId:j.id+"Grip"+a.firstUpperCase(d),normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).override("defaultColor",function(a,b){return"stroke"===b?null:i}).pvMark.lock("data").lock("visible")[r](K[y])[u](K[z]);if(m){var l="resize-"+d;k.lock("events","all")[s](5).cursor(p?"ew-resize":"ns-resize").event("mousedown",b.Behavior.resize(c).autoRender(!1).positionConstraint(function(a){f(a,l)}).preserveOrtho(!0)).event("resize",e).event("resizeend",e)}else k.events("none")[s](1);return k};W(q),W(t);var X=w,Y=x}},_getDatumsOnRect:function(b,c,d){var e,f,g=this.chart,h=g.axesPanels.x,i=g.axesPanels.y;h&&(e=new a.Map,h._getDatumsOnRect(e,c,d),e.count||(e=null)),i&&(f=new a.Map,i._getOwnDatumsOnRect(f,c,d),f.count||(f=null)),e&&f?(e.intersect(f,b),d.toggle=!0):e?b.copy(e):f?b.copy(f):g.plotPanelList.forEach(function(a){a._getDatumsOnRect(b,c,d)},this)}}),a.type("pvc.CartesianAbstractPanel",Fa.PlotPanel).init(function(a,b,c,d){function e(a){h[a.type]=a,h[a.orientedId]=a,a.v1SecondOrientedId&&(h[a.v1SecondOrientedId]=a)}function f(a,b){var c=i[a];(null==c||b>c)&&(j=!0,i[a]=b)}function g(a){var b=a&&a.option("Offset");null!=b&&b>0&&1>b&&("x"===a.orientation?(f("left",b),f("right",b)):(f("top",b),f("bottom",b)))}this.base(a,b,c,d);var h=this.axes;e(a._getAxis("base",c.option("BaseAxis")-1)),e(a._getAxis("ortho",c.option("OrthoAxis")-1));var i={},j=!1,k=a.axesByType;["base","ortho"].forEach(function(a){var b=k[a];b&&b.forEach(g)}),j&&(this.offsetPaddings=i)}).add({offsetPaddings:null,_calcLayout:function(a){a.requestPaddings=this._calcRequestPaddings(a)},_calcRequestPaddings:function(a){var b,c=this.offsetPaddings;if(c){var d=this.chart._getAxesRoundingPaddings(),e=a.clientSize,f=a.paddings;Ja.names.forEach(function(a){var g=Fa.BasePanel.orthogonalLength[a],h=e[g],i=f[g],j=h+i;if(!d[a+"Locked"]){var k=j*(c[a]||0),l=h*(d[a]||0);(b||(b={}))[a]=Math.max(k-l,0)}},this)}return b},_createCore:function(){this.pvPanel.zOrder(-10);var b,c=this.chart.options.leafContentOverflow||"auto";b="auto"===c?a.query(["ortho","base"]).select(function(a){return this.axes[a]},this).any(function(a){return null!=a.option("FixedMin")||null!=a.option("FixedMax")}):"hidden"===c,b&&this.pvPanel.borderPanel.overflow("hidden")}}),a.type("pvc.PlotBgPanel",Fa.BasePanel).init(function(a,b,c){this.base(a,b,c)}).add({anchor:"fill",_getExtensionId:function(){return"plotBg"},_createCore:function(a){this.pvPanel.borderPanel.lock("zOrder",-13).antialias(!1),this.base(a)}}),a.type("pvc.CategoricalAbstract",Fa.CartesianAbstract).init(function(a){this.base(a);var b=this.parent;b&&(this._catRole=b._catRole)}).add({_interpolatable:!0,_initVisualRoles:function(){this.base(),this._catRole=this._addVisualRole("category",this._getCategoryRoleSpec())},_getCategoryRoleSpec:function(){return{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0}},_createVisibleData:function(b,c){var d=this._serRole&&this._serRole.flattenedGrouping(),e=this._catRole.flattenedGrouping();return d?b.groupBy(a.get(c,"inverted",!1)?[d,e]:[e,d],c):b.groupBy(e,c)},_interpolateDataCell:function(a,b){var c=this._getNullInterpolationOperType(a.nullInterpolationMode);if(c){this._warnSingleContinuousValueRole(a.role);var d=a.dataPartValue,e=this.partData(d,b),f=this.visibleData(d,{baseData:b});f.childCount()>0&&new c(b,e,f,this._catRole,this._serRole,a.role,!0).interpolate()}},_getNullInterpolationOperType:function(b){switch(b){case"linear":return Fa.data.LinearInterpolationOper;case"zero":return Fa.data.ZeroInterpolationOper;case"none":break;default:throw a.error.argumentInvalid("nullInterpolationMode",""+b)}},_generateTrendsDataCell:function(b,c,d){function e(c){var d=m?null:function(a){return a.atoms[k].value},e=function(a){var b=p.child(a.key);return b&&c&&(b=b.child(c.key)),b?b.dimensions(l).value(n):null},f=a.create(i,{rows:a.query(s),x:d,y:e}),g=j.model(f);g&&s.forEach(function(d,f){var h=m?f:d.atoms[k].value,j=g.sample(h,e(d),f);if(null!=j){var n,o=p.child(d.key),s=o||d;if(c){var t=o&&o.child(c.key);t?n=Object.create(t._datums[0].atoms):(n=Object.create(s._datums[0].atoms),a.copyOwn(n,c.atoms))}else n=Object.create(s._datums[0].atoms);n[l]=j,n[r]=q,b.push(new Fa.data.TrendDatum(s.owner,n,i))}},this)}var f=this._serRole,g=this._catRole,h=c.role,i=c.trend,j=i.info;this._warnSingleContinuousValueRole(h);var k,l=h.firstDimensionName(),m=g.isDiscrete();m||(k=g.firstDimensionName());var n={zeroIfNone:!1},o=this.partData(c.dataPartValue,d),p=this.visibleData(c.dataPartValue,{baseData:d}),q=this._getTrendDataPartAtom(),r=q.dimension.name,s=g.flatten(d,{visible:!0}).childNodes,t=f&&f.isBound()?f.flatten(o,{visible:!0}).children():a.query([null]);t.each(e,this)},_getContinuousVisibleCellExtent:function(b,c){var d=c.role;switch(d.name){case"series":case"category":return this.base(b,c)}this._warnSingleContinuousValueRole(d);var e=c.dataPartValue,f=d.firstDimensionName(),g=this.visibleData(e),h=b.scaleUsesAbs();return"ortho"===b.type&&c.isStacked?g.children().select(function(a){var b=this._getStackedCategoryValueExtent(a,f,h);return b?{range:b,group:a}:void 0},this).where(a.notNully).reduce(function(a,b){return this._reduceStackedCategoryValueExtent(a,b.range,b.group)}.bind(this),null):g.leafs().select(function(a){var b=a.dimensions(f).value();return h&&0>b?-b:b}).range()},_getStackedCategoryValueExtent:function(a,b,c){var d=null,e=null;return a.children().select(function(a){var d=a.dimensions(b).value();return c&&0>d?-d:d}).each(function(a){null!=a&&(a>=0?d+=a:e+=a)}),null==d&&null==e?null:{max:d||0,min:e||0}},_reduceStackedCategoryValueExtent:function(a,b){return Fa.unionExtents(a,b)},_coordinateSmallChartsLayout:function(b){this.base(b);var c,d=0,e=null,f={};this.children.forEach(function(b){b.basePanel.layout();var g,h=b.titlePanel;h&&(c||(c=h.anchorOrthoLength()),g=h[c],g>d&&(d=g));var i=b.axesPanels;e||(e=a.query(a.ownKeys(i)).where(function(a){return a===i[a].axis.id}).select(function(a){return f[a]={axis:0,title:0},a}).array()),e.forEach(function(a){var b=i[a],c=f[a],d="x"===b.axis.orientation?"height":"width";g=b[d],g>c.axis&&(c.axis=g);var e=b.titlePanel;e&&(g=e[d],g>c.title&&(c.title=g))})},this),this.children.forEach(function(a){if(d>0){var b=a.titlePanel;b.size=b.size.clone().set(c,d)}var g=a.axesPanels;e.forEach(function(a){var b=g[a],c=f[a],d="x"===b.axis.orientation?"height":"width";b.size=b.size.clone().set(d,c.axis);var e=b.titlePanel;e&&(e.size=e.size.clone().set(d,c.title))}),a.basePanel.invalidateLayout()},this)}}),a.type("pvc.CategoricalAbstractPanel",Fa.CartesianAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.stacked=c.option("Stacked")}),a.type("pvc.AxisPanel",Fa.BasePanel).init(function(b,c,d,e){e=a.create(e,{anchor:d.option("Position")});var f=e.anchor||this.anchor;if(this.axis=d,this.base(b,c,e),this.roleName=d.role.name,this.isDiscrete=d.role.isDiscrete(),this._extensionPrefix=d.extensionPrefixes,null==this.labelSpacingMin&&(this.labelSpacingMin=this.isDiscrete?.25:1.5),null==this.showTicks&&(this.showTicks=!this.isDiscrete),void 0===e.font){var g=this._getConstantExtension("label","font");g&&(this.font=g)}if(void 0===e.tickLength){var h=+this._getConstantExtension("ticks",this.anchorOrthoLength(f));!isNaN(h)&&isFinite(h)&&(this.tickLength=h)}}).add({pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:!1,roleName:null,axis:null,anchor:"bottom",tickLength:6,scale:null,ruleCrossesMargin:!0,font:"9px sans-serif",labelSpacingMin:null,desiredTickCount:null,showMinorTicks:!0,showTicks:null,hiddenLabelText:"",_isScaleSetup:!1,_createLogInstanceId:function(){return this.base()+" - "+this.axis.id},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks},_calcLayout:function(a){var b=this.axis.scale;return this._isScaleSetup||(this.pvScale=b,this.scale=b,this.extend(b,"scale"),this._isScaleSetup=!0),b.isNull?a.axisSize=0:this._calcLayoutCore(a),this.createAnchoredSize(a.axisSize,a.clientSize)},_calcLayoutCore:function(a){var b=a.desiredClientSize[this.anchorOrthoLength()];a.axisSize=b,this.isDiscrete&&this.useCompositeAxis?null==a.axisSize&&(a.axisSize=50):(this._readTextProperties(a),this._calcTicks(),"discrete"===this.scale.type&&(this._tickIncludeModulo=this._calcDiscreteTicksIncludeModulo()),this._calcAxisSizeFromLabel(a),null==a.axisSize&&(a.axisSize=a.requiredAxisSize),this._calcMaxTextLengthThatFits(),this._calcOverflowPaddings())},_calcAxisSizeFromLabel:function(a){this._calcTicksLabelBBoxes(a),this._calcAxisSizeFromLabelBBox(a)},_readTextProperties:function(b){var c=this._getExtension("label","textAngle");b.isTextAngleFixed=null!=c,b.textAngle=a.number.as(c,0),b.textMargin=a.number.as(this._getExtension("label","textMargin"),3);var d=this._getExtension("label","textAlign");"string"!=typeof d&&(d=this.isAnchorTopOrBottom()?"center":"left"==this.anchor?"right":"left"),b.textAlign=d;var e=this._getExtension("label","textBaseline");if("string"!=typeof e)switch(this.anchor){case"right":case"left":case"center":e="middle";break;case"bottom":e="top";break;default:e="bottom"}b.textBaseline=e},_calcAxisSizeFromLabelBBox:function(a){var b=a.maxLabelBBox,c=this._getLabelBBoxQuadrantLength(b,this.anchor),d=this.tickLength+c,e=b.sourceAngle;0===e&&this.isAnchorTopOrBottom()||(d+=this.tickLength),a.requiredAxisSize=d},_getLabelBBoxQuadrantLength:function(a,b){var c;switch(b){case"left":c=-a.x;break;case"right":c=a.x2;break;case"top":c=-a.y;break;case"bottom":c=a.y2}return Math.max(c,0)},_calcOverflowPaddings:function(){this._layoutInfo.canChange?this._calcOverflowPaddingsFromLabelBBox():Fa.debug>=2&&this._warn("Layout cannot change. Skipping calculation of overflow paddings.")},_calcOverflowPaddingsFromLabelBBox:function(){var b=null,c=this,d=c._layoutInfo,e=d.ticks,f=e.length;if(f){var g=d.ticksBBoxes,h=d.paddings,i=c.isAnchorTopOrBottom(),j=i?"left":"bottom",k=i?"right":"top",l=c.scale,m="discrete"===l.type,n=d.clientSize[c.anchorLength()];this.axis.setScaleRange(n);var o=function(d,f,g,i){var j=c._getLabelBBoxQuadrantLength(d,f);if(j>1){var k=l(m?e[i].value:e[i]),o=g?k-j:k+j,p=Math.max(0,g?-o:o-n);if(p>1&&(p-=h[f]||0,p>1))if(m&&(p*=1.05),b){var q=b[f];(null==q||p>q)&&(b[f]=p)}else b=a.set({},f,p)}};g.forEach(function(a,b){o(a,j,!0,b),o(a,k,!1,b)}),Fa.debug>=6&&b&&c._log("OverflowPaddings = "+Fa.stringify(b))}d.overflowPaddings=b},_calcMaxTextLengthThatFits:function(){var a=this._layoutInfo;if(this.compatVersion()<=1)a.maxTextWidth=null;else{var c=a.clientSize[this.anchorOrthoLength()],d=Math.min(a.axisSize,c);if(d>=a.requiredAxisSize-this.tickLength)a.maxTextWidth=null;else{var e,f,g=a.maxLabelBBox,h=d-2*this.tickLength;switch(this.anchor){case"left":f=b.vector(0,1),e=b.vector(-h,0);break;case"right":f=b.vector(0,1),e=b.vector(h,0);break;case"top":f=b.vector(1,0),e=b.vector(0,-h);break;case"bottom":f=b.vector(1,0),e=b.vector(0,h)}var i=e.norm(),j=g.source.points(),k=j[0],l=j[1],m=j[2],n=j[3],o=m.minus(n),p=l.minus(k),q=b.SvgScene.lineIntersect,r=q(e,f,k,p),s=q(e,f,n,o),t=g.sourceTextWidth,u=t,v=r.minus(k),w=v.length();t>=w&&v.dot(o)>=0&&(u=k.dot(i)<l.dot(i)?w:r.minus(l).length());var x=s.minus(n),y=x.length();if(t>=y&&x.dot(o)>=0&&(u=n.dot(i)<m.dot(i)?Math.min(u,y):Math.min(u,s.minus(m).length())),"center"===g.sourceAlign){var z=t-u;u-=z}a.maxTextWidth=u,Fa.debug>=3&&this._log("Trimming labels' text at length "+u.toFixed(2)+"px maxOrthoLength="+h.toFixed(2)+"px")}}},_calcTicks:function(){var c=this._layoutInfo;switch(c.textHeight=2*b.Text.fontHeight(this.font)/3,c.maxTextWidth=null,this.axis.setTicks(null),this.scale.type){case"discrete":this._calcDiscreteTicks();break;case"timeSeries":this._calcTimeSeriesTicks();break;case"numeric":this._calcNumberTicks(c);break;default:throw a.error.operationInvalid("Undefined axis scale type")}this.axis.setTicks(c.ticks);var d=c.clientSize[this.anchorLength()];this.axis.setScaleRange(d),null==c.maxTextWidth&&this._calcTicksTextLength(c)},_calcDiscreteTicks:function(){var c=this.axis,d=this._layoutInfo;d.ticks=c.domainItems();var e,f,g=c.role.grouping;if(g.isSingleDimension&&(f=g.firstDimensionType())&&f.valueType===Date){var h=a.query(c.domainValues()).range();if(h&&h.min!==h.max){var i=new b.Scale.linear(h.min,h.max);i.ticks();var j=c.option("TickFormatter");j&&i.tickFormatter(j);var k=c.domainValues();e=function(a,b){return i.tickFormat(k[b])}}}e||(e=function(a){return a.absLabel}),d.ticksText=d.ticks.map(e),this._clearTicksTextDeps(d)},_clearTicksTextDeps:function(a){a.maxTextWidth=a.ticksTextLength=a.ticksBBoxes=null},_calcTimeSeriesTicks:function(){this._calcContinuousTicks(this._layoutInfo,this.desiredTickCount)},_calcNumberTicks:function(){var a=this.desiredTickCount;if(null==a){if(this.isAnchorTopOrBottom())return void this._calcNumberHTicks();a=this._calcNumberVDesiredTickCount()}this._calcContinuousTicks(this._layoutInfo,a)},_calcContinuousTicks:function(a,b){this._calcContinuousTicksValue(a,b),this._calcContinuousTicksText(a)},_calcContinuousTicksValue:function(a,b){a.ticks=this.axis.calcContinuousTicks(b),Fa.debug>4&&(this._log("DOMAIN: "+Fa.stringify(this.scale.domain())),this._log("TICKS:  "+Fa.stringify(a.ticks)))},_calcContinuousTicksText:function(a){var b=a.ticksText=a.ticks.map(function(a){return this.scale.tickFormat(a)},this);return this._clearTicksTextDeps(a),b},_calcTicksTextLength:function(a){var c=0,d=this.font,e=a.ticksText||this._calcContinuousTicksText(a),f=a.ticksTextLength=e.map(function(a){var e=b.Text.measureWidth(a,d);return e>c&&(c=e),e});return a.maxTextWidth=c,a.ticksBBoxes=null,f},_calcTicksLabelBBoxes:function(a){var b,c=this,d=c._layoutInfo,e=a.ticksTextLength||c._calcTicksTextLength(a),f=d.maxTextWidth;a.ticksBBoxes=e.map(function(a){var d=c._calcLabelBBox(a);return b||a!==f||(b=d),d},c),d.maxLabelBBox=b},_calcLabelBBox:function(a){var b=this._layoutInfo;return Fa.text.getLabelBBox(a,b.textHeight,b.textAlign,b.textBaseline,b.textAngle,b.textMargin)},_calcDiscreteTicksIncludeModulo:function(){var a=this.axis.option("OverlappedLabelsMode");if("hide"!==a&&"rotatethenhide"!==a)return 1;var c=this._layoutInfo,d=c.ticks,e=d.length;if(2>=e)return 1;var f=this.scale.range().step,g=c.textHeight,h=c.maxTextWidth;if(!(h>0&&g>0&&f>0))return 1;var i=g*this.labelSpacingMin,j=i,k=b.Text.measureWidth("x",this.font),l=k+i,m=c.textAngle,n=this.isAnchorTopOrBottom(),o=Math.abs(Math[n?"sin":"cos"](m)),p=Math.abs(Math[n?"cos":"sin"](m)),q=1e-8>o?1/0:Math.ceil((j+g)/(f*o)),r=1e-8>p?1/0:Math.ceil((l+h)/(f*p)),s=Math.min(q,r);return(!isFinite(s)||1>s||Math.ceil(e/s)<2)&&(s=1),s},_tickMultipliers:[1,2,5,10],_calcNumberVDesiredTickCount:function(){var a=this._layoutInfo,c=a.textHeight*(1+Math.max(0,this.labelSpacingMin)),d=a.clientSize[this.anchorLength()],e=Math.max(1,~~(d/c));if(1>=e)return 1;var f=this.scale.domain(),g=f[1]-f[0];if(0>=g)return e;for(var h,i=g/e,j=Math.floor(b.log(i,10)),k=Math.pow(10,j),l=this._tickMultipliers,m=0;m<l.length&&(h=l[m]*k,!(h>=i));m++);return Math.max(1,Math.floor(g/h))},_calcNumberHTicks:function(){for(var a,b,c,d,e,f=this._layoutInfo,g=f.clientSize[this.anchorLength()],h=f.textHeight*Math.max(0,this.labelSpacingMin),i=this._calcNumberHDesiredTickCount(h),j=Fa.debug>=7;;){j&&this._log("calculateNumberHTicks TickCount IN desired = "+i),c={},this._calcContinuousTicksValue(c,i);var k=c.ticks,l=k.length;if(k.exponentOverflow){if(null!=a){if(1===a){d&&(c=d);break}e&&(c=e);break}k.exponent===this.exponentMin?(d=c,a=1):(e=c,a=-1)}else if(null==b||l!==b){j&&this._log("calculateNumberHTicks TickCount desired/resulting = "+i+" -> "+l),b=l,this._calcContinuousTicksText(c);var m=this._calcNumberHLength(c,h),n=c.excessLength=m-g,o=c.error=Math.abs(n/g);if(j&&(this._log("calculateNumberHTicks error="+(n>=0?"+":"-")+(100*c.error).toFixed(0)+"% count="+l+" step="+k.step),this._log("calculateNumberHTicks Length client/resulting = "+g+" / "+m+" spacing = "+h)),n>0){if(1===i){3===l&&1>=o?(c.ticks.splice(1,1),c.ticksText.splice(1,1),c.ticks.step*=2):(c.ticks.length=1,c.ticksText.length=1),delete c.maxTextWidth;break}if(d){c=d;break}e=c,a=-1}else{if(.05>=o||-1===a)break;d=c,a=1}}i+=a}c&&(f.ticks=c.ticks,f.ticksText=c.ticksText,f.maxTextWidth=c.maxTextWidth,Fa.debug>=5&&this._log("calculateNumberHTicks RESULT error="+(c.excessLength>=0?"+":"-")+(100*c.error).toFixed(0)+"% count="+c.ticks.length+" step="+c.ticks.step)),j&&this._log("calculateNumberHTicks END")},_calcNumberHDesiredTickCount:function(a){var c=this._layoutInfo,d=this.scale.domain().map(function(a){a=+a.toFixed(2);var c=this.scale.tickFormat(a);return b.Text.measureWidth(c,this.font)},this),e=Math.max((d[1]+d[0])/2,c.textHeight),f=c.clientSize[this.anchorLength()];return Math.max(1,~~(f/(e+a)))},_calcNumberHLength:function(c,d){var e=c.ticksText,f=a.query(e).select(function(a){return b.Text.measureWidth(a,this.font)},this).max();return Math.max(f,(e.length-1)*(f+d))},_createCore:function(){if(!this.scale.isNull){var b=this._layoutInfo.clientSize,c=this._layoutInfo.paddings,d=this.anchorOrtho(),e=this.anchorOpposite(d),f=this.anchorOrthoLength(d),g=this.ruleCrossesMargin?-c[d]:0,h=b[f]+(this.ruleCrossesMargin?c[e]:0),i=h-g;this._rSize=i;var j=this._getRootScene();this.pvRule=new Fa.visual.Rule(this,this.pvPanel,{extensionId:"rule"}).lock("data",[j]).override("defaultColor",a.fun.constant("#666666")).lock(this.anchorOpposite(),0).lock(d,g).lock(f,i).pvMark.zOrder(30).strokeDasharray(null).lineCap("square"),this.isDiscrete?this.useCompositeAxis?this.renderCompositeOrdinalAxis():this.renderOrdinalAxis():this.renderLinearAxis()}},_getExtensionId:function(){return""},_getRootScene:function(){if(!this._rootScene){var a=this._rootScene=new Fa.visual.CartesianAxisRootScene(null,{
panel:this,source:this._getRootData()}),b=this._layoutInfo,c=b.ticks,d=b.ticksText;if(this.isDiscrete)if(this.useCompositeAxis)this._buildCompositeScene(a);else{var e=this._tickIncludeModulo,f=this.hiddenLabelText;a.vars.tickIncludeModulo=e,a.vars.hiddenLabelText=f;var g,h,i,j;if(e>2){Fa.debug>=3&&this._info("Showing only one in every "+e+" tick labels");var k=a.group.owner.keySep;i=function(){var b=g.map(function(a){return a.key}).join(k),c=h.slice(0,10).join(", ")+(h.length>10?", ...":""),d=new Fa.visual.CartesianAxisTickScene(a,{source:g,tick:b,tickRaw:b,tickLabel:c,isHidden:!0});d.dataIndex=j,g=h=j=null}}c.forEach(function(b,c){var f=c%e!==0;if(f&&e>2)null==j&&(j=c),(g||(g=[])).push(b),(h||(h=[])).push(d[c]);else{g&&i();var k=new Fa.visual.CartesianAxisTickScene(a,{source:b,tick:b.value,tickRaw:b.rawValue,tickLabel:d[c],isHidden:f});k.dataIndex=c}}),g&&i()}else c.forEach(function(b,c){var e=new Fa.visual.CartesianAxisTickScene(a,{tick:b,tickRaw:b,tickLabel:d[c]});e.dataIndex=c},this)}return this._rootScene},_buildCompositeScene:function(a){function b(a){var d=a.group;if(c){var e=a.vars.tick;a.nodeValue=a.value=e.rawValue,a.nodeLabel=a.label=e.label}d.childCount()&&d.children().each(function(c){var d=new Fa.visual.CartesianAxisTickScene(a,{source:c,tick:c.value,tickRaw:c.rawValue,tickLabel:c.label});d.dataIndex=c.childIndex(),b(d)})}var c=this.compatVersion()<=1;a.vars.tick=new Ta("",""),b(a)},_getRootData:function(){var a;if(this.isDiscrete&&this.useCompositeAxis){var b=this.anchor,c={visible:!!this.axis.domainVisibleOnly()||null,isNull:!this.chart.options.ignoreNulls&&!this.axis.domainIgnoreNulls()&&null,reverse:"bottom"==b||"left"==b};a=this.axis.role.select(this.data,c)}else a=this.data;return a},renderOrdinalAxis:function(){var a,c=this.scale,d=this.hiddenLabelText,e=this._tickIncludeModulo,f=e*c.range().step/2,g=this.anchorOpposite(),h=this.anchorLength(),i=this.anchorOrtho(),j=this.anchorOrthoLength(),k=this.pvRule,l=this._getRootScene(),m=this._layoutInfo,n=this.compatVersion()<=1;if(n){var o=function(a){this.value=this.absValue=a.rawValue,this.nodeName=""+(this.value||""),this.path=this.nodeName?[this.nodeName]:[],this.label=this.absLabel=a.label};o.prototype.toString=function(){return""+this.value},a=function(a){return function(b){var c=Object.create(this);return c.index=this.parent.index,a.call(c,new o(b.vars.tick))}}}var p=new Fa.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"}).lock("data",l.childNodes).lock(g,0).lockMark(i,function(a){return a.isHidden?c(a.previousSibling.vars.tick.value)+f:c(a.vars.tick.value)}).lock("strokeDasharray",null).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);(n||this.showTicks)&&(this.pvTicks=new Fa.visual.Rule(this,p,{extensionId:"ticks",wrapper:a}).lock("data").intercept("visible",function(a){return!a.isHidden&&this.delegateExtension(!0)}).optional("lineWidth",1).lock(g,0).lock(i,0).lock(h,null).optional(j,2*this.tickLength/3).override("defaultColor",function(){return n?b.Color.names.transparent:k.scene?k.scene[0].strokeStyle:"#666666"}).pvMark);var q=this.font,r=this._layoutInfo.maxTextWidth;isFinite(r)||(r=0),this.pvLabel=new Fa.visual.Label(this,p,{extensionId:"label",showsInteraction:!0,noClick:!1,noDoubleClick:!1,noSelect:!1,noTooltip:!1,noHover:!1,wrapper:a}).intercept("visible",function(a){return a.isHidden?!!a.vars.hiddenLabelText:this.delegateExtension(!0)}).intercept("text",function(a){var b;return a.isHidden?b=d:(b=this.delegateExtension(),void 0===b&&(b=a.vars.tick.label),!r||this.showsInteraction()&&a.isActive||(b=Fa.text.trimToWidthB(r,b,q,"..",!1))),b}).pvMark.zOrder(40).lock(g,this.tickLength).lock(i,0).font(q).textStyle("#666666").textAlign(m.textAlign).textBaseline(m.textBaseline),this._debugTicksPanel(p)},_getTooltipFormatter:function(a){if(this.axis.option("TooltipEnabled")){a.gravity=this._calcTipsyGravity();var b=this.axis.option("TooltipFormat");if(b)return function(a){return b.call(a,a.scene)};var c=this.axis.option("TooltipAutoContent");if("summary"===c)return this._summaryTooltipFormatter;if("value"===c)return a.isLazy=!1,function(a){return a.scene.vars.tick.label}}},_debugTicksPanel:function(a){if(Fa.debug>=16){var c=(this.font,this._layoutInfo),d=c.ticksBBoxes||this._calcTicksLabelBBoxes(c);a.add(b.Panel)[this.anchorOpposite()](this.tickLength)[this.anchorOrtho()](0)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).visible(function(a){return!a.isHidden}).add(b.Line).data(function(a){var b=d[a.dataIndex],c=b.source.points();return c.length>1&&(c=c.concat(c[0])),c}).left(function(a){return a.x}).top(function(a){return a.y}).strokeStyle("red").lineWidth(.5).strokeDasharray("-")}},renderLinearAxis:function(){var a,c=this.scale,d=this.pvRule,e=this.anchorOpposite(),f=this.anchorLength(),g=this.anchorOrtho(),h=this.anchorOrthoLength(),i=this._getRootScene();this.compatVersion()<=1&&(a=function(a){return function(b){var c=Object.create(this);return c.index=this.parent.index,a.call(c,b.vars.tick.rawValue)}});var j=new Fa.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"}).lock("data",i.childNodes).lock(e,0).lockMark(g,function(a){return c(a.vars.tick.value)}).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);if(this.showTicks){var k=this.pvTicks=new Fa.visual.Rule(this,j,{extensionId:"ticks",wrapper:a}).lock("data").override("defaultColor",function(){return d.scene?d.scene[0].strokeStyle:"#666666"}).lock(e,0).lock(g,0).lock(f,null).optional(h,this.tickLength).pvMark;if(this.showMinorTicks){var l=this._layoutInfo,m=l.ticks,n=m.length,o=n>1?Math.abs(c(m[1])-c(m[0]))/2:0;this.pvMinorTicks=new Fa.visual.Rule(this,this.pvTicks,{extensionId:"minorTicks",wrapper:a}).lock("data").intercept("visible",function(a){var b=a.childIndex()<n-1&&(!k.scene||k.scene[0].visible);return b&&this.delegateExtension(!0)}).override("defaultColor",function(){return k.scene?k.scene[0].strokeStyle:b.Color.names.d}).lock(e,0).lock(f,null).optional(h,this.tickLength/2).lockMark(g,o).pvMark}}this.renderLinearAxisLabel(j,a),this._debugTicksPanel(j)},renderLinearAxisLabel:function(a,b){var c=(this.pvTicks,this.anchorOpposite()),d=this.anchorOrtho(),e=(this.scale,this.font),f=this._layoutInfo.maxTextWidth;isFinite(f)||(f=0);var g=this.pvLabel=new Fa.visual.Label(this,a,{extensionId:"label",noHover:!1,showsInteraction:!0,wrapper:b}).lock("data").intercept("text",function(a){var b=a.vars.tick.label;return!f||this.showsInteraction()&&a.isActive||(b=Fa.text.trimToWidthB(f,b,e,"..",!1)),b}).pvMark.lock(c,this.tickLength).lock(d,0).zOrder(40).font(this.font).textStyle("#666666"),h=this.pvPanel.root;this.isAnchorTopOrBottom()?g.textBaseline(c).textAlign(function(a){var b;if(0===this.index){if(b=g.toScreenTransform().transformHPosition(g.left()),0>=b)return"left"}else if(this.index===a.parent.childNodes.length-1&&(b=g.toScreenTransform().transformHPosition(g.left()),b>=h.width()))return"right";return"center"}):g.textAlign(c).textBaseline(function(a){var b;if(0===this.index){if(b=g.toScreenTransform().transformVPosition(g.top()),b>=h.height())return"bottom"}else if(this.index===a.parent.childNodes.length-1&&(b=g.toScreenTransform().transformVPosition(g.top()),0>=b))return"top";return"middle"})},_onV1Click:function(a,b){this.isDiscrete&&this.useCompositeAxis&&b.call(a.pvMark,a.scene,a.event)},_onV1DoubleClick:function(a,b){this.isDiscrete&&this.useCompositeAxis&&b.call(a.pvMark,a.scene,a.event)},_getSelectableMarks:function(){return this.isDiscrete&&this.isVisible&&this.pvLabel?this.base():void 0},renderCompositeOrdinalAxis:function(){var c=this.isAnchorTopOrBottom(),d=c?"h":"v",e=2,f=2,g=this.font,h=b.Text.fontHeight(g)/2,i=this._pvLayout=this._getCompositeLayoutSingleCluster();i.node.def("fitInfo",null).height(function(a){var b=Fa.text.getFitInfo(a.dx,a.dy,a.vars.tick.label,g,h);return b.h||("v"===d&&b.v?f=Math.min(e,a.depth):e=Math.min(e,a.depth)),this.fitInfo(b),a.dy}),i.node.add(b.Bar).fillStyle("rgba(127,127,127,.001)").strokeStyle(function(a){return 1!==a.maxDepth&&a.maxDepth?"rgba(127,127,127,0.3)":null}).lineWidth(function(a){return 1!==a.maxDepth&&a.maxDepth?.5:0}).text(function(a){return a.vars.tick.label});var j,k=.3,l=1.27,m=c?"center":"left"==this.anchor?"right":"left";this.compatVersion()<=1&&(j=function(a){return function(b){return a.call(this,b)}}),this.pvLabel=new Fa.visual.Label(this,i.label,{extensionId:"label",noClick:!1,noDoubleClick:!1,noSelect:!1,noTooltip:!1,noHover:!1,showsInteraction:!0,wrapper:j,tooltipArgs:{options:{offset:2*h}}}).pvMark.def("lblDirection","h").textAngle(function(a){if(a.depth>=f&&a.depth<e)return this.lblDirection("v"),-Math.PI/2;if(a.depth>=e){var b=a.dy/a.dx,c=Math.atan(b);if(c>l)return this.lblDirection("v"),-Math.PI/2;if(c>k)return this.lblDirection("d"),-c}return this.lblDirection("h"),0}).textMargin(1).textAlign(function(a){return"v"!=d||a.depth>=f||a.depth>=e?"center":m}).left(function(a){return"v"!=d||a.depth>=f||a.depth>=e?a.x+a.dx/2:"right"==m?a.x+a.dx:a.x}).font(g).textStyle("#666666").text(function(b){var c=b.vars.tick.label;if(!b.isActive||!this.sign.showsInteraction()){var d=this.fitInfo();switch(this.lblDirection()){case"h":if(!d.h)return Fa.text.trimToWidthB(b.dx,c,g,"..");break;case"v":if(!d.v)return Fa.text.trimToWidthB(b.dy,c,g,"..");break;case"d":if(!d.d){var e=Math.sqrt(a.sqr(b.dy)+a.sqr(b.dx));return Fa.text.trimToWidthB(e-h,c,g,"..")}}}return c})},_getCompositeLayoutSingleCluster:function(){var c=this._getRootScene(),d=this.anchor,e=c.group.treeHeight,f=this._layoutInfo.axisSize;e++;var g=f/e,h=e>2?1/12*f:0;g-=h;var i=e/(e-1),j=Fa.BasePanel.orthogonalLength[d],k="width"==j?"left"===d?[-g,0]:[g,0]:"top"===d?[0,-g]:[0,g];this.pvRule.sign.override("defaultColor",a.fun.constant(null)).override("defaultStrokeWidth",a.fun.constant(0));var l=this.pvRule.add(b.Panel)[j](f).strokeStyle(null).lineWidth(0).add(b.Panel)[j](f*i).strokeStyle(null).lineWidth(0);return l.transform(b.Transform.identity.translate(k[0],k[1])),l.add(b.Layout.Cluster.Fill).nodes(c.nodes()).orient(d)},_calcTipsyGravity:function(){switch(this.anchor){case"bottom":return"s";case"top":return"n";case"left":return"w";case"right":return"e"}return"s"}}),a.type("pvc.AxisTitlePanel",Fa.TitlePanelAbstract).init(function(a,b,c,d){this.axis=c,this.base(a,b,d),this._extensionPrefix=c.extensionPrefixes.map(function(a){return a+"Title"})}).add({_calcLayout:function(a){var b=this.axis.scale;return!b||b.isNull?new Ma(0,0):this.base(a)},_createCore:function(a){var b=this.axis.scale;return b&&!b.isNull?this.base(a):void 0}}),a.type("pvc.PiePanel",Fa.PlotPanel).init(function(a,b,c,d){var e=c.option("ValuesLabelStyle");this.base(a,b,c,d),this.explodedOffsetRadius=c.option("ExplodedSliceRadius"),this.explodedSliceIndex=c.option("ExplodedSliceIndex"),this.activeOffsetRadius=c.option("ActiveSliceRadius"),this.labelStyle=e,"linked"===e&&(this.linkInsetRadius=c.option("LinkInsetRadius"),this.linkOutsetRadius=c.option("LinkOutsetRadius"),this.linkMargin=c.option("LinkMargin"),this.linkHandleWidth=c.option("LinkHandleWidth"),this.linkLabelSize=c.option("LinkLabelSize"),this.linkLabelSpacingMin=c.option("LinkLabelSpacingMin"))}).add({pvPie:null,pvPieLabel:null,valueRoleName:"value",_getV1Datum:function(a){var b=a.datum;if(b){var c=Object.create(b);c.percent=a.vars.value.percent,b=c}return b},_calcLayout:function(c){function d(b){return a.between(Ka.resolve(b,h),0,h)}function e(b){return a.between(Ka.resolve(b,g),0,g)}var f=c.clientSize,g=f.width,h=Math.min(g,f.height)/2;if(!h)return new Ma(0,0);var i=b.vector(f.width/2,f.height/2),j=this._getConstantExtension("label","font");a.string.is(j)||(j=this.valuesFont);var k=h;if(this.valuesVisible&&"linked"===this.labelStyle){var l=d(this.linkInsetRadius),m=d(this.linkOutsetRadius),n=e(this.linkMargin),o=e(this.linkLabelSize),p=a.number.to(this._getConstantExtension("label","textMargin"),3),q=2*b.Text.fontHeight(j)/3,r=this.linkHandleWidth*q;n+=r;var s=this.linkLabelSpacingMin*q,t=Math.max(0,g/2-h),u=Math.max(0,m+n+o-t),v=m+q,w=Math.max(0,v,u);w>=k?(this.valuesVisible=!1,Fa.debug>=2&&this._log("Hiding linked labels due to insufficient space.")):(k-=w,c.link={insetRadius:l,outsetRadius:m,elbowRadius:k+m,linkMargin:n,handleWidth:r,labelSize:o,maxTextWidth:o-p,labelSpacingMin:s,textMargin:p,lineHeight:q})}var x=d(this.explodedOffsetRadius),y=0;this.hoverable()&&(y=d(this.activeOffsetRadius));var z=x+y,A=k-z;return 0>A?new Ma(0,0):(c.resolvePctRadius=d,c.center=i,c.clientRadius=h,c.normalRadius=A,c.explodedOffsetRadius=x,c.activeOffsetRadius=y,c.maxOffsetRadius=z,void(c.labelFont=j))},_createCore:function(c){var d,e=this,f=e.chart,g=this._buildScene(),h=c.center,i=c.normalRadius,j=["slice"];if(this.compatVersion()<=1&&(j.push(""),d=function(a){return function(b){return a.call(this,b.vars.value.value)}}),this.pvPie=new Fa.visual.PieSlice(this,this.pvPanel,{extensionId:j,center:h,activeOffsetRadius:c.activeOffsetRadius,maxOffsetRadius:c.maxOffsetRadius,resolvePctRadius:c.resolvePctRadius,wrapper:d,tooltipArgs:{options:{useCorners:!0,gravity:function(){var a=this.midAngle(),b=Math.cos(a)>=0,c=Math.sin(a)>=0;return b?c?"nw":"sw":c?"ne":"se"}}}}).lock("data",g.childNodes).override("angle",function(a){return a.vars.value.angle}).override("defaultOffsetRadius",function(){var a=e.explodedSliceIndex;return null==a||a==this.pvMark.index?c.explodedOffsetRadius:0}).lockMark("outerRadius",function(){return f.animate(0,i)}).localProperty("innerRadiusEx",Ka.parse).intercept("innerRadius",function(){var a=this.delegateExtension();if(null==a){var b=this.pvMark.innerRadiusEx();a=null!=b?Ka.resolve(b,this.pvMark.outerRadius())||0:0}return a>0?f.animate(0,a):0}).pvMark,this.valuesVisible){if(this.valuesFont=c.labelFont,"inside"===this.labelStyle)this.pvPieLabel=Fa.visual.ValueLabel.maybeCreate(this,this.pvPie,{wrapper:d}).override("defaultText",function(a){return a.vars.value.sliceLabel}).override("calcTextFitInfo",function(a,c){var d=this.pvMark,f=d.textMargin();if(!(-1e-6>f)){var g=d.textBaseline();if("middle"===g){var h=Fa.normAngle(e.pvPie.midAngle()),i=Fa.normAngle(d.textAngle()),j=Math.abs(h-i)<1e-6,k=!1;if(!j){var l=Fa.normAngle(i+Math.PI);k=Math.abs(h-l)<1e-6}if(j||k){var m=d.name(),n=d.textAlign(),o="outer"===m&&n===(j?"right":"left");if(o){var p=!1,q=b.Text.measure(c,d.font()),r=.85*q.height,s=e.pvPie.outerRadius(),t=e.pvPie.innerRadius(),u=a.vars.value.angle,v=r+f/2,w=u<Math.PI?Math.max(t,v/(2*Math.tan(u/2))):t,x=s-f-w;return p|=0>=x,x-=f,p|=this.hideOverflowed&&q.width>x,{hide:p,widthMax:x}}}}}}).pvMark.textMargin(10);else if("linked"===this.labelStyle){var k=c.link;g.layoutLinkLabels(c),this.pvLinkPanel=this.pvPanel.add(b.Panel).data(g.childNodes).localProperty("pieSlice").pieSlice(function(){return e.pvPie.scene[this.index]});var l=!1,m=!0;if(this.pvLinkLine=new Fa.visual.Line(this,this.pvLinkPanel,{extensionId:"linkLine",freePosition:m,noClick:m,noDoubleClick:m,noSelect:m,noTooltip:m,noHover:m,showsActivity:l}).lockMark("data",function(a){var b=this.parent.pieSlice(),c=b.startAngle+b.angle/2,d=b.outerRadius-k.insetRadius,e=b.left+d*Math.cos(c),f=b.top+d*Math.sin(c),g=a.childNodes[0];return g&&g._isFirstDynamicScene?(g.x=e,g.y=f):(g=new Fa.visual.PieLinkLineScene(a,e,f,0),g._isFirstDynamicScene=m),a.childNodes}).override("defaultColor",function(a,b){return"stroke"===b?"black":this.base(a,b)}).override("defaultStrokeWidth",a.fun.constant(.5)).pvMark.lock("visible").lock("top",function(a){return a.y}).lock("left",function(a){return a.x}),this.pvPieLabel=new Fa.visual.Label(this,this.pvLinkPanel,{extensionId:"label",noClick:l,noDoubleClick:l,noSelect:l,noHover:l,showsInteraction:m}).lockMark("data",function(a){return a.lineScenes}).intercept("textStyle",function(a){this._finished=l;var b=this.delegate();return b&&!this._finished&&!this.mayShowActive(a)&&this.mayShowNotAmongSelected(a)&&(b=this.dimColor(b,"text")),b}).pvMark.lock("visible").left(function(a){return a.vars.link.labelX}).top(function(a){return a.vars.link.labelY+(this.index+1)*k.lineHeight}).textAlign(function(a){return a.vars.link.labelAnchor}).textMargin(k.textMargin).textBaseline("bottom").text(function(a){return a.vars.link.labelLines[this.index]}),Fa.debug>=20){this.pvPanel.add(b.Panel).zOrder(-10).left(h.x-c.clientRadius).top(h.y-c.clientRadius).width(2*c.clientRadius).height(2*c.clientRadius).strokeStyle("red"),this.pvPanel.strokeStyle("green");var n=b.Colors.category10();this.pvLinkLine.segmented(m).strokeStyle(function(){return n(this.index)})}}this.pvPieLabel.font(c.labelFont)}},_getExtensionId:function(){var a=[{abs:"content"}];return this.chart.parent&&a.push({abs:"smallContent"}),a.concat(this.base())},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(){var a=new Fa.visual.PieRootScene(this);return this.sum=a.vars.sumAbs.value,a}}),a.type("pvc.visual.PieRootScene",Fa.visual.Scene).init(function(b){function c(a,b){if(b){var c=b._datums;if(1===c.length)return c[0].atoms[g].label}return h.format(a)}var d=b.axes.category,e=d.domainData();this.base(null,{panel:b,source:e});var f=new Fa.visual.RoleVarHelper(this,b.visualRoles.color,{roleVar:"color"}),g=b.visualRoles[b.valueRoleName].firstDimensionName(),h=e.dimensions(g),i=b.chart.options.percentValueFormat,j=b.axes.angle.scale,k=j.isNull?0:j.domain()[1];this.vars.sumAbs=new Ta(k,c(k));var l=this,m=a.type(Fa.visual.PieCategoryScene).init(function(a,b){this.base(l,{source:a}),this.vars.category=Ta.fromComplex(a);var d=new Ta(b,c(b,a));d.angle=j(b);var e=Math.abs(b)/k;d.percent=new Ta(e,i(e)),this.vars.value=d,d.sliceLabel=this.sliceLabel(),f.onNewScene(this,!0)});b._extendSceneType("category",m,["sliceLabel","sliceLabelMask"]);var n=d.domainItems();if(n.length&&(n.forEach(function(a){var b=a.dimensions(g).value();0!==b&&new m(a,b)}),!l.childNodes.length&&!b.visualRoles.multiChart.isBound()))throw new InvalidDataException("Unable to create a pie chart, please check the data values.")}).add({layoutLinkLabels:function(a){var b=-Math.PI/2,c=[],d=[];this.childNodes.forEach(function(e){b=e.layoutI(a,b),(e.vars.link.dir>0?d:c).push(e)}),this._distributeLabels(-1,c,a),this._distributeLabels(1,d,a)},_distributeLabels:function(b,c,d){c.sort(function(b,c){return a.compare(b.vars.link.targetY,c.vars.link.targetY)}),this._distributeLabelsDownwards(c,d)&&this._distributeLabelsUpwards(c,d)&&this._distributeLabelsEvenly(c,d),c.forEach(function(a){a.layoutII(d)})},_distributeLabelsDownwards:function(a,b){for(var c=b.link,d=c.labelSpacingMin,e=b.clientSize.height,f=!1,g=0,h=a.length-1;h>g;g++){var i=a[g].vars.link;!g&&i.labelTop()<0&&(f=!0);var j=a[g+1].vars.link,k=i.labelBottom()+d;if(j.labelTop()<k){var l=j.labelHeight/2,m=k+l,n=e-l;m>n?(f=!0,j.targetY=n):j.targetY=m}}return f},_distributeLabelsUpwards:function(a,b){for(var c=b.link,d=c.labelSpacingMin,e=!1,f=a.length-1;f>0;f--){var g=a[f-1].vars.link,h=a[f].vars.link;1===f&&g.labelTop()<0&&(e=!0);var i=h.labelTop()-d;if(g.labelBottom()>i){var j=g.labelHeight/2,k=i-j,l=j;l>k?(e=!0,g.targetY=l):g.targetY=k}}return e},_distributeLabelsEvenly:function(a,b){var c=0;a.forEach(function(a){c+=a.vars.link.labelHeight});var d=b.clientSize.height-c,e=d;a.length>1&&(e/=a.length-1);var f=0;return a.forEach(function(a){var b=a.vars.link,c=b.labelHeight/2;f+=c,b.targetY=f,f+=c+e}),!0}}),a.type("pvc.visual.PieLinkLabelVar").add({labelTop:function(){return this.targetY-this.labelHeight/2},labelBottom:function(){return this.targetY+this.labelHeight/2}}),a.type("pvc.visual.PieCategoryScene",Fa.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask},sliceLabel:function(){return this.format(this.sliceLabelMask())},layoutI:function(b,c){var d=this.vars.value,e=c+d.angle,f=(c+e)/2,g=this.vars.link=new Fa.visual.PieLinkLabelVar,h=b.link,i=Fa.text.justify(d.sliceLabel,h.maxTextWidth,b.labelFont),j=i.length;g.labelLines=i,g.labelHeight=j*h.lineHeight,this.lineScenes=a.array.create(j,this);var k=Math.cos(f),l=Math.sin(f),m=k>=0,n=m?1:-1;g.labelAnchor=m?"left":"right";var o=b.center,p=h.elbowRadius,q=o.x+p*k,r=o.y+p*l,s=o.x+n*p,t=s+n*h.linkMargin;return new Fa.visual.PieLinkLineScene(this,q,r),new Fa.visual.PieLinkLineScene(this,s,r),g.elbowY=r,g.targetY=r+0,g.targetX=t,g.dir=n,e},layoutII:function(a){var b=this.vars.link,c=b.targetY,d=b.targetX,e=a.link.handleWidth;e>0&&new Fa.visual.PieLinkLineScene(this,d-b.dir*e,c),new Fa.visual.PieLinkLineScene(this,d,c),b.labelX=d,b.labelY=c-b.labelHeight/2}}),a.type("pvc.visual.PieLinkLineScene",Fa.visual.Scene).init(function(a,b,c,d){this.base(a,{source:a.group,index:d}),this.x=b,this.y=c}).add(b.Vector),a.type("pvc.PieChart",Fa.BaseChart).add({_animatable:!0,_axisClassByType:{category:Fa.visual.Axis,angle:Fa.visual.NormalizedAxis},_axisCreateChartLevel:{category:2,angle:2},_axisSetScaleChartLevel:{category:2,angle:2},_axisCreationOrder:function(){var a=Fa.BaseChart.prototype._axisCreationOrder.slice();return a.push("category","angle"),a}(),pieChartPanel:null,_getColorRoleSpec:function(){return{isRequired:!0,defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:!0}},_initVisualRoles:function(){this.base(),this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0}),this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"})},_initPlotsCore:function(){new Fa.visual.PiePlot(this)},_createVisibleData:function(a,b){return this.visualRoles.category.flatten(a,b)},_setAxisScale:function(a,b){this.base(a,b),2&b&&"angle"===a.type&&a.setScaleRange({min:0,max:2*Math.PI})},_createContent:function(b){this.base();var c=this.compatVersion()<=1;if(c){var d=Fa.castNumber(this.options.innerGap)||.95;d=a.between(d,.1,1),b.paddings=(100*(1-d)/2).toFixed(2)+"%"}else null==b.paddings&&(b.paddings=new Ka(.025));var e=this.plots.pie;this.pieChartPanel=new Fa.PiePanel(this,this.basePanel,e,a.create(b,{scenes:a.getPath(this.options,"pie.scenes")}))}}),a.type("pvc.BarAbstractPanel",Fa.CategoricalAbstractPanel).add({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,_creating:function(){var a=this.defaultLegendGroupScene();if(a&&!a.hasRenderer()){var b=a.colorAxis,c=b.option("LegendDrawLine"),d=!c||b.option("LegendDrawMarker");if(d){var e={drawMarker:!0,markerShape:b.option("LegendShape"),drawRule:c,markerPvProto:new Ga};this.extend(e.markerPvProto,"",{constOnly:!0}),a.renderer(new Fa.visual.legend.BulletItemDefaultRenderer(e))}}},_createCore:function(){this.base();var a,c,d=this,e=d.chart,f=d.plot,g=!!d.stacked,h=d.isOrientationVertical(),i=d.visibleData({ignoreNulls:!1}),j=d.axes.ortho,k=d.axes.base,l=k.domainItems(),m=d.visualRoles.series.flatten(d.partData(),{visible:!0,isNull:!e.options.ignoreNulls&&null}).childNodes,n=d._buildScene(i,m,l),o=j.scale,p=o(0),q=j.sceneScale({sceneVarName:"value",nullToZero:!1}),r=k.sceneScale({sceneVarName:"category"}),s=f.option("BarSizeRatio"),t=f.option("BarSizeMax"),u=f.option("BarStackedMargin"),v=f.option("BarOrthoSizeMin"),w=k.scale.range(),x=w.band,y=w.step,z=w.margin,A=h===g;g?a=x:(c=m.length,a=c?1===c?x:s*x/c:0),a>t&&(a=t),d.barWidth=a,d.barStepWidth=y;var B;d.compatVersion()<=1&&(B=function(a){return function(b){var c=Object.create(this.parent),d=Object.create(this);d.parent=c;var e=b.parent.childIndex(),f=b.childIndex();return g?(c.index=e,d.index=f):(c.index=f,d.index=e),a.call(d,b.vars.value.rawValue)}}),d.pvBarPanel=new Fa.visual.Panel(d,d.pvPanel,{panelType:b.Layout.Band,extensionId:"panel"}).lock("layers",n.childNodes).lockMark("values",function(a){return a.childNodes}).lockMark("orient",h?"bottom-left":"left-bottom").lockMark("layout",g?"stacked":"grouped").lockMark("verticalMode",d._barVerticalMode()).lockMark("yZero",p).optionalMark("hZero",v).pvMark.band.x(r).w(x).differentialControl(d._barDifferentialControl()).item.order(A?"reverse":null).h(function(a){var b=q(a);return null!=b?e.animate(0,b-p):null}).w(a).horizontalRatio(s).verticalMargin(u).end;var C=4>=a||2>z,D=this.pvBar=new Fa.visual.Bar(d,d.pvBarPanel.item,{extensionId:"",freePosition:!0,wrapper:B}).lockDimensions().pvMark.antialias(function(a){if(C)return!0;var b=q(a),c=null==b?0:Math.abs(b-p);return 1e-8>c});f.option("OverflowMarkersVisible")&&this._addOverflowMarkers(B);var E=Fa.visual.ValueLabel.maybeCreate(d,D,{wrapper:B});if(E){var F;E.hideOrTrimOverflowed&&(F=x,!g&&c>1&&(F/=c)),d.pvBarLabel=E.override("calcTextFitInfo",function(a,c){var d=this.pvMark,e=d.textMargin();if(!(-1e-6>e)){var f=d.textAngle(),g=Math.sin(f),i=Math.abs(g)<1e-6,j=!i&&Math.abs(Math.cos(f))<1e-6;if(i||j&&h){var k,l,m,n=D.height(),o=D.width(),p=h?n:o,q=h?o:n,r=b.Text.measure(c,d.font()),s=.75*r.height,t=r.width,u=d.name(),v=d.textBaseline(),w=d.textAlign(),x="center"===u,y=!1;if(h)if(i){if(l=x||u===v,!l)return;y|=x&&"middle"!==v?s+e>p/2:s+2*e>p}else y|=s>p,m="center"===w,l=x,l||m||(l=g>=1e-6?"left"===w?"top"===u:"bottom"===u:"left"===w?"bottom"===u:"top"===u),l?(k=!x||m?p-2*e:(p-e)/2,y|=("middle"===v?s>q:s>q/2)||this.hideOverflowed&&t>k):y|=s>=Math.max(q,F);else y|=s>p,l=x||u===w,l?(k=x&&"center"!==w?(p-e)/2:p-2*e,y|=("middle"===v?s>q:s>q/2)||this.hideOverflowed&&t>k):y|=s>=Math.max(q,F);return{hide:y,widthMax:k}}}}).pvMark}},_barVerticalMode:function(){return null},_barDifferentialControl:function(){return null},_getV1Datum:function(a){var b=a.datum;if(b){var c=Object.create(b);c.percent=a.vars.value.percent,b=c}return b},_addOverflowMarkers:function(a){var b=this.axes.ortho;null!=b.option("FixedMax")&&(this.pvOverflowMarker=this._addOverflowMarker(!1,b.scale,a)),null!=b.option("FixedMin")&&(this.pvUnderflowMarker=this._addOverflowMarker(!0,b.scale,a))},_addOverflowMarker:function(a,b,c){var d,e=this.isOrientationVertical(),f=e?"bottom":"left",g=this.anchorOpposite(f),h=this.anchorOrthoLength(f),i=this.anchorLength(f),j=this._layoutInfo.paddings,k=a?b.min-j[f]:b.max+j[g];return d=a?e?0:Math.PI/2:e?Math.PI:-Math.PI/2,new Fa.visual.Dot(this,this.pvBar.anchor("center"),{noSelect:!0,noHover:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,freePosition:!0,extensionId:a?"underflowMarker":"overflowMarker",wrapper:c}).intercept("visible",function(b){var c=this.delegateExtension();if(void 0!==c&&!c)return!1;var d=b.vars.value.value;if(null==d)return!1;var e=this.pvMark.scene.target[this.pvMark.index],g=e[f]+(d>0?e[h]:0);return a?k>g:g>k}).lock(g,null).lock("shapeSize").pvMark.shape("triangle").shapeRadius(function(){return Math.min(Math.sqrt(10),this.scene.target[this.index][i]/2)}).shapeAngle(d).lineWidth(1.5).strokeStyle("red").fillStyle("white")[f](function(){return k+(a?1:-1)*(this.shapeRadius()+2)})},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(a,b,c){function d(b){var d=new Fa.visual.Scene(e,{source:b}),f=b.key;d.vars.series=Ta.fromComplex(b),h.onNewScene(d,!1),c.forEach(function(b){var c=a.child(b.key),e=c&&c.child(f),i=new Fa.visual.Scene(d,{source:e}),j=i.vars.category=Ta.fromComplex(c);j.group=c,g.onNewScene(i,!0),h.onNewScene(i,!0)})}var e=new Fa.visual.Scene(null,{panel:this,source:a}),f=(a.childNodes,this.visualRoles),g=new Fa.visual.RoleVarHelper(e,f.value,{roleVar:"value",hasPercentSubVar:this.stacked}),h=new Fa.visual.RoleVarHelper(e,f.color,{roleVar:"color"});return b.forEach(d),e}}),a.type("pvc.BarAbstract",Fa.CategoricalAbstract).init(function(a){this.base(a);var b=this.parent;b&&(this._valueRole=b._valueRole)}).add({_initVisualRoles:function(){this.base(),this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:this.options.stacked,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"}),this._valueRole=this.visualRoles.value},_getCategoryRoleSpec:function(){var a=this.base();return a.requireIsDiscrete=!0,a},_initData:function(){this.base.apply(this,arguments);var a=this.data;this._valueDim=a.dimensions(this._valueRole.firstDimensionName())}}),a.type("pvc.BarPanel",Fa.BarAbstractPanel).add({}),a.type("pvc.BarChart",Fa.BarAbstract).add({_animatable:!0,_trendable:!0,_allowV1SecondAxis:!0,_initPlotsCore:function(){var a=this.options,b=new Fa.visual.BarPlot(this),c=b.option("Trend");if(a.plot2){var d=new Fa.visual.PointPlot(this,{name:"plot2",fixed:{DataPart:"1"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!0}});c||(c=d.option("Trend"))}this._trendable=!!c,c&&new Fa.visual.PointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",ColorRole:"series",NullInterpolatioMode:"none"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!1}})},_hasDataPartRole:function(){return!0},_createPlotPanels:function(a,b){var c=this.plots,d=c.bar,e=new Fa.BarPanel(this,a,d,Object.create(b));this.barChartPanel=e;var f=c.plot2;if(f){Fa.debug>=3&&this._log("Creating Point panel.");var g=new Fa.PointPanel(this,a,f,Object.create(b));e.pvSecondLine=g.pvLine,e.pvSecondDot=g.pvDot,g._applyV1BarSecondExtensions=!0}var h=c.trend;h&&(Fa.debug>=3&&this._log("Creating Trends Point panel."),new Fa.PointPanel(this,a,h,Object.create(b)))}}),a.type("pvc.NormalizedBarPanel",Fa.BarAbstractPanel).add({_barVerticalMode:function(){return"expand"}}),a.type("pvc.NormalizedBarChart",Fa.BarAbstract).add({_processOptionsCore:function(a){a.stacked=!0,this.base(a)},_getContinuousVisibleExtentConstrained:function(a,b,c){return"ortho"===a.type?{min:0,max:100,minLocked:!0,maxLocked:!0}:this.base(a,b,c)},_initPlotsCore:function(){new Fa.visual.NormalizedBarPlot(this)},_createPlotPanels:function(a,b){var c=this.plots.bar;this.barChartPanel=new Fa.NormalizedBarPanel(this,a,c,Object.create(b))}}),a.type("pvc.visual.legend.WaterfallBulletGroupScene",Fa.visual.legend.BulletGroupScene).init(function(b,c){c=a.set(c,"clickMode","none"),this.base(b,c),this.createItem(c)}).add({renderer:function(a){return null!=a&&(this._renderer=a),this._renderer},itemSceneType:function(){return Fa.visual.legend.WaterfallBulletItemScene}}),a.type("pvc.visual.legend.WaterfallBulletItemScene",Fa.visual.legend.BulletItemScene).init(function(b,c){this.base.apply(this,arguments);var d=Fa.visual.Interactive;this._ibits=d.Interactive|d.ShowsInteraction,this.color=a.get(c,"color"),this.vars.value=new Ta(null,a.get(c,"label"))}),a.type("pvc.WaterfallPanel",Fa.BarAbstractPanel).add({pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var a=this.chart._isFalling;return function(b){if(a&&!this.index)return 1;var c=b.vars.category.group,d=c._isFlattenGroup&&!c._isDegenerateFlattenGroup;return d?-2:a?-1:1}},_creating:function(){var a=this._getLegendBulletRootScene();if(a){var b=a.firstChild;if(b&&!b.hasRenderer()){var c={drawRule:!0,drawMarker:!1,rulePvProto:new Ga};this.extend(c.rulePvProto,"line",{constOnly:!0}),b.renderer(new Fa.visual.legend.BulletItemDefaultRenderer(c))}}},_createCore:function(){this.base();var c=this.chart,d=this.isOrientationVertical(),e=d?"bottom":"left",f=this.anchorOrtho(e),g=this._buildRuleScene(),h=c.axes.ortho.scale,i=h(0),j=c.axes.ortho.sceneScale({sceneVarName:"value"}),k=c.axes.base.sceneScale({sceneVarName:"category"}),l=c.axes.base.scale,m=this.barWidth/2,n=this.barWidth,o=this.barStepWidth,p=c._isFalling,q=c._waterColor;if(this.plot.option("AreasVisible")){var r=b.Colors.category10(),s=this._buildWaterGroupScene(),t=h.range(),u=.04*(t[1]-t[0]);this.pvWaterfallGroupPanel=new Fa.visual.Panel(this,this.pvPanel,{extensionId:"group"}).lock("data",s.childNodes).pvMark.zOrder(-1).fillStyle(function(){return r(0).alpha(.15)})[f](function(a){var b=a.vars.category;return l(b.valueLeft)-o/2})[this.anchorLength(e)](function(a){var b=a.vars.category,c=Math.abs(l(b.valueRight)-l(b.valueLeft));return c+o})[e](function(a){var b=a.vars.value,d=h(b.valueBottom)-u/2;return c.animate(i,d)})[this.anchorOrthoLength(e)](function(a){var b=a.vars.value,d=h(b.valueTop)-h(b.valueBottom)+u;return c.animate(0,d)})}this.pvBar.sign.override("baseColor",function(a,c){var d=this.base(a,c);return"fill"!==c||a.vars.category.group._isFlattenGroup?d:b.color(d).alpha(.5)}),this.pvWaterfallLine=new Fa.visual.Rule(this,this.pvPanel,{
extensionId:"line",noTooltip:!1,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1}).lock("data",g.childNodes).optional("visible",function(a){return p&&!!a.previousSibling||!p&&!!a.nextSibling}).optional(e,function(a){return i+c.animate(0,j(a)-i)}).optional(this.anchorLength(e),o+n).optional(f,p?function(a){return k(a)-o-m}:function(a){return k(a)-m}).override("defaultColor",a.fun.constant(q)).pvMark.antialias(!0).lineCap("butt"),this.plot.option("TotalValuesVisible")&&(this.pvWaterfallLabel=new Fa.visual.Label(this,this.pvWaterfallLine,{extensionId:"lineLabel"}).intercept("visible",function(a){return!a.vars.category.group._isFlattenGroup&&(p||!!a.nextSibling)}).pvMark[e](function(a){return i+c.animate(0,j(a)-i)})[this.anchorOrtho(e)](k).textAlign(d?"center":"left").textBaseline(function(a){if(!d)return"middle";var b=a.vars.direction;if(null==b)return"bottom";var c=!p;return c===("up"===b)?"bottom":"top"}).textStyle(b.Color.names.darkgray.darker(2)).textMargin(5).text(function(a){return a.vars.value.label}))},_buildRuleScene:function(){function b(a){var b=a.group,c=new Fa.visual.Scene(f,{source:b}),d=c.vars.category=Ta.fromComplex(b);d.group=b;var e=a.offset;c.vars.value=new Ta(e,this.chart._valueDim.format(e))}function c(a,b){var c=a.vars.value.value;a.vars.direction=b&&d!==c?e===c>d?"up":"down":null,d=c}var d,e,f=new Fa.visual.Scene(null,{panel:this,source:this.visibleData({ignoreNulls:!1})}),g=this.chart._ruleInfos;if(g){g.forEach(b,this);var h=a.query(f.childNodes);e=!this.chart._isFalling,e||(h=h.reverse()),h.each(c,this)}return f},_buildWaterGroupScene:function(){function b(a,d){var e=a.children().where(function(a){return""!==a.key});if(e.next()){d&&c(a,d),d++;do b(e.item,d);while(e.next())}}function c(a,b){var c=new Fa.visual.Scene(j,{source:a}),h=c.vars.category=Ta.fromComplex(a);h.group=a,h.level=b;var i,k,l,m,n,o=c.vars.value={},p=f[a.absKey],q=p.offset,r=p.range,s=-r.min+r.max;g?(i=e(a),k=f[i.absKey],l=p.group.value,m=k.group.value,n=q-r.max):(i=d(a),k=f[i.absKey],l=k.group.value,m=p.group.value,n=q-r.max),h.valueLeft=l,h.valueRight=m,o.valueHeight=s,o.valueBottom=n,o.valueTop=n+s}function d(a){var b=a.childNodes,c=b&&b[0];return c?d(c):a}function e(a){var b=a.childNodes,c=b&&b[b.length-1];return c?e(c):a}var f,g,h=this.chart,i=h._catRole.select(h.partData(this.dataPartValue),{visible:!0}),j=new Fa.visual.Scene(null,{panel:this,source:i}),k=h._ruleInfos;return k&&(f=a.query(k).object({name:function(a){return a.group.absKey}}),g=h._isFalling,b(i,0)),j}}),a.type("pvc.WaterfallChart",Fa.BarAbstract).init(function(a){this.base(a);var b=this.parent;b&&(this._isFalling=b._isFalling)}).add({_animatable:!0,_isFalling:!0,_ruleInfos:null,_waterColor:b.color("#1f77b4").darker(),_processOptionsCore:function(a){a.stacked=!0,a.baseAxisComposite=!1,this.base(a),a.plot2=!1},_initPlotsCore:function(){var a=(this.options,new Fa.visual.WaterfallPlot(this));this._isFalling="down"===a.option("Direction");var b=this._isFalling?"FlattenDfsPre":"FlattenDfsPost";this._catRole.setTraversalMode(Fa.visual.TraversalMode[b]),this._catRole.setRootLabel(a.option("AllCategoryLabel"))},_initLegendScenes:function(a){var c=this.plots.water,d=Fa.makeExtensionAbsId("line",c.extensionPrefixes),e=this._getConstantExtension(d,"strokeStyle");e&&(this._waterColor=b.color(e));var f=a._getBulletRootScene();new Fa.visual.legend.WaterfallBulletGroupScene(f,{extensionPrefix:Fa.buildIndexedId("",1),label:c.option("TotalLineLabel"),color:this._waterColor}),this.base(a)},_reduceStackedCategoryValueExtent:function(a,b,c){var d,e=a?a.offset:0,f=b.min+b.max;if(!a)return b?(d=e+f,this._ruleInfos=[{offset:d,group:c,range:b}],{min:b.min,max:b.max,offset:d}):null;var g=this._isFalling,h=c._isFlattenGroup&&!c._isDegenerateFlattenGroup;if(h){var i=-b.min;if(i>0){var j=e+i;j>a.max&&(a.max=j)}var k=-b.max;if(0>k){var l=e+k;l<a.min&&(a.min=l)}}else{var m=g?-1:1;d=a.offset=e+m*f,d>a.max?a.max=d:d<a.min&&(a.min=d)}return this._ruleInfos.push({offset:g?e:a.offset,group:c,range:b}),a},_createPlotPanels:function(b,c){this.wfChartPanel=new Fa.WaterfallPanel(this,b,this.plots.water,a.create(c,{waterfall:this.options.waterfall}))}}),a.type("pvc.PointPanel",Fa.CategoricalAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.linesVisible=c.option("LinesVisible"),this.dotsVisible=c.option("DotsVisible"),this.areasVisible=c.option("AreasVisible"),this.linesVisible||this.dotsVisible||this.areasVisible||(this.linesVisible=!0,c.option.specify({LinesVisible:!0})),this.visualRoles.value=a.visualRole(c.option("OrthoRole"))}).add({pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,_creating:function(){var c=this.defaultLegendGroupScene();if(c&&!c.hasRenderer()){var d=c.colorAxis,e=a.nullyTo(d.option("LegendDrawMarker",!0),this.dotsVisible||this.areasVisible),f=!e||a.nullyTo(d.option("LegendDrawLine",!0),this.linesVisible&&!this.areasVisible);if(e||f){var g={drawMarker:e,drawRule:f};if(e){var h=d.option("LegendShape",!0);this.dotsVisible?(h||(h="circle"),g.markerPvProto=(new b.Dot).lineWidth(1.5,Fa.extensionTag).shapeSize(12,Fa.extensionTag)):g.markerPvProto=new Ga,g.markerShape=h,this._applyV1BarSecondExtensions&&this.chart.extend(g.markerPvProto,"barSecondDot",{constOnly:!0}),this.extend(g.markerPvProto,"dot",{constOnly:!0})}f&&(g.rulePvProto=(new b.Line).lineWidth(1.5,Fa.extensionTag),this._applyV1BarSecondExtensions&&this.chart.extend(g.rulePvProto,"barSecondLine",{constOnly:!0}),this.extend(g.rulePvProto,"line",{constOnly:!0})),c.renderer(new Fa.visual.legend.BulletItemDefaultRenderer(g))}}},_createCore:function(){this.base();var c=this,d=this.chart,e=this.stacked,f=this.dotsVisible,g=this.areasVisible,h=this.linesVisible,i=this.isOrientationVertical()?"bottom":"left",j=this.axes.base,k=j.domainItems(),l=j.role.grouping.isDiscrete(),m=this.visibleData({ignoreNulls:!1}),n=this._buildScene(m,k,l);this.pvPanel.zOrder(g?-7:1),this.pvScatterPanel=new Fa.visual.Panel(this,this.pvPanel,{extensionId:"panel"}).lock("data",n.childNodes).pvMark;var o,p=g&&h&&!e?.5:null;this.compatVersion()<=1&&(o=e?function(a){return function(b){return a.call(this,b.vars.value.rawValue)}}:function(a){return function(b){var c={category:b.vars.category.rawValue,value:b.vars.value.rawValue},d=Object.create(this);return d.index=b.dataIndex,a.call(d,c)}});var q=l&&e?function(a){return!a.isNull||a.isIntermediate}:function(a){return!a.isNull},r=d.selectableByFocusWindow();this.pvArea=new Fa.visual.Area(this,this.pvScatterPanel,{extensionId:"area",noTooltip:!1,wrapper:o,noSelect:r,noRubberSelect:!0,showsSelection:!r}).lockMark("data",function(a){return a.childNodes}).lockMark("visible",q).override("x",function(a){return a.basePosition}).override("y",function(a){return a.orthoPosition}).override("dy",function(a){return d.animate(0,a.orthoLength)}).override("color",function(a,b){return g?this.base(a,b):null}).override("baseColor",function(a,b){var c=this.base(a,b);return!this._finished&&c&&null!=p&&(c=c.alpha(p)),c}).override("dimColor",function(a,b){return e?Fa.toGrayScale(a,1,null,null).brighter():this.base(a,b)}).lock("events",g?"painted":"none").pvMark;var s=f&&!h&&!g,t=e&&g,u=["line"];this._applyV1BarSecondExtensions&&u.push({abs:"barSecondLine"});var v=!s&&q,w=g&&!h;this.pvLine=new Fa.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(i)),{extensionId:u,freePosition:!0,wrapper:o,noTooltip:w,noDoubleClick:w,noClick:w,noHover:w,noSelect:w||r,showsSelection:!r}).lockMark("visible",v).override("defaultColor",function(a,b){var c=this.base(a,b);return!this._finished&&t&&c&&(c=c.darker(.6)),c}).override("normalColor",function(a,b){return h?b:null}).override("interactiveColor",function(a,b,c){return h||this.mayShowAnySelected(a)||this.mayShowActive(a)?this.base(a,b,c):null}).override("baseStrokeWidth",function(a){var b;return h&&(b=this.base(a)),null==b?1.5:b}).intercept("strokeDasharray",function(a){var b=this.delegateExtension();if(void 0===b){var c=a.isInterpolated;if(!c){var d=a.nextSibling;if(c=d&&d.isIntermediate&&d.isInterpolated,!c){var e=a.previousSibling;c=e&&a.isIntermediate&&e.isInterpolated}}b=c?". ":null}return b}).pvMark;var x=!(g&&l&&e);u=["dot"],this._applyV1BarSecondExtensions&&u.push({abs:"barSecondDot"}),this.pvDot=new Fa.visual.Dot(this,this.pvLine,{extensionId:u,freePosition:!0,wrapper:o}).intercept("visible",function(a){return!a.isNull&&!a.isIntermediate&&this.delegateExtension(!0)}).override("color",function(a,c){if(!f){var d=a.isActive||!x&&a.isSingle||x&&a.isAlone;if(!d)return Fa.invisibleFill}var e=this.base(a,c);return a.isInterpolated&&"fill"===c?e&&b.color(e).brighter(.5):e}).override("defaultColor",function(a,b){var c=this.base(a,b);return!this._finished&&t&&c&&(c=c.darker(.6)),c}).override("baseSize",function(b){if(!f){var d=b.isActive||!x&&b.isSingle||x&&b.isAlone;if(d&&!b.isActive){var e=Math.max(c.pvLine.lineWidth(),.2)/2;return a.sqr(e)}}return b.isInterpolated?.8*this.base(b):this.base(b)}).pvMark;var y=Fa.visual.ValueLabel.maybeCreate(this,this.pvDot,{wrapper:o});y&&(this.pvLabel=y.pvMark)},renderInteractive:function(){this.pvScatterPanel.render()},_buildScene:function(b,c,d){function e(a){for(var b,c=[],d=a.childNodes,e=0,h=null,i=0,j=0,k=d.length;k>i;i++,j++){var l=d[j],n=2*i;if(c[n]=l,f.call(this,b,l,w&&w[n]),l.isAlone&&!h&&(h=l),l.isNull||e++,b){var o=g.call(this,a,b,l,j,w&&w[n-1]);o&&(c[n-1]=o,j++)}b=l}1===e&&h&&1===k&&(h.isSingle=!0),m&&(w=c)}function f(a,b,c){var e=b.vars.value.accValue;c&&(b.isNull&&!d?e=t:e+=c.vars.value.accValue,b.vars.value.accValue=e),b.basePosition=v(b),b.orthoPosition=u,b.orthoLength=s(e)-u;var f=!a||a.isNull,g=f&&!b.isNull;if(g){var h=b.nextSibling;g=!h||h.isNull}b.isAlone=g,b.isSingle=!1}function g(a,b,c,e,f){var g=b.isNull||c.isNull;if(g&&!this.areasVisible)return null;var h,i,j;if(g){if(f&&d){var k=f.vars.value;i=k.accValue,h=k[l.name]}else h=i=t;j=m&&d?c.basePosition-v.range().step/2:b.isNull?c.basePosition:b.basePosition}else{var n=b.vars.value,p=c.vars.value;h=(p.value+n.value)/2,i=(p.accValue+n.accValue)/2,j=(c.basePosition+b.basePosition)/2}var r=new Fa.visual.Scene(a,{index:e,source:c.source});r.dataIndex=c.dataIndex,r.vars.category=c.vars.category;var w=new Ta(h,q.format(h),h);return w.accValue=i,r.vars.value=w,r.ownerScene=c,r.isInterpolated=c.isInterpolated,r.isIntermediate=!0,r.isSingle=!1,r.isNull=g,r.isAlone=g&&c.isNull&&b.isNull,r.basePosition=j,r.orthoPosition=u,r.orthoLength=s(i)-u,o.onNewScene(r,!0),r}function h(a){for(var b,c,d=a.childNodes,e=d.length;e&&(b=d[0]).isNull&&(c=b.nextSibling,!c||c.isNull);)a.removeAt(0),e--;for(;e&&(b=d[e-1]).isNull&&(c=b.previousSibling,!c||c.isNull);)a.removeAt(e-1),e--}var i=new Fa.visual.Scene(null,{panel:this,source:b}),j=this.chart,k=this.visualRoles.series,l=this.visualRoles.value,m=this.stacked,n=new Fa.visual.RoleVarHelper(i,l,{roleVar:"value",hasPercentSubVar:m}),o=new Fa.visual.RoleVarHelper(i,this.visualRoles.color,{roleVar:"color"}),p=l.firstDimensionName(),q=b.owner.dimensions(p),r=k.isBound()?k.flatten(this.partData(),{visible:!0,isNull:!j.options.ignoreNulls&&null}):null,s=this.axes.ortho.scale,t=a.scope(function(){var a=s.domain(),b=a[0],c=a[1];return b*c>=0?b>=0?b:c:0}),u=s(t),v=this.axes.base.sceneScale({sceneVarName:"category"});(r?r.children():a.query([null])).each(function(d){var e=new Fa.visual.Scene(i,{source:d||b});e.vars.series=Ta.fromComplex(d),o.onNewScene(e,!1),c.forEach(function(c,f){var g=b.child(c.key),h=g;h&&d&&(h=h.child(d.key));var i=new Fa.visual.Scene(e,{source:h});i.dataIndex=f,i.vars.category=Ta.fromComplex(g),n.onNewScene(i,!0);var j=i.vars.value,k=j.value;j.accValue=null!=k?k:t,o.onNewScene(i,!0);var l=null!=h&&h.datums().prop("isInterpolated").any(a.truthy);i.isInterpolated=l,i.isNull=null==k,i.isIntermediate=!1},this)},this);var w,x=i.children().reverse().array();return x.forEach(e,this),x.forEach(h,this),i}}),a.type("pvc.PointAbstract",Fa.CategoricalAbstract).add({_animatable:!0,_trendable:!0,_processOptionsCore:function(a){a.panelSizeRatio=1,this.base(a)},_hasDataPartRole:function(){return!0},_initVisualRoles:function(){this.base(),this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:this.options.stacked,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"})},_initPlotsCore:function(){var a=this.options,b=this._createPointPlot(),c=b.option("Trend");if(a.plot2){var d=new Fa.visual.PointPlot(this,{name:"plot2",fixed:{DataPart:"1"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!0}});c||(c=d.option("Trend"))}this._trendable=!!c,c&&new Fa.visual.PointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",ColorRole:"series",NullInterpolatioMode:"none"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!1}})},_initAxes:function(a){this.base(a);var b=this.axesByType.base;b&&b.forEach(function(a){var b="discrete"===a.scaleType;b||a.option.defaults({Offset:.01})}),b=this.axesByType.ortho,b&&b.forEach(function(a){a.option.defaults({Offset:.04})})},_createPlotPanels:function(a,b){var c=this.plots,d=c.point;this.scatterChartPanel=new Fa.PointPanel(this,a,d,Object.create(b));var e=c.plot2;e&&(Fa.debug>=3&&this._log("Creating second Point panel."),new Fa.PointPanel(this,a,e,Object.create(b)));var f=c.trend;f&&(Fa.debug>=3&&this._log("Creating Trends Point panel."),new Fa.PointPanel(this,a,f,Object.create(b)))},defaults:{tooltipOffset:10}}),a.type("pvc.DotChart",Fa.PointAbstract).add({_createPointPlot:function(){return new Fa.visual.PointPlot(this,{fixed:{DotsVisible:!0}})}}),a.type("pvc.LineChart",Fa.PointAbstract).add({_createPointPlot:function(){return new Fa.visual.PointPlot(this,{fixed:{LinesVisible:!0}})}}),a.type("pvc.AreaChart",Fa.PointAbstract).add({_createPointPlot:function(){return new Fa.visual.PointPlot(this,{fixed:{AreasVisible:!0}})}}),Fa.mStackedLineChart=a.type("pvc.StackedLineChart",Fa.PointAbstract).add({_createPointPlot:function(){return new Fa.visual.PointPlot(this,{fixed:{LinesVisible:!0,Stacked:!0}})}}),a.type("pvc.StackedDotChart",Fa.PointAbstract).add({_createPointPlot:function(){return new Fa.visual.PointPlot(this,{fixed:{DotsVisible:!0,Stacked:!0}})}}),Fa.mStackedAreaChart=a.type("pvc.StackedAreaChart",Fa.PointAbstract).add({_createPointPlot:function(){return new Fa.visual.PointPlot(this,{fixed:{AreasVisible:!0,Stacked:!0},defaults:{LinesVisible:!0}})}}),a.type("pvc.HeatGridPanel",Fa.CategoricalAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.axes.size=a._getAxis("size",c.option("SizeAxis")-1);var e=this.visualRoles,f=c.option("SizeRole");e.size=a.visualRole(f),this.useShapes=c.option("UseShapes"),this.shape=c.option("Shape"),this.nullShape=c.option("NullShape")}).add({defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){var b=this;b.base();var c=b._calcCellSize(),d=b.isOrientationVertical()?"bottom":"left",e=Fa.BasePanel.relativeAnchor[d],f=Fa.BasePanel.parallelLength[d],g=Fa.BasePanel.orthogonalLength[d],h=b.visualRoles.series.flatten(b.partData(),{visible:!0,isNull:!b.chart.options.ignoreNulls&&null}),i=b._buildScene(b.visibleData({ignoreNulls:!1}),h,c),j=i.isColorBound,k=i.isSizeBound,l=b._buildSignsWrapper(i),m=b.compatVersion()<=1,n=this.axes.base.scale,o=this.axes.ortho.scale,p=n.range().step,q=o.range().step,r=p/2,s=q/2,t=new Fa.visual.Panel(b,b.pvPanel).pvMark.data(i.childNodes)[d](function(a){return o(a.vars.series.value)-s})[g](q),u=["panel"];m&&u.push("");var v={extensionId:u,wrapper:l};if(!b.useShapes){var w=!1;a.copy(v,{noSelect:w,noHover:w,noClick:w,noDoubleClick:w,freeColor:w,noTooltip:m})}b.pvHeatGrid=new Fa.visual.Panel(b,t,v).pvMark.lock("data",function(a){return a.childNodes}).lock(e,function(a){return n(a.vars.category.value)-r}).lock(f,p).antialias(!1),b.shapes=b.useShapes?b._createShapesHeatMap(c,l,j,k):b._createNoShapesHeatMap(j),b.valuesVisible&&!b.valuesMask&&(b.valuesMask=b._getDefaultValuesMask(j,k));var x=Fa.visual.ValueLabel.maybeCreate(b,b.pvHeatGrid,{wrapper:l});x&&(b.pvHeatGridLabel=x.pvMark)},_calcCellSize:function(){var a=this.axes.x.scale,b=this.axes.y.scale,c=(a.max-a.min)/a.domain().length,d=(b.max-b.min)/b.domain().length;if(!this.isOrientationVertical()){var e=c;c=d,d=e}return{width:c,height:d}},_buildSignsWrapper:function(b){if(this.compatVersion()>1)return null;var c=a.query(b.childNodes).object({name:function(a){return""+a.vars.series.value},value:function(b){return a.query(b.childNodes).object({name:function(a){return""+a.vars.category.value},value:function(a){var b=a.vars.color;return b?""+b.value:null}})}});return function(a){return function(b){var d=c[b.vars.series.value],e=b.vars.category.rawValue,f=Object.create(this.parent),g=Object.create(this);g.parent=f;var h=b.childIndex(),i=b.parent.childIndex();return f.index=h,g.index=i,a.call(g,d,e)}}},_getDefaultValuesMask:function(a,b){var c=this.visualRoles,d=a?"color":b?"size":null;if(d){var e=c[d].firstDimensionName();return"{#"+e+"}"}},_createNoShapesHeatMap:function(a){var b=this._buildGetBaseFillColor(a);return this.pvHeatGrid.sign.override("defaultColor",function(a,c){return"stroke"===c?null:b.call(this.pvMark,a)}).override("interactiveColor",function(a,b,c){return a.isActive?b.alpha(.6):a.anySelected()&&!a.isSelected()?this.dimColor(b,c):this.base(a,b,c)}).override("dimColor",function(a){return Fa.toGrayScale(a,.6)}).pvMark.lineWidth(1.5)},_buildGetBaseFillColor:function(b){var c=this.axes.color;return b?c.sceneScale({sceneVarName:"color"}):a.fun.constant(c.option("Unbound"))},_createShapesHeatMap:function(b,c,d,e){var f=this,g=f._calcDotAreaRange(b);e&&f.axes.size.setScaleRange(g);var h={extensionId:"dot",freePosition:!0,activeSeriesAware:!1,wrapper:c,tooltipArgs:f._buildShapesTooltipArgs(d,e)},i=new Fa.visual.DotSizeColor(f,f.pvHeatGrid,h).override("dimColor",function(a){return Fa.toGrayScale(a,.6)}).pvMark;return e||i.sign.override("defaultSize",a.fun.constant(g.max)),i},_calcDotAreaRange:function(b){var c=b.width,d=b.height,e=Math.min(c,d)/2;"diamond"===this.shape&&(e/=Math.SQRT2),e-=2;var f=a.sqr(e),g=12,h=f-g;return 1>=h&&(f=Math.max(f,2),g=1,h=f-g,Fa.debug>=2&&this._warn("Using rescue mode dot area calculation due to insufficient space.")),{min:g,max:f,span:h}},_buildShapesTooltipArgs:function(a,b){var c=this.chart;if(this.compatVersion()<=1&&this.showsTooltip()){var d=c.options,e=d.customTooltip;e||(e=function(a,b,c){return null!=c&&void 0!==c[0]?c.join(", "):c});var f=this.visualRoles,g=f.series.grouping.dimensionNames(),h=f.category.grouping.dimensionNames();return{buildTooltip:d.isMultiValued?function(c){var f=c.scene.group;if(!f)return"";var i=Fa.data.Complex.values(f,g),j=Fa.data.Complex.values(f,h),k=[],l=c.scene.vars;return b&&(k[d.sizeValIdx||0]=l.size.value),a&&(k[d.colorValIdx||0]=l.color.value),e.call(d,i,j,k)}:function(b){var c=b.scene.vars,f=c.series.rawValue,g=c.category.rawValue,h=c[a?"color":"size"],i=h?h.value:null;return e.call(d,f,g,i)}}}},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(a,b,c){function d(a){var b=new Fa.visual.Scene(g,{source:a});b.vars.series=Ta.fromComplex(a),h.forEach(function(c){e.call(f,b,c,a)})}function e(b,c,d){var e=a.child(c.key).child(d.key),f=new Fa.visual.Scene(b,{source:e});f.vars.category=Ta.fromComplex(c),j.onNewScene(f,!0),k.onNewScene(f,!0)}var f=this,g=new Fa.visual.Scene(null,{panel:f,source:a}),h=a.childNodes,i=f.visualRoles,j=new Fa.visual.RoleVarHelper(g,i.color,{roleVar:"color"}),k=new Fa.visual.RoleVarHelper(g,i.size,{roleVar:"size"});return g.cellSize=c,b.children().each(d),g}}),a.type("pvc.HeatGridChart",Fa.CategoricalAbstract).add({_allowColorPerCategory:!0,_interpolatable:!1,_axisCreateIfUnbound:{color:!0},_processOptionsCore:function(b){this.base(b),a.set(b,"legend",!1,"panelSizeRatio",1);var c="value",d="value2";if(this.compatVersion()<=1){switch(this.options.colorValIdx){case 0:c="value";break;case 1:c="value2";break;default:c="value"}switch(this.options.sizeValIdx){case 0:d="value";break;case 1:d="value2";break;default:d="value"}}this._colorDimName=c,this._sizeDimName=d},_getCategoryRoleSpec:function(){var a=this.base();return a.requireIsDiscrete=!0,a},_getColorRoleSpec:function(){return{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:this._colorDimName}},_initVisualRoles:function(){this.base(),this._addVisualRole("size",{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:this._sizeDimName})},_initPlotsCore:function(){new Fa.visual.HeatGridPlot(this)},_createPlotPanels:function(a,b){var c=this.plots.heatGrid;this.heatGridChartPanel=new Fa.HeatGridPanel(this,a,c,Object.create(b))},defaults:{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],axisOffset:0,plotFrameVisible:!1,colorNormByCategory:!0,numSD:2}}),a.type("pvc.MetricXYAbstract",Fa.CartesianAbstract).add({_processOptionsCore:function(a){this.base(a),a.panelSizeRatio=1},_initVisualRoles:function(){this.base(),this._addVisualRole("x",{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"x",dimensionDefaults:{valueType:this.options.timeSeries?Date:Number}}),this._addVisualRole("y",{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"y",dimensionDefaults:{valueType:Number}})},_generateTrendsDataCell:function(b,c,d){function e(c){var d=function(a){return a.atoms[k].value},e=function(a){return a.atoms[l].value},f=c.datums().sort(null,d).array(),g=a.create(i,{rows:a.query(f),x:d,y:e}),h=j.model(g);h&&f.forEach(function(f,g){var j=d(f);if(j){var p=h.sample(j,e(f),g);if(null!=p){var q=a.set(Object.create(c.atoms),k,j,l,p,o,n);b.push(new Fa.data.TrendDatum(m.owner,q,i))}}})}var f=this._serRole,g=this.visualRoles.x,h=c.role,i=c.trend,j=i.info;this._warnSingleContinuousValueRole(h);var k=g.firstDimensionName(),l=h.firstDimensionName(),m=this.visibleData(c.dataPartValue,{baseData:d}),n=this._getTrendDataPartAtom(),o=n.dimension.name;(f.isBound()?m.children():a.query([m])).each(e,this)}}),a.type("pvc.data.MetricPointChartTranslationOper").add({_meaLayoutRoles:["x","y","color","size"],configureType:function(){var a=[],b=[];this.collectFreeDiscreteAndConstinuousIndexes(b,a);var c,d=[],e=a.length;if(e>0){for(var f=this._meaLayoutRoles.length,g=0;f>g&&d.length<e;)this._getUnboundRoleDefaultDimNames(this._meaLayoutRoles[g],1,d),g++;c=d.length,c>0&&(a.length=c,this.defReader({names:d,indexes:a}))}e=b.length,e>0&&(d.length=0,this._getUnboundRoleDefaultDimNames("series",e,d),c=d.length,c>0&&(b.length=c,this.defReader({names:d,indexes:b})))}}),a.type("pvc.MetricPointPanel",Fa.CartesianAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.axes.size=a._getAxis("size",(c.option("SizeAxis")||0)-1);var e=c.option("SizeRole");this.visualRoles.size=e?a.visualRole(e):null,this.linesVisible=c.option("LinesVisible"),this.dotsVisible=c.option("DotsVisible"),this.linesVisible||this.dotsVisible||(this.linesVisible=!0,c.option.specify({LinesVisible:!0})),this.offsetPaddings||(this.offsetPaddings=new Ja(.01))}).add({sizeAxisRatio:.2,sizeAxisRatioTo:"minWidthHeight",autoPaddingByDotSize:!0,_v1DimRoleName:{category:"x",value:"y"},_creating:function(){var c=this.defaultLegendGroupScene();if(c&&!c.hasRenderer()){var d=c.colorAxis,e=a.nullyTo(d.option("LegendDrawMarker",!0),this.dotsVisible),f=a.nullyTo(d.option("LegendDrawLine",!0),this.linesVisible);if(e||f){var g={drawMarker:e,drawRule:f};e&&(g.markerShape=d.option("LegendShape",!0)||"circle",g.markerPvProto=(new b.Dot).lineWidth(1.5,Fa.extensionTag).shapeSize(12,Fa.extensionTag),this.extend(g.markerPvProto,"dot",{constOnly:!0})),f&&(g.rulePvProto=(new b.Line).lineWidth(1.5,Fa.extensionTag),this.extend(g.rulePvProto,"line",{constOnly:!0})),c.renderer(new Fa.visual.legend.BulletItemDefaultRenderer(g))}}},_getRootScene:function(){return a.lazy(this,"_rootScene",this._buildScene,this)},_calcLayout:function(a){var b=this._getRootScene();b.isSizeBound&&this.axes.size.setScaleRange(this._calcDotAreaRange(a)),this._calcAxesPadding(a,b)},_getDotDiameterRefLength:function(b){var c=b.clientSize,d=b.paddings;switch(this.sizeAxisRatioTo){case"minWidthHeight":return Math.min(c.width+d.width,c.height+d.height);case"width":return c.width+d.width;case"height":return c.height+d.height}return Fa.debug>=2&&this._log(a.format("Invalid option 'sizeAxisRatioTo' value. Assuming 'minWidthHeight'.",[this.sizeAxisRatioTo])),this.sizeRatioTo="minWidthHeight",this._getDotDiameterRefLength(b)},_calcDotRadiusRange:function(a){var b=this._getDotDiameterRefLength(a),c=this.sizeAxisRatio/2*b,d=Math.sqrt(12);return{min:d,max:c}},_calcDotAreaRange:function(b){var c=this._calcDotRadiusRange(b);"diamond"===this.shape&&(c.max/=Math.SQRT2,c.min/=Math.SQRT2);var d=a.sqr(c.max),e=a.sqr(c.min),f=d-e;return 1>=f&&(d=Math.max(d,2),e=1,f=d-e,c={min:Math.sqrt(e),max:Math.sqrt(d)},Fa.debug>=3&&this._log("Using rescue mode dot area calculation due to insufficient space.")),{min:e,max:d,span:f}},_calcAxesPadding:function(b,c){var d;if(this.autoPaddingByDotSize){var e=this.axes,f=b.clientSize,g=b.paddings;d={},e.x.setScaleRange(f.width),e.y.setScaleRange(f.height);var h=this.isOrientationVertical(),i=e.x.sceneScale({sceneVarName:h?"x":"y"}),j=e.y.sceneScale({sceneVarName:h?"y":"x"}),k=e.x.scale.max,l=e.y.scale.max,m=c.isSizeBound,n=m?e.size.scale:null;if(!n){var o=a.number.as(this._getExtension("dot","shapeRadius"),0);0>=o?(o=a.number.as(this._getExtension("dot","shapeSize"),0),0>=o&&(o=12)):o=a.sqr(o),n=a.fun.constant(o)}d={};var p;this.offsetPaddings&&(p={},Ja.names.forEach(function(a){var b=Fa.BasePanel.orthogonalLength[a];p[a]=(this.offsetPaddings[a]||0)*(f[b]+g[b])},this));var q=function(a,b){p&&(b+=p[a]||0),0>b&&(b=0);var c=d[a];(null==c||b>c)&&(d[a]=b)},r=function(a){var b=i(a),c=j(a),d=Math.sqrt(n(m?a.vars.size.value:0));q("left",d-b),q("bottom",d-c),q("right",b+d-k),q("top",c+d-l)};c.children().selectMany(function(a){return a.childNodes}).each(r)}else d=this._calcRequestPaddings(b);b.requestPaddings=d},_createCore:function(){var b=this;b.base();var c=b.chart,d=b._getRootScene(),e=b._buildSignsWrapper(),f=b.compatVersion()<=1;this._finalizeScene(d),b.pvPanel.zOrder(1),this.pvScatterPanel=new Fa.visual.Panel(b,b.pvPanel,{extensionId:"panel"}).lock("data",d.childNodes).pvMark;var g=c.selectableByFocusWindow(),h=d.isColorBound&&this.visualRoles.color.isDiscrete(),i=new Fa.visual.Line(b,b.pvScatterPanel,{extensionId:"line",wrapper:e,noTooltip:!1,noSelect:g,showsSelection:!g}).lockMark("data",function(a){return a.childNodes}).intercept("visible",function(a){if(!b.linesVisible)return!1;var c=this.delegateExtension();return null==c&&(c=!a.isNull&&(!d.isSizeBound&&!d.isColorBound||d.isSizeBound&&null!=a.vars.size.value||d.isColorBound&&(h||null!=a.vars.color.value))),c}).override("x",function(a){return a.basePosition}).override("y",function(a){return a.orthoPosition});b.pvLine=i.pvMark;var j=new Fa.visual.DotSizeColor(b,b.pvLine,{extensionId:"dot",wrapper:e,activeSeriesAware:b.linesVisible}).override("x",function(a){return a.basePosition}).override("y",function(a){return a.orthoPosition}).override("color",function(a,c){return b.dotsVisible||a.isActive||a.isSingle?this.base(a,c):Fa.invisibleFill});if(d.isSizeBound?b.autoPaddingByDotSize&&"minWidthHeight"===b.sizeAxisRatioTo||b.pvPanel.borderPanel.overflow("hidden"):j.override("baseSize",function(c){if(!b.dotsVisible&&c.isSingle){var d=Math.max(b.pvLine.scene[this.pvMark.index].lineWidth,.2)/2;return a.sqr(d)}return this.base(c)}),b.pvDot=j.pvMark,b.pvDot.rubberBandSelectionMode="center",Fa.visual.ValueLabel.isNeeded(b)){var k=["label"];f&&k.push("lineLabel");var l=Fa.visual.ValueLabel.maybeCreate(b,b.pvDot,{extensionId:k,wrapper:e});l&&(b.pvHeatGridLabel=l.pvMark)}},_buildSignsWrapper:function(){return this.compatVersion()>1?null:function(a){return function(b){var c={category:b.vars.x.rawValue,value:b.vars.y.rawValue},d=Object.create(this);return d.index=b.dataIndex,a.call(d,c)}}},renderInteractive:function(){this.pvScatterPanel.render()},_buildScene:function(){function a(a){var b=new Fa.visual.Scene(e,{source:a});b.vars.series=Ta.fromComplex(a),g.onNewScene(b,!1),a.datums().each(function(a,c){var d=a.atoms[i.name];if(null!=d.value){var e=a.atoms[j.name];if(null!=e.value){var f=new Fa.visual.Scene(b,{source:a});f.dataIndex=c,f.vars.x=Ta.fromAtom(d),f.vars.y=Ta.fromAtom(e),h.onNewScene(f,!0),g.onNewScene(f,!0),f.isIntermediate=!1}}})}function b(a){for(var b,d=a.childNodes,e=0,f=0,g=d.length;g>e;e++,f++){var h=d[f];if(h.isSingle=!b&&!h.nextSibling,b){var i=c(a,b,h,f);i&&f++}b=h}}function c(a,b,c,d){var e=+c.vars.y.value,f=+b.vars.y.value,k=+c.vars.x.value,l=+b.vars.x.value,m=j.type.cast.call(null,(e+f)/2),n=i.type.cast.call(null,(k+l)/2),o=new Fa.visual.Scene(a,{index:d,source:c.datum});return o.dataIndex=c.dataIndex,o.vars.x=new Ta(n,i.format(n),n),o.vars.y=new Ta(m,j.format(m),m),h.onNewScene(o,!0),g.onNewScene(o,!0),o.ownerScene=c,o.isIntermediate=!0,o.isSingle=!1,o}var d=this.visibleData({ignoreNulls:!1}),e=new Fa.visual.Scene(null,{panel:this,source:d}),f=this.visualRoles,g=(this.axes,new Fa.visual.RoleVarHelper(e,f.color,{roleVar:"color"})),h=new Fa.visual.RoleVarHelper(e,f.size,{roleVar:"size"}),i=d.owner.dimensions(f.x.firstDimensionName()),j=d.owner.dimensions(f.y.firstDimensionName());return d.children().each(a,this),e.children().each(b,this),e},_finalizeScene:function(a){var b=this.axes,c=b.base.sceneScale({sceneVarName:"x"}),d=b.ortho.sceneScale({sceneVarName:"y"});return a.children().selectMany(function(a){return a.childNodes}).each(function(a){a.basePosition=c(a),a.orthoPosition=d(a)}),a}}),a.type("pvc.MetricPointAbstract",Fa.MetricXYAbstract).add({_trendable:!0,_initPlotsCore:function(){var a=this._createPointPlot(),b=a.option("Trend");(this._trendable=!!b)&&new Fa.visual.MetricPointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",NullInterpolatioMode:"none",ColorRole:"series",SizeRole:null,SizeAxis:null,OrthoAxis:1},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!1}})},_hasDataPartRole:function(){return!0},_getColorRoleSpec:function(){return{defaultSourceRole:"series",defaultDimension:"color*",dimensionDefaults:{valueType:Number}}},_initVisualRoles:function(){this.base(),this._addVisualRole("size",{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"size",dimensionDefaults:{valueType:Number}})},_getTranslationClass:function(b){return a.type(this.base(b)).add(Fa.data.MetricPointChartTranslationOper)},_createPlotPanels:function(b,c){var d=this.options,e=a.set(Object.create(c),"sizeAxisRatio",d.sizeAxisRatio,"sizeAxisRatioTo",d.sizeAxisRatioTo,"autoPaddingByDotSize",d.autoPaddingByDotSize),f=this.plots.scatter;this.scatterChartPanel=new Fa.MetricPointPanel(this,b,f,e);var g=this.plots.trend;g&&new Fa.MetricPointPanel(this,b,g,Object.create(e))},defaults:{axisOriginIsZero:!1,tooltipOffset:10}}),a.type("pvc.MetricDotChart",Fa.MetricPointAbstract).add({_createPointPlot:function(){return new Fa.visual.MetricPointPlot(this,{fixed:{DotsVisible:!0}})}}),a.type("pvc.MetricLineChart",Fa.MetricPointAbstract).add({_createPointPlot:function(){return new Fa.visual.MetricPointPlot(this,{fixed:{LinesVisible:!0}})}}),a.type("pvc.BulletChart",Fa.BaseChart).init(function(a){a=a||{};var b=a.dimensionGroups||(a.dimensionGroups={}),c=b.range||(b.range={});void 0===c.valueType&&(c.valueType=Number);var d=b.marker||(b.marker={});void 0===d.valueType&&(d.valueType=Number),this.base(a)}).add({bulletChartPanel:null,allowNoData:!0,_processOptionsCore:function(a){a.legend=!1,a.selectable=!1,this.base(a)},_initVisualRoles:function(){this.base(),this._addVisualRole("title",{defaultDimension:"title*"}),this._addVisualRole("subTitle",{defaultDimension:"subTitle*"}),this._addVisualRole("value",{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value*"}),this._addVisualRole("marker",{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"marker*"}),this._addVisualRole("range",{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"range*"})},_createTranslation:function(a){var c=this.base(a),d=c.virtualItemSize();
if(d)switch(d){case 1:c.defReader({names:"value"});break;case 2:c.defReader({names:["title","value"]});break;case 3:c.defReader({names:["title","value","marker"]});break;default:c.defReader({names:["title","subTitle","value","marker"]}),d>4&&c.defReader({names:"range",indexes:b.range(4,d)})}return c},_initPlotsCore:function(){new Fa.visual.BulletPlot(this)},_createContent:function(a){var b=this.plots.bullet;this.bulletChartPanel=new Fa.BulletChartPanel(this,this.basePanel,b,a)},defaults:{compatVersion:1,orientation:"horizontal",bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Title",bulletSubtitle:"",bulletTitlePosition:"left",tooltipFormat:function(a,b,c){return this.chart.options.valueFormat(c)},crosstabMode:!1,seriesInRows:!1}}),a.type("pvc.BulletChartPanel",Fa.PlotPanel).add({pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,_createCore:function(a){var c,d,e,f,g,h,i,j,k,l=this.chart,m=l.options,n=this.buildData(),o="horizontal"==m.orientation?"left":"bottom";if("horizontal"==m.orientation){switch(c=a.clientSize.width-this.chart.options.bulletMargin-20,d=0,m.bulletTitlePosition){case"top":i=this.chart.options.bulletMargin,f=0,e="left",g=-12,k=parseInt(m.titleSize/2,10);break;case"bottom":i=this.chart.options.bulletMargin,f=0,e="left",g=m.bulletSize+32,k=0;break;case"right":i=5,f=c+5,e="left",g=parseInt(m.bulletSize/2,10),k=0;break;case"left":default:i=this.chart.options.bulletMargin,f=0,g=parseInt(m.bulletSize/2,10),e="right",k=0}h="bottom",j=function(){return this.index*(m.bulletSize+m.bulletSpacing)+k}}else{switch(c=a.clientSize.height-this.chart.options.bulletMargin-20,m.bulletTitlePosition){case"top":i=this.chart.options.bulletMargin,f=0,e="left",g=-20,d=0,j=void 0;break;case"bottom":i=this.chart.options.bulletMargin,f=0,e="left",g=c+20,d=0,j=20;break;case"right":i=5,f=this.chart.options.bulletSize+40,e="left",g=c,d=-Math.PI/2,j=void 0;break;case"left":default:i=this.chart.options.bulletMargin,f=-12,g=this.height-this.chart.options.bulletMargin-20,e="left",d=-Math.PI/2,j=void 0}h="right",i=function(){return m.bulletMargin+this.index*(m.bulletSize+m.bulletSpacing)}}if(this.pvBullets=this.pvPanel.add(b.Panel).data(n)[Fa.BasePanel.orthogonalLength[o]](c)[Fa.BasePanel.parallelLength[o]](this.chart.options.bulletSize).margin(20).left(i).top(j),this.pvBullet=this.pvBullets.add(b.Layout.Bullet).orient(o).ranges(function(a){return a.ranges}).measures(function(a){return a.measures}).markers(function(a){return a.markers}),l.clickable()&&this.clickAction){var p=this;this.pvBullet.cursor("pointer").event("click",function(a){var c=a.title,d=a.subtitle,e=b.event;return p.clickAction(c,d,a.measures,e)})}if(this.pvBulletRange=this.pvBullet.range.add(b.Bar),this.pvBulletMeasure=this.pvBullet.measure.add(b.Bar).text(function(a,b){return b.formattedMeasures[this.index]}),this.pvBulletMarker=this.pvBullet.marker.add(b.Dot).shape("square").fillStyle("white").text(function(a,b){return b.formattedMarkers[this.index]}),this.showsTooltip()){var q=this;this.pvBulletMeasure.localProperty("tooltip").tooltip(function(a,b){var c=b.title,d=b.subtitle;return l.options.tooltipFormat.call(q,c,d,a)}),this.pvBulletMarker.localProperty("tooltip").tooltip(function(a,b){var c=b.title,d=b.subtitle;return l.options.tooltipFormat.call(q,c,d,a)}),this.pvBulletMeasure.event("mouseover",b.Behavior.tipsy(this.chart._tooltipOptions)),this.pvBulletMarker.event("mouseover",b.Behavior.tipsy(this.chart._tooltipOptions))}this.pvBulletRule=this.pvBullet.tick.add(b.Rule),this.pvBulletRuleLabel=this.pvBulletRule.anchor(h).add(b.Label).text(this.pvBullet.x.tickFormat),this.pvBulletTitle=this.pvBullet.anchor(o).add(b.Label).font("bold 12px sans-serif").textAngle(d).left(-10).textAlign(e).textBaseline("bottom").left(f).top(g).text(function(a){return a.formattedTitle}),this.pvBulletSubtitle=this.pvBullet.anchor(o).add(b.Label).textStyle("#666").textAngle(d).textAlign(e).textBaseline("top").left(f).top(g).text(function(a){return a.formattedSubtitle});var r="function"==typeof m.axisDoubleClickAction?function(a,b){m.axisDoubleClickAction(a,b)}:null;l.doubleClickable()&&r&&(this.pvBulletTitle.cursor("pointer").events("all").event("dblclick",function(a){r(a,arguments[arguments.length-1])}),this.pvBulletSubtitle.cursor("pointer").events("all").event("dblclick",function(a){r(a,arguments[arguments.length-1])}))},applyExtensions:function(){this.base(),this.extend(this.pvBullets,"bulletsPanel"),this.extend(this.pvBullet,"bulletPanel"),this.extend(this.pvBulletRange,"bulletRange"),this.extend(this.pvBulletMeasure,"bulletMeasure"),this.extend(this.pvBulletMarker,"bulletMarker"),this.extend(this.pvBulletRule,"bulletRule"),this.extend(this.pvBulletRuleLabel,"bulletRuleLabel"),this.extend(this.pvBulletTitle,"bulletTitle"),this.extend(this.pvBulletSubtitle,"bulletSubtitle")},_getExtensionId:function(){return[{abs:"content"}].concat(this.base())},buildData:function(){var b,c=this.chart,d=c.options,e=c.visualRoles.title,f=e.grouping,g=c.visualRoles.subTitle,h=g.grouping,i=c.visualRoles.value,j=i.grouping,k=c.visualRoles.marker,l=k.grouping,m=c.visualRoles.range,n=m.grouping,o={title:d.bulletTitle,formattedTitle:d.bulletTitle,subtitle:d.bulletSubtitle,formattedSubtitle:d.bulletSubtitle,ranges:a.array.to(d.bulletRanges)||[],measures:a.array.to(d.bulletMeasures)||[],markers:a.array.to(d.bulletMarkers)||[]};return a.set(o,"formattedRanges",o.ranges.map(String),"formattedMeasures",o.measures.map(String),"formattedMarkers",o.markers.map(String)),b=j||f||l||h||n?c.data.datums().select(function(a){var b,c=Object.create(o);return j&&(b=j.view(a),c.measures=b.values(),c.formattedMeasures=b.labels()),f&&(b=f.view(a),c.title=b.value,c.formattedTitle=b.label),h&&(b=h.view(a),c.subtitle=b.value,c.formattedSubtitle=b.label),l&&(b=l.view(a),c.markers=b.values(),c.formattedMarkers=b.labels()),n&&(b=n.view(a),c.ranges=b.values(),c.formattedRanges=b.labels()),c},this).array():[o]}}),a.type("pvc.ParallelCoordinates",Fa.BaseChart).init(function(a){a=a||{},a.dimensions=a.dimensions||{},a.dimensions.value||(a.dimensions.value={valueType:null}),this.base(a)}).add({parCoordPanel:null,_createContent:function(b){this.parCoordPanel=new Fa.ParCoordPanel(this,this.basePanel,a.create(b,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}))},defaults:a.create(Fa.BaseChart.prototype.defaults,{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:!0,mapAllDimensions:!0,numDigits:0})}),a.type("pvc.ParCoordPanel",Fa.BasePanel).add({anchor:"fill",pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var a=this.chart.data,b=this.chart.options.numDigits;this.dimensions=a.getVisibleCategories();var c=a.getValues(),d=a.getVisibleSeriesIndexes(),e=a.getVisibleCategoriesIndexes(),f=a.getCategories(),g=e.map(this.chart.options.mapAllDimensions?function(a){return isNaN(c[a][0])?{categorical:!0,len:0,map:[]}:{categorical:!1,len:0,map:[],displayValue:[]}}:function(a){return isNaN(c[a][0])?{categorical:!0,len:0,map:[]}:null}),h=function(a,c){var d=g[a],e=null;if(d.categorical)e=d.map[c],null==e&&(e=d.len,d.len++,d.map[c]=e);else{var f=c.toFixed(b);e=d.map[f],null==e&&(e=d.len,d.len++,d.map[f]=e,d.displayValue[f]=c)}return e};for(var i in g)g.hasOwnProperty(i)&&g[i]&&g[i].categorical&&(g[i].displayValue=g[i].map);var j,k,l;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions)for(j=0;j<g.length;j++)if(g[j]){for(var m=0;m<c[j].length;m++)h(j,c[j][m]);var n=g[j].map,o=[];for(k in n)n.hasOwnProperty(k)&&o.push(k);if(o.sort(),g[j].categorical)for(l=0;l<o.length;l++)n[o[l]]=l;else for(l=0;l<o.length;l++)n[o[l]].index=l}var p=function(a){var b={};for(var d in e)e.hasOwnProperty(d)&&(b[f[d]]=g[d]?h(d,c[d][a]):c[d][a]);return b};this.data=d.map(function(a){return p(a)});var q=this.dimensions.map(function(a){var b={},c=a.split("__");return b.id=a,b.name=c[0],b.unit=c.length>1?c[1]:"",b});for(j=0;j<q.length;j++){k=q[j];var r=e[j];k.orgRowIndex=r;var s,t,u,v,w,x=c[r].length;if(g[r])for(s=t=u=v=g[r].displayValue[c[r][0]],l=1;x>l;l++)w=g[r].displayValue[c[r][l]],s>w&&(u=s,s=w),w>t&&(v=t,t=w);else for(s=t=u=v=c[r][0],l=1;x>l;l++)w=c[r][l],s>w&&(u=s,s=w),w>t&&(v=t,t=w);var y=(t-v+(u-s))/2;if(k.min=s,k.max=t,k.step=y,k.categorical=!1,g[r]&&(k.map=g[r].map,k.mapLength=g[r].len,k.categorical=g[r].categorical,!k.categorical)){k.orgValue=[];var z=g[r].map;for(var A in z)z.hasOwnProperty(A)&&(k.orgValue[z[A]]=0+A)}}var B=function(a,b){for(var c={},d=0;d<a.length;d++)c[a[d]]=b[d];return c};this.dimensionDescr=B(this.dimensions,q)},_createCore:function(){function a(a){var b=a.dim;return v[b].min=Math.max(t[b].domain()[0],t[b].invert(e-a.y-a.dy)),v[b].max=Math.min(t[b].domain()[1],t[b].invert(e-a.y)),w=b,G.render(),!1}function c(a){if(a.dy<3){var b=a.dim;v[b].min=Math.max(t[b].domain()[0],t[b].invert(0)),v[b].max=Math.min(t[b].domain()[1],t[b].invert(e)),a.y=h,a.dy=l,w=b,G.render()}return!1}var d=this;this.retrieveData();var e=this.height,f=this.chart.options.numDigits,g=this.chart.options.topRuleOffset,h=this.chart.options.botRuleOffset,i=this.chart.options.leftRuleOffset,j=this.width-this.chart.options.rightRuleOffset,k=this.height-g,l=k-h,m=g-12,n=this.dimensions,o=this.dimensionDescr,p=function(a,c){var d=o[a].min,e=o[a].max,f=o[a].step;return c&&(d-=f,e+=f),b.Scale.linear(d,e).range(h,k)},q=function(a){var b=p(a,!0).range(h,k),c=o[a];if(c.orgValue&&!c.categorical){var d=function(a){var d=b(c.orgValue[a]);return d};return d.domain=function(){return b.domain()},d.invert=function(a){return b.invert(a)},d}return b},r=function(a){var b=p(a,!1).range("steelblue","brown");return b},s=b.Scale.ordinal(n).splitFlush(i,j),t=b.dict(n,q),u=b.dict(n,r),v=b.dict(n,function(a){return{min:t[a].domain()[0],max:t[a].domain()[1]}}),w=n[0],x=this.chart.options.mapAllDimensions?function(a){return n.every(function(b){var c=o[b],d=c.orgValue&&!c.categorical?c.orgValue[a[b]]:a[b];return d>=v[b].min&&d<=v[b].max})}:function(a){return n.every(function(b){return a[b]>=v[b].min&&a[b]<=v[b].max})};this.pvParCoord=this.pvPanel.add(b.Panel).data(d.data).visible(x).add(b.Line).data(n).left(function(a){return s(a)}).bottom(function(a,b){var c=t[a](b[a]);return c}).strokeStyle("#ddd").lineWidth(1).antialias(!1);var y=this.pvPanel.add(b.Rule).data(n).left(s).top(g).bottom(h);y.anchor("top").add(b.Label).top(m).font("bold 10px sans-serif").text(function(a){return o[a].name});var z=[],A=6,B=3;for(var C in o)if(o.hasOwnProperty(C)){var D=o[C];if(D.categorical){var E=s(D.id)+A;for(var F in D.map)D.map.hasOwnProperty(F)&&(z[z.length]={x:E,y:t[D.id](D.map[F])+B,label:F})}}var G=(this.pvPanel.add(b.Panel).data(z).add(b.Label).left(function(a){return a.x}).bottom(function(a){return a.y}).text(function(a){return a.label}).textAlign("left"),this.pvPanel.add(b.Panel)),H=(G.add(b.Panel).data(d.data).visible(x).add(b.Line).data(n).left(function(a){return s(a)}).bottom(function(a,b){return t[a](b[a])}).strokeStyle(function(a,b){var c=o[w],d=c.orgValue&&!c.categorical?c.orgValue[b[w]]:b[w];return u[w](d)}).lineWidth(1),G.add(b.Panel).data(n.map(function(a){return{y:h,dy:l,dim:a}})).left(function(a){return s(a.dim)-30}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",b.Behavior.select()).event("select",a).event("selectend",c).add(b.Bar).left(25).top(function(a){return a.y}).width(10).height(function(a){return a.dy}).fillStyle(function(a){return a.dim==w?u[a.dim]((v[a.dim].max+v[a.dim].min)/2):"hsla(0,0,50%,.5)"}).strokeStyle("white").cursor("move").event("mousedown",b.Behavior.drag()).event("dragstart",a).event("drag",a));H.anchor("bottom").add(b.Label).textBaseline("top").text(function(a){return o[a.dim].categorical?"":v[a.dim].min.toFixed(f)+o[a.dim].unit}),H.anchor("top").add(b.Label).textBaseline("bottom").text(function(a){return o[a.dim].categorical?"":v[a.dim].max.toFixed(f)+o[a.dim].unit}),this.extend(this.pvParCoord,"parCoord"),this.extend(this.pvPanel,"chart")}}),a.type("pvc.DataTree",Fa.BaseChart).init(function(a){a=a||{},a.dimensionGroups=a.dimensionGroups||{},a.dimensionGroups.value||(a.dimensionGroups.value={valueType:null}),this.base(a)}).add({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,_getColorRoleSpec:function(){return{isRequired:!0,defaultSourceRole:"category",requireIsDiscrete:!0}},setStructData:function(a){this.structDataset=a.resultset,this.structDataset.length||this._log("Warning: Structure-dataset is empty"),this.structMetadata=a.metadata,this.structMetadata.length||this._log("Warning: Structure-Metadata is empty")},_createContent:function(b){var c=this.structEngine,d=c?c.type:new Fa.data.ComplexType;d.addDimension("value",{});var e={seriesInRows:!0,crosstabMode:!0},f=new Fa.data.CrosstabTranslationOper(d,this.structDataset,this.structMetadata,e);f.configureType(),c||(c=this.structEngine=new Fa.data.Data({type:d})),c.load(f.execute(c)),Fa.debug>=3&&this._log(this.structEngine.getInfo()),this.dataTreePanel=new Fa.DataTreePanel(this,this.basePanel,a.create(b,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,minAspectRatio:this.options.minAspectRatio}))},defaults:{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:!1,numDigits:0,connectorSpace:.15,minVerticalSpace:.05,minAspectRatio:2}}),a.type("pvc.DataTreePanel",Fa.PlotPanel).add({pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(a){this.hRules=[],this.vRules=[],this.rules=[];for(var b in this.structMap){var c=this.structMap[b];if(null!=c.children){var d=1e4,e=-1e4,f=c.left+c.width;this.hRules.push({left:f,width:a,bottom:c.bottom+c.height/2}),f+=a;for(var g in c.children){var h=this.structMap[c.children[g]],i=h.bottom+h.height/2;i>e&&(e=i),d>i&&(d=i),this.hRules.push({left:f,width:h.left-f,bottom:i})}e>d&&this.vRules.push({left:f,bottom:d,height:e-d})}}},generateLineSegment:function(a,b,c,d){var e=[];e.push({x:a,y:b}),e.push({x:c,y:d}),this.rules.push(e)},generateConnectors:function(a){if(this.hRules=[],this.vRules=[],this.chart.options.perpConnector)this.generatePerpConnectors(a);else{this.rules=[];for(var b in this.structMap){var c=this.structMap[b];if(null!=c.children){var d,e,f,g=1e4,h=-1e4;for(f in c.children)e=this.structMap[c.children[f]],d=e.bottom+e.height/2,d>h&&(h=d),g>d&&(g=d);var i=(h+g)/2,j=c.left+c.width,k=j+a;this.generateLineSegment(j,c.bottom+c.height/2,k,i);for(f in c.children)e=this.structMap[c.children[f]],d=e.bottom+e.height/2,this.generateLineSegment(k,i,e.left,d)}}}},retrieveStructure:function(){var a=this.chart.structEngine,b=this.chart.options,c=a.getVisibleCategories();this.treeElements=a.getVisibleSeries();var d,e=a.getValues(),f=c.length>4;for(d in this.treeElements)this.treeElements[d]=$.trim(this.treeElements[d]);var g=[];g.getElement=function(a){return null==g[a]&&(g[a]={min:1e4,max:-1e4}),g[a]},g.addValue=function(a,b){var c=g.getElement(a);return b<c.min&&(c.min=b),b>c.max&&(c.max=b),c};var h,i,j,k;for(d in this.treeElements)j=this.treeElements[d],h=j[0],i=h.charCodeAt(0),k=parseInt(j.slice(1),10),g.addValue("__cols",i),g.addValue(h,k);var l=g.getElement("__cols"),m=this.innerWidth/(l.max-l.min+1),n=b.connectorSpace*m,o=m-n,p=o/b.minAspectRatio,q=l.min;delete g.__cols;for(d in g)if(l=g[d],"function"!=typeof l){var r=l.max-l.min+1;l.gridHeight=this.innerHeight/r,l.cellHeight=l.gridHeight*(1-b.minVerticalSpace),l.cellHeight>p&&(l.cellHeight=p),l.relBottom=(l.gridHeight-l.cellHeight)/2,l.numRows=r}var s=new RegExp("[\\s\"']+","g");this.structMap={};for(d in this.treeElements){var t={};j=this.treeElements[d],t.box_id=j,this.structMap[j]=t,h=j[0],i=h.charCodeAt(0),k=parseInt(j.slice(1),10),l=g.getElement(h),t.colIndex=i-q,t.rowIndex=l.numRows-(k-l.min)-1,t.left=this.leftOffs+t.colIndex*m,t.width=o,f?(t.bottom=e[4][d],t.height=e[5][d]):(t.bottom=this.botOffs+t.rowIndex*l.gridHeight+l.relBottom,t.height=l.cellHeight),t.label=e[0][d],t.selector=e[1][d],t.aggregation=e[2][d];var u=(e[3][d]||"").replace(s," ");t.children=" "===u||""===u?null:u.split(" ")}this.generateConnectors((m-o)/2),this.structArr=[];for(d in this.structMap)j=this.structMap[d],this.structArr.push(j)},findDataValue:function(a,b){for(var c=0;c<b[0].length;c++)if(b[0][c]==a)return b[1][c];this._log("Error: value with key : "+a+" not found.")},generateBoxPlots:function(){var a=this.chart.options;for(var c in this.structArr){var d=this.structArr[c];if(d.values.length){d.subplot={};var e=d.subplot,f=[],g=15,h=d.width/6;e.hRules=[],e.vRules=[],e.marks=[],e.labels=[],f.push(this.findDataValue("_p5",d.values)),f.push(this.findDataValue("_p25",d.values)),f.push(this.findDataValue("_p50",d.values)),f.push(this.findDataValue("_p75",d.values)),f.push(this.findDataValue("_p95",d.values));var i=!1;if("undefined"!=typeof f[2]){f[4]<f[0]&&(f=f.reverse(),this._log(" dataset "+d.box_id+" repaired (_p95 was smaller than _p5)")),f[4]>f[0]?e.hScale=b.Scale.linear(f[0],f[4]):(i=!0,e.hScale=b.Scale.linear(f[0]-1e-10,f[0]+1e-10)),e.hScale.range(d.left+h,d.left+d.width-h);var j,k=""+f[2];for(j=0;j<f.length;j++)f[j]=e.hScale(f[j]);e.bot=d.bottom+d.height/3,e.top=d.bottom+2*d.height/3,e.mid=(e.top+e.bot)/2,e.textBottom=d.bottom+g,e.textBottom=e.bot-a.valueFontsize-1;var l=3;if(i)e.vRules.push({left:f[0],bottom:e.bot,lWidth:l,height:e.top-e.bot});else for(e.hRules.push({left:f[0],width:f[1]-f[0],lWidth:1,bottom:e.mid}),e.hRules.push({left:f[1],width:f[3]-f[1],lWidth:1,bottom:e.bot}),e.hRules.push({left:f[1],width:f[3]-f[1],lWidth:1,bottom:e.top}),e.hRules.push({left:f[3],width:f[4]-f[3],lWidth:1,bottom:e.mid}),j=0;j<f.length;j++)e.vRules.push({left:f[j],bottom:e.bot,lWidth:2==j?l:1,height:e.top-e.bot});e.labels.push({left:f[2],bottom:e.textBottom,text:this.labelFixedDigits(k),size:a.smValueFont,color:a.boxplotColor})}}}},labelFixedDigits:function(a){if("string"==typeof a&&(a=parseFloat(a)),"number"==typeof a){var b=this.chart.options.numDigits;a=a.toFixed(b)}return""+a},addDataPoint:function(a){var b=this.chart.options;for(var c in this.structArr){var d=this.structArr[c];if(d.values.length){var e=this.findDataValue(a,d.values);if("undefined"!=typeof e){var f=d.subplot,g=f.hScale(e),h="green";f.marks.push({left:g,bottom:f.mid,color:h}),f.labels.push({left:g,bottom:f.textBottom,text:this.labelFixedDigits(e),size:b.valueFont,color:h})}}}},retrieveData:function(){var a,b=this.chart.data,c=this.chart.options,d=(b.getVisibleCategories(),b.getVisibleSeries()),e=b.getValues(),f={},g=e.length;for(var h in this.structArr){var i=this.structArr[h];for(i.values=[],a=0;g>a;a++)i.values.push([]);f[i.selector]=i}var j={};for(a in d){var k=f[d[a]];if("undefined"!=typeof k)for(var l in e)k.values[l].push(e[l][a]);else j[d[a]]=!0}for(var m in j)this._log("Could'nt find box for selector: "+m);this.generateBoxPlots();var n=new RegExp("[\\s\"']+","g");if(c.selectParam){var o=c.selectParam.replace(n,"");"undefined"!=o&&o.length>0&&"undefined"!=typeof window[o]&&(o=window[o],this.addDataPoint(o))}},_createCore:function(){var a=this,c=this.chart.options;c.smValueFontsize=Math.round(.6*c.valueFontsize),c.smValueFont=""+c.smValueFontsize+"px sans-serif",c.valueFont=""+c.valueFontsize+"px sans-serif";var d=c.topRuleOffset,e=c.botRuleOffset,f=c.leftRuleOffset;this.innerWidth=this.width-f-c.rightRuleOffset,this.innerHeight=this.height-d-e,this.botOffs=e,this.leftOffs=f,this.retrieveStructure(),this.retrieveData();var g,h=c.headerFontsize+3,i=this.rules;for(g=0;g<i.length;g++)this.pvPanel.add(b.Line).data(i[g]).left(function(a){return a.x}).bottom(function(a){return a.y}).lineWidth(1).strokeStyle("black");for(this.pvDataTree=this.pvPanel.add(b.Bar).data(a.structArr).left(function(a){return a.left}).bottom(function(a){return a.bottom}).height(function(a){return a.height}).width(function(a){return a.width}).fillStyle("green").add(b.Bar).left(function(a){return a.left+c.border}).bottom(function(a){return a.bottom+c.border}).height(function(a){return a.height-c.border-h}).width(function(a){return a.width-2*c.border}).fillStyle("white").add(b.Label).text(function(a){return a.label}).textAlign("center").left(function(a){return a.left+a.width/2}).bottom(function(a){return a.bottom+a.height-c.headerFontsize-5+c.headerFontsize/5}).font(""+c.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue"),g=0;g<this.structArr.length;g++){var j=this.structArr[g];this.pvPanel.add(b.Rule).data(j.subplot.hRules).left(function(a){return a.left}).width(function(a){return a.width}).bottom(function(a){return a.bottom}).lineWidth(function(a){return a.lWidth}).strokeStyle(a.chart.options.boxplotColor),this.pvPanel.add(b.Rule).data(j.subplot.vRules).left(function(a){return a.left}).height(function(a){return a.height}).bottom(function(a){return a.bottom}).lineWidth(function(a){return a.lWidth}).strokeStyle(a.chart.options.boxplotColor),this.pvPanel.add(b.Dot).data(j.subplot.marks).left(function(a){return a.left}).bottom(function(a){return a.bottom}).fillStyle(function(a){return a.color}),this.pvPanel.add(b.Label).data(j.subplot.labels).left(function(a){return a.left}).bottom(function(a){return a.bottom}).font(function(a){return a.size}).text(function(a){return a.text}).textAlign("center").textStyle(function(a){return a.color})}c.perpConnector&&(this.pvPanel.add(b.Rule).data(a.vRules).left(function(a){return a.left}).bottom(function(a){return a.bottom}).height(function(a){return a.height}).strokeStyle("black"),this.pvPanel.add(b.Rule).data(a.hRules).left(function(a){return a.left}).bottom(function(a){return a.bottom}).width(function(a){return a.width}).strokeStyle("black"))},applyExtensions:function(){this.extend(this.pvDataTree,"dataTree")}}),a.type("pvc.data.BoxplotChartTranslationOper").add({_configureTypeCore:function(){var b=[],c=[],d=[];this.collectFreeDiscreteAndConstinuousIndexes(d,c),this._getUnboundRoleDefaultDimNames("category",d.length,b),a.query(Fa.BoxplotChart.measureRolesNames).take(c.length).each(function(a){this._getUnboundRoleDefaultDimNames(a,1,b)},this),b.length&&this.defReader({names:b})}}),a.type("pvc.BoxplotPanel",Fa.CategoricalAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.boxSizeRatio=c.option("BoxSizeRatio"),this.maxBoxSize=c.option("BoxSizeMax")}).add({plotType:"box",anchor:"fill",_v1DimRoleName:{value:"median"},_createCore:function(){function b(a,b){var c=this.base(a,b);return"stroke"===b?c.darker(1):c}function c(a){return a.lock(h,function(){return this.pvMark.parent[i]()/2}).override("defaultColor",b),a}function d(a){return a.lockMark(h,function(a){return a.vars.category.boxLeft}).lockMark(i,function(a){return a.vars.category.boxWidth}),a}function e(a){return d(a),a.override("defaultColor",b),a}this.base();var f=this._buildScene(),g=this.isOrientationVertical()?"bottom":"left",h=this.anchorOrtho(g),i=this.anchorLength(g),j=this.anchorOrthoLength(g),k=["panel"];this.compatVersion()<=1&&k.push(""),this.pvBoxPanel=new Fa.visual.Panel(this,this.pvPanel,{extensionId:k}).lock("data",f.childNodes).lockMark(h,function(a){var b=a.vars.category;return b.x-b.width/2}).pvMark[i](function(a){return a.vars.category.width}),this.pvRuleWhiskerUpper=c(new Fa.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(a){return a.vars.category.showRuleWhiskerUpper&&this.delegateExtension(!0)}).pvMark.lock(g,function(a){return a.vars.category.ruleWhiskerUpperBottom}).lock(j,function(a){return a.vars.category.ruleWhiskerUpperHeight}),this.pvRuleWhiskerLower=c(new Fa.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(a){return a.vars.category.showRuleWhiskerBelow&&this.delegateExtension(!0)}).pvMark.lock(g,function(a){return a.vars.category.ruleWhiskerLowerBottom}).lock(j,function(a){return a.vars.category.ruleWhiskerLowerHeight}),this.pvBar=d(new Fa.visual.Bar(this,this.pvBoxPanel,{extensionId:"boxBar",freePosition:!0,normalStroke:!0})).intercept("visible",function(a){return a.vars.category.showBox&&this.delegateExtension(!0)}).lockMark(g,function(a){return a.vars.category.boxBottom}).lockMark(j,function(a){return a.vars.category.boxHeight}).override("defaultColor",b).override("defaultStrokeWidth",a.fun.constant(1)).pvMark,this.pvRuleMin=e(new Fa.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMin",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(a){return null!=a.vars.minimum.value&&this.delegateExtension(!0)}).pvMark.lock(g,function(a){return a.vars.minimum.position}),this.pvRuleMax=e(new Fa.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMax",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(a){return null!=a.vars.maximum.value&&this.delegateExtension(!0)}).pvMark.lock(g,function(a){return a.vars.maximum.position}),this.pvRuleMedian=e(new Fa.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMedian",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(a){return null!=a.vars.median.value&&this.delegateExtension(!0)}).lockMark(g,function(a){return a.vars.median.position}).override("defaultStrokeWidth",a.fun.constant(2)).pvMark},renderInteractive:function(){this.pvBoxPanel.render()},_buildScene:function(){function b(b){var f=new Fa.visual.Scene(g,{source:b}),m=f.vars;m.series=new Ta(null,"");var n=m.category=new Ta(b.value,b.label);a.set(n,"group",b,"x",h(b.value),"width",i,"boxWidth",j,"boxLeft",i/2-j/2),c.measureVisualRoles().forEach(function(a){var c,f=d[a.name];if(f){var g=b.dimensions(f),h=g.value(e);c=new Ta(h,g.format(h)),c.position=k(h)}else c=new Ta(null,""),c.position=null;m[a.name]=c}),l.onNewScene(f,!0);var o,p,q=null!=m.minimum.value,r=null!=m.lowerQuartil.value,s=null!=m.median.value,t=null!=m.upperQuartil.value,u=r||t;u&&(o=r?m.lowerQuartil.position:s?m.median.position:m.upperQuartil.position,p=t?m.upperQuartil.position:s?m.median.position:m.lowerQuartil.position,u=p!==o,u&&(n.boxBottom=o,n.boxHeight=p-o)),n.showBox=u,u=null!=m.maximum.value,u&&(o=t?m.upperQuartil.position:s?m.median.position:r?m.lowerQuartil.position:q?m.minimum.position:null,u=null!=o,u&&(n.ruleWhiskerUpperBottom=o,n.ruleWhiskerUpperHeight=m.maximum.position-o)),n.showRuleWhiskerUpper=u,u=q,u&&(p=r?m.lowerQuartil.position:s?m.median.position:t?m.upperQuartil.position:null,u=null!=p,u&&(o=m.minimum.position,n.ruleWhiskerLowerHeight=p-o,n.ruleWhiskerLowerBottom=o)),n.showRuleWhiskerBelow=u}var c=this.chart,d=a.query(c.measureVisualRoles()).object({name:function(a){return a.name},value:function(a){return a.firstDimensionName()}}),e={visible:!0,zeroIfNone:!1},f=this.visibleData({ignoreNulls:!1}),g=new Fa.visual.Scene(null,{panel:this,source:f}),h=this.axes.base.scale,i=h.range().band,j=Math.min(i*this.boxSizeRatio,this.maxBoxSize),k=this.axes.ortho.scale,l=new Fa.visual.RoleVarHelper(g,this.visualRoles.color,{roleVar:"color"});return f.children().each(b,this),g}}),a.type("pvc.BoxplotChart",Fa.CategoricalAbstract).add({_processOptionsCore:function(a){this.base.apply(this,arguments),a.stacked=!1},_initVisualRoles:function(){this.base();var b={isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number};[{name:"median",label:"Median",defaultDimension:"median",isRequired:!0},{name:"lowerQuartil",label:"Lower Quartil",defaultDimension:"lowerQuartil"},{name:"upperQuartil",label:"Upper Quartil",defaultDimension:"upperQuartil"},{name:"minimum",label:"Minimum",defaultDimension:"minimum"},{name:"maximum",label:"Maximum",defaultDimension:"maximum"}].forEach(function(c){this._addVisualRole(c.name,a.create(b,c))},this)},_getTranslationClass:function(b){return a.type(this.base(b)).add(Fa.data.BoxplotChartTranslationOper)},_initPlotsCore:function(){new Fa.visual.BoxPlot(this),this.options.plot2&&(this._animatable=!0,new Fa.visual.PointPlot(this,{name:"plot2",defaults:{LinesVisible:!0,DotsVisible:!0,OrthoRole:"median",ColorAxis:2},fixed:{OrthoAxis:1}}))},_initAxes:function(a){this.base(a);var b=this.axesByType.ortho;b&&b.forEach(function(a){a.option.defaults({Offset:.02})})},_createPlotPanels:function(a,b){var c=this.plots,d=c.box,e=new Fa.BoxplotPanel(this,a,d,Object.create(b));this.bpChartPanel=e;var f=c.plot2;if(f){Fa.debug>=3&&this._log("Creating Point panel.");var g=new Fa.PointPanel(this,a,f,Object.create(b));g._v1DimRoleName.value=f.option("OrthoRole")}},defaults:{crosstabMode:!1}}).addStatic({measureRolesNames:["median","lowerQuartil","upperQuartil","minimum","maximum"]}),a.type("pvc.visual.TreemapDiscreteColorAxis",Fa.visual.ColorAxis).init(function(a,b,c,d){this.base(a,b,c,d),this.isByParent="byparent"===a.plots.treemap.option("ColorMode")}).add({domainItemValueProp:function(){return this.role&&this.role.grouping.isSingleDimension?"value":"absKey"},domainGroupOperator:function(){return"select"},_calcAvgColor:function(a){var c=a.length;if(c>1){var d=0,e=0,f=0,g=0;a.forEach(function(a){var b=a.rgb();d+=b.r,e+=b.g,f+=b.b,g+=b.a});var h=Math.floor;return b.rgb(h(d/c),h(e/c),h(f/c),h(g/c))}var i=a[0];return c?i.darker(.7):i},_getBaseScheme:function(){var b=this,c=function(a){return null!=a.value},d=function(a){return a.children().where(c)},e=function(a){return d(a).any()},f=function(a){return d(a).any(e)},g=a.query(this.domainData().nodes()).where(f).array(),h=b.option("Colors");return function(c){var e=c instanceof Array?c:a.array.copy(arguments),f=a.query(g).object({name:function(a){return b.domainItemValue(a)}});a.array.removeIf(e,function(b){return a.hasOwnProp.call(f,b)});var i=h(e),j={},k=function(c){var e,g=b.domainItemValue(c);if(a.hasOwnProp.call(f,g)){if(e=a.getOwn(j,g),!e){var h=d(c).select(k).array();if(!h.length)throw a.assert("Should have at least one child that is also a parent.");e=j[g]=b._calcAvgColor(h)}}else e=i(g);return e};g.forEach(k);var l=function(b){return a.getOwn(j,b)||i(b)};a.copy(l,i);var m,n;return l.domain=function(){if(arguments.length)throw a.error.operationInvalid("The scale cannot be modified.");return m||(m=a.array.append(a.ownKeys(j),e))},l.range=function(){if(arguments.length)throw a.error.operationInvalid("The scale cannot be modified.");return n||(n=a.array.append(a.own(j),i.range()))},l}},_selectDomainItems:function(b){var c=a.query(b.nodes()),d=function(a){return null!=a.value},e=function(a){return a.children().where(d)},f=function(a){return e(a).any()},g=function(a){return!f(a)};return c.where(this.isByParent?function(a){return a.parent?d(a)&&f(a):g(a)||e(a).any(g)}:function(a){return(!a.parent||d(a))&&g(a)})}}),a.type("pvc.data.TreemapChartTranslationOper").add({_configureTypeCore:function(){var b=[],c=[],d=[];this.collectFreeDiscreteAndConstinuousIndexes(d,c);var e=d.length,f=c.length;e&&this._getUnboundRoleDefaultDimNames("category",e,b),f&&a.query(["size","color"]).take(f).each(function(a){this._getUnboundRoleDefaultDimNames(a,1,b)},this),b.length&&this.defReader({names:b})}}),a.type("pvc.TreemapPanel",Fa.PlotPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.axes.size=a._getAxis("size",(c.option("SizeAxis")||0)-1),
this.visualRoles.size=a.visualRole(c.option("SizeRole")),this.layoutMode=c.option("LayoutMode")}).add({_createCore:function(c){var d=this,e=c.clientSize,f=d._buildScene();if(f){if(!f.childNodes.length&&!this.visualRoles.multiChart.isBound())throw new InvalidDataException("Unable to create a treemap chart, please check the data values.");var g=a.number.to(d._getConstantExtension("leaf","lineWidth"),1),h=g,i=h/2,j=d.visualRoles.size.isBound()?d.axes.size.scale.by1(function(a){return a.vars.size.value}):100,k=d.pvTreemapPanel=new Fa.visual.Panel(d,d.pvPanel,{panelType:b.Layout.Treemap,extensionId:"panel"}).pvMark.lock("visible",!0).lock("nodes",f.nodes()).lock("left",i).lock("top",i).lock("width",e.width-h).lock("height",e.height-h).lock("size",j).lock("mode",d.layoutMode).lock("order",null).lock("round",!1);k.node.left(function(a){return a.x+i}).top(function(a){return a.y+i}).width(function(a){return a.dx-h}).height(function(a){return a.dy-h});var l,m=d.axes.color;l=d.visualRoles.color.isBound()?m.sceneScale({sceneVarName:"color"}):a.fun.constant(m.option("Unbound"));var n=new Fa.visual.Bar(d,k.leaf,{extensionId:"leaf"}).lockMark("visible").override("defaultColor",function(a){return l(a)}).override("defaultStrokeWidth",function(){return g}).pvMark.antialias(!1).lineCap("round").strokeDasharray(function(a){return a.vars.size.value<0?"dash":null});new Fa.visual.Bar(d,k.node,{extensionId:"ascendant",noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0}).intercept("visible",function(a){return!!a.parent&&!!a.firstChild&&this.delegateExtension(!0)}).override("anyInteraction",function(a){return a.anyInteraction()||a.isActiveDescendantOrSelf()}).override("defaultStrokeWidth",function(){return 1.5*h}).override("interactiveStrokeWidth",function(a,b){return this.showsActivity()&&a.isActiveDescendantOrSelf()&&(b=1.5*Math.max(1,b)),b}).override("defaultColor",function(a){return l(a)}).override("normalColor",a.fun.constant(null)).override("interactiveColor",function(a,c,d){if("stroke"===d){if(this.showsActivity()){if(a.isActiveDescendantOrSelf())return b.color(c).brighter(.5);if(a.anyActive())return null}if(this.showsSelection()&&a.isSelectedDescendantOrSelf())return b.color(c).brighter(.5)}return null}).pvMark.antialias(!1);var o=Fa.visual.ValueLabel.maybeCreate(d,k.label,{noAnchor:!0});o&&o.pvMark.textMargin(3).sign.optional("textAngle",function(a){var c=this.defaultText(a),d=this.pvMark;return a.dx-2*d.textMargin()>b.Text.measureWidth(c,d.font())?0:a.dx>=a.dy?0:-Math.PI/2}).override("calcTextFitInfo",function(a,c){var d=this.pvMark,e=d.textMargin();if(!(-1e-6>e)){var f=d.textAngle();if(isHorizText=Math.abs(Math.sin(f))<1e-6,isVertiText=!isHorizText&&Math.abs(Math.cos(f))<1e-6,isHorizText||isVertiText){var g,h=!1,i=b.Text.measure(c,d.font()),j=.75*i.height,k=a[isVertiText?"dx":"dy"];"middle"!==d.textBaseline()&&(k/=2),k-=2*e,h|=j>k;var g=a[isVertiText?"dy":"dx"];return"center"!==d.textAlign()&&(g/=2),g-=2*e,h|=0>=g||this.hideOverflowed&&i.width>g,{hide:h,widthMax:g}}}}).override("getAnchoredToMark",function(){return n})}},_getExtensionId:function(){var a=[{abs:this.chart.parent?"smallContent":"content"}];return a.concat(this.base())},renderInteractive:function(){this.pvTreemapPanel.render()},_buildScene:function(){var a=this.visibleData({ignoreNulls:!1});if(!a.childCount())return null;var b=this.visualRoles,c=new Fa.visual.Scene(null,{panel:this,source:a}),d=new Fa.visual.RoleVarHelper(c,b.size,{roleVar:"size",allowNestedVars:!0,hasPercentSubVar:!0}),e=b.size.isBound(),f=b.color&&b.color.grouping,g=f&&"byparent"===this.plot.option("ColorMode"),h=function(a){var b=a.group;if(a.vars.category=Ta.fromComplex(b),d.onNewScene(a,!0),e&&!a.vars.size.value)return a.parentNode&&a.parentNode.removeChild(a),a;var c=b.children().where(function(a){return null!=a.value}).array();if(f){var i=g&&!c.length?b.parent:b;if(i){var j=f.view(i);a.vars.color=new Ta(j.keyTrimmed(),j.label)}else a.vars.color=new Ta(null,"")}else a.parent||(a.vars.color=new Ta(null,""));return c.length&&c.forEach(function(b){h(new Fa.visual.Scene(a,{source:b}))}),a};return h(c)}}),a.type("pvc.TreemapChart",Fa.BaseChart).add({_animatable:!1,_axisClassByType:{size:Fa.visual.NormalizedAxis},_axisCreateIfUnbound:{color:!0},_getColorRoleSpec:function(){return{defaultSourceRole:"category",defaultDimension:"color*"}},_initVisualRoles:function(){this.base(),this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0}),this._addVisualRole("size",{isMeasure:!0,isRequired:!1,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"size"})},_getTranslationClass:function(b){return a.type(this.base(b)).add(Fa.data.TreemapChartTranslationOper)},_getIsNullDatum:a.fun.constant(),_initPlotsCore:function(){var a=new Fa.visual.TreemapPlot(this);null==this.options.legend&&(this.options.legend="byparent"===a.option("ColorMode"));var b=a.option("RootCategoryLabel");this.visualRoles.category.setRootLabel(b),this.visualRoles.color.setRootLabel(b)},_initAxes:function(b){return this.visualRoles.color.isDiscrete()?(a.hasOwnProp.call(this,"_axisClassByType")||(this._axisClassByType=Object.create(this._axisClassByType)),this._axisClassByType.color=Fa.visual.TreemapDiscreteColorAxis):delete this._axisClassByType,this.base(b)},_createContent:function(a){this.base();var b=this.plots.treemap;new Fa.TreemapPanel(this,this.basePanel,b,a)},_createVisibleData:function(a,b){return this.visualRoles.category.select(a,b)},defaults:{legend:null}}),a.type("pvc.visual.SunburstDiscreteColorAxis",Fa.visual.ColorAxis).add({_getOptionsDefinition:function(){return ib},domainItemValueProp:function(){return this.role&&this.role.grouping.isSingleDimension?"value":"absKey"},domainGroupOperator:function(){return"select"},_selectDomainItems:function(b){var c=a.query(b.nodes()),d=function(a){return null!=a.value};return c.where(function(a){return!!a.parent&&(d(a)&&!a.parent.parent)})}});var ib=a.create(eb,{SliceBrightnessFactor:{resolve:"_resolveFull",cast:Fa.castNonNegativeNumber,value:1}});return a.type("pvc.visual.SunburstSlice",Fa.visual.Sign).init(function(c,d,e){var f=d.add(b.Wedge);e=a.setDefaults(e,"freeColor",!1),this.base(c,f,e),this._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({defaultStrokeWidth:a.fun.constant(.5),interactiveStrokeWidth:function(a,b){return this.showsActivity()&&a.isActiveDescendantOrSelf()?2*Math.max(1,b):b},defaultColor:function(a){return a.color},normalColor:function(a,b,c){return b&&"stroke"===c?b.darker():b},interactiveColor:function(a,b,c){if(this.showsActivity())if("stroke"===c){if(a.isActiveDescendantOrSelf())return b.brighter(2).alpha(.7)}else if(a.isActive)return b.brighter(.2).alpha(.8);return this.mayShowNotAmongSelected(a)?this.dimColor(b,c):this.normalColor(a,b,c)}}),a.type("pvc.data.SunburstChartTranslationOper").add({_configureTypeCore:function(){var a=[],b=[],c=[];this.collectFreeDiscreteAndConstinuousIndexes(c,b);var d=c.length,e=b.length;d&&this._getUnboundRoleDefaultDimNames("category",d,a),e&&this._getUnboundRoleDefaultDimNames("size",1,a),a.length&&this.defReader({names:a})}}),a.type("pvc.SunburstPanel",Fa.PlotPanel).init(function(a,b,c,d){this.base(a,b,c,d),this.axes.size=a._getAxis("size",(c.option("SizeAxis")||0)-1),this.visualRoles.size=a.visualRole(c.option("SizeRole")),this.sliceOrder=c.option("SliceOrder"),this.emptySlicesVisible=c.option("EmptySlicesVisible"),this.emptySlicesLabel=this.emptySlicesVisible?c.option("EmptySlicesLabel"):""}).add({_createCore:function(c){var d=this._getConstantExtension("label","font");a.string.is(d)&&(this.valuesFont=d);var e=this,f=(c.clientSize,e._buildScene());if(f){if(!f.childNodes.length&&!this.visualRoles.multiChart.isBound())throw new InvalidDataException("Unable to create a sunburst chart, please check the data values.");var g=e.visualRoles.size.isBound()?e.axes.size.scale.by1(function(a){return a.vars.size.value}):a.fun.constant(100),h=e.pvSunburstPanel=new Fa.visual.Panel(e,e.pvPanel,{panelType:b.Layout.Partition.Fill,extensionId:"panel"}).pvMark.lock("visible",!0).lock("nodes",f.nodes()).lock("size",g).lock("orient","radial"),i=new Fa.visual.SunburstSlice(this,h.node,{extensionId:"slice",tooltipArgs:{options:{useCorners:!0,gravity:function(){var a=this.midAngle(),b=Math.cos(a)>=0,c=Math.sin(a)>=0;return b?c?"nw":"sw":c?"ne":"se"}}}}),j=Fa.visual.ValueLabel.maybeCreate(e,h.label,{noAnchor:!0});j&&j.override("defaultText",function(a){return a.isRoot()?"":this.base(a)}).override("calcTextFitInfo",function(a,c){var d=this.pvMark,e=d.textMargin();if(!(-1e-6>e)&&"center"===d.textAlign()&&c){var f=Fa.normAngle(a.midAngle),g=Fa.normAngle(d.textAngle()),h=Math.abs(f-g)<1e-6,i=!1;if(!h){var j=Fa.normAngle(g+Math.PI);i=Math.abs(f-j)<1e-6}if(h||i){var k,l=a.innerRadius,m=l,n=a.outerRadius,e=d.textMargin(),o=a.angle,p=b.Text.measure(c,d.font()),q=!1;if(o<Math.PI){var r=.85*p.height,s=d.textBaseline(),t="middle"===s?r+e/2:2*(r+3*e/2);m=Math.max(m,t/(2*Math.tan(o/2)))}return k=n-e-m,q|=0>=k,k-=e,q|=this.hideOverflowed&&p.width>k,{hide:q,widthMax:k}}}}).override("getAnchoredToMark",function(){return i.pvMark})}},_getExtensionId:function(){var a=[{abs:this.chart.parent?"smallContent":"content"}];return a.concat(this.base())},renderInteractive:function(){this.pvSunburstPanel.render()},_buildScene:function(){var b=this.visibleData({ignoreNulls:!1}),c=this.emptySlicesVisible,d=this.emptySlicesLabel;if(!b.childCount())return null;var e,f=this.visualRoles,g=new Fa.visual.SunburstScene(null,{panel:this,source:b}),h=f.size.isBound(),i=new Fa.visual.RoleVarHelper(g,f.size,{roleVar:"size",allowNestedVars:!0,hasPercentSubVar:!0}),j=f.color&&f.color.grouping,k=this.axes.color,l=k.option("SliceBrightnessFactor");e=f.color.isBound()?k.sceneScale({sceneVarName:"color"}):a.fun.constant(k.option("Unbound"));var m=function(a){var b=a.group,e=a.vars.category=Ta.fromComplex(b);if(d&&null==e.value&&(e.value=d),i.onNewScene(a,!0),h&&!a.vars.size.value)return a.parentNode&&a.parentNode.removeChild(a),a;var f=b.children();if(c||(f=f.where(function(a){return null!=a.value})),j){var g=j.view(b);a.vars.color=new Ta(g.keyTrimmed(),g.label)}else a.vars.color=new Ta(null,"");return f.each(function(b){m(new Fa.visual.SunburstScene(a,{source:b}))}),a},n=function(a,b,c){var d=null,f=a.parent;f&&(d=e(a),f.isRoot()||d.isFixedColor||(d=f.color,b&&l&&(d=d.brighter(l*b/(c-1))))),a.color=d;var g=a.childNodes,h=g.length;g.forEach(function(a,b){n(a,b,h)})};if(m(g),this.sliceOrder&&h&&"none"!==this.sliceOrder){var o="bysizeascending"===this.sliceOrder?a.ascending:a.descending;g.sort(function(b,c){return o(b.vars.size.value,c.vars.size.value)||a.ascending(b.childIndex(),c.childIndex())})}return n(g,0),g}}),a.type("pvc.visual.SunburstScene",Fa.visual.Scene).add({_createSelectedInfo:function(){var a=this.chart().data.owner.selectedCount()>0,b=a&&this.datums().all(Ra);return{any:a,is:b}}}),a.type("pvc.SunburstChart",Fa.BaseChart).add({_animatable:!1,_axisClassByType:{size:Fa.visual.NormalizedAxis},_axisCreateIfUnbound:{color:!0},_getColorRoleSpec:function(){return{defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:!0}},_initVisualRoles:function(){this.base(),this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0}),this._addVisualRole("size",{isMeasure:!0,isRequired:!1,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"size"})},_getTranslationClass:function(b){return a.type(this.base(b)).add(Fa.data.SunburstChartTranslationOper)},_getIsNullDatum:a.fun.constant(),_initPlotsCore:function(){var a=new Fa.visual.SunburstPlot(this);this.options.legend=!1;var b=a.option("RootCategoryLabel");this.visualRoles.category.setRootLabel(b),this.visualRoles.color.setRootLabel(b)},_initAxes:function(b){return a.hasOwnProp.call(this,"_axisClassByType")||(this._axisClassByType=Object.create(this._axisClassByType)),this._axisClassByType.color=Fa.visual.SunburstDiscreteColorAxis,this.base(b)},_createContent:function(a){this.base();var b=this.plots.sunburst;new Fa.SunburstPanel(this,this.basePanel,b,a)},_createVisibleData:function(a,b){return this.visualRoles.category.select(a,b)}}),Fa}(def,pv);